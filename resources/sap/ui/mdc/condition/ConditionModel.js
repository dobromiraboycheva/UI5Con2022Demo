/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/condition/ConditionModelPropertyBinding","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/ChangeReason","sap/ui/mdc/condition/FilterOperatorUtil","sap/base/util/merge","sap/base/util/deepEqual","sap/base/Log","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/FilterConverter"],function(t,e,i,n,o,r,s,a,d,p){"use strict";var h=e.extend("sap.ui.mdc.condition.ConditionModel",{constructor:function(){e.apply(this,arguments);this.setSizeLimit(1e3);if(!this.getProperty("/conditions")){this.setProperty("/conditions",{})}if(!this.getProperty("/fieldPath")){this.setProperty("/fieldPath",{})}}});h.prototype.bindProperty=function(e,i,n){var o=e;if(e.startsWith("/conditions/")){var r=e.slice(12);this._getFieldPathProperty(r);r=l.call(this,r);o="/conditions/"+r}var s=new t(this,o,i,n);s._sOriginapPath=e;return s};h.prototype.getContext=function(t){if(t.startsWith("/conditions/")){var i=t.slice(12);i=l.call(this,i);t="/conditions/"+i}return e.prototype.getContext.apply(this,[t])};h.prototype.bindList=function(t,i,n,o,r){var s=e.prototype.bindList.apply(this,arguments);s.enableExtendedChangeDetection(true);return s};h.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments)};h.prototype.clone=function(t){var e=new h;e._sName=this._sName+"_clone";var i={};if(typeof t==="string"){var n=this.getConditions(t);for(var o=0;o<n.length;o++){var s=n[o];var a=l.call(this,t);if(!i[a]){i[a]=[]}i[a].push(r({},s))}}else{i=r({},this.getAllConditions())}e.setConditions(i);return e};h.prototype.merge=function(t,e,i){this.removeAllConditions(t);var n=r({},e.getAllConditions());for(var o in n){if(!(typeof i==="string")||o===i){var s=d._removeEmptyConditions(n[o]);for(var a=0;a<s.length;a++){var p=s[a];this.addCondition(o,p)}}}this.checkUpdate(true,true)};h.prototype.getConditions=function(t){return f.call(this,t)};function f(t,e){var i=this.getProperty("/conditions");var n;if(typeof t=="string"){t=l.call(this,t);if(!i[t]&&e){i[t]=[]}n=i[t]||[]}else{throw new Error("ConditionModel","getConditions without FieldPath is not supported!")}return n}h.prototype.getAllConditions=function(t){var e=this.getProperty("/conditions");var i={};for(var n in e){var o=this.getProperty("/fieldPath");var s=o[n];var a=s?s.fieldPath:n;if(t&&[].concat(t).indexOf(a)===-1){continue}i[a]=r([],e[n])}return i};h.prototype.indexOf=function(t,e,i){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}var n=this.getConditions(t);var r=i?[i(e),n.map(i)]:[e,n];var s=o.indexOfCondition.apply(o,r);return s};h.prototype.exist=function(t,e){if(typeof e==="string"){return this.indexOf(e,t)>=0}else{throw new Error("sFieldPath must be provided "+this)}};h.prototype.setConditions=function(t){var e=0;var i;this.setProperty("/conditions",{},undefined,true);if(Array.isArray(t)){throw new Error("setConditions with an Array of condition is not supported! "+this)}else{this._bNoSingleEvent=true;for(var o in t){this._getFieldPathProperty(o);for(e=0;e<t[o].length;e++){i=t[o][e];this.insertCondition(o,-1,i,true)}this.firePropertyChange({reason:n.Add,path:"/conditions/"+o,context:undefined,value:t[o]})}this.checkUpdate(true,true);this._bNoSingleEvent=false}return this};h.prototype.addCondition=function(t,e,i){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}return this.insertCondition(t,-1,e,i)};h.prototype.insertCondition=function(t,e,i,r){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}if(!i){return this}var s;o.checkConditionsEmpty(i);o.updateConditionsValues(i);this._getFieldPathProperty(t);if(!r){var a=this.indexOf(t,i);if(a>=0){return this}}s=f.call(this,t,true);if(e==-1){s.push(i)}else{s.splice(e,0,i)}if(!this._bNoSingleEvent){this.checkUpdate(true,true);this.firePropertyChange({reason:n.Add,path:"/conditions/"+t,context:undefined,value:s})}return this};h.prototype.createItemCondition=function(t,e,i){a.error("ConditionModel","createItemCondition is deprecated");return d.createItemCondition(e,i)};h.prototype.createCondition=function(t,e,i){a.error("ConditionModel","createCondition is deprecated");return d.createCondition(e,i)};h.prototype.removeCondition=function(t,e){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}var i=-1;if(typeof e==="object"){i=this.indexOf(t,e)}else if(typeof e==="number"){i=e}if(i>=0){var o=this.getConditions(t);if(o.length>i){o.splice(i,1);this.checkUpdate(true,true);this.firePropertyChange({reason:n.Remove,path:"/conditions/"+t,context:undefined,value:o});return true}}return false};h.prototype.removeAllConditions=function(t){var e=this.getProperty("/conditions");if(typeof t==="string"){var i=l.call(this,t);if(e[i]&&e[i].length>0){e[i]=[];this.firePropertyChange({reason:n.Remove,path:"/conditions/"+t,context:undefined,value:e[t]})}}else{for(var o in e){if(e[o]&&e[o].length>0){e[o]=[];var r=this.getProperty("/fieldPath");var s=r[o].fieldPath;this.firePropertyChange({reason:n.Remove,path:"/conditions/"+s,context:undefined,value:e[o]})}}}this.checkUpdate(true,true);return this};h.prototype._getFieldPathProperty=function(t){var e=l.call(this,t);var i=this.getProperty("/fieldPath");if(!i[e]){i[e]={fieldPath:t}}var n=this.getProperty("/conditions");if(!n[e]){n[e]=[]}return i[e]};h.prototype.getFilters=function(t){a.error("ConditionModel","usage or deprecated getFilters() function! Please use the FilterConverter.createFilters() function instead.");return p.createFilters(this.getAllConditions(),{})};h.prototype.serialize=function(){var t=r({},this.getAllConditions());for(var e in t){var i=t[e];i.forEach(function(t){delete t.isEmpty},this);if(i.length===0){delete t[e]}}return'{"conditions":'+JSON.stringify(t)+"}"};h.prototype.parse=function(t){var e=function(t,e){var i;if(!isNaN(parseInt(t))&&typeof e==="string"){i=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).(\d{3})Z$/.exec(e);if(i){return new Date(e)}}return e};this.setConditions(JSON.parse(t,e).conditions)};function l(t){if(t){var e=t.split("/");if(e.length>1){t="";for(var i=0;i<e.length;i++){var n=e[i];if(i>0){if(!isNaN(n)||!isNaN(e[i-1])){t=t+"/"}else{t=t+"\\"}}t=t+n}}}return t}return h});