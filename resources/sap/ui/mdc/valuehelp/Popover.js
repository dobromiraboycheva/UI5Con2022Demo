/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/valuehelp/base/Container","sap/ui/mdc/util/loadModules","sap/ui/dom/units/Rem","sap/ui/thirdparty/jquery"],function(t,e,n,o){"use strict";var i,r,a,s;var p=t.extend("sap.ui.mdc.valuehelp.Popover",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContainer","sap.ui.mdc.valuehelp.IDialogContainer"],properties:{},defaultAggregation:"content"}});p.prototype.invalidate=function(e){if(e){var n=this.getAggregation("_container");var o=this._oCurrentContent;if(n&&o&&e===o&&!this._bIsBeingDestroyed){n.invalidate(e)}else{t.prototype.invalidate.apply(this,arguments)}}};p.prototype._getUIAreaForContent=function(){var e=this.getAggregation("_container");if(e){return e.getUIArea()}return t.prototype._getUIAreaForContent.apply(this,arguments)};p.prototype._getContent=function(){var t=this.getContent();return t&&t[0]};p.prototype._getContainer=function(){var t=this.getAggregation("_container");if(!t){return e(["sap/m/Popover","sap/m/library","sap/m/Toolbar","sap/m/ToolbarSpacer"]).then(function(e){i=e[0];r=e[1];a=e[2];s=e[3];t=new i(this.getId()+"-pop",{contentHeight:"auto",placement:r.PlacementType.VerticalPreferredBottom,showHeader:false,showArrow:false,title:this.getTitle(),titleAlignment:r.TitleAlignment.Center,afterOpen:this._handleOpened.bind(this),afterClose:this._handleClosed.bind(this)}).addStyleClass("sapMdcValueHelpPopover").addStyleClass("sapMComboBoxBasePicker").addStyleClass("sapMComboBoxBasePicker-CTX");t.addStyleClass(this._isSingleSelect()?"sapMdcValueHelpSingleSelect":"sapMdcValueHelpMultiSelect");t.addDelegate({onsapshow:this._handleRequestSwitchToDialog.bind(this)});t._getAllContent=function(){var t=this.getParent();var e=[];if(t){if(this._oCurrentContent){e.push(this._oCurrentContent)}}return e}.bind(this);var n=this._getContent();var o=this._getContainerConfig(n);if(o){t.setShowArrow(!!o.showArrow);t.setShowHeader(!!o.showHeader);t.setResizable(!!o.resizable);if(o.getContentWidth){t.setContentWidth(o.getContentWidth())}}this.setAggregation("_container",t,true);return t}.bind(this))}return t};var l=function(){var t=this.getAggregation("_container");var e=this._getContent();var o=e&&this._getContainerConfig(e);if(t&&o&&o.getContentHeight){var i=o.getContentHeight();var r=t.$().find(".sapMPopoverCont").height();var a=r<n.toPx("30rem");t.setContentHeight(!i||a||r>=i?"auto":"30rem");t.invalidate()}};p.prototype.providesScrolling=function(){return true};p.prototype._observeChanges=function(e){if(e.name==="content"){var n=e.child;if(e.mutation==="remove"){n.detachEvent("contentUpdated",l,this);n.detachNavigated(this._handleNavigated,this)}else{n.attachEvent("contentUpdated",l,this)}}t.prototype._observeChanges.apply(this,arguments)};p.prototype._placeContent=function(t){var e=this._getContent();var n=e&&e.getContent();var o=e&&e.onBeforeShow();var i=this._getContainerConfig(e);var r=i&&i.getFooter&&i.getFooter();return Promise.all([n,r,o]).then(function(e){this._oCurrentContent=e[0];var n=e[1];if(n&&t.getFooter()!=n&&n.isA&&n.isA("sap.m.Toolbar")){t.setFooter(n);return t}if(n){if(!t.getFooter()){var o=[new s(this.getId()+"-Spacer")].concat(n);var i=new a(this.getId()+"-TB",{content:o}).setModel(this._oManagedObjectModel,"$help");t.setFooter(i)}else{}}else if(t.getFooter()){t.setFooter()}return t}.bind(this))};p.prototype._open=function(t){if(t.isOpen()){return}var e=this._getControl();var n=e&&e.getFocusElementForValueHelp?e.getFocusElementForValueHelp(this.isTypeahead()):e;if(n&&n.getDomRef()){t.setContentMinWidth(o(n.getDomRef()).outerWidth()+"px");if(!this.isFocusInHelp()){t.setInitialFocus(n)}t.openBy(n)}};p.prototype._close=function(){var t=this.getAggregation("_container");if(t){t.close()}};p.prototype._handleOpened=function(){l.call(this);t.prototype._handleOpened.apply(this,arguments);var e=this._getContent();if(e){e.onShow()}};p.prototype._handleConfirmed=function(t){this.fireConfirm({close:t.getParameter("close")||this._isSingleSelect()})};p.prototype._handleClosed=function(e){var n=this._getContent();if(n){n.onHide()}var o=this.getAggregation("_container");if(o){o._oPreviousFocus=null}t.prototype._handleClosed.apply(this,arguments)};p.prototype.removeFocus=function(){var t=this._getContent();if(t){t.removeFocus()}};p.prototype._navigate=function(t){var e=this._getContent();if(e){return e.navigate(t)}};p.prototype.getItemForValue=function(t){var e=this._getContent();if(e){return e.getItemForValue(t)}};p.prototype.isValidationSupported=function(t){var e=this._getContent();if(e){return e.isValidationSupported()}};p.prototype.getUseAsValueHelp=function(){var t=this._getContent();return t&&t.getUseAsValueHelp&&t.getUseAsValueHelp()};p.prototype.getValueHelpIcon=function(){var t=this._getContent();return t&&t.getValueHelpIcon()};p.prototype.getAriaAttributes=function(e){var n=this._getContent();var o=n&&n.getAriaAttributes(e);if(o){return{contentId:o.contentId,ariaHasPopup:o.ariaHasPopup,role:this.getUseAsValueHelp()?"combobox":null,roleDescription:o.roleDescription}}return t.prototype.getAriaAttributes.apply(this,arguments)};p.prototype.shouldOpenOnClick=function(){var t=this._getContent();return!!t&&t.shouldOpenOnClick()};p.prototype.shouldOpenOnNavigate=function(){var t=this._getContent();return!!t&&t.shouldOpenOnNavigate()};p.prototype.isFocusInHelp=function(){var t=this._getContent();return!!t&&t.isFocusInHelp()};p.prototype.isMultiSelect=function(){var t=this._getContent();return!!t&&t.isMultiSelect()};p.prototype.isTypeaheadSupported=function(){var t=this._getContent();return t&&t.isSearchSupported()};p.prototype.exit=function(){if(this._oCurrentContent){if(!this._oCurrentContent.bIsDestroyed){this._oCurrentContent.destroy()}this._oCurrentContent=null}};return p});