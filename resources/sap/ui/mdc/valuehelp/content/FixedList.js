/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/valuehelp/base/ListContent","sap/ui/mdc/util/loadModules","sap/ui/mdc/enum/ConditionValidated","sap/ui/mdc/enum/SelectType","sap/ui/model/ParseException"],function(e,t,i,a,r){"use strict";var s=e.extend("sap.ui.mdc.valuehelp.content.FixedList",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContent","sap.ui.mdc.valuehelp.IDialogContent"],properties:{groupable:{type:"boolean",group:"Appearance",defaultValue:false},filterList:{type:"boolean",group:"Appearance",defaultValue:true}},aggregations:{items:{type:"sap.ui.mdc.field.ListFieldHelpItem",multiple:true,singularName:"item"}},defaultAggregation:"items",events:{}}});s.prototype.init=function(){e.prototype.init.apply(this,arguments);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")};s.prototype.exit=function(){if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel}e.prototype.exit.apply(this,arguments)};s.prototype.getContent=function(){return this._retrievePromise("content",function(){return t(["sap/m/List","sap/m/DisplayListItem","sap/m/library","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/base/ManagedObjectModel","sap/base/strings/whitespaceReplacer"]).then(function(e){var t=e[0];var i=e[1];var a=e[2];var r=e[3];var s=e[4];var n=e[5];var o=e[6];this._oManagedObjectModel=new n(this);var p=new i(this.getId()+"-item",{type:a.ListType.Active,label:{path:"$help>text",formatter:o},value:{path:"$help>additionalText",formatter:o},valueTextDirection:"{$help>textDirection}"}).addStyleClass("sapMComboBoxNonInteractiveItem");var c=new r({path:"text",test:u.bind(this),caseSensitive:true});var h;if(this.getGroupable()){h=new s("groupKey",false,d.bind(this))}var f=new t(this.getId()+"-List",{width:"100%",showNoData:false,mode:a.ListMode.SingleSelectMaster,rememberSelections:false,items:{path:"$help>/items",template:p,filters:c,sorter:h,templateShareable:false},itemPress:l.bind(this)}).addStyleClass("sapMComboBoxBaseList").addStyleClass("sapMComboBoxList");f.setModel(this._oManagedObjectModel,"$help");this.setAggregation("displayContent",f,true);return f}.bind(this))}.bind(this))};function n(){return this.getAggregation("displayContent")}function l(e){var t=e.getParameter("listItem");var i=t.getSelected();if(i){var r=f.call(this,t);var s=g.call(this,r);o.call(this,s,t.getLabel());this.fireSelect({type:a.Set,conditions:this.getConditions()});this.fireConfirm()}}function o(e,t){var i=this._createCondition(e,t);this.setProperty("conditions",[i],true);return i}function u(e){var t=this.getFilterList();return!t||p.call(this,e,this.getFilterValue())}function p(e,t){return!t||typeof t==="string"&&(this.getCaseSensitive()?e.startsWith(t):e.toLowerCase().startsWith(t.toLowerCase()))}function c(){var e=n.call(this);if(e){var t=e.getBinding("items");t.update();e.updateItems();e.invalidate();h.call(this)}}function d(e){var t=e.getProperty("groupKey");var i=e.getProperty("groupText");return{key:t,text:i}}function h(){var e=n.call(this);if(e){var t=this.getConditions();var a;var r=this.getFilterValue();var s=this.getUseFirstMatch();var l=false;if(t.length>0&&(t[0].validated===i.Validated||t[0].operator==="EQ")){a=t[0].values[0]}var o=e.getItems();for(var u=0;u<o.length;u++){var c=o[u];if(c.isA("sap.m.DisplayListItem")){var d=f.call(this,c);if(t.length>0&&g.call(this,d)===a){c.setSelected(true)}else if(t.length===0&&s&&r&&!l&&p.call(this,c.getLabel(),r)){c.setSelected(true);l=true}else if(this.hasOwnProperty("_iNavigateIndex")&&u===this._iNavigateIndex){c.setSelected(true)}else{c.setSelected(false)}}}}}function f(e){var t=e.getBindingContextPath();return this._oManagedObjectModel.getProperty(t)}function g(e){var t=e.getBinding("key");if(t){return t.getInternalValue()}else{return e.getKey()}}s.prototype.getItemForValue=function(e){return Promise.resolve().then(function(){if(e.value===null||e.value===undefined){return null}else if(!e.value&&e.checkDescription){return null}var t=this.getItems();var i;var a=0;var s;var n;for(a=0;a<t.length;a++){i=t[a];s=g.call(this,i);n=i.getText();if(e.checkKey&&s===e.parsedValue||e.checkDescription&&(n===e.value||s==e.value)){return{key:s,description:i.getText()}}}if(e.checkKey&&e.value===""){return null}if(this.getUseFirstMatch()){for(a=0;a<t.length;a++){i=t[a];n=e.checkDescription?i.getText():i.getKey();if(p.call(this,n,e.value)){s=g.call(this,i);return{key:s,description:i.getText()}}}}var l=this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[e.value]);var o=e.exception||r;throw new o(l)}.bind(this))};s.prototype.isValidationSupported=function(e){return true};s.prototype.isSearchSupported=function(){return true};s.prototype._handleConditionsUpdate=function(e){h.call(this)};s.prototype._handleFilterValueUpdate=function(e){c.call(this)};s.prototype.removeFocus=function(){var e=n.call(this);if(e){e.removeStyleClass("sapMListFocus")}};s.prototype.navigate=function(e){var t=n.call(this);if(!t){return}t.addStyleClass("sapMListFocus");var i=t.getSelectedItem();var a=t.getItems();var r=a.length;var s=0;var l=this.getFilterList();var u=this.getFilterValue();var c=false;if(!l&&!i){var d=0;if(e>=0){for(d=0;d<a.length;d++){if(!a[d].isA("sap.m.GroupHeaderListItem")&&p.call(this,a[d].getLabel(),u)){s=d;break}}}else{for(d=a.length-1;d>=0;d--){if(!a[d].isA("sap.m.GroupHeaderListItem")&&p.call(this,a[d].getLabel(),u)){s=d;break}}}}else if(i){s=t.indexOfItem(i);s=s+e}else if(e>=0){s=e-1}else{s=r+e}var h;if(s<0){s=0;h=true;c=true}else if(s>=r-1){s=r-1;h=false}else{h=e>=0}while(a[s]&&a[s].isA("sap.m.GroupHeaderListItem")){if(h){s++}else{s--}}if(s<0||s>r-1){h=!h;c=s<0;s=s<0?0:r-1;while(a[s]&&a[s].isA("sap.m.GroupHeaderListItem")){if(h){s++}else{s--}}}var v=a[s];if(v){var m=this.getUseFirstMatch();if(v!==i||m&&!c){var y=f.call(this,v);var I=g.call(this,y);var b=y.getText();if(this.getParent().isOpen()){t.scrollToIndex(s)}else{this._iNavigateIndex=s}v.setSelected(true);var x=o.call(this,I,b);this.fireNavigated({condition:x,itemId:v.getId(),leaveFocus:false})}else if(c){this.fireNavigated({condition:undefined,itemId:undefined,leaveFocus:c})}}};s.prototype.onShow=function(){e.prototype.onShow.apply(this,arguments);var t=n.call(this);if(!t){return}var i=t.getSelectedItem();if(i){var a=t.indexOfItem(i);t.scrollToIndex(a)}if(this.hasOwnProperty("_iNavigateIndex")){delete this._iNavigateIndex}};s.prototype.onHide=function(){this.removeFocus()};s.prototype.getValueHelpIcon=function(){if(this.getUseAsValueHelp()){return"sap-icon://slim-arrow-down"}else{return null}};s.prototype.getAriaAttributes=function(e){return{contentId:this.getId()+"-List",ariaHasPopup:"listbox",roleDescription:null}};s.prototype.shouldOpenOnClick=function(){return!this.getFilterList()};s.prototype.isFocusInHelp=function(){return false};s.prototype._isSingleSelect=function(e){return true};s.prototype.shouldOpenOnNavigate=function(){return!e.prototype._isSingleSelect.apply(this)};return s});