/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/base/DataType","sap/base/util/merge","sap/base/util/isPlainObject","sap/base/Log"],function(e,t,r,o,n){"use strict";var i={name:{type:"string",mandatory:true,allowedForComplexProperty:true},label:{type:"string",mandatory:true,allowedForComplexProperty:true},visible:{type:"boolean",default:{value:true},allowedForComplexProperty:true},path:{type:"string",valueForComplexProperty:null},typeConfig:{type:{className:{type:"string"},baseType:{type:"string"},typeInstance:{type:"object"}},valueForComplexProperty:null},maxConditions:{type:"int",default:{value:-1},valueForComplexProperty:null},caseSensitive:{type:"boolean",default:{value:true}},group:{type:"string",allowedForComplexProperty:true},groupLabel:{type:"string",allowedForComplexProperty:true},filterable:{type:"boolean",default:{value:true},valueForComplexProperty:false},sortable:{type:"boolean",default:{value:true},valueForComplexProperty:false},key:{type:"boolean",valueForComplexProperty:false},groupable:{type:"boolean",valueForComplexProperty:false},propertyInfos:{type:"PropertyReference[]",allowedForComplexProperty:true},unit:{type:"PropertyReference"},text:{type:"PropertyReference"},exportSettings:{type:"object",default:{value:{},ignoreIfNull:true},allowedForComplexProperty:true},visualSettings:{type:{widthCalculation:{type:{minWidth:{type:"int",default:{value:2}},maxWidth:{type:"int",default:{value:19}},defaultWidth:{type:"int",default:{value:8}},gap:{type:"float",default:{value:0}},includeLabel:{type:"boolean",default:{value:true}},verticalArrangement:{type:"boolean",default:{value:false}},excludeProperties:{type:"PropertyReference[]"}},default:{value:{},ignoreIfNull:true}}},default:{value:{}},allowedForComplexProperty:true},required:{type:"boolean"},hiddenFilter:{type:"boolean"}};var a={isComplex:function(){return F.isPropertyComplex(this)},getReferencedProperties:function(){return this.propertyInfosProperties||[]},getSortableProperties:function(){return C(this,function(e){return e.sortable})},getFilterableProperties:function(){return C(this,function(e){return e.filterable})},getGroupableProperties:function(){return C(this,function(e){return e.groupable})},getVisibleProperties:function(){return C(this,function(e){return e.visible})}};var p=["name","label","visible","path","typeConfig","maxConditions","group","groupLabel","caseSensitive"];var l=new WeakMap;function u(e){return JSON.stringify(e,function(e,t){return t===undefined?null:t})||""}function s(e,t){var r=u(t);n.warning("Invalid property definition: "+e+(r?"\n"+r:""))}function f(e,t){var r=t?u(t):null;throw new Error("Invalid property definition: "+e+(r?"\n"+r:""))}function y(e,t){t.map(function(e){Object.keys(a).forEach(function(t){Object.defineProperty(e,t,{value:function(){return a[t].call(this)},writable:true})})})}function c(e){var t=Object.getOwnPropertyNames(e);Object.freeze(e);for(var r=0;r<t.length;r++){var n=e[t[r]];if(typeof n==="function"){Object.freeze(n)}else if(o(n)&&!Object.isFrozen(n)){c(n)}else if(Array.isArray(n)){c(n)}}}function d(e,t){if(!t){return e}return t.split(".").reduce(function(e,t){return e&&e[t]?e[t]:null},e)}function b(e){var r;if(typeof e==="object"){r="object"}else{r=e.replace("PropertyReference","string")}return t.getType(r)}function v(e){var t=b(e);if(t.isArrayType()){return t.getBaseType().getDefaultValue()}else{return t.getDefaultValue()}}function P(e,t){t.forEach(function(t){e.prepareProperty(t)});c(t)}function g(e,t,r,o,n,i){var a=o==null;var p=[];var u=F.isPropertyComplex(t);if(a){i=l.get(e).mAttributeMetadata;n=t}if(!n){return[]}for(var s in i){var f=i[s];var y=a?s:o+"."+s;var c=n[s];if(u&&!f.allowedForComplexProperty){if("valueForComplexProperty"in f){n[s]=f.valueForComplexProperty}continue}if(c!=null&&typeof f.type==="string"&&f.type.startsWith("PropertyReference")||y==="propertyInfos"){if(u||y!=="propertyInfos"){m(n,s,r)}continue}if(c==null){h(n,f,o,s,p,c)}if(typeof f.type==="object"){p=p.concat(g(e,t,r,y,n[s],f.type))}}return p}function m(e,t,r){var o=e[t];var n;var i=t;if(Array.isArray(o)){n=o.map(function(e){return r[e]});i+="Properties"}else{n=r[o];i+="Property"}Object.defineProperty(e,i,{value:n})}function h(e,t,o,n,i,a){if("default"in t){var p=t.default;if(a===null&&p.ignoreIfNull&&p.value!==undefined){return}if(p.value===undefined){e[n]=v(t.type)}else if(typeof p.value==="string"&&p.value.startsWith("attribute:")){i.push({source:p.value.substring(p.value.indexOf(":")+1),targetPath:o,targetAttribute:n,targetType:t.type})}else if(typeof p.value==="object"){e[n]=r({},p.value)}else{e[n]=p.value}}else{e[n]=v(t.type)}}function x(e){return Object.freeze(e.reduce(function(e,t){e[t.name]=t;return e},{}))}function C(e,t){if(e.isComplex()){return e.getReferencedProperties().filter(t)}else if(t(e)){return[e]}else{return[]}}function w(e,t,r){for(var o in e){var n=e[o];var i=t==null?o:t+"."+o;if(t==="extension"){w(n.type,i);continue}if(r&&n.allowedForComplexProperty!==false){n.allowedForComplexProperty=true}if(typeof n.type==="object"){w(n.type,i,n.allowedForComplexProperty)}}}function A(e,t){var r=0;t=t||{};for(var o=0;o<e.length;o++){if("extension"in e[o]){f("Property contains invalid attribute 'extension'.",e[o])}if(e[o].name in t){e[o].extension=t[e[o].name];r++}else{e[o].extension={}}}if(r!==Object.keys(t).length){throw new Error("At least one property extension does not point to an existing property.")}}function j(e,t,o,n,a,u){var s={};var f=p.concat(a||[]).reduce(function(e,t){if(t in i){e[t]=i[t]}return e},Object.assign({},e._mExperimentalAdditionalAttributes));if(u){s.mAttributeMetadata=Object.assign({extension:{type:u,mandatory:true,allowedForComplexProperty:true}},f);s.aMandatoryExtensionAttributes=Object.keys(u).filter(function(e){return u[e].mandatory})}else{s.mAttributeMetadata=f;s.aMandatoryExtensionAttributes=[]}w(s.mAttributeMetadata);s.aMandatoryAttributes=Object.keys(s.mAttributeMetadata).filter(function(e){return s.mAttributeMetadata[e].mandatory});var c=r([],o);var d=x(c);if(u){A(c,r({},n))}var b=l.get(e);var v=b&&b.aRawProperties;l.set(e,s);e.validateProperties(c,v);s.oParent=t||null;s.aRawProperties=o;s.aProperties=c;s.mProperties=d;s._={mExtensions:n,aAllowedAttributes:a,mExtensionAttributeMetadata:u};y(e,c);P(e,c)}var F=e.extend("sap.ui.mdc.util.PropertyHelper",{constructor:function(t,r,n,a,p){e.call(this);if(!Array.isArray(t)){f("Property infos must be an array.")}if(r){if(!p){throw new Error("Property extensions are not supported.")}else if(!o(r)){throw new Error("Property extensions must be a plain object.")}}if(n&&!e.isA(n,"sap.ui.base.ManagedObject")){throw new Error("The type of the parent is invalid.")}if(this._mExperimentalAdditionalAttributes){Object.keys(i).concat("extension").forEach(function(e){if(e in this._mExperimentalAdditionalAttributes){throw new Error("The attribute '"+e+"' is reserved and cannot be overridden by additional attributes.")}}.bind(this))}j(this,n,t,r,a,p)}});F.prototype.validateProperties=function(e,t){var r=new Set;for(var o=0;o<e.length;o++){this.validateProperty(e[o],e,t);r.add(e[o].name)}if(r.size!==e.length){f("Properties do not have unique names.")}};F.prototype.validateProperty=function(e,t,r){if(!o(e)){f("Property info must be a plain object.",e)}E(this,e,t);if(F.isPropertyComplex(e)){if(e.propertyInfos.length===0){f("Complex property does not reference existing properties.",e)}}l.get(this).aMandatoryAttributes.forEach(function(t){if(!(t in e)){s("Property does not contain mandatory attribute '"+t+"'.",e)}else if(e[t]==null){f("Property does not contain mandatory attribute '"+t+"'.",e)}});l.get(this).aMandatoryExtensionAttributes.forEach(function(t){if(!(t in e.extension)){s("Property does not contain mandatory attribute 'extension."+t+"'.",e)}else if(e.extension[t]==null){f("Property does not contain mandatory attribute 'extension."+t+"'.",e)}})};function E(e,t,r,o,n,i){var a=o==null;if(a){i=l.get(e).mAttributeMetadata;n=t}for(var p in n){var u=i[p];var y=a?p:o+"."+p;var c=n[p];if(!u){s("Property contains invalid attribute '"+y+"'.",t)}else if(F.isPropertyComplex(t)&&!u.allowedForComplexProperty){s("Complex property contains invalid attribute '"+y+"'.",t)}else if(typeof u.type==="object"&&c&&typeof c==="object"){E(e,t,r,y,c,u.type)}else if(c!=null&&!b(u.type).isValid(c)){f("The value of '"+y+"' is invalid.",t)}else if(c&&typeof u.type==="string"&&u.type.startsWith("PropertyReference")){O(e,t,r,y,c,u)}}}function O(e,t,r,o,n,i){var a=i.type.endsWith("[]")?n:[n];var p=new Set(a);if(a.indexOf(t.name)>-1){f("Property references itself in the '"+o+"' attribute",t)}if(p.size!==a.length){f("Property contains duplicate names in the '"+o+"' attribute.",t)}for(var l=0;l<r.length;l++){if(p.has(r[l].name)){if(F.isPropertyComplex(r[l])){f("Property references complex properties in the '"+o+"' attribute.",t)}p.delete(r[l].name)}}if(p.size>0){f("Property references non-existing properties in the '"+o+"' attribute.",t)}}F.prototype.prepareProperty=function(e){var t=this.getPropertyMap();var r=g(this,e,t);r.forEach(function(r){var o=d(e,r.targetPath);if(o){var n=d(e,r.source);if(n==null){n=v(r.targetType)}o[r.targetAttribute]=n;if(typeof r.targetType==="string"&&r.targetType.startsWith("PropertyReference")){m(o,r.targetAttribute,t)}}})};F.prototype.getParent=function(){var e=l.get(this);return e?e.oParent:null};F.prototype.setProperties=function(e){var t=l.get(this);j(this,t.oParent,e,t._.mExtensions,t._.aAllowedAttributes,t._.mExtensionAttributeMetadata);return this};F.prototype.getProperties=function(){var e=l.get(this);return e?e.aProperties:[]};F.prototype.getPropertyMap=function(){var e=l.get(this);return e?e.mProperties:{}};F.prototype.getProperty=function(e){return this.getPropertyMap()[e]||null};F.prototype.hasProperty=function(e){return e in this.getPropertyMap()};F.isPropertyComplex=function(e){return e!=null&&typeof e==="object"?"propertyInfos"in e:false};F.prototype.getSortableProperties=function(){return this.getProperties().filter(function(e){return e.sortable})};F.prototype.getFilterableProperties=function(){return this.getProperties().filter(function(e){return e.filterable})};F.prototype.getGroupableProperties=function(){return this.getProperties().filter(function(e){return e.groupable})};F.prototype.getKeyProperties=function(){return this.getProperties().filter(function(e){return e.key})};F.prototype.getVisibleProperties=function(){return this.getProperties().filter(function(e){return e.visible})};F.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);l.delete(this)};return F});