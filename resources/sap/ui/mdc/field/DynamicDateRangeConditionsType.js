/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/field/ConditionsType","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/condition/Operator","sap/ui/mdc/condition/Condition","sap/ui/mdc/enum/ConditionValidated","sap/ui/mdc/enum/BaseType","sap/ui/mdc/util/DateUtil","sap/ui/model/SimpleType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/m/DynamicDate","sap/m/library"],function(t,e,a,r,i,o,n,s,l,p,u,v,d){"use strict";var c=t.extend("sap.ui.mdc.field.DynamicDateRangeConditionsType",{constructor:function(t,e){s.apply(this,arguments);this.sName="ConditionsDateRange";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")}});c.prototype.destroy=function(){s.prototype.destroy.apply(this,arguments);this._bDestroyed=true};c.prototype.formatValue=function(t,r){if(t==undefined||t==null||this._bDestroyed){return null}if(!Array.isArray(t)){throw new l("No valid conditions provided")}var i=g.call(this);var o;if(i!==1){throw new l("MaxConditions must be 1")}if(t.length===1){var n=t[0];var s=e.getOperator(n.operator);if(!n.operator||!s){throw new l("No valid condition provided, Operator wrong.")}var p=[];var u=O.call(this);var v=e.getDynamicDateOptionForOperator(s,d.StandardDynamicDateRangeKeys,u);for(var c=0;c<s.valueTypes.length;c++){if(v&&s.valueTypes[c]===a.ValueType.Self){p.push(h.call(this,n.values[c]))}else if(s.valueTypes[c]&&s.valueTypes[c]!==a.ValueType.Static){p.push(n.values[c])}}if(!v){v=e.getCustomDynamicDateOptionForOperator(s,u)}var m=y.call(this,u);o=m.formatValue({operator:v,values:p},r)}return o};function y(t){if(!this._oDynamicDateType){var e={date:{source:{pattern:"timestamp"}},int:{}};if(t===o.DateTime){e.datetime={source:{pattern:"timestamp"}}}this._oDynamicDateType=new v(e)}return this._oDynamicDateType}function h(t){var e=f.call(this);var a=O.call(this);var r=e.formatValue(t,"string");var i;var n=0;var s=0;var l=0;var p=0;if(a===o.DateTime){i=r.split("T");r=i[0];var u=i[1];i=u.split(":");n=parseInt(i[0]);s=parseInt(i[1]);l=parseInt(i[2])}i=r.split("-");var v=parseInt(i[0]);var d=parseInt(i[1])-1;var c=parseInt(i[2]);var y=new Date(v,d,c,n,s,l,p).getTime();return y}function m(t){var e=f.call(this);var a=O.call(this);var r=new Date(t);var i=r.getFullYear();var n=r.getMonth()+1;var s=r.getDate();var l=i.toString()+"-"+(n<10?"0":"")+n.toString()+"-"+(s<10?"0":"")+s.toString();if(a===o.DateTime){var p=r.getHours();var u=r.getMinutes();var v=r.getSeconds();var d=0;l=l+"T"+(p<10?"0":"")+p.toString()+":"+(u<10?"0":"")+u.toString()+":"+(v<10?"0":"")+v.toString()+":"+(d<100?"0":"")+(d<10?"0":"")+d.toString()}var c=e.parseValue(l,"string");return c}function f(){if(!this._oInternalType){var t=T.call(this);var e=O.call(this);var a;if(e===o.DateTime){a="yyyy-MM-dd'T'HH:mm:ss:SSS"}else{a="yyyy-MM-dd"}this._oInternalType=n.createInternalType(t,a)}return this._oInternalType}c.prototype.parseValue=function(t,o){if(this._bDestroyed){return null}if(g.call(this)!==1){throw new p("Only one condition supported for parsing")}var n=D.call(this);var s=[];if(t&&t.operator){if(t.operator==="PARSEERROR"){throw new p(t.values[0])}var l=t.operator;var u=e.getOperatorForDynamicDateOption(l,O.call(this));l=u.name;if(u){var v=O.call(this);var c=y.call(this,v);var h=c.parseValue(t,o);var f=[];for(var T=0;T<u.valueTypes.length;T++){if(d.StandardDynamicDateRangeKeys[t.operator]&&u.valueTypes[T]===a.ValueType.Self){f.push(m.call(this,h.values[T]))}else if(u.valueTypes[T]&&u.valueTypes[T]!==a.ValueType.Static){f.push(h.values[T])}}var w=r.createCondition(u.name,f,undefined,undefined,i.NotValidated);e.updateConditionValues(w);e.checkConditionsEmpty(w,n);s.push(w)}}return s};c.prototype.validateValue=function(t){if(t===undefined||t===null||this._bDestroyed){return}if(!Array.isArray(t)){throw new u("No valid conditions provided")}var a=T.call(this);var r=D.call(this);for(var i=0;i<t.length;i++){var o=t[i];if(typeof o!=="object"||!o.operator||!o.values||!Array.isArray(o.values)){throw new u(this._oResourceBundle.getText("field.VALUE_NOT_VALID"))}var n=e.getOperator(o.operator);if(!n||r.indexOf(n.name)===-1){throw new u("No valid condition provided, Operator wrong.")}n.validate(o.values,a)}};function g(){var t=1;if(this.oFormatOptions.hasOwnProperty("maxConditions")){t=this.oFormatOptions.maxConditions}return t}function T(){var t=this.oFormatOptions.valueType;if(!t){throw new Error("Type missing")}return t}function D(){var t=this.oFormatOptions.operators;if(!t||t.length===0){t=e.getOperatorsForType(O.call(this))}return t}function O(){var t=T.call(this);var e=t.getMetadata().getName();var a=t.getFormatOptions();var r=t.getConstraints();var i=this.oFormatOptions.delegate;var n=this.oFormatOptions.payload;var s=i?i.getTypeUtil(n).getBaseType(e,a,r):o.Date;return s}return c});