/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/mdc/enum/EditMode","sap/ui/mdc/enum/ContentMode","sap/ui/mdc/util/loadModules","sap/ui/mdc/field/content/DefaultContent","sap/ui/mdc/field/content/SearchContent","sap/ui/mdc/field/content/DateContent","sap/ui/mdc/field/content/TimeContent","sap/ui/mdc/field/content/DateTimeContent","sap/ui/mdc/field/content/LinkContent","sap/ui/mdc/field/content/BooleanContent","sap/ui/mdc/field/content/UnitContent","sap/ui/mdc/field/ConditionType","sap/ui/mdc/field/ConditionsType","sap/ui/base/SyncPromise"],function(t,e,n,i,o,s,r,a,p,d,l,y,u,h,f){"use strict";var C=t.extend("sap.ui.mdc.field.content.ContentFactory",{metadata:{library:"sap.ui.mdc"},constructor:function(e,n){this._oField=n?n.field:null;this._fnHandleTokenUpdate=n?n.handleTokenUpdate:null;this._fnHandleContentChange=n?n.handleContentChange:null;this._fnHandleContentLiveChange=n?n.handleContentLiveChange:null;this._fnHandleValueHelpRequest=n?n.handleValueHelpRequest:null;this._fnHandleEnter=n?n.handleEnter:null;this._fnHandleContentPress=n?n.handleContentPress:null;t.prototype.constructor.apply(this,arguments)}});var c={Default:o,Search:s,Date:r,Time:a,DateTime:p,Link:d,Boolean:l,Unit:y};C.prototype.init=function(){this._oContentTypeClass;this._sOperator};C.prototype.exit=function(){this._oField=undefined;this._fnHandleTokenUpdate=undefined;this._fnHandleContentChange=undefined;this._fnHandleContentLiveChange=undefined;this._fnHandleValueHelpRequest=undefined;this._fnHandleEnter=undefined;this._fnHandleContentPress=undefined;this._oContentTypeClass=undefined;this._sOperator=undefined;if(this._oConditionType&&this._oConditionType._bCreatedByField){this._oConditionType.destroy();this._oConditionType=undefined}if(this._oConditionsType&&this._oConditionsType._bCreatedByField){this._oConditionsType.destroy();this._oConditionsType=undefined}};C.prototype.createContent=function(t,e,n){var o=t.getControlNames(e,this._sOperator);var s;if(o.every(function(t){return!t})){return Promise.resolve([])}try{s=i(o).catch(function(t){throw new Error("loadModules promise rejected in sap.ui.mdc.field.content.ContentFactory:createContent function call - could not load controls "+JSON.stringify(o))}).then(function(i){if(this.getField()&&!this.getField()._bIsBeingDestroyed){return t.create(this,e,this._sOperator,i,n)}else{return[]}}.bind(this)).unwrap()}catch(t){throw new Error("Error in sap.ui.mdc.field.content.ContentFactory:createContent function call ErrorMessage: '"+t.message+"'")}if(s.then){s.catch(function(t){throw new Error("Error in sap.ui.mdc.field.content.ContentFactory:createContent function call ErrorMessage: '"+t.message+"'")});return s}return f.resolve(s)};C.prototype.getContentMode=function(t,i,o,s,r){var a=n.Edit;if(i===e.Display){if(o!==1){a=n.DisplayMultiValue}else if(s){a=n.DisplayMultiLine}else{a=n.Display}}else if(o!==1){a=n.EditMultiValue}else if(s){a=n.EditMultiLine}else if(r.length===1&&t.getEditOperator()&&t.getEditOperator()[r[0]]){this._sOperator=r[0];a=n.EditOperator}else if(this.getField().getFieldHelp()){a=n.EditForHelp}return a};C.prototype.getContentType=function(t,e,n){var i=this.getField();var o=c[t]?c[t]:null;if(!o){if(i.getFieldInfo()&&n){o=c.Link}else{var s=new RegExp("^\\*(.*)\\*|\\$search$");if(s.test(i.getFieldPath())&&e===1){o=c.Search}else{o=c.Default}}}return o};C._updateLink=function(t,e){if(e){t.setHref(e.href);t.setTarget(e.target)}};C._getEnabled=function(t){return t&&t!==e.Disabled};C._getEditable=function(t){return t===e.Editable||t===e.EditableReadOnly||t===e.EditableDisplay};C._getDisplayOnly=function(t){return t&&t!==e.Editable};C._getEditableUnit=function(t){return t===e.Editable};C.prototype.getField=function(){return this._oField};C.prototype.getFieldHelpIcon=function(){return this.getField()._getFieldHelpIcon()};C.prototype.getHandleTokenUpdate=function(){return this._fnHandleTokenUpdate};C.prototype.getHandleContentChange=function(){return this._fnHandleContentChange};C.prototype.getHandleContentLiveChange=function(){return this._fnHandleContentLiveChange};C.prototype.getHandleValueHelpRequest=function(){return this._fnHandleValueHelpRequest};C.prototype.getHandleEnter=function(){return this._fnHandleEnter};C.prototype.getHandleContentPress=function(){return this._fnHandleContentPress};C.prototype.setBoundProperty=function(t){this._sBoundProperty=t};C.prototype.getBoundProperty=function(){return this._sBoundProperty};C.prototype.setAriaLabelledBy=function(t){if(t.addAriaLabelledBy){var e=this.getField().getAriaLabelledBy();for(var n=0;n<e.length;n++){var i=e[n];t.addAriaLabelledBy(i)}}};C.prototype.setHideOperator=function(t){this._bHideOperator=t};C.prototype.getHideOperator=function(){return this._bHideOperator};function _(t,e,n,i){if(!i){if(this[t]&&this[t].getMetadata().getName()!==e.getMetadata().getName()){this[t].destroy();this[t]=undefined}if(!this[t]){var o=n();this[t]=new e(o);this[t]._bCreatedByField=true}}return this[t]}C.prototype.getConditionType=function(t){return _.call(this,"_oConditionType",u,this.getField()._getFormatOptions.bind(this.getField()),t)};C.prototype.setConditionType=function(t){this._oConditionType=t};C.prototype.getConditionsType=function(t,e){var n=e||h;return _.call(this,"_oConditionsType",n,this.getField()._getFormatOptions.bind(this.getField()),t)};C.prototype.setConditionsType=function(t){this._oConditionsType=t};C.prototype.getUnitConditionsType=function(t){return _.call(this,"_oUnitConditionsType",h,this.getField()._getUnitFormatOptions.bind(this.getField()),t)};C.prototype.getContentConditionTypes=function(){return this._oContentConditionTypes};C.prototype.setContentConditionTypes=function(t){this._oContentConditionTypes=t};C.prototype._setUsedConditionType=function(t,n){if(this._oConditionType&&!this._oConditionType._bCreatedByField){this._oConditionType=undefined}if(this._oConditionsType&&!this._oConditionsType._bCreatedByField){this._oConditionsType=undefined}var i;var o;if(t){if(this._oContentConditionTypes.content){i=this._oContentConditionTypes.content.oConditionType;o=this._oContentConditionTypes.content.oConditionsType}}else if(n===e.Display&&this.getField().getContentDisplay()){if(this._oContentConditionTypes.contentDisplay){i=this._oContentConditionTypes.contentDisplay.oConditionType;o=this._oContentConditionTypes.contentDisplay.oConditionsType}}else if(n!==e.Display&&this.getField().getContentEdit()){if(this._oContentConditionTypes.contentEdit){i=this._oContentConditionTypes.contentEdit.oConditionType;o=this._oContentConditionTypes.contentEdit.oConditionsType}}if(i){if(this._oConditionType&&this._oConditionType._bCreatedByField){this._oConditionType.destroy()}this._oConditionType=i}if(o){if(this._oConditionsType&&this._oConditionsType._bCreatedByField){this._oConditionsType.destroy()}this._oConditionsType=o}this.updateConditionType()};C.prototype.getDataType=function(){return this._oDataType};C.prototype.setDataType=function(t){this._oDataType=t};C.prototype.retrieveDataType=function(){if(!this._oDataType){var t=this.getField().getDataType();if(typeof t==="string"){this._oDataType=this.getField().getTypeUtil().getDataTypeInstance(t,this.getField().getDataTypeFormatOptions(),this.getField().getDataTypeConstraints());this._oDataType._bCreatedByField=true}}return this._oDataType};C.prototype.getDateOriginalType=function(){return this._oDateOriginalType};C.prototype.setDateOriginalType=function(t){this._oDateOriginalType=t};C.prototype.getUnitOriginalType=function(){return this._oUnitOriginalType};C.prototype.setUnitOriginalType=function(t){this._oUnitOriginalType=t};C.prototype.getUnitType=function(){return this._oUnitType};C.prototype.setUnitType=function(t){this._oUnitType=t};C.prototype.getCompositeTypes=function(){return this._aCompositeTypes};C.prototype.setCompositeTypes=function(t){this._aCompositeTypes=t};C.prototype.isMeasure=function(){return this._bIsMeasure};C.prototype.setIsMeasure=function(t){this._bIsMeasure=t};C.prototype.getDisplayFormat=function(){return this._sDisplayFormat};C.prototype.setDisplayFormat=function(t){this._sDisplayFormat=t};C.prototype.getValueFormat=function(){return this._sValueFormat};C.prototype.setValueFormat=function(t){this._sValueFormat=t};C.prototype.getCalendarType=function(){return this._sCalendarType};C.prototype.setCalendarType=function(t){this._sCalendarType=t};C.prototype.getFieldTypeInitialization=function(){return this.getField()._oTypeInitialization};C.prototype.updateConditionType=function(){var t=this._oConditionType;var e=this._oConditionsType;if(t||e){var n=this.getField()._getFormatOptions();if(t){t.setFormatOptions(n)}if(e){e.setFormatOptions(n)}if(this._oUnitConditionsType){n=this.getField()._getUnitFormatOptions();this._oUnitConditionsType.setFormatOptions(n)}}};return C});