/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/field/FieldValueHelpTableWrapperBase","sap/ui/model/ChangeReason","sap/base/strings/capitalize","sap/m/library","sap/ui/mdc/util/loadModules","sap/ui/thirdparty/jquery"],function(e,t,i,n,a,r){"use strict";var s=n.ListMode;var o=n.Sticky;var l;var p=e.extend("sap.ui.mdc.field.FieldValueHelpMTableWrapper",{metadata:{library:"sap.ui.mdc",aggregations:{table:{type:"sap.m.Table",multiple:false}},defaultAggregation:"table"}});p._init=function(){l=undefined};p.prototype.exit=function(){e.prototype.exit.apply(this,arguments)};p.prototype.initialize=function(e){if(e||this._oScrollContainer){return this._bTableResolved?this:this._oTablePromise}if(!l){a("sap/m/ScrollContainer").then(function(e){if(!this._bIsBeingDestroyed){l=e[0];this.initialize();this.fireDataUpdate({contentChange:true})}}.bind(this));return this}this._oScrollContainer=new l(this.getId()+"-SC",{height:"100%",width:"100%",vertical:true});this._oScrollContainer._oWrapper=this;this._oScrollContainer.getContent=function(){var e=[];var t=this._oWrapper&&this._oWrapper.getTable();if(t){e.push(t)}return e};return this};p.prototype.dispose=function(){if(this._oScrollContainer){this._oScrollContainer.destroy();delete this._oScrollContainer}};p.prototype.getDialogContent=function(){return this._oScrollContainer};p.prototype.getSuggestionContent=function(){return this._getWrappedTable()};p.prototype.fieldHelpOpen=function(t){e.prototype.fieldHelpOpen.apply(this,arguments);var i=this._getWrappedTable();if(i){if(t){var n=i.getSelectedItem();if(n){this._handleScrolling(n)}}}return this};p.prototype.getListBinding=function(){var e=this._getWrappedTable();return e&&e.getBinding("items")};p.prototype._getListBindingInfo=function(){var e=this._getWrappedTable();return e&&e.getBindingInfo("items")};p.prototype.isSuspended=function(){var e=this.getListBinding();if(!e){return true}return e.isSuspended()};p.prototype._handleEvents=function(e){var t=this._getWrappedTable();if(t){var i=(e?t.attachEvent:t.detachEvent).bind(t);i("itemPress",this._handleItemPress,this);i("selectionChange",this._handleSelectionChange,this);i("updateFinished",this._handleUpdateFinished,this)}};p.prototype._adjustTable=function(t,i){e.prototype._adjustTable.apply(this,arguments);var n=this._getWrappedTable();if(n&&this.getParent()){n.setRememberSelections(false);if(t){if(this._getMaxConditions()===1){n.setMode(s.SingleSelectMaster)}else{n.setMode(s.MultiSelect)}}else if(this._getMaxConditions()===1){n.setMode(s.SingleSelectLeft)}else{n.setMode(s.MultiSelect)}var a=n.getSticky();if(!a||a.length===0){n.setSticky([o.ColumnHeaders])}}};var h=function(e){if(e){this._handleModelContextChange();return true}};p.prototype._handleTableChanged=function(t,i){if(t==="insert"){this._adjustTable(true);if(!h.call(this,this.getListBinding())){this._oObserver.observe(i,{bindings:["items"]})}}else{this._oObserver.unobserve(i)}e.prototype._handleTableChanged.call(this,t,i)};p.prototype._observeChanges=function(t,i){if(t.name==="items"&&t.mutation==="ready"){h.call(this,t.bindingInfo.binding)}e.prototype._observeChanges.apply(this,arguments)};p.prototype._handleItemPress=function(e){var t=e.getParameter("listItem");if(!this._bSuggestion||this._getMaxConditions()!==1){t.setSelected(!t.getSelected())}this._fireSelectionChange(true)};p.prototype._handleSelectionChange=function(e,t){if(!this._bSuggestion||this._getMaxConditions()!==1||t){this._fireSelectionChange.call(this,false)}};p.prototype._handleUpdateFinished=function(e){if(!this.getParent()){return}this._updateSelectedItems();if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep)}this.fireDataUpdate({contentChange:false})};p.prototype._getTableItems=function(e,t){var i=this._getWrappedTable();if(i){return e?i.getSelectedItems():i.getItems()}return[]};p.prototype._modifyTableSelection=function(e,t,i,n){if(t.getSelected()!==i){t.setSelected(i)}};p.prototype._handleTableEvent=function(e){if(!this._bSuggestion){return}var t=this._getWrappedTable();var i=r(e.target).control(0);switch(e.type){case"sapprevious":if(i.isA("sap.m.ListItemBase")){if(t.indexOfItem(i)===0){this.fireNavigate({key:undefined,description:undefined,leave:true});e.preventDefault();e.stopPropagation();e.stopImmediatePropagation(true)}}break;default:break}};p.prototype._handleScrolling=function(e){var t=this.getScrollDelegate();if(t){var i=this._getWrappedTable();var n=!isNaN(e)?e:i.indexOfItem(e);i.scrollToIndex(n).catch(function(e){});return true}};p.prototype.enableShowAllItems=function(){var e=this._getWrappedTable();var t=e&&e.getBindingInfo("items");return t&&!!t.length};p.prototype.getAllItemsShown=function(){var e=this.getListBinding();return e&&(!e.getLength()||e.bLengthFinal)};return p});