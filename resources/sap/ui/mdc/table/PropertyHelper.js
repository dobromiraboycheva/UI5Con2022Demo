/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../util/PropertyHelper","sap/m/table/Util"],function(t,e){"use strict";var r=t.extend("sap.ui.mdc.table.PropertyHelper",{constructor:function(e,r,n,i){var a=["filterable","sortable","groupable","key","unit","text","exportSettings","propertyInfos","visualSettings"];t.call(this,e,r,n,a,i)}});function n(t){return!!(t&&t.isA&&t.isA("sap.ui.mdc.table.Column"))}function i(t){if(t.indexOf("em")>0){return Math.round(parseFloat(t))}if(t.indexOf("px")>0){return Math.round(parseInt(t)/16)}return""}r.prototype.prepareProperty=function(e){t.prototype.prepareProperty.apply(this,arguments);e.aggregatable=false};r.prototype.getColumnExportSettings=function(t){var e=[];if(!n(t)){return e}var r=this.getProperty(t.getDataProperty());if(!r){return e}var i=r.exportSettings;if(i===null){return e}var l=[];var u;var p;if(!r.isComplex()){u=a(t,r,i);u.property=r.path;e.push(u);return e}p=r.getReferencedProperties();if(Object.keys(i).length){u=a(t,r,i);p.forEach(function(t){l.push(t.path)});u.property=l;e.push(u)}else{p.forEach(function(r,n){var i=r.exportSettings,l=a(t,r,i);l.property=r.path;if(n>0){l.columnId=t.getId()+"-additionalProperty"+n}if(i||l.property){e.push(l)}})}return e};function a(t,e,r){var n=Object.assign({columnId:t.getId(),label:e.label,width:i(t.getWidth()),textAlign:t.getHAlign(),type:"String"},r);return n}r.prototype.calculateColumnWidth=function(t){var e=t.getDataProperty();var r=this.getProperty(e);if(!r){return null}var n=r.visualSettings;if(n&&n.widthCalculation===null){return null}return this._calcColumnWidth(r)};r.prototype._calcColumnWidth=function(t){var r=Object.assign({gap:0,includeLabel:true,excludeProperties:[]},t.visualSettings&&t.visualSettings.widthCalculation);var n=[];if(t.isComplex()){n=t.getReferencedProperties().flatMap(function(t){var e=t.visualSettings?t.visualSettings.widthCalculation:undefined;return e===null||r.excludeProperties.includes(t.name)?[]:[[t.typeConfig.typeInstance,e]]})}else{n.push(t.typeConfig.typeInstance)}if(t.unit){r.gap+=2.5}var i=r.includeLabel?t.label:"";return e.calcColumnWidth(n,i,r)};return r});