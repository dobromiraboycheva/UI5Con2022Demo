/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/mdc/condition/FilterOperatorUtil"],function(e,n,t){"use strict";var i=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};var r=function(e){return new Promise(function(n,t){sap.ui.require([e],n,t)})};var o=function(e){var n=e&&e.getEngine?e.getEngine().getController(e,"Filter"):null;return n?n.getFilterControl():null};var a=function(a,u,f,d,l){var c=o(f);if(c&&c.applyConditionsAfterChangesApplied){c.applyConditionsAfterChangesApplied(f)}return i(f,function(){var i,o=null,p=d.modifier;return p.getProperty(f,"filterConditions").then(function(g){i=e({},g);if(i){for(var C in i){if(C===u.name){o=i[C];break}}}if(!o){i[u.name]=[];o=i[u.name]}var s=t.indexOfCondition(u.condition,o);if(s<0){o.push(u.condition);p.setProperty(f,"filterConditions",i);if(!l){a.setRevertData({name:u.name,condition:u.condition})}return p.getProperty(f,"delegate").then(function(e){return r(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().addCondition:e.addCondition);if(t){return t(u.name,f,d).catch(function(e){n.error("Error during Delegate.addCondition call: "+e)})}}).finally(function(){if(c&&c.addCondition){return c.addCondition(u.name,u.condition)}})}})})};var u=function(a,u,f,d,l){var c=o(f);if(c&&c.applyConditionsAfterChangesApplied){c.applyConditionsAfterChangesApplied(f)}return i(f,function(){var i,o,p=-1,g=d.modifier;return g.getProperty(f,"filterConditions").then(function(C){i=e({},C);if(i){for(var s in i){if(s===u.name){o=i[s];break}}}if(o&&o.length>0){p=t.indexOfCondition(u.condition,o);if(p>=0){o.splice(p,1);g.setProperty(f,"filterConditions",i);if(!l){a.setRevertData({name:u.name,condition:u.condition})}return g.getProperty(f,"delegate").then(function(e){return r(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().removeCondition:e.removeCondition);if(t){return t(u.name,f,d).catch(function(e){n.error("Error during Delegate.removeCondition call: "+e)})}}).finally(function(){if(c&&c.removeCondition){return c.removeCondition(u.name,u.condition)}})}}})})};var f={};f.addCondition={changeHandler:{applyChange:function(e,n,t){return a(e,e.getContent(),n,t,false)},completeChangeContent:function(e,n,t){},revertChange:function(e,n,t){return u(e,e.getRevertData(),n,t,true).then(function(){e.resetRevertData()})}},layers:{USER:true}};f.removeCondition={changeHandler:{applyChange:function(e,n,t){return u(e,e.getContent(),n,t,false)},completeChangeContent:function(e,n,t){},revertChange:function(e,n,t){return a(e,e.getRevertData(),n,t,true).then(function(){e.resetRevertData()})}},layers:{USER:true}};return f});