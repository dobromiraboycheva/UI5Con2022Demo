/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/p13n/Engine"],function(e){"use strict";var n={};var t=function(n){if(!n._bWaitForModificationChanges&&n.isA){n._bWaitForModificationChanges=true;e.getInstance().waitForChanges(n).then(function(){if(n._onModifications instanceof Function){n._onModifications()}delete n._bWaitForModificationChanges})}};var a=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};n.createSetChangeHandler=function(n){if(!n||!n.hasOwnProperty("aggregation")||!n.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}var r=n.aggregation;var o=n.property;return{changeHandler:{applyChange:function(n,i,g){return a(i,function(){return e.getInstance().readXConfig(i,{propertyBag:g}).then(function(t){var a=null;if(t&&t.aggregations&&t.aggregations[r]&&t.aggregations[r][n.getContent().name]&&t.aggregations[r][n.getContent().name][o]){a=t.aggregations[r][n.getContent().name][o]}n.setRevertData({name:n.getContent().name,value:a});return e.getInstance().enhanceXConfig(i,{controlMeta:{aggregation:r,property:o},name:n.getContent().name,value:n.getContent().value,propertyBag:g})}).then(function(){t(i)})})},completeChangeContent:function(e,n,t){},revertChange:function(n,a,i){return e.getInstance().enhanceXConfig(a,{controlMeta:{aggregation:r,property:o},name:n.getRevertData().name,value:n.getRevertData().value,propertyBag:i}).then(function(){n.resetRevertData();t(a)})}},layers:{USER:true}}};return n});