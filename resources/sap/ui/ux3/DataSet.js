/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/ui/core/ResizeHandler","./library","./DataSetRenderer","sap/ui/model/SelectionModel","sap/ui/commons/SegmentedButton","sap/ui/commons/SearchField","sap/ui/commons/Toolbar","sap/ui/commons/Button","sap/base/Log"],function(e,t,i,r,o,s,n,l,a,h,d){"use strict";var u=t.extend("sap.ui.ux3.DataSet",{metadata:{deprecated:true,library:"sap.ui.ux3",properties:{showToolbar:{type:"boolean",group:"Misc",defaultValue:true},showFilter:{type:"boolean",group:"Misc",defaultValue:true},showSearchField:{type:"boolean",group:"Misc",defaultValue:true},multiSelect:{type:"boolean",group:"Behavior",defaultValue:false}},aggregations:{items:{type:"sap.ui.ux3.DataSetItem",multiple:true,singularName:"item",bindable:"bindable"},views:{type:"sap.ui.ux3.DataSetView",multiple:true,singularName:"view"},filter:{type:"sap.ui.core.Control",multiple:true,singularName:"filter"},_viewSwitches:{type:"sap.ui.core.Control",multiple:true,singularName:"_viewSwitch",visibility:"hidden"},_toolbar:{type:"sap.ui.commons.Toolbar",multiple:false,visibility:"hidden"}},associations:{selectedView:{type:"sap.ui.ux3.DataSetView",multiple:false}},events:{selectionChanged:{parameters:{oldLeadSelectedIndex:{type:"int"},newLeadSelectedIndex:{type:"int"}}},search:{parameters:{query:{type:"string"}}}}}});u.prototype.init=function(){var e=this,t;this.selectionModel=new s(s.SINGLE_SELECTION);this._oSegBut=new n;this._oSegBut.attachSelect(function(t){e.press(t)},e);this._oSegBut.show=false;this._oSearchField=new l(this.getId()+"-searchValue");this._oSearchField.setShowListExpander(false);this._oSearchField.setEnableListSuggest(false);this._oSearchField.setEnableFilterMode(true);this._oSearchField.setEnableClear(true);this._oSearchField.show=false;e=this;this._oSearchField.attachSearch(function(t){e.fireSearch(t.getParameters())});this.selectionModel.attachSelectionChanged(function(t){var i,r;var o=t.getParameters();if(o){r=o.leadIndex;i=o.oldIndex}e.fireSelectionChanged({oldLeadSelectedIndex:i,newLeadSelectedIndex:r});d.debug("Selection Change fired")});t=new a;this._setToolbar(t);this._iShiftStart=null};u.prototype.exit=function(){this._oSegBut.destroy();this._oSearchField.destroy();this.destroyAggregation("_toolbar")};u.prototype._prepareToolbar=function(){var e=this.getViews().length,t=this._getToolbar();if(e>1&&this._oSegBut.show==false){t.insertItem(this._oSegBut,0);this._oSegBut.show=true}else if(e<=1&&this._oSegBut.show){t.removeItem(this._oSegBut);this._oSegBut.show=false}if(this.getShowSearchField()&&this._oSearchField.show==false){t.insertRightItem(this._oSearchField,t.getRightItems().length);this._oSearchField.show=true}else if(!this.getShowSearchField()&&this._oSearchField.show==true){t.removeRightItem(this._oSearchField);this._oSearchField.show=false}};u.prototype.press=function(e,t){var i=e.getParameters().selectedButtonId,r=i.substring(i.lastIndexOf("-")+1),o=sap.ui.getCore().byId(this.getSelectedView());o.exitView(this.getItems());this.setSelectedView(r)};u.prototype.filter=function(){this.fireFilter({filterValue:this.getFilterValue()})};u.prototype.sort=function(){this.fireSort()};u.prototype.addSelectionInterval=function(e,t){this.selectionModel.addSelectionInterval(e,t);return this};u.prototype.setSelectionInterval=function(e,t){this.selectionModel.setSelectionInterval(e,t);return this};u.prototype.removeSelectionInterval=function(e,t){this.selectionModel.removeSelectionInterval(e,t);return this};u.prototype.getSelectedIndex=function(){return this.selectionModel.getLeadSelectedIndex()};u.prototype.getSelectedIndices=function(){return this.selectionModel.getSelectedIndices()||[]};u.prototype.clearSelection=function(){this.selectionModel.clearSelection();return this};u.prototype.selectItem=function(e){var t=e.getParameters(),i=e.getParameters().itemId,r=sap.ui.getCore().byId(i),o=this.getItems(),s=o.indexOf(r),n=this.getLeadSelection();if(!this.getMultiSelect()){if(n==s&&!t.shift){this.setLeadSelection(-1)}else{this.setLeadSelection(s)}this._iShiftStart=null}else{if(t.ctrl){if(!this.isSelectedIndex(s)){this.addSelectionInterval(s,s)}else{this.removeSelectionInterval(s,s)}if(this._iShiftStart>=0){this._iShiftStart=s}}if(t.shift){if(!this._iShiftStart&&this._iShiftStart!==0){this._iShiftStart=n}if(this._iShiftStart>=0&&t.ctrl){this.addSelectionInterval(this._iShiftStart,s)}else if(this._iShiftStart>=0&!t.ctrl){this.setSelectionInterval(this._iShiftStart,s)}else{this.setLeadSelection(s);this._iShiftStart=s}}if(!t.shift&&!t.ctrl){if(n==s&&s!=this._iShiftStart){this.setLeadSelection(-1)}else{this.setLeadSelection(s)}this._iShiftStart=null}}};u.prototype.prepareRendering=function(){var e,t=this.getViews().length;if(t==0){return}this._prepareToolbar();if(this._bDirty){e=sap.ui.getCore().byId(this.getSelectedView());if(e.exitView){e.exitView(this.getItems())}if(e.initView){e.initView(this.getItems())}this._bDirty=false}};u.prototype.getLeadSelection=function(){return this.selectionModel.getLeadSelectedIndex()};u.prototype.setLeadSelection=function(e){this.selectionModel.setLeadSelectedIndex(e)};u.prototype.isSelectedIndex=function(e){return this.selectionModel.isSelectedIndex(e)};u.prototype.getSelectedItemId=function(e){return this.getItems()[e].getId()};u.prototype.createViewSwitch=function(e,t){var i;if(e.getIcon()){i=new h({id:this.getId()+"-view-"+e.getId(),lite:true,icon:e.getIcon(),iconHovered:e.getIconHovered(),iconSelected:e.getIconSelected()})}else if(e.getName()){i=new h({id:this.getId()+"-view-"+e.getId(),text:e.getName(),lite:true})}else{i=new h({id:this.getId()+"-view-"+e.getId(),text:e.getId(),lite:true})}i._viewIndex=t;return i};u.prototype._rerenderToolbar=function(){var e=this.$("toolbar");this._prepareToolbar();if(e.length>0){var t=sap.ui.getCore().createRenderManager();o.renderToolbar(t,this);t.flush(e[0]);t.destroy()}};u.prototype._rerenderFilter=function(){var e=this.$("filter");if(e.length>0){var t=sap.ui.getCore().createRenderManager();o.renderFilterArea(t,this);t.flush(e[0]);if(this.getShowFilter()){e.removeClass("noPadding")}else{e.addClass("noPadding")}t.destroy()}};u.prototype.setMultiSelect=function(e){this.clearSelection();if(!e){this.setProperty("multiSelect",false);if(this.selectionModel){this.selectionModel.setSelectionMode(s.SINGLE_SELECTION)}}else{this.setProperty("multiSelect",true);if(this.selectionModel){this.selectionModel.setSelectionMode(s.MULTI_SELECTION)}}return this};u.prototype.removeItem=function(e){var t=this.removeAggregation("items",e,true);if(t){t.detachSelected(this.selectItem,this);t.destroyAggregation("_template",true);this._bDirty=true}return t};u.prototype.removeAllItems=function(){var t=this.getItems(),i;e.each(t,function(e,t){t.destroyAggregation("_template",true);t.detachSelected(this.selectItem,this)});i=this.removeAllAggregation("items");this._bDirty=true;return i};u.prototype.destroyItems=function(){var e=this.destroyAggregation("items");this._bDirty=true;this.invalidate();return e};u.prototype.addItem=function(e){this.addAggregation("items",e,true);e.attachSelected(this.selectItem,this);this._bDirty=true;return this};u.prototype.insertItem=function(e,t){this.insertAggregation("items",e,t,true);e.attachSelected(this.selectItem,this);this._bDirty=true;return this};u.prototype.setFilterValue=function(e){this.setProperty("filterValue",e,true);return this};u.prototype.getFilterValue=function(){return this.getProperty("filterValue")};u.prototype.insertView=function(e,t){var i=this.createViewSwitch(e,t,true);if(!this.getSelectedView()){this.setSelectedView(e)}this.insertAggregation("views",e,t);this._oSegBut.insertButton(i,t);this._rerenderToolbar();return this};u.prototype.addView=function(e){var t=this.getViews().length,i=this.createViewSwitch(e,t);if(!this.getSelectedView()){this.setSelectedView(e)}this.addAggregation("views",e,true);this._oSegBut.addButton(i);this._rerenderToolbar();return this};u.prototype.removeView=function(e){var t=this.removeAggregation("views",e,true);if(t){if(this.getSelectedView()==t.getId()){this.setSelectedView(this.getViews()[0]);this._bDirty=true;t.invalidate()}else{this._rerenderToolbar()}this._oSegBut.removeButton(this.getId()+"-view-"+t.getId()).destroy()}return t};u.prototype.destroyViews=function(){this._oSegBut.destroyButtons();this.destroyAggregation("views");return this};u.prototype.removeAllViews=function(){var e=this.removeAllAggregation("views");this._oSegBut.destroyButtons();return e};u.prototype.setEnableSorting=function(e){this.setProperty("enableSorting",e,true);this._rerenderToolbar();return this};u.prototype.setEnableFiltering=function(e){this.setProperty("enableFiltering",e,true);this._rerenderToolbar();return this};u.prototype.setSelectedView=function(e){var t=this.getSelectedView();this.setAssociation("selectedView",e);if(t!=this.getSelectedView()){this._bDirty=true}if(this.getId()+"-view-"+this.getSelectedView()!==this._oSegBut.getSelectedButton()){this._oSegBut.setSelectedButton(this.getId()+"-view-"+this.getSelectedView())}return this};u.prototype.addToolbarItem=function(e){this._getToolbar().addItem(e);this._rerenderToolbar()};u.prototype.removeToolbarItem=function(e){this._getToolbar().removeItem(e);this._rerenderToolbar()};u.prototype.setShowToolbar=function(e){this.setProperty("showToolbar",e,true);this._rerenderToolbar();return this};u.prototype.setShowFilter=function(e){this.setProperty("showFilter",e,true);this._rerenderFilter();return this};u.prototype.setShowSearchField=function(e){this.setProperty("showSearchField",e,true);this._rerenderToolbar();return this};u.prototype._setToolbar=function(e){this.setAggregation("_toolbar",e,true);this._rerenderToolbar()};u.prototype._getToolbar=function(){return this.getAggregation("_toolbar")};u.prototype.refreshItems=function(){var e=this.getBinding("items"),t=sap.ui.getCore().byId(this.getSelectedView());e.bUseExtendedChangeDetection=true;if(t&&t.getItemCount&&t.getItemCount()){var i=Math.max(t.getItemCount(),this.getItems().length);if(i){e.getContexts(0,i)}else{e.getContexts()}}else{e.getContexts()}};u.prototype.updateItems=function(t){var i=this.mBindingInfos["items"],r=this.getMetadata().getAggregation("items"),o=sap.ui.getCore().byId(this.getSelectedView()),s=i.binding,n=i.factory,l,a,h,d,u=this,c=[];s.bUseExtendedChangeDetection=true;if(o&&o.getItemCount&&o.getItemCount()){var g=Math.max(o.getItemCount(),this.getItems().length);if(g){c=s.getContexts(0,g)}else{c=s.getContexts()}}else{c=s.getContexts()}if(c.diff&&t){var p=c.diff;for(var S=0;S<p.length;S++){a=this.getItems();d=p[S].index;if(p[S].type==="delete"){h=a[d];p[S].item=h;this.removeItem(h)}else if(c.diff[S].type==="insert"){h=n("",c[d]);h.setBindingContext(c[d],i.model);p[S].item=h;this.insertItem(h,d)}}if(o&&o.updateView){o.updateView(p)}}else{this[r._sDestructor]();e.each(c,function(e,t){var o=u.getId()+"-"+e;l=n(o,t);l.setBindingContext(t,i.model);u[r._sMutator](l)})}a=this.getItems();for(var S=0,f=c.length;S<f;S++){a[S].setBindingContext(c[S],i.model)}};return u});