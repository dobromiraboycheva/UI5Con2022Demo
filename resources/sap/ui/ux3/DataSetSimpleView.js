/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/ui/core/ResizeHandler","./library","./DataSetSimpleViewRenderer","sap/base/Log","sap/ui/model/ChangeReason"],function(e,t,i,s,n,r,o){"use strict";var a=t.extend("sap.ui.ux3.DataSetSimpleView",{metadata:{deprecated:true,interfaces:["sap.ui.ux3.DataSetView"],library:"sap.ui.ux3",properties:{floating:{type:"boolean",group:"Misc",defaultValue:true},name:{type:"string",group:"Misc",defaultValue:"Name of this View"},icon:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},iconHovered:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},iconSelected:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},responsive:{type:"boolean",group:"Misc",defaultValue:false},itemMinWidth:{type:"int",group:"Misc",defaultValue:0},initialItemCount:{type:"int",group:"Appearance",defaultValue:0},reloadItemCount:{type:"int",group:"Appearance",defaultValue:0},scrollArea:{type:"any",group:"Appearance",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}},aggregations:{template:{type:"sap.ui.core.Control",multiple:false}}}});a.prototype.init=function(){this._oDataSet=this.getParent();this.items=[];this._bRendered=false;if(this.getInitialItemCount()>0&&this.getReloadItemCount()<=0){this.setReloadItemCount(this.getInitialItemCount())}this._bUsePagination=false};a.prototype.exit=function(){if(this.sResizeListenerId){i.deregister(this.sResizeListenerId);this.sResizeListenerId=null}};a.prototype.handleSelection=function(t){var i=this.getParent();var s=i.getItems(),n=i.getSelectedIndices();if(n.length>1){this._clearTextSelection()}e.each(s,function(e,t){if(i.isSelectedIndex(e)){t.$().addClass("sapUiUx3DSSVSelected")}else{t.$().removeClass("sapUiUx3DSSVSelected")}})};a.prototype._clearTextSelection=function(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection&&document.selection.empty){try{document.selection.empty()}catch(e){}}};a.prototype.isItemSelected=function(e){var t=this.items.indexOf(e);if(t==-1){return false}return this.getParent().isSelectedIndex(t)};a.prototype.initView=function(e){this.getParent().attachSelectionChanged(this.handleSelection,this);this.items=this.items.concat(e);for(var t=0;t<e.length;t++){var i=this.getTemplate().clone();e[t].setAggregation("_template",i,true)}};a.prototype.updateView=function(e){var t;if(!this.getDomRef()){for(t=0;t<e.length;t++){if(e[t].type==="delete"){e[t].item.destroy()}}return}var i=sap.ui.getCore().createRenderManager(),s=this.items.length;for(t=0;t<e.length;t++){var n=e[t].item;var r=e[t].index;if(e[t].type==="insert"){var a=this.getTemplate().clone();n.setAggregation("_template",a,true);if(t==e.length-1&&s==0){var l={onAfterRendering:function(){this.calculateItemCounts();this.getParent().updateItems(o.Change);a.removeDelegate(l)}};a.addDelegate(l,false,this)}this.getRenderer().renderItem(i,this,n);i.flush(this.$()[0],false,r);this.items.splice(r,0,n)}else{this.items.splice(r,1);n.$().remove();n.destroy()}}if(e.length>0&&this.getFloating()&&this.getResponsive()){this._computeWidths(true)}i.destroy()};a.prototype.exitView=function(e){this.getParent().detachSelectionChanged(this.handleSelection,this);for(var t=0;t<e.length;t++){e[t].destroyAggregation("_template",true)}this.items=[]};a.prototype.initScrollArea=function(){var t=this.getScrollArea(),i=this;var s=function(e){i.getParent().updateItems(o.Change)};if(typeof t==="string"){t=e(document.getElementById(t))}if(!t){t=this.$()}else if(t.is("html")){t=e(document)}if(!this._bUsePagination){t.off("scroll",s)}else{t.on("scroll",s)}};a.prototype.checkScrollItems=function(){if(!this._bRendered){return}var t=this.getParent().mBindingInfos["items"],i=this.getScrollArea(),s=t.binding,n=this.getParent(),r=0,o,a,l,h;if(n.getItems().length===s.getLength()){return r}if(typeof i==="string"){i=e(document.getElementById(i))}if(!i){i=this.$()}if(!i||i.length==0){return r}a=i[0];l=a.clientHeight;h=a.scrollHeight;if(i.is("html")){i=e(document)}if(l==h){o=l+this._iScrollTrigger}else{o=l+this._iScrollTrigger+i.scrollTop()}if(o>0){var u=Math.floor(o/this._iRowHeight)*this._iItemsPerRow;var g=n.getItems().length;u=Math.ceil(u/this._iItemsPerRow)*this._iItemsPerRow;r=u-g}return r};a.prototype.getItemCount=function(){if(this._bUsePagination){var e=this.getParent().getItems().length,t=this.checkScrollItems();if(e==0){e+=this.getInitialItemCount()}else{e+=t}return e}else{return null}};a.prototype.setInitialItemCount=function(e){this.setProperty("initialItemCount",e);this._bUsePagination=e!=0;return this};a.prototype.onBeforeRendering=function(){if(this.sResizeListenerId){i.deregister(this.sResizeListenerId);this.sResizeListenerId=null}};a.prototype.onAfterRendering=function(){this._bRendered=true;this.initScrollArea();if(this.getFloating()&&this.getResponsive()||this._bUsePagination){this._height=-1;this._itemsPerRow=-1;this.onresize();this.sResizeListenerId=i.register(this.getDomRef(),e.proxy(this.onresize,this))}};a.prototype.onThemeChanged=function(){if(this._bRendered){this.calculateItemCounts();this.getParent().updateItems(o.Change)}};a.prototype.onresize=function(){if(!this.getDomRef()){if(this.sResizeListenerId){i.deregister(this.sResizeListenerId);this.sResizeListenerId=null}return}if(this.getFloating()&&this.getResponsive()){this._computeWidths()}if(this._bUsePagination&&this.items.length>0){this.calculateItemCounts();this.getParent().updateItems(o.Change)}};a.prototype.setTemplate=function(e){this.setAggregation("template",e,true);if(this.getParent()){this.getParent().updateItems()}return this};a.prototype.calculateItemCounts=function(){if(this.getDomRef()&&sap.ui.getCore().isThemeApplied()){var e=this.$(),t=e.children().first();this._iItemsPerRow=Math.floor(e.outerWidth(true)/t.outerWidth(true));this._iNewRows=Math.ceil(this.getReloadItemCount()/this._iItemsPerRow);this._iNewItems=this._iItemsPerRow*this._iNewRows;this._iRowHeight=t.outerHeight(true);this._iScrollTrigger=this._iNewRows*this._iRowHeight}};a.prototype._computeWidths=function(e){var t=this.$();var i=Math.floor(t.width()/this.getItemMinWidth());var s=Math.floor(100/i);if(t.width()*s/100<this.getItemMinWidth()){i--;s=Math.floor(100/i)}if(e||this._height!=t.height()||this._itemsPerRow!=i){var n=-1;var r=this.getParent().getItems();var o,a;for(var l=0;l<r.length;l++){if(n==-1||n+1>i){n=0;o=100-i*s}var a=s;if(o>0){a++;o--}r[l].$().css("width",a+"%");n++}this._height=t.height();this._itemsPerRow=i}};a.prototype.setScrollArea=function(t,i){if(typeof t!=="string"&&!(t instanceof e)){r.error("You can only pass a string (ID of scroll area DOM) or a jQuery object as scrollarea")}this.setProperty("scrollArea",t,i);return this};return a});