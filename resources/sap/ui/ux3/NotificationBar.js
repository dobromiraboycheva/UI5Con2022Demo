/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","sap/ui/core/theming/Parameters","./library","./NotificationBarRenderer","sap/ui/core/Message","sap/ui/core/library","sap/ui/Device","sap/base/Log"],function(e,t,i,s,a,r,o,n,g,l){"use strict";var f=n.MessageType;var h=a.NotificationBarStatus;var u=t.extend("sap.ui.ux3.NotificationBar",{metadata:{deprecated:true,library:"sap.ui.ux3",properties:{visibleStatus:{type:"sap.ui.ux3.NotificationBarStatus",group:"Misc",defaultValue:h.Default},resizeEnabled:{type:"boolean",group:"Misc",defaultValue:true},alwaysShowToggler:{type:"boolean",defaultValue:false,since:"1.24.5"}},aggregations:{messageNotifier:{type:"sap.ui.core.Element",multiple:false},notifiers:{type:"sap.ui.core.Element",multiple:true,singularName:"notifier"}},events:{display:{parameters:{show:{type:"boolean"}}},resize:{parameters:{status:{type:"sap.ui.ux3.NotificationBarStatus"}}}}}});t.extend("sap.ui.ux3.NotificationBar.NotifierView",{renderMessages:function(e){e.write("<div");e.writeAttribute("id",this.getId()+"-content");e.addClass("sapUiNotifierContent");e.writeClasses();e.write(">");var t=this.getMessages();var i=t.length-1;var s=true;for(;i>=0;i--){if(!s||i==0&&t.length>1){e.write("<div");e.addClass("sapUiNotificationBarCltSep");e.writeClasses();e.write(">");e.write("</div>")}else{s=false}var a=t[i];if(a._message&&a._message.getReadOnly()){a.addStyleClass("sapUiNotifierMessageReadOnly")}e.renderControl(a)}e.write("</div>")},metadata:{library:"sap.ui.ux3",properties:{title:"string",visibleItems:"int",renderMode:{type:"string",defaultValue:"callout"}},aggregations:{messages:"sap.ui.ux3.NotificationBar.MessageView"}},init:function(){this._oResBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.ux3")},exit:function(){if(this._renderedControl){delete this._renderedControl}delete this._oResBundle},getTitle:function(){var e=this.getProperty("title");var t=this.getMessages().length;if(t>0){var i="NOTIBAR_NOTIFIER_VIEW_TITLE";e=this._oResBundle.getText(i,[e,t])}return e},renderer:function(e,t){e.write("<div");e.addClass("sapUiNotifierContainer");e.writeControlData(t);e.writeClasses();e.write(">");e.write("<div");e.writeAttribute("id",t.getId()+"-title");e.addClass("sapUiNotifierTitle");e.writeClasses();e.write(">");e.writeEscaped(t.getTitle());e.write("</div>");if(t.getMessages().length>0){t.renderMessages(e)}e.write("</div>")},onAfterRendering:function(){var e=this.$("content"),t=e.children(".sapUiNotifierMessage"),i=t.length,s=this.getVisibleItems();if(i>s){setTimeout(this._fnAfterRenderingCallback.bind(this,t,e,s),0)}},_fnAfterRenderingCallback:function(t,i,s){var a=s-1,r=0;t.each(function(){if(r===s){i.css("max-height",a);return}a+=e(this).outerHeight();r++})}});t.extend("sap.ui.ux3.NotificationBar.MessageView",{metadata:{library:"sap.ui.ux3",properties:{text:"string",timestamp:"string",icon:"sap.ui.core.URI"}},renderer:function(e,t){var i=t.getId();e.write("<div");e.writeControlData(t);e.addClass("sapUiNotifierMessage");e.writeClasses();e.writeAttribute("tabindex","0");e.write(">");if(t.getIcon()){e.write("<div");e.writeAttribute("id",i+"-icon");e.addClass("sapUiNotifierMessageIcon");e.writeClasses();e.write(">");e.write("<img");e.writeAttributeEscaped("src",t.getIcon());e.write(">");e.write("</div>")}e.write("<div");e.writeAttribute("id",i+"-text");e.addClass("sapUiNotifierMessageText");e.writeClasses();e.write(">");e.writeEscaped(t.getText());e.write("</div>");e.write("<div");e.writeAttribute("id",i+"-timestamp");e.addClass("sapUiNotifierMessageTimestamp");e.writeClasses();e.write(">");e.writeEscaped(t.getTimestamp());e.write("</div>");e.write("</div>")},onclick:function(e){if(!this._message.getReadOnly()){var t=this._message.getParent();t.fireMessageSelected({message:this._message,notifier:t})}},onsapselect:function(e){this.onclick(e)},exit:function(e){if(this._message){delete this._message}}});var d=function(e){var t=e.hasItems();var i=e.getVisibleStatus();if(t&&i==="None"){return true}else if(!t&&i!=="None"){return true}else if(!t&&i!=="Min"){return true}else{return false}};var c=function(e,t){var i=t.getMessages().concat([]);if(i.length>0){i.sort(o.compareByType);var s=i.length-1;e._sSeverestMessageLevel=i[s].getLevel()}};var v=function(e){var t=e.getParameter("callout");switch(e.getParameter("type")){case"added":case"removed":var i=e.getParameter("notifier");if(this.getMessageNotifier()&&this.getMessageNotifier().getId()===i.getId()){c(this,this.getMessageNotifier())}if(d(this)){var s=this.hasItems();this.fireDisplay({show:s})}else{this.invalidate();if(e.getParameter("type")==="removed"){if(t.getContent().length>0){var a=t.getContent()[0];var r=e.getParameter("message");var o=a.getMessages();var n;for(var g=0;g<o.length;g++){n=o[g];if(r.getId()===n._message.getId()){n.destroy();t.rerender();t.adjustPosition();break}}}}}break;case"openCallout":t.destroyContent();var i=e.getParameter("notifier");i.destroyAggregation("views",true);var l=i.getId();var f=this.getMessageNotifier();if(f&&l===f.getId()){l+="-messageNotifierView"}else{l+="-messageView"}var h=new u.NotifierView(l,{title:i.getTitle(),visibleItems:this._visibleItems});if(i._bEnableMessageSelect){h.addStyleClass("sapUiNotifierSelectable")}var v=i.getMessages();for(var g=0;g<v.length;g++){var m=p(v[g],i,this);h.addMessage(m)}i.addAggregation("views",h,true);t.addContent(h);break}};u.HOVER_ITEM_HEIGHT=16;u.prototype.init=function(){this._oItemNavigation=new i;this._oItemNavigation.setCycling(true);this.addDelegate(this._oItemNavigation);this._iCalloutWidth=parseInt(250);this._iCalloutHeight=parseInt(200);this._visibleItems=5;this._eventListener=e.proxy(v,this);this._oResBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.ux3");this._togglerPosition="50%";this._gapMessageArea="5";this._sSeverestMessageLevel=f.None;e(window).on("resize",e.proxy(S,this));this._proxyEnableMessageSelect=e.proxy(N,this);this.data("sap-ui-fastnavgroup","true",true);this.setAlwaysShowToggler(false)};u.prototype.exit=function(){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation;delete this._iCalloutWidth;delete this._iCalloutHeight;delete this._visibleItems;delete this._eventListener;if(this.getMessageNotifier()){var t=this.getMessageNotifier();t._oMessageArea.destroy();delete t._oMessageArea}delete this._resizeFrom;delete this._resizeTo;delete this._oResBundle;delete this._formerVisibleStatus;delete this._togglerPosition;delete this._gapMessageArea;delete this._isHovered;delete this._togglerClicked;delete this._sSeverestMessageLevel;e(window).off("resize",S);delete this._proxyEnableMessageSelect};var p=function(e,t,i){var s=new u.MessageView(t.getId()+"-messageView-"+e.getId(),{text:e.getText(),timestamp:e.getTimestamp()});s._message=e;if(t.sParentAggregationName=="messageNotifier"){if(i.getVisibleStatus()==h.Max){s.setIcon(e.getIcon()||e.getDefaultIcon("32x32"))}else{s.setIcon(e.getIcon()||e.getDefaultIcon())}}else{s.setIcon(e.getIcon())}return s};var m=function(e,t){t.attachEvent("_childControlCalling",e._eventListener,e)};var M=function(e,t){t.detachEvent("_childControlCalling",e._eventListener,e)};u.prototype.addNotifier=function(e){if(e){var t=this.getVisibleStatus()==h.None?true:false;this.addAggregation("notifiers",e,t);m(this,e)}return this};u.prototype.insertNotifier=function(e,t){if(e){this.insertAggregation("notifiers",e,t);m(this,e)}return this};u.prototype.removeNotifier=function(e){var t=this.removeAggregation("notifiers",e);M(this,t);return t};u.prototype.removeAllNotifiers=function(){var e=this.removeAllAggregation("notifiers");for(var t=0;t<e.length;t++){var i=e[t];M(this,i)}return e};u.prototype.destroyNotifiers=function(){var e=this.getNotifiers();for(var t=0;t<e.length;t++){var i=e[t];M(this,i)}this.destroyAggregation("notifiers");return this};var N=function(e){var t=this.getMessageNotifier();if(t&&t.getId()===e.getParameter("notifier").getId()){t.invalidate()}};u.prototype.setMessageNotifier=function(e){var t=this.getMessageNotifier();if(t){t._oMessageArea.destroy();delete t._oMessageArea;t.detachEvent("_enableMessageSelect",this._proxyEnableMessageSelect);M(this,t)}this.setAggregation("messageNotifier",e);if(e){e._oMessageArea=new u.MessageView(this.getId()+"-inplaceMessage");e._oMessageArea.setParent(e);e.attachEvent("_enableMessageSelect",this._proxyEnableMessageSelect);m(this,e)}return this};u.prototype.destroyMessageNotifier=function(e){var t=this.getMessageNotifier();if(t){t._oMessageArea.destroy();delete t._oMessageArea;t.detachEvent("_enableMessageSelect",this._proxyEnableMessageSelect);M(this,t)}this.destroyAggregation("messageNotifier");return this};var _=function(e,t){var i=e.$();switch(t){case h.Min:i.addClass("sapUiNotificationBarMinimized");break;case h.Max:var s=e.getHeightOfStatus(e.getVisibleStatus());i.addClass("sapUiNotificationBarMaximized");i.css("height",s);var a=e.$("containers");a.css("max-height",s);break;case h.None:if(!e._resizeTo){i.css("display","none")}break;case h.Default:default:i.removeClass("sapUiNotificationBarMaximized");i.removeClass("sapUiNotificationBarMinimized");break}};var w=function(e){if(x(e)){var t=e.getHeightOfStatus(e._resizeFrom);var i=e.$();i.css("height",t);var s=e.getHeightOfStatus(e._resizeTo);i.stop(true,true).animate({height:s},"fast",function(){var t=e.getVisibleStatus();if(t==="None"){i.css("display","none");if(e.hasItems()){if(e.getMessageNotifier()){var s=e.getMessageNotifier();s.$().css("display","none")}if(e.getNotifiers().length>0){var a=e.getNotifiers();for(var r=0;r<a.length;r++){a[r].$().css("display","none")}}}}_(e,t);V(e,t)})}else{var a=e.getVisibleStatus();_(e,a)}delete e._resizeFrom;delete e._resizeTo};var b=function(t){if(t.getMessageNotifier()&&t.getMessageNotifier().hasItems()){var i;var s=t.getId()+"-notifiers";var a=e(document.getElementById(s));if(a.length>0){var r=parseInt(a.width());var o=a.children();for(var n=0;n<o.length;n++){var g=e(o[n]);if(g.hasClass("sapUiNotifier")){r-=g.width()}else if(g.hasClass("sapUiNotifierSeparator")){r-=g.width()}else if(g.hasClass("sapUiInPlaceMessage")){i=g}}if(i){r-=t._gapMessageArea+2;i.css("width",r+"px")}}}};u.prototype.onAfterRendering=function(){this._oItemNavigation.setRootDomRef(this.getDomRef());var t=[];var i=this.getVisibleStatus()===h.Max;if(i){var s=this.getMessageNotifier();if(s!=null){var a=s.getMessages();var r=s.getId()+"-messageNotifierView-messageView-";for(var o=a.length-1;o>=0;o--){var n=document.getElementById(r+a[o].getId());if(n){t.push(n)}}}var l=this.getNotifiers();for(var o=0;o<l.length;o++){var a=l[o].getMessages();var r=l[o].getId()+"-notifierView-messageView-";for(var f=a.length-1;f>=0;f--){var n=document.getElementById(r+a[f].getId());if(n){t.push(n)}}}}else{var l=this.getNotifiers();for(var o=0;o<l.length;o++){var n=l[o].getDomRef();if(n){t.push(n)}}var s=this.getMessageNotifier();if(s!=null){var n=s.getDomRef();if(n){t.push(n)}n=this.getDomRef("inplaceMessage");if(n&&e(n).hasClass("sapUiInPlaceMessageSelectable")){t.push(n)}}}this._oItemNavigation.setItemDomRefs(t);w(this);b(this);y(this,this.getMessageNotifier());I(this);if(g.browser.mobile){var u=this.$("toggler");if(this.getVisibleStatus()!==h.None){u.css("display","block")}else{u.css("display","none")}}};var y=function(e,t){if(t&&t.hasItems()){var i=t.$("counter");i.removeClass("sapUiMessageInformation");i.removeClass("sapUiMessageSuccess");i.removeClass("sapUiMessageWarning");i.removeClass("sapUiMessageError");c(e,t);var s=e._sSeverestMessageLevel;i.addClass("sapUiMessage"+s);var a=t.getMessages().length;var r="NOTIBAR_MESSAGE_NOTIFIER_DESC_LEVEL_"+s.toUpperCase()+(a===1?"_SING":"_PL");C(e,t,r,a)}};var I=function(e){var t=e.getNotifiers();for(var i=0;i<t.length;i++){var s=t[i].getMessages().length;var a="NOTIBAR_NOTIFIER_COUNT_TEXT_"+(s===1?"SING":"PL");C(e,t[i],a,s)}};var C=function(e,t,i,s){var a=t.$("description");var r=e._oResBundle.getText(i,[s]);a.html(r)};var S=function(e){b(this)};var x=function(e){if(e._resizeFrom&&e._resizeTo){if(e._resizeFrom!=e._resizeTo){return true}}return false};u.prototype.hasItems=function(){var e=this.getNotifiers();if(e.length>0){for(var t=0;t<e.length;t++){var i=e[t];if(i.hasItems()){return true}}}if(this.getMessageNotifier()){if(this.getMessageNotifier().hasItems()){return true}}return false};var V=function(e,t){var i="none";var s=e.$();switch(t){case h.Max:case h.None:break;case h.Min:s.stop().animate({height:e.getHeightOfStatus(t)},{duration:"fast",queue:true});s.addClass("sapUiNotificationBarMinimized");e.$("notifiers").css("display","none");i="block";break;case h.Default:default:s.stop().animate({height:e.getHeightOfStatus(t)},{duration:"fast",queue:true});s.removeClass("sapUiNotificationBarMaximized");s.removeClass("sapUiNotificationBarMinimized");break}var a=e.$("hoverItem");a.css("display",i)};u.prototype.onfocusin=function(e){if(this._togglerClicked){delete this._togglerClicked;e.stopImmediatePropagation(true)}};u.prototype.onclick=function(t){this._togglerClicked=true;this.$().trigger("blur");var i=e(document.activeElement);A(this);var s=t.target.id;var a=s.split("-");if(a){var r=this.getVisibleStatus();var o=a.length-1;switch(a[o]){case"ArrowUp":if(r==="Min"){this.setVisibleStatus("Default")}else{this.setVisibleStatus("Max")}break;case"ArrowDown":if(r==="Max"){this.setVisibleStatus("Default")}else{this.setVisibleStatus("Min")}t.preventDefault();break;case"BarUp":if(this._formerVisibleStatus){this.setVisibleStatus(this._formerVisibleStatus)}else{this.setVisibleStatus("Default")}break;case"BarDown":this._formerVisibleStatus=r;this.setVisibleStatus("Min");i.trigger("blur");break;default:if(i.hasClass("sapUiNotifier")){i.trigger("focus")}else{if(this.hasItems()){var n=this.getNotifiers();if(n.length>0){var g=e(n[0]);g.trigger("focus")}else{var l=this.getMessageNotifier();if(l){e(l).trigger("focus")}}}}break}}};u.prototype.onThemeChanged=function(e){if(this.getDomRef()){this.invalidate()}};var A=function(e){var t=e.getNotifiers();for(var i=0;i<t.length;i++){var s=t[i];s._oCallout.close()}if(e.getMessageNotifier()){e.getMessageNotifier()._oCallout.close()}};u.prototype.getHeightOfStatus=function(e){if(e==h.None){return"0px"}var t=Object.assign({sapUiNotificationBarHeightMinimized:"0px",sapUiNotificationBarHeight:"40px",sapUiNotificationBarHeightMaximized:"40%"},s.get({name:["sapUiNotificationBarHeightMinimized","sapUiNotificationBarHeight","sapUiNotificationBarHeightMaximized"],callback:this.invalidate.bind(this)}));switch(e){case h.Min:return t["sapUiNotificationBarHeightMinimized"];case h.Max:return this.calculateStatusHeightMax(t["sapUiNotificationBarHeightMaximized"]);case h.Default:default:return t["sapUiNotificationBarHeight"]}};u.prototype.calculateStatusHeightMax=function(t){var i=t.indexOf("%");if(i!==-1){var s=parseInt(t),a=e(window).height();a=parseInt(a/100*s);var r=parseInt(this.getHeightOfStatus(h.Default));if(a<r){a=r+1}}else{l.warning("No valid percantage value given for maximized size. 400px is used");a=400}return a+"px"};u.prototype.setVisibleStatus=function(e){this._resizeFrom=this.getVisibleStatus();this._resizeTo=e;if(this._resizeFrom!==this._resizeTo){if(e===h.None){A(this);if(this.getDomRef()){V(this,e)}else{this.$().css({height:"0px",display:"none"})}}this.setProperty("visibleStatus",e);this.fireResize({status:e})}return this};u.prototype.setAlwaysShowToggler=function(e){if(g.browser.mobile){e=true}this.setProperty("alwaysShowToggler",e,true);var t=this.$("toggler");if(e){t.css("display","block")}else{t.css("display","none")}return this};return u});