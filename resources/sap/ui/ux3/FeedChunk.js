/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/commons/MenuButton","sap/ui/core/Control","sap/ui/core/theming/Parameters","./Feeder","./library","./FeedChunkRenderer","sap/ui/commons/Menu","sap/ui/commons/MenuItem"],function(e,t,o,n,i,s,r,a,u){"use strict";var l=s.FeederType;var h=o.extend("sap.ui.ux3.FeedChunk",{metadata:{deprecated:true,library:"sap.ui.ux3",properties:{thumbnailSrc:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},text:{type:"string",group:"Data",defaultValue:null},sender:{type:"string",group:"Data",defaultValue:null},timestamp:{type:"string",group:"Data",defaultValue:null},deletionAllowed:{type:"boolean",group:"Behavior",defaultValue:false},commentChunk:{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},feederThumbnailSrc:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},feederSender:{type:"string",group:"Data",defaultValue:null},flagged:{type:"boolean",group:"Data",defaultValue:false},favorite:{type:"boolean",group:"Data",defaultValue:null},shared:{type:"boolean",group:"Data",defaultValue:false},enableFlag:{type:"boolean",group:"Appearance",defaultValue:true},enableShare:{type:"boolean",group:"Appearance",defaultValue:true},enableComment:{type:"boolean",group:"Appearance",defaultValue:true},enableInspect:{type:"boolean",group:"Appearance",defaultValue:true},enableFavorite:{type:"boolean",group:"Appearance",defaultValue:true}},aggregations:{comments:{type:"sap.ui.ux3.FeedChunk",multiple:true,singularName:"comment",bindable:"bindable"},actionMenuItems:{type:"sap.ui.commons.MenuItem",multiple:true,singularName:"actionMenuItem",bindable:"bindable"}},events:{deleted:{},commentAdded:{parameters:{comment:{type:"sap.ui.ux3.FeedChunk"}}},toggleFlagged:{parameters:{flagged:{type:"boolean"}}},senderClicked:{},referenceClicked:{parameters:{text:{type:"string"}}},toggleFavorite:{parameters:{favorite:{type:"boolean"}}},inspect:{},toggleShared:{parameters:{shareed:{type:"boolean"}}},actionItemSelected:{parameters:{itemId:{type:"string"},item:{type:"sap.ui.unified.MenuItemBase"}}}}}});h.prototype.init=function(){this.maxComments=2;this.allComments=false;this.rb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.ux3");this.expanded=false};h.prototype.initCommentFeeder=function(){if(!this.oCommentFeeder){this.oCommentFeeder=new i(this.getId()+"-CommentFeeder",{type:l.Comment}).setParent(this);this.oCommentFeeder.attachEvent("submit",this.handleCommentFeederSubmit,this);this.showCommentFeeder=true}};h.prototype.initToolsButton=function(){if(!this.oToolsButton){this.oToolsButton=new t(this.getId()+"-toolsButton",{tooltip:this.rb.getText("FEED_TOOLS"),lite:true,menu:new a(this.getId()+"-toolsMenu")}).setParent(this);this.oToolsButton.attachEvent("itemSelected",this.handleToolsButtonSelected,this);var e=n._getThemeImage("_sap_ui_ux3_Feed_ToolsIconUrl");var o=n._getThemeImage("_sap_ui_ux3_Feed_ToolsIconHoverUrl");if(e){this.oToolsButton.setProperty("icon",e,true)}if(o){this.oToolsButton.setProperty("iconHovered",o,true)}}};h.prototype.exit=function(){if(this.oCommentFeeder){this.oCommentFeeder.destroy();delete this.oCommentFeeder}if(this.oToolsButton){this.oToolsButton.destroy();delete this.oToolsButton}this.rb=undefined;this.showCommentFeeder=undefined;this.expanded=undefined;this.oText=undefined;if(this.oHCMMenuButton){this.oHCMMenuButton.destroy();delete this.oHCMMenuButton}};h.prototype.onAfterRendering=function(){this.oText=this.$().children(".sapUiFeedChunkText").get(0);if(this.oText.clientHeight<this.oText.scrollHeight){var t=this.$().children(".sapUiFeedChunkByline").get(0);e(t).append(r.renderExpander(this));if(this.expanded){e(this.oText).css("height","auto")}}};h.prototype.onclick=function(t){var o=t.target.getAttribute("ID");if(o){switch(o){case this.getId()+"-delete":this.fireDeleted();break;case this.getId()+"-sender":this.fireSenderClicked();break;case this.getId()+"-thumb":this.fireSenderClicked();break;case this.getId()+"-exp":var n="";if(this.expanded){e(this.oText).css("height","");n=this.rb.getText("FEED_EXPAND");this.expanded=false}else{e(this.oText).css("height","auto");n=this.rb.getText("FEED_COLLAPSE");this.expanded=true}e(document.getElementById(o)).attr("title",n).toggleClass("sapUiFeedChunkExpand sapUiFeedChunkCollapse");break;case this.getId()+"-all":this.showAllComments();break;case this.getId()+"-ActComment":if(!this.showCommentFeeder){this.initCommentFeeder();this.rerender()}break;case this.getId()+"-ActFlag":this.setFlagged(!this.getFlagged());this.fireToggleFlagged({flagged:this.getFlagged()});break;case this.getId()+"-ActFavorite":this.setFavorite(!this.getFavorite());this.fireToggleFavorite({favorite:this.getFavorite()});break;case this.getId()+"-ActInspect":this.fireInspect();break;case this.getId()+"-ActShare":this.setShared(!this.getShared());this.fireToggleShared({shared:this.getShared()});break;default:if(o.search(this.getId()+"-Ref")!=-1){this.fireReferenceClicked({text:e(t.target).text()})}break}}t.preventDefault();t.stopPropagation()};h.prototype.showAllComments=function(){this.allComments=!this.allComments;var e=this.$().children("section");if(e.length>0){var t=sap.ui.getCore().createRenderManager();this.getRenderer().renderComments(t,this);t.flush(e[0]);t.destroy()}};h.prototype.handleCommentFeederSubmit=function(e){var t=new Date;var o=String(t);var n=new h(this.getId()+"-new-"+this.getComments().length,{text:e.getParameter("text"),commentChunk:true,deletionAllowed:true,timestamp:o,sender:this.getFeederSender(),thumbnailSrc:this.getFeederThumbnailSrc()});this.addComment(n);this.fireCommentAdded({comment:n})};h.prototype.handleToolsButtonSelected=function(e){if(e.getParameter("itemId")==this.getId()+"-actDelete"){this.fireDeleted()}else{this.fireActionItemSelected(e.mParameters)}};h.prototype.insertComment=function(e,t){this.insertAggregation("comments",e,t);this.initCommentFeeder();return this};h.prototype.addComment=function(e){this.addAggregation("comments",e);this.initCommentFeeder();return this};h.prototype.setDeletionAllowed=function(e){if(e==this.getDeletionAllowed()){return this}this.setProperty("deletionAllowed",e);if(e){this.initToolsButton();this.oToolsButton.getMenu().insertItem(new u(this.getId()+"-actDelete",{text:this.rb.getText("FEED_DELETE")}),0)}else{if(this.oToolsButton){this.oToolsButton.getMenu().removeItem(this.getId()+"-actDelete")}}return this};h.prototype.getActionMenuItems=function(){if(this.oToolsButton){var e=this.oToolsButton.getMenu().getItems();if(e.length>0&&e[0].getId()==this.getId()+"-actDelete"){e.shift()}return e}};h.prototype.insertActionMenuItem=function(e,t){this.initToolsButton();var o=this.oToolsButton.getMenu().getItems();if(o.length>0&&o[0].getId()==this.getId()+"-actDelete"){t++}this.oToolsButton.getMenu().insertItem(e,t);return this};h.prototype.addActionMenuItem=function(e){this.initToolsButton();this.oToolsButton.getMenu().addItem(e);return this};h.prototype.removeActionMenuItem=function(e){if(this.oToolsButton){return this.oToolsButton.getMenu().removeItem(e)}};h.prototype.removeAllActionMenuItems=function(){if(this.oToolsButton){var e=this.oToolsButton.getMenu().getItems();if(e.length>0&&e[0].getId()==this.getId()+"-actDelete"){e.shift();for(var t=0;t<e.length;t++){this.oToolsButton.getMenu().removeItem(e[t])}return e}else{return this.oToolsButton.getMenu().removeAllItems()}}};h.prototype.indexOfActionMenuItem=function(e){if(this.oToolsButton){var t=this.oToolsButton.getMenu().indexOfItem(e);var o=this.oToolsButton.getMenu().getItems();if(o.length>0&&o[0].getId()==this.getId()+"-actDelete"){t--}return t}};h.prototype.destroyActionMenuItems=function(){if(this.oToolsButton){var e=this.oToolsButton.getMenu().getItems();if(e.length>0&&e[0].getId()==this.getId()+"-actDelete"){this.removeAllActionMenuItems()}else{this.oToolsButton.getMenu().destroyItems()}}return this};h.prototype.bindActionMenuItems=function(e,t,o,n){this.initToolsButton();this.oToolsButton.getMenu().bindItems(e,t,o,n);return this};h.prototype.unbindActionMenuItems=function(){if(this.oToolsButton){this.oToolsButton.getMenu().unbindItems()}return this};h.prototype.getFeederThumbnailSrc=function(){var e=this.getProperty("feederThumbnailSrc");if(!e||e==""){var t=this.getParent();if(t&&(t instanceof sap.ui.ux3.Feed||t instanceof h)){e=t.getFeederThumbnailSrc()}}return e};h.prototype.getFeederSender=function(){var e=this.getProperty("feederSender");if(!e||e==""){var t=this.getParent();if(t&&(t instanceof sap.ui.ux3.Feed||t instanceof h)){e=t.getFeederSender()}}return e};h.prototype.initHCMMenuButton=function(){if(!this.oHCMMenuButton){this.oHCMMenuButton=new t(this.getId()+"-HCMMenu",{lite:true}).setParent(this);this.oHCMMenuButton.attachEvent("itemSelected",this.handleHCMMenuButtonSelected,this)}};h.prototype.setHCMMenu=function(e){this.initHCMMenuButton();this.oHCMMenuButton.setMenu(e);return this};h.prototype.handleHCMMenuButtonSelected=function(e){this.fireEvent("HCMMenuItemSelected",e.mParameters)};return h});