/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/base/ManagedObject","sap/m/Token","sap/m/library","sap/ui/comp/util/FormatUtil"],function(e,t,a,r,o){"use strict";var n=e.valuehelpdialog.ValueHelpRangeOperation;var i=r.P13nConditionOperation;var p=function(e){this._sDefaultOperation=e;this._aKeyFields=[];this._mTypeOperations={default:[i.EQ,i.BT,i.LT,i.LE,i.GT,i.GE,i.NotEQ,i.NotBT,i.NotLT,i.NotLE,i.NotGT,i.NotGE],string:[i.Empty,i.NotEmpty,i.Contains,i.EQ,i.BT,i.StartsWith,i.EndsWith,i.LT,i.LE,i.GT,i.GE,i.NotEQ,i.NotContains,i.NotStartsWith,i.NotEndsWith,i.NotBT,i.NotLT,i.NotLE,i.NotGT,i.NotGE],date:[i.Empty,i.NotEmpty,i.EQ,i.BT,i.LT,i.LE,i.GT,i.GE,i.NotEQ,i.NotBT,i.NotLT,i.NotLE,i.NotGT,i.NotGE],time:[i.EQ,i.BT,i.LT,i.LE,i.GT,i.GE,i.NotEQ,i.NotBT,i.NotLT,i.NotLE,i.NotGT,i.NotGE],numeric:[i.EQ,i.BT,i.LT,i.LE,i.GT,i.GE,i.NotEQ,i.NotBT,i.NotLT,i.NotLE,i.NotGT,i.NotGE],numc:[i.Contains,i.EQ,i.BT,i.EndsWith,i.LT,i.LE,i.GT,i.GE,i.NotContains,i.NotEQ,i.NotBT,i.NotEndsWith,i.NotLT,i.NotLE,i.NotGT,i.NotGE],boolean:[i.EQ]};this._init()};function s(e){var t=this.re.exec(e),a=t[1],r=t[2];if(t){if(a&&a.trim){a=a.trim()}if(r&&r.trim){r=r.trim()}return[a,r]}return[]}p.rangeOperations={};p.rangeOperations[i.Empty]={regex:new RegExp("^"+o.getFormattedRangeText(n.Empty,null,null,false)+"$","i"),operator:i.Empty,example:o.getFormattedRangeText(n.Empty,null,null,false),template:o.getFormattedRangeText(n.Empty,null,null,false),exclude:false,parse:function(e){return[]}};p.rangeOperations[i.BT]={regex:/^([^!].*)\.\.\.(.+)$/,operator:i.BT,example:"foo...bar",template:"$0...$1",exclude:false,parse:s};p.rangeOperations[i.EQ]={regex:/^\=(.+)$/,operator:i.EQ,example:"=foo",template:"=$0",exclude:false};p.rangeOperations[i.Contains]={regex:/^\*(.+)\*$/,operator:i.Contains,example:"*foo*",template:"*$0*",exclude:false};p.rangeOperations[i.StartsWith]={regex:/^([^\*!].*)\*$/,operator:i.StartsWith,example:"foo*",template:"$0*",exclude:false};p.rangeOperations[i.EndsWith]={regex:/^\*(.*[^\*])$/,operator:i.EndsWith,example:"*foo",template:"*$0",exclude:false};p.rangeOperations[i.LT]={regex:/^\<([^\=].*)$/,operator:i.LT,example:"< foo",template:"<$0",exclude:false};p.rangeOperations[i.LE]={regex:/^\<\=(.+)$/,operator:i.LE,example:"<=foo",template:"<=$0",exclude:false};p.rangeOperations[i.GT]={regex:/^\>([^\=].*)$/,operator:i.GT,example:"> foo",template:">$0",exclude:false};p.rangeOperations[i.GE]={regex:/^>=(.+)$/,operator:i.GE,example:">=foo",template:">=$0",exclude:false};p.rangeOperations[i.NotEmpty]={regex:new RegExp("^"+o.getFormattedRangeText(n.Empty,null,null,true).replace("(","\\(").replace(")","\\)")+"$","i"),operator:i.NotEmpty,example:o.getFormattedRangeText(n.Empty,null,null,true),template:o.getFormattedRangeText(n.Empty,null,null,true),exclude:true,parse:function(e){return[]}};p.rangeOperations[i.NotBT]={regex:/^![(]?(.+)\.\.\.([^)]+)[)]?$/,operator:i.NotBT,example:"!foo...bar",template:"!($0...$1)",exclude:true,parse:s};p.rangeOperations[i.NotEQ]={regex:/^![(]?=(.+?)[)]?$/,operator:i.NotEQ,example:"!=foo",template:"!(=$0)",exclude:true};p.rangeOperations[i.NotContains]={regex:/^![(]?\*(.+)\*[)]?$/,operator:i.NotContains,example:"!*foo*",template:"!(*$0*)",exclude:true};p.rangeOperations[i.NotStartsWith]={regex:/^![(]?([^\\*].*)\*[)]?$/,operator:i.NotStartsWith,example:"!foo*",template:"!($0*)",exclude:true};p.rangeOperations[i.NotEndsWith]={regex:/^![(]?\*([^\*)]*)[)]?$/,operator:i.NotEndsWith,example:"!*foo",template:"!(*$0)",exclude:true};p.rangeOperations[i.NotLT]={regex:/^![(]?<([^=].*?)[)]?$/,operator:i.NotLT,example:"!<foo",template:"!(<$0)",exclude:true};p.rangeOperations[i.NotLE]={regex:/^![(]?<=(.+?)[)]?$/,operator:i.NotLE,example:"!<=foo",template:"!(<=$0)",exclude:true};p.rangeOperations[i.NotGT]={regex:/^![(]?>([^=].*?)[)]?$/,operator:i.NotGT,example:"!>foo",template:"!(>$0)",exclude:true};p.rangeOperations[i.NotGE]={regex:/^![(]?>=(.+?)[)]?$/,operator:i.NotGE,example:"!>=foo",template:"!(>=$0)",exclude:true};p.excludeOperationsMapping={};p.excludeOperationsMapping[i.NotEmpty]=i.Empty;p.excludeOperationsMapping[i.NotLT]=i.LT;p.excludeOperationsMapping[i.NotLE]=i.LE;p.excludeOperationsMapping[i.NotGT]=i.GT;p.excludeOperationsMapping[i.NotGE]=i.GE;p.excludeOperationsMapping[i.NotContains]=i.Contains;p.excludeOperationsMapping[i.NotStartsWith]=i.StartsWith;p.excludeOperationsMapping[i.NotEndsWith]=i.EndsWith;p.excludeOperationsMapping[i.NotBT]=i.BT;p.excludeOperationsMapping[i.NotEQ]=i.EQ;p.prototype._init=function(){this.createOperation(p.rangeOperations[i.Empty]);this.createOperation(p.rangeOperations[i.BT]);this.createOperation(p.rangeOperations[i.EQ]);this.createOperation(p.rangeOperations[i.Contains]);this.createOperation(p.rangeOperations[i.StartsWith]);this.createOperation(p.rangeOperations[i.EndsWith]);this.createOperation(p.rangeOperations[i.LT]);this.createOperation(p.rangeOperations[i.LE]);this.createOperation(p.rangeOperations[i.GT]);this.createOperation(p.rangeOperations[i.GE]);this.createOperation(p.rangeOperations[i.NotEmpty]);this.createOperation(p.rangeOperations[i.NotBT]);this.createOperation(p.rangeOperations[i.NotEQ]);this.createOperation(p.rangeOperations[i.NotContains]);this.createOperation(p.rangeOperations[i.NotStartsWith]);this.createOperation(p.rangeOperations[i.NotEndsWith]);this.createOperation(p.rangeOperations[i.NotLT]);this.createOperation(p.rangeOperations[i.NotLE]);this.createOperation(p.rangeOperations[i.NotGT]);this.createOperation(p.rangeOperations[i.NotGE])};p.prototype.destroy=function(){if(this._oInput&&!this._oInput.bIsDestroyed){this._oInput.removeValidator(this._validator);if(this._aOrgValidators&&this._aOrgValidators.length>0){this._oInput.addValidator(this._aOrgValidators)}this._oInput=null}this._aOrgValidators=null;this._aKeyFields=null;this._mTypeOperations=null};p.prototype.setDefaultOperation=function(e){this._sDefaultOperation=e};p.prototype.getDefaultOperation=function(){return this._sDefaultOperation};p.prototype.getOperations=function(){return this._mOperations};p.prototype.getOperation=function(e){return this._mOperations&&this._mOperations[e]};p.prototype._getKeyFieldByLabel=function(e){var t;this._aKeyFields.some(function(a){if(a.label.toUpperCase()===e.toUpperCase()){t=a}},this);return t};p.prototype.addKeyField=function(e){this._aKeyFields.push(e)};p.prototype.getKeyFields=function(){return this._aKeyFields};p.prototype.addTypeOperations=function(e,t){this._mTypeOperations[e]=t};p.prototype.removeTypeOperations=function(e){delete this._mTypeOperations[e]};p.prototype.getTypeOperations=function(e){return this._mTypeOperations[e]||this._mTypeOperations["default"]};p.prototype.createOperation=function(e){var t=e.operator,a=e.example,r=e.regex,o=e.template,n=e.parse,i=e.exclude;if(!this._mOperations){this._mOperations={}}this._mOperations[t]={key:t,example:a,re:r,template:o,exclude:i,parser:this,match:function(e,t){var a=this.re.exec(e);if(a){var r=this.parse(e);if(t){r.forEach(function(e){if(t.hasOwnProperty("maxLength")&&t.maxLength>=0&&e.length>t.maxLength){a=null}if(t.oType){try{e=t.oType.parseValue(e,"string");t.oType.validateValue(e)}catch(e){a=null}}},this)}}return a},parse:n||function(e){var t=this.re.exec(e);if(t){var a=t[1]||t[2];if(a&&a.trim){a=a.trim()}return[a]}return[]},getFilledTemplate:function(e,t){var a=this.parse(e);var r=[];var o="";for(var n=0;n<a.length;n++){r[n]=this.formatValue(a[n],false,t)}o=p._templateReplace(this.template,r);return o},getConditionData:function(e,t){var a={};a.exclude=this.exclude;if(this.exclude){a.operation=p.excludeOperationsMapping[this.key];if(!a.operation){a.operation=this.key}}else{a.operation=this.key}var r=this.parse(e);for(var o=0;o<r.length;o++){a["value"+(o+1)]=this.formatValue(r[o],true,t)}return a},formatValue:function(e,t,a){if(!a){return e}if(a.hasOwnProperty("maxLength")){if(a.maxLength>=0){e=e.substring(0,a.maxLength)}}if(a.displayFormat){if(a.displayFormat==="UpperCase"){e=e.toUpperCase()}}if(a.oType){try{e=a.oType.parseValue(e,"string");a.oType.validateValue(e)}catch(e){return"ERROR"}if(!t){e=a.oType.formatValue(e,"string")}}return e}};return this._mOperations[t]};p.prototype.removeOperation=function(e){delete this._mOperations[e]};p.prototype.removeAllOperations=function(){var e=Object.keys(this._mOperations);e.forEach(function(e){delete this._mOperations[e]},this)};p.prototype.getTranslatedText=function(e,t,a){var r=t.key;e=e!=="default"?"_"+e.toUpperCase()+"_":"";if(e==="_STRING_"||e==="_BOOLEAN_"||e==="_NUMC_"){e=""}if(e==="_TIME_"){e="_DATE_"}if(!a){a="sap.m"}r="CONDITIONPANEL_OPTION"+e+r;var o=sap.ui.getCore().getLibraryResourceBundle(a).getText(r)||r;if(o.startsWith("CONDITIONPANEL_OPTION")){r="CONDITIONPANEL_OPTION"+t.key;o=sap.ui.getCore().getLibraryResourceBundle(a).getText(r)}return o};p.prototype.associateInput=function(e){this._oInput=e;this._aOrgValidators=this._oInput&&this._oInput.isA("sap.m.MultiInput")?this._oInput.getValidators().slice():[];this._oInput.removeAllValidators();this._oInput.addValidator(this._validator.bind(this))};p.prototype._validator=function(e){if(this._aOrgValidators){var t;this._aOrgValidators.some(function(a){t=a(e);return t},this);if(t){return t}}if(e.text){return this._onValidate(e.text)}return null};p._templateReplace=function(e,t){return e.replace(/\$\d/g,function(e){return t[parseInt(e.substr(1))]})};p.prototype._onValidate=function(e){var r=this._aKeyFields.length>0?this._aKeyFields[0]:null;if(this._oInput._getIsSuggestionPopupOpen&&this._oInput._getIsSuggestionPopupOpen()&&this._oInput._oSuggestionsTable&&this._oInput._oSuggestionsTable.getSelectedItem()){return null}if(r){var o=/^\w+\:\s/.exec(e);if(o){var n=o[0];r=this._getKeyFieldByLabel(n.slice(0,n.indexOf(":")));if(r){e=e.slice(o[0].length).trim()}}}var s=r&&r.type||"default";var l=this.getTypeOperations(s);var u=function(e,o){if(e.match(o,r)){var n=e.getConditionData(o,r);n.keyField=r?r.key:null;if(r.hasOwnProperty("maxLength")&&r.maxLength===1){if([i.Contains,i.EndsWith,i.StartsWith].indexOf(e.key)!==-1){return}}if(s==="numc"){if([i.Contains,i.EndsWith].indexOf(e.key)!==-1){n.value1=r.oType.formatValue(n.value1,"string")}}var p=(r&&r.label&&this._aKeyFields.length>1?r.label+": ":"")+e.getFilledTemplate(o,r);p=t.escapeSettingsValue(p);return new a({text:p,tooltip:p}).data("range",n)}return null}.bind(this);var g;if(l.some(function(t){g=u(this._mOperations[t],e);return g},this)){return g}if(this._sDefaultOperation&&this._mOperations[this._sDefaultOperation]){e=p._templateReplace(this._mOperations[this._sDefaultOperation].template,[e]);return u(this._mOperations[this._sDefaultOperation],e)}return null};p._createRangeByText=function(e){var t=p._matchOperationFromText(e);if(!t){return{exclude:false,operation:i.EQ,tokenText:null,value1:e,value2:null}}var a=t;var r=false;if(p.excludeOperationsMapping[t]){a=p.excludeOperationsMapping[t];r=true}var o=a===i.BT?true:false;return p._getRangeByTextAndOperation(e,a,r,o)};p._matchOperationFromText=function(e){var t=[];for(var a in p.rangeOperations){if(p.rangeOperations[a].regex.test(e)){t.push(a)}}if(t.length===0){return null}if(t.length>1){if(e===o.getFormattedRangeText(n.Empty,null,null,false)&&t.indexOf(p.rangeOperations[i.Empty].operator)>-1){t=[p.rangeOperations[i.Empty].operator]}if(e===o.getFormattedRangeText(n.Empty,null,null,true)&&t.indexOf(p.rangeOperations[i.NotEmpty].operator)>-1){t=[p.rangeOperations[i.NotEmpty].operator]}if(t.indexOf(p.rangeOperations[i.NotContains].operator)>-1&&t.indexOf(p.rangeOperations[i.NotStartsWith].operator)>-1){return p.rangeOperations[i.NotContains].operator}}return t[0]};p._getRangeByTextAndOperation=function(e,t,a,r){var o=[];if(a&&e.startsWith("!(")&&e.endsWith(")")){e=e.slice(2,-1)}var n=p.rangeOperations[t].template;if(r){o=e.split("...");return{exclude:a,operation:t,value1:o[0],value2:o[1]}}else{var i=n.indexOf("$0");var s=i+2;if(s===n.length){e=e.slice(i)}else{s=n.length-s;e=e.slice(i,-s)}return{exclude:a,operation:t,value1:e,value2:null}}};return p},true);