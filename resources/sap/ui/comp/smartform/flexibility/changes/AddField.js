/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/changeHandler/Base","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/comp/smartform/flexibility/changes/AddFields"],function(e,t,n,r){"use strict";var i={};i.applyChange=function(n,i,o){var l=n.getDefinition();var a=function(e){var t=e.texts&&e.texts.fieldLabel&&e.texts.fieldLabel.value;var n=e.content;var r=false;if(n){r=e.content.field&&(e.content.field.selector||e.content.field.id)&&e.content.field.jsType&&e.content.field.value&&e.content.field.valueProperty}return t&&n&&r};var f=o.modifier;var d=o.appComponent;var c=o.view;if(a(l)){var u=l.content;var s=u.field.selector;var p=u.field.id;var v=l.texts.fieldLabel.value;var g=u.field.jsType;var h=u.field.valueProperty;var y=u.field.value;var b=u.field.entitySet;var C=u.field.index;if(f.bySelector(s||p,d,c)){return t.markAsNotApplicable("Control to be created already exists:"+s||p,true)}return Promise.resolve().then(f.createControl.bind(f,"sap.ui.comp.smartform.GroupElement",d,c,s||p)).then(function(e){if(!s){s=f.getSelector(p,d)}n.setRevertData({newFieldSelector:s});f.setProperty(e,"label",undefined);f.setProperty(e,"label",v);return Promise.resolve().then(f.insertAggregation.bind(f,i,"groupElements",e,C,c)).then(function(){return r.addElementIntoGroupElement(f,c,e,g,h,y,b,C,d)})})}e.error("Change does not contain sufficient information to be applied: ["+l.layer+"]"+l.namespace+"/"+l.fileName+"."+l.fileType);return Promise.resolve()};i.completeChangeContent=function(e,r,i){var o=i.appComponent;var l=e.getDefinition();if(r.fieldLabel){t.setTextInChange(l,"fieldLabel",r.fieldLabel,"XFLD")}else{throw new Error("oSpecificChangeInfo.fieldLabel attribute required")}if(!l.content){l.content={}}if(!l.content.field){l.content.field={}}if(r.fieldValue){l.content.field.value=r.fieldValue}else{throw new Error("oSpecificChangeInfo.fieldValue attribute required")}if(r.valueProperty){l.content.field.valueProperty=r.valueProperty}else{throw new Error("oSpecificChangeInfo.valueProperty attribute required")}if(r.newControlId){l.content.field.selector=n.getSelector(r.newControlId,o,{index:r.index})}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(r.jsType){l.content.field.jsType=r.jsType}else{throw new Error("oSpecificChangeInfo.jsType attribute required")}if(r.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required")}else{l.content.field.index=r.index}if(r.entitySet){l.content.field.entitySet=r.entitySet}};i.revertChange=function(e,t,n){return r.revertChange(e,t,n)};i.getChangeVisualizationInfo=function(e){return{affectedControls:[e.getDefinition().content.field.selector]}};return i},true);