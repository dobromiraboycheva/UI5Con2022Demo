/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define([],function(){"use strict";var e={};e.applyChange=function(e,t,n){var r=e.getDefinition();var o=n.modifier;var i=n.appComponent;var l=n.view;var a=o.bySelector(r.content.sourceSelector,i,l);var s;var c=function(e,t){if(e.index>t.index){return 1}else if(e.index<t.index){return-1}};var g=o.bySelector(r.content.parentSelector,i,l);var u=r.content.newElementIds.slice();var p=[];var d;var f;var m;var v;return Promise.all([o.getAggregation(a,"elements"),o.getProperty(a,"elementForLabel"),o.getAggregation(g,"groupElements")]).then(function(e){d=e[0];f=e[1];m=e[2];v=m.indexOf(a);return o.getProperty(a,"label")}).then(function(e){if(e&&typeof e!=="string"){return o.getProperty(e,"text")}return e}).then(function(e){s=e;return d.reduce(function(e,t,r){if(r!==f){var c=u.pop();var d;return e.then(o.createControl.bind(o,"sap.ui.comp.smartform.GroupElement",n.appComponent,l,c)).then(function(e){d=e;p.push({groupElementSelector:o.getSelector(d,i),index:r});return Promise.resolve().then(o.removeAggregation.bind(o,a,"elements",t)).then(o.insertAggregation.bind(o,d,"elements",t,0,l)).then(o.insertAggregation.bind(o,g,"groupElements",d,v+r,l)).then(o.getProperty.bind(o,d,"label")).then(function(e){if(e&&typeof e!=="string"){o.setProperty(e,"text",s)}else{o.setProperty(d,"label",s)}})})}else{p.push({groupElementSelector:o.getSelector(a,i),index:r});if(f!==0){o.setProperty(a,"elementForLabel",0)}return e.then(o.removeAggregation.bind(o,a,"elements",t)).then(o.insertAggregation.bind(o,a,"elements",t,0,l)).then(o.getProperty.bind(o,a,"label")).then(function(e){if(e&&typeof e!=="string"){o.setProperty(e,"text",s)}else{o.setProperty(a,"label",s)}})}},Promise.resolve())}).then(function(){e.setRevertData({sourceControlSelector:r.content.sourceSelector,labelText:s,splittedFields:p.sort(c)})})};e.completeChangeContent=function(e,t,n){var r=n.modifier;var o=n.appComponent;var i=e.getDefinition();if(t.newElementIds){i.content.newElementIds=t.newElementIds.slice(0,-1)}else{throw new Error("oSpecificChangeInfo.newElementIds attribute required")}if(t.sourceControlId){i.content.sourceSelector=r.getSelector(t.sourceControlId,o);e.addDependentControl(t.sourceControlId,"sourceControl",n)}else{throw new Error("oSpecificChangeInfo.sourceControlId attribute required")}if(t.parentId){i.content.parentSelector=r.getSelector(t.parentId,o);e.addDependentControl(t.parentId,"parent",n)}else{throw new Error("oSpecificChangeInfo.parentId attribute required")}};e.revertChange=function(e,t,n){var r=n.view;var o=n.modifier;var i=n.appComponent;var l=e.getRevertData();var a=l.splittedFields;var s=o.bySelector(l.sourceControlSelector,i,r);return a.reduce(function(e,t){var n=o.bySelector(t.groupElementSelector,i,r);return e.then(o.getAggregation.bind(o,n,"elements")).then(function(e){var i=e[0];return Promise.resolve().then(o.removeAggregation.bind(o,n,"elements",i)).then(o.insertAggregation.bind(o,s,"elements",i,t.index,r))}).then(function(){if(n!==s){o.destroy(n)}})},Promise.resolve()).then(o.getProperty.bind(o,s,"label")).then(function(t){if(t&&typeof t!=="string"){o.setProperty(t,"text",l.labelText)}else{o.setProperty(s,"label",l.labelText)}e.resetRevertData()})};e.getChangeVisualizationInfo=function(e){return{affectedControls:[e.getDefinition().content.sourceSelector],dependentControls:e.getDefinition().content.newElementIds}};return e},true);