/*
 * ! SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/m/library","sap/ui/core/library","sap/ui/core/Core","sap/ui/core/ShortcutHintsMixin","sap/ui/core/format/ListFormat","sap/ui/events/KeyCodes","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FilterUtil","sap/m/Column","sap/m/ColumnListItem","sap/m/Label","sap/m/MessageBox","sap/m/Table","sap/m/Text","sap/m/Title","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/OverflowToolbarButton","sap/m/ToolbarSeparator","sap/m/VBox","sap/m/FlexItemData","sap/ui/comp/library","sap/ui/comp/providers/TableProvider","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/table/AnalyticalColumn","sap/ui/table/AnalyticalTable","sap/ui/table/Column","sap/ui/table/Table","sap/ui/table/TreeTable","sap/ui/comp/personalization/Controller","sap/ui/comp/personalization/Util","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FullScreenUtil","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/odata/ODataType","sap/ui/comp/state/UIState","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/core/format/NumberFormat","sap/ui/Device","sap/base/Log","sap/base/util/deepEqual","sap/base/util/merge","sap/m/ColumnHeaderPopover","sap/m/ColumnPopoverActionItem","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/m/Button","sap/m/Link","sap/m/MessageStrip","sap/ui/core/InvisibleMessage","sap/ui/util/openWindow","sap/ui/core/theming/Parameters","sap/m/plugins/ColumnResizer","sap/m/ColumnPopoverSelectListItem","sap/m/table/Util","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/table/columnmenu/Menu","sap/m/table/columnmenu/ActionItem","sap/base/util/UriParameters","sap/m/table/columnmenu/QuickSort","sap/m/table/columnmenu/QuickSortItem","sap/m/table/columnmenu/QuickAction","sap/m/table/columnmenu/QuickGroup","sap/m/table/columnmenu/QuickGroupItem"],function(t,e,i,a,o,n,r,s,l,u,h,d,p,g,_,f,c,m,b,T,y,C,S,v,P,E,I,x,M,B,D,A,F,w,V,L,R,O,U,H,N,W,K,k,z,G,q,j,X,Q,$,Y,Z,J,tt,et,it,at,ot,nt,rt,st,lt,ut,ht,dt,pt,gt,_t,ft,ct,mt){"use strict";var bt=e.ButtonType;var Tt=e.MenuButtonMode;var yt=e.ToolbarDesign;var Ct=e.ToolbarStyle;var St=i.SortOrder;var vt=i.TitleLevel;var Pt=v.smarttable.InfoToolbarBehavior;var Et=C.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},enableExport:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5ClientPDF"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},customizeConfig:{type:"object",group:"Misc",defaultValue:null},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:vt.Auto},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:Pt.Auto},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},enableAutoColumnWidth:{type:"boolean",group:"Misc",defaultValue:false},showPasteButton:{type:"boolean",group:"Behavior",defaultValue:false},enablePaste:{type:"boolean",group:"Behavior",defaultValue:true}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false},dataStateIndicator:{type:"sap.m.plugins.DataStateIndicator",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}},uiStateChange:{}}},renderer:{apiVersion:2},constructor:function(){this._oTableReady=function(){var t={};t.promise=new Promise(function(e){t.resolve=e});return t}();C.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._updateP13nDialogSettings();this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);this._bUseColumnMenu=pt.fromQuery(window.location.search).get("sap-ui-xx-columnmenu")==="true"}});Et.prototype._getP13nDialogSettings=function(){var t=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{t=JSON.parse(this._oP13nDialogSettings)}catch(e){t=null}}return t};Et.prototype.getDataStateIndicatorPluginOwner=function(){return this._oTable||this._oTableReady.promise};Et.prototype.setDataStateIndicator=function(t){this._handeDataStateEvents(this.getDataStateIndicator(),"detach");this.setAggregation("dataStateIndicator",t,true);this._handeDataStateEvents(this.getDataStateIndicator(),"attach");return this};Et.prototype.setCustomizeConfig=function(t){this.setProperty("customizeConfig",t,true);return this};Et.prototype.setUseExportToExcel=function(t){var e=this.getUseExportToExcel();this.setProperty("useExportToExcel",t,true);if(e!==this.getUseExportToExcel()){this.setEnableExport(t)}return this};Et.prototype.setEnableExport=function(t){var e=this.getEnableExport();this.setProperty("enableExport",t,true);if(e!==this.getEnableExport()){this.setUseExportToExcel(t)}return this};Et.prototype._validateCustomizeConfig=function(t){if(!t){return}if(t.isA){G.error("Invalid config property. Provided configuration has been deleted from the customizeConfig property - "+this.getId());this.setCustomizeConfig(null);return}for(var e in t){switch(e){case"textInEditModeSource":this._validateTextInEditModeSource(t);break;default:G.error(e+" is not a supported configuration for the customizeConfig property - "+this.getId());delete t[e];break}}};Et.prototype._validateTextInEditModeSource=function(t){var e=Object.keys(v.smartfield.TextInEditModeSource);if(typeof t["textInEditModeSource"]!=="object"||!Object.keys(t["textInEditModeSource"]).length||t["textInEditModeSource"].isA){delete t.textInEditModeSource;G.error("Invalid config property textInEditModeSource. Provided configuration has been deleted from the customizeConfig property - "+this.getId());return}for(var i in t["textInEditModeSource"]){if(!e.includes(t["textInEditModeSource"][i])){G.error("Invalid config property '"+i+"' for the textInEditModeSource property of the customizeConfig - "+this.getId());delete t["textInEditModeSource"][i]}}};Et.prototype._handeDataStateEvents=function(t,e){if(t){t[e+"ApplyFilter"](this._onApplyMessageFilter,this);t[e+"ClearFilter"](this._onClearMessageFilter,this);t[e+"Event"]("filterInfoPress",this._handleInfoToolbarPress,this)}};Et.prototype.setHeaderLevel=function(t){if(this.getHeaderLevel()===t){return this}this.setProperty("headerLevel",t,true);this._headerText&&this._headerText.setLevel(t);return this};Et.prototype._getP13nFilterMessageStrip=function(){var t,e;if(this._oMessageFilter){e=a.getLibraryResourceBundle("sap.ui.comp");t=new et({text:e.getText("SMARTTABLE_P13N_FILTER_MESSAGESTRIP"),link:new tt({text:e.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"),press:[function(){this._fnClearMessageFilter();t.setVisible(false)},this]})})}return t};Et.prototype._onApplyMessageFilter=function(t){this._fnClearMessageFilter=t.getParameter("revert");this._oMessageFilter=t.getParameter("filter");t.preventDefault();this._reBindTable()};Et.prototype._onClearMessageFilter=function(t){this._oMessageFilter=null;t.preventDefault();this._reBindTable()};Et.prototype.init=function(){C.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={}};Et.prototype._getVariantManagementControl=function(t){var e=null;if(t){if(typeof t==="string"){e=a.byId(t)}else{e=t}if(e){if(!(e instanceof E)){G.error("Control with the id="+t.getId?t.getId():t+" not of expected type");return null}}}return e};Et.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||!this.getUseVariantManagement()&&!this.getUseTablePersonalisation()||!this.getPersistencyKey()){return}var t=new K({type:"table",keyName:"persistencyKey",dataSource:"TODO"});t.setControl(this);var e=this.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){e=this._oSmartFilter.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}}else{this._oVariantManagement=new E(this.getId()+"-variant",{showShare:true})}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(t);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this)}};Et.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD"}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding()}};Et.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}};Et.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()})};Et.prototype.setTableBindingPath=function(t){this.setProperty("tableBindingPath",t,true);return this};Et.prototype.setTableType=function(t){if(this.getTableType()===t){return this}if(this._bInitialising){throw new Error("tableType changed while SmartTable control was initializing - "+this.getId())}this.setProperty("tableType",t);return this};Et.prototype.setShowTablePersonalisation=function(t){this.setProperty("showTablePersonalisation",t,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(t)}return this};Et.prototype.setUseVariantManagement=function(t){this.setProperty("useVariantManagement",t,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!t)}return this};Et.prototype.setShowVariantManagement=function(t){this.setProperty("showVariantManagement",t,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(t);if(this._oSeparator){this._oSeparator.setVisible(t)}}return this};Et.prototype.setToolbarStyleClass=function(t){this.setProperty("toolbarStyleClass",t,true);return this};Et.prototype.setCustomToolbar=function(t){this._oCustomToolbar=t;return this};Et.prototype.getCustomToolbar=function(){return this._oCustomToolbar};Et.prototype.setHeader=function(t){var e=this.getProperty("header"),i;this.setProperty("header",t,true);if(this.bIsInitialised&&this._oToolbar){i=!e===!t;if(!i){this._createToolbarContent()}else{this._refreshHeaderText()}}return this};Et.prototype.setShowRowCount=function(t){this.setProperty("showRowCount",t,true);this._refreshHeaderText();return this};Et.prototype.setEditable=function(t){if((t=!!t)==this.getEditable()){return this}this.setProperty("editable",t,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",t)}if(this._oEditButton){this._oEditButton.setIcon(t?"sap-icon://display":"sap-icon://edit")}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(t?"Edit":"Navigation")}this._updateVisibleColumnsWidthForEdit();return this};Et.prototype.setDemandPopin=function(t){var e=this.getDemandPopin();if(e===t){return this}this.setProperty("demandPopin",t,true);if(this.bIsInitialised){if(t){this._updateColumnsPopinFeature()}else{this._deactivateColumnsPopinFeature()}}return this};Et.prototype._refreshHeaderText=function(){if(!this._headerText){return}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=k.getFloatInstance()}var t;var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){t=this._getRowCount(true);if(t>0){var i=this._oNumberFormatInstance.format(t);e+=" ("+i+")"}}this._headerText.setText(e);this._updateAriaLabelledByInfo();if(this._bDataLoadPending===false&&this._bUpdateTableAnnouncement){this._bUpdateTableAnnouncement=false;this._updateTableAnnouncement(t)}};Et.prototype._updateAriaLabelledByInfo=function(){var t=this._headerText.getId();if(this._oTable&&this._oTable.addAriaLabelledBy){if(this._headerText.getVisible()){if(this._oTable.getAriaLabelledBy().indexOf(t)===-1){this._oTable.addAriaLabelledBy(t)}}else{this._oTable.removeAriaLabelledBy(t)}}};Et.prototype._updateTableAnnouncement=function(t){var e=it.getInstance();if(e){var i=a.getLibraryResourceBundle("sap.ui.comp");var o=this.getHeader();if(t===undefined&&this._getRowCount(false)>0){e.announce(i.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED",[o]))}else if(t>1){e.announce(i.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_MULT",[o,t]))}else if(t===1){e.announce(i.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_SING",[o,t]))}else{e.announce(i.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[o]))}}};Et.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton)}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new T(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen)},this]});this._oFullScreenButton.addStyleClass("sapUiCompSmartTableToolbarContent");if(z.system.phone){this._oFullScreenButton.setLayoutData(new m({priority:"NeverOverflow"}))}}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton)}};Et.prototype._addPasteButton=function(){var t=this.getId()+"-btnPaste";var e=a.byId(t);if(e){this._oToolbar.removeContent(e)}if(this.getShowPasteButton()){if(!e){e=new T(t);e.addStyleClass("sapUiCompSmartTableToolbarContent");sap.ui.require(["sap/m/plugins/PasteProvider"],function(t){e.addDependent(new t({pasteFor:this._oTable.getId()}))}.bind(this))}e.setEnabled(this.getEnablePaste());this._oToolbar.addContent(e)}};Et.prototype._createToolbar=function(){var t=null;if(!this._oToolbar){t=this.getCustomToolbar();if(t){this._oToolbar=t}else{this._oToolbar=new c({design:yt.Transparent,style:this.getTableType()==="ResponsiveTable"?Ct.Standard:Ct.Clear});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass())}}this._oToolbar.setLayoutData(new S({shrinkFactor:0}))}};Et.prototype._toggleShowHideDetails=function(t){if(!this._oShowHideDetailsButton||t===this.bHideDetails){return}this.bHideDetails=t;if(this.bHideDetails){this._oTable.setHiddenInPopin(this._getImportanceToHide());this._oShowHideDetailsButton.setSelectedKey("hideDetails")}else{this._oTable.setHiddenInPopin([]);this._oShowHideDetailsButton.setSelectedKey("showDetails")}};Et.prototype._getImportanceToHide=function(){var t=this.getDetailsButtonSetting()||[];var e=[];if(t.length){e=t}else{e=z.system.phone?["Low","Medium"]:["Low"]}return e};Et.prototype._toggleFullScreen=function(t,e){if(!this._oFullScreenButton||t===this.bFullScreen&&!e){return}this.bFullScreen=t;U.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:t})};Et.prototype._renderFullScreenButton=function(){var t=a.getLibraryResourceBundle("sap.ui.comp"),e;e=this.bFullScreen?t.getText("CHART_MINIMIZEBTN_TOOLTIP"):t.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(e);this._oFullScreenButton.setText(e);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen")};Et.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar()}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addPasteButton();this._addEditTogglableToToolbar();this._addShowHideDetailsButton();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar()};Et.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0)}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar)}else{this._oTable.addExtension(this._oToolbar)}};Et.prototype.getToolbar=function(){return this._oToolbar};Et.prototype._addEditTogglableToToolbar=function(){var t;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton)}if(this.getEditTogglable()){if(!this._oEditButton){t=a.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new T(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:t,tooltip:t,press:[function(){var t=this.getEditable();t=!t;this.setEditable(t,true);this.fireEditToggled({editable:t})},this]});this._oEditButton.addStyleClass("sapUiCompSmartTableToolbarContent")}this._oToolbar.addContent(this._oEditButton)}};Et.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText)}if(!this._headerText){this._headerText=new f(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");this._headerText.addStyleClass("sapUiCompSmartTableToolbarContent");this._headerText.setLevel(this.getHeaderLevel())}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0)};Et.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator)}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new y(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false)}}this._oToolbar.insertContent(this._oSeparator,0)}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX")}};Et.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContent");if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement())}}}};Et.prototype._addSpacerToToolbar=function(){var t=false,e=this._oToolbar.getContent(),i,a;if(e){a=e.length;i=0;for(i;i<a;i++){if(e[i]instanceof b){t=true;break}}}if(!t){this._oToolbar.addContent(new b(this.getId()+"-toolbarSpacer").addStyleClass("sapUiCompSmartTableToolbarContent"))}};Et.prototype._createShowHideDetailsButton=function(){var t=a.getLibraryResourceBundle("sap.ui.comp");this._oShowHideDetailsButton=new lt(this.getId()+"-btnShowHideDetails",{visible:false,items:[new ut({icon:"sap-icon://detail-more",key:"showDetails",tooltip:t.getText("TABLE_SHOWDETAILS_TEXT"),press:[function(){this._toggleShowHideDetails(false)},this]}),new ut({icon:"sap-icon://detail-less",key:"hideDetails",tooltip:t.getText("TABLE_HIDEDETAILS_TEXT"),press:[function(){this._toggleShowHideDetails(true)},this]})]});this._oShowHideDetailsButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oShowHideDetailsButton.setSelectedKey("hideDetails")};Et.prototype._addShowHideDetailsButton=function(){if(this._oShowHideDetailsButton){this._oToolbar.removeContent(this._oShowHideDetailsButton)}if(this.getShowDetailsButton()&&this._isMobileTable){if(this.bHideDetails===undefined){this.bHideDetails=true}if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton()}this._oToolbar.addContent(this._oShowHideDetailsButton)}};Et.prototype._addTablePersonalisationToToolbar=function(){var t;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton)}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){t=a.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new T(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:t,tooltip:t,press:[function(t){this._oPersController.openDialog()},this]});o.addConfig(this._oTablePersonalisationButton,{messageBundleKey:z.os.macintosh?"SMARTTABLE_SHORTCUT_SHOW_SETTINGS_MAC":"SMARTTABLE_SHORTCUT_SHOW_SETTINGS"},this);this._oTablePersonalisationButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation())}this._oToolbar.addContent(this._oTablePersonalisationButton)}};Et.prototype._triggerGWExport=function(){var t=a.getLibraryResourceBundle("sap.ui.comp");var e=function(){var t=this._getRowBinding();var e=t.getDownloadUrl("xlsx");e=this._removeExpandParameter(e);var i={url:e};this.fireBeforeExport({exportSettings:i});at(i.url)}.bind(this);var i=this._getRowCount(true);if(i>1e4){p.confirm(t.getText("DOWNLOAD_CONFIRMATION_TEXT",i),{actions:[p.Action.YES,p.Action.NO],onClose:function(t){if(t===p.Action.YES){e()}}})}else{e()}};Et.prototype._addExportToExcelToToolbar=function(){if(this._oExportButton){this._oToolbar.removeContent(this._oExportButton)}if(!this.getEnableExport()){return}if(!this._oExportButton){var t=this.getId()+"-btnExcelExport";var e="sap-icon://excel-attachment";var i=a.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType().indexOf("UI5Client")>-1){this._oExportButton=this._createClientExportButton(t,e)}else if(this._bTableSupportsExcelExport&&this.getExportType()=="GW"){var o;o=i.getText("TABLE_EXPORT_TEXT");this._oExportButton=new T(t,{icon:e,text:o,tooltip:o,press:[this._triggerGWExport,this]})}this._setExcelExportEnableState();if(this._oExportButton){this._oExportButton.addStyleClass("sapUiCompSmartTableToolbarContent")}}this._oToolbar.addContent(this._oExportButton)};Et.prototype._createClientExportButton=function(t,e){var i=a.getLibraryResourceBundle("sap.ui.comp");var n={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=n}var r=new Y(t,{icon:e,tooltip:i.getText("TABLE_EXPORT_TEXT"),type:bt.Ghost,buttonMode:Tt.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport()},this],menu:[new $({items:[new Z({text:i.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport()},this]}),new Z({text:i.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._triggerUI5ClientExport(true)},this]})]})]});o.addConfig(r._getButtonControl(),{addAccessibilityLabel:true,messageBundleKey:z.os.macintosh?"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL_MAC":"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL"},this);return r};Et.prototype.onkeydown=function(t){if(t.isMarked()){return}if((t.metaKey||t.ctrlKey)&&t.shiftKey&&t.which===r.E){if(this.getUseExportToExcel()&&this.getExportType().indexOf("UI5Client")>-1&&this._oExportButton&&this._oExportButton.getEnabled()){this._triggerUI5ClientExport(true);t.setMarked();t.preventDefault()}}else if((t.metaKey||t.ctrlKey)&&t.which===r.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();t.setMarked();t.preventDefault()}}};Et.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=a.loadLibrary("sap.ui.export",true)}return this._oExportLibLoadPromise};Et.prototype._getColumnLabel=function(t){var e,i;if(typeof t==="string"){e=t;t=this._getColumnByKey(t)}if(!t){var a=this._oTableProvider.getFieldLabel(this.getEntitySet(),e);if(a&&a.match(/{@i18n>.+}/gi)){var o=this.getModel("@i18n");if(o&&o.isA("sap.ui.model.resource.ResourceModel")){return o.getProperty(a.slice(1,-1).substring(6))||a}}if(!a){var n=this._mFieldMetadataByKey[e];if(n){a=n.label}}return a}if(t.getLabel){i=t.getLabel()}else if(t.getHeader){i=t.getHeader()}return i&&i.getText?i.getText():null};Et.prototype._getColumnWidthNumber=function(t){if(t.indexOf("em")>0){return Math.round(parseFloat(t))}if(t.indexOf("px")>0){return Math.round(parseInt(t)/16)}return""};Et.prototype._triggerUI5ClientExport=function(t){var e=this;var i,o,n,r;i=this._createExportColumnConfiguration();if(!i||!i.length){p.error(a.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:this.$()&&this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return}r=this._getRowBinding();o=this._getColumnLabel.bind(this);n={workbook:{columns:i,hierarchyLevel:this._isTreeTable&&r.getTreeAnnotation?r.getTreeAnnotation("hierarchy-level-for"):undefined,context:{title:this.getHeader()}},dataSource:r,fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportHandler"],function(i){var a,r,s;if(!e._oExportHandler){r=e._oTableProvider.getExportCapabilities(e.getExportType());a=new i(r);a.attachBeforeExport(function(t){e.fireBeforeExport({exportSettings:t.getParameter("exportSettings"),userExportSettings:t.getParameter("userExportSettings")})});e._oExportHandler=a}s=(t?e._oExportHandler.exportAs:e._oExportHandler.export).bind(e._oExportHandler);s(n,o)})})};Et.prototype._createExportColumnConfiguration=function(){var t,e,i,a,o,n,r,s,l,u,h,d,p,g=[],_,f,c;var m=function(t,e){return"{"+(parseInt(e)-1)+"}"};t=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();i=t.length;c=this.data("useUTCDateTime");if(c!=null){if(typeof c==="string"){_=c==="true"}else if(typeof c==="boolean"){_=c}}for(e=0;e<i;e++){r=null;s=null;a=t[e];f=_;if(a.getVisible()){o=a.data("p13nData");if(a.getLeadingProperty){r=a.getLeadingProperty()}if(!r&&o){r=o["leadingProperty"]}if(Array.isArray(r)){r=r[0]}if(r){n=this._getColumnLabel(a);l=a.getWidth().toLowerCase()||o.width||"";l=this._getColumnWidthNumber(l);u=o.type==="numeric"?"Number":o.type;p=o.typeInstance;d=null;h=null;if(o.unit){u=o.isCurrency?"Currency":"Number"}else if(p&&p.isA("sap.ui.comp.odata.type.FiscalDate")){var b=p.getFormatter();s=b.getTemplate().replace(/\$(\d)/g,m);h=b.getRegExPattern().toString().slice(1,-1);u="String"}else if(u!="date"&&N.isDateOrTime(o.edmType)){u=N.getTypeName(o.edmType);if(u==="DateTimeOffset"){u="DateTime";f=false}}else if(u==="stringdate"){u="Date";h="YYYYMMDD"}else if(u==="boolean"){u="Boolean";d=N.getType(o.edmType)}else if(o.description){u="String";s=O.getFormattedExpressionFromDisplayBehaviour(o.displayBehaviour,"{0}","{1}")}else if(o.isDigitSequence){u="Number"}else if(u==="string"){u="String"}else if(u==="date"){u="Date"}else if(u==="time"){u="Time"}g.push({columnId:a.getId(),property:o.description?[r,o.description]:r,type:u,inputFormat:h,label:n?n:r,width:l,textAlign:a.getHAlign(),template:s,trueValue:u==="Boolean"&&d?d.formatValue(true,"string"):undefined,falseValue:u==="Boolean"&&d?d.formatValue(false,"string"):undefined,unitProperty:u==="Currency"||u==="Number"?o.unit:undefined,displayUnit:u==="Currency",precision:o.precision,scale:o.scale,autoScale:u==="Number",utc:u==="DateTime"&&f!=null?f:undefined,timezoneProperty:u==="DateTime"?o.additionalProperty:undefined})}}}return g};Et.prototype._removeExpandParameter=function(t){var e=t.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(t,e,i){return i?e.substring(0,1):""});return e};Et.prototype._getRowCount=function(t){var e=this._getRowBinding();if(!e){return t?undefined:0}var i;if(!t){i=e.getLength()}else if(typeof e.getCount==="function"){i=e.getCount()}else if(!e.isA("sap.ui.model.TreeBinding")&&typeof e.isLengthFinal==="function"&&e.isLengthFinal()){i=e.getLength()}if(i<0||i==="0"){i=0}return i};Et.prototype._setExcelExportEnableState=function(){if(this._oExportButton){var t=this._getRowCount();this._oExportButton.setEnabled(t>0)}};Et.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return}var t=this._oP13nDialogSettings;t=this._setIgnoreFromPersonalisationToSettings(t);t=t||{};if(this._isTreeTable){t.stableColumnKeys=[];t.stableColumnKeys.push(this._aColumnKeys[0])}if(this._bIsFilterPanelEnabled){t.filter=t.filter?t.filter:{};t.filter.createMessageStrip=this._getP13nFilterMessageStrip.bind(this)}this._oPersController=new L(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:t,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});this._oPersController.attachDialogAfterClose(function(t){if(this._fGetDataForKeyUser){if(t.getParameter("cancel")){this._fGetDataForKeyUser([])}this._cleanUpKeyUser()}}.bind(this));if(this._aDeactivatedColumns.length>0){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns)}};Et.prototype.getVariantManagement=function(){return this._oVariantManagement};Et.prototype.openDialogForKeyUser=function(t,e){this._fGetDataForKeyUser=e;this._oPersController.openDialog({showReset:false,useAvailablePanels:true,styleClass:t})};Et.prototype._cleanUpKeyUser=function(){this._fGetDataForKeyUser=null};Et.prototype._createKeyUserChange=function(){return[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}]};Et.prototype._setIgnoreFromPersonalisationToSettings=function(t){var e=R.createArrayFromString(this.getIgnoreFromPersonalisation());if(e.length){if(!t){t={}}var i=function(i){if(!t[i]){t[i]={}}t[i].ignoreColumnKeys=e};i("filter");i("sort");i("group");i("columns")}return t};Et.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation)}};Et.prototype.setEntitySet=function(t){if(this.getEntitySet()===t){return this}if(this._bInitialising){throw new Error("entitySet changed while SmartTable control was initializing - "+this.getId())}this.setProperty("entitySet",t,true);this._initialiseMetadata();return this};Et.prototype._initialiseMetadata=function(t){var e=this,i=e;if(t){i=t.getSource()}if(!i.bIsInitialised){H.handleModelInit(i,i._onMetadataInitialised,[{selector:i},{selector:i._oTable,changeTypes:["addXML","addXMLAtExtensionPoint"]}])}};Et.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(this.bIsInitialised){return}this._updateInitialColumns();this._fireBeforeInitialiseAndValidate();this._validateCustomizeConfig(this.getCustomizeConfig());this._createTableProvider();if(!this._oTableProvider){return}this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(!this._aTableViewMetadata){return}if(this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(this._setWidthForCustomColumn,this)}if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);G.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false")}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;delete this._bInitialising;this._updateP13nDialogSettings(true);this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new B({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||this._oVariantManagement&&this._bVariantInitialised){this._checkAndTriggerBinding()}};Et.prototype._fireBeforeInitialiseAndValidate=function(){if(!this.hasListeners("beforeInitialise")){return}this._bInitialising=true;this.fireEvent("beforeInitialise");this._validateControlConfig();this._updateInitialColumns()};Et.prototype._validateControlConfig=function(){var t=this.getItems();if(!t.length){throw new Error("Internals of the SmartTable control changed via beforeInitialise event - "+this.getId())}var e=t.find(function(t){return t.isA(["sap.m.Table","sap.ui.table.Table"])});if(!e){throw new Error("Inner Table removed via beforeInitialise event - "+this.getId())}if(e!==this._oTable){throw new Error("Inner table changed via beforeInitialise event for SmartTable - "+this.getId())}};Et.prototype._updateP13nDialogSettings=function(t){this._oP13nDialogSettings=this._getP13nDialogSettings();this._bIsFilterPanelEnabled=this._oP13nDialogSettings&&this._oP13nDialogSettings.filter?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=this._oP13nDialogSettings&&this._oP13nDialogSettings.sort?this._oP13nDialogSettings.sort.visible!==false:true;if(t){this._attachTableCustomFilter()}};Et.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search()}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search()},this)}}else{this._reBindTable()}}}};Et.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId","showDetailsButton","enableAutoColumnWidth","customizeConfig"];Et.prototype._aToolbarRelatedProperties=["enableExport","exportType","showFullScreenButton","showPasteButton","editTogglable","placeToolbarInTable"];Et.prototype._onPropertyChange=function(t){var e=t.getParameter("name");if(this._aStaticProperties.indexOf(e)>-1){G.error("Property "+e+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised")}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(e)>-1){if(e==="exportType"&&this._oExportButton){this._oExportButton.destroy();this._oExportButton=null}this._createToolbarContent()}};Et.prototype._createTableProvider=function(){var t,e,i,a,o;e=this.getEntitySet();i=this.getIgnoredFields();t=this.getModel();a=this.data("preserveDecimals");o=this.getCustomizeConfig();this._oTextInEditModeSource=o&&o["textInEditModeSource"];if(a!=null){if(a==false||typeof a==="string"&&a==="false"){this._bPreserveDecimals=false}else{this._bPreserveDecimals=true}}else{this._bPreserveDecimals=true}if(t&&e){if(this._aExistingColumns.length){if(i){i+=","+this._aExistingColumns.toString()}else{i=this._aExistingColumns.toString()}}this._oTableProvider=new P({entitySet:e,ignoredFields:i,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:t,semanticObjectController:this.getSemanticObjectController(),showDetailsButton:this.getShowDetailsButton(),enableAutoColumnWidth:this.getEnableAutoColumnWidth(),preserveDecimals:this._bPreserveDecimals,textInEditModeSource:this._oTextInEditModeSource})}};Et.prototype._listenToSmartFilter=function(){var t,e,i=false;t=this.getSmartFilterId();this._oSmartFilter=this._findControl(t,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);i=true}var o=a.getLibraryResourceBundle("sap.ui.comp"),n,r,s={SMARTTABLE_NO_DATA:o.getText("SMARTTABLE_NO_DATA"),SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR:o.getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"),SMARTTABLE_NO_RESULTS:o.getText("SMARTTABLE_NO_RESULTS")};if(this._oTable){n=!this._isMobileTable&&this._oTable.getNoData;r="noData";if(!n){n=this._oTable.getNoDataText;r="noDataText"}}if(n){var l=n.call(this._oTable);if(l&&(!this._isMobileTable||!this._oTable.isPropertyInitial(r))){if(Object.values(s).indexOf(l)==-1){this._vCustomNoData=l}}}e=this.getInitialNoDataText();if(e){i=e==="$FILTERBAR";if(!i&&e!=="$NO_FILTERBAR"){this._setNoDataText(e);return}}if(i){this._setNoDataText(s["SMARTTABLE_NO_DATA"])}else{this._setNoDataText(s["SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"])}};Et.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true)}};Et.prototype._showOverlay=function(t){if(t){var e={show:true};this.fireShowOverlay({overlay:e});t=e.show}this._oTable.setShowOverlay(t)};Et.prototype._findControl=function(t,e){var i,o;if(t){i=a.byId(t);if(!i||!i.isA(e)){o=this._getView();if(o){i=o.byId(t)}}if(i&&!i.isA(e)){i=undefined}}return i};Et.prototype._getView=function(){if(!this._oView){var t=this.getParent();while(t){if(t.isA("sap.ui.core.mvc.View")){this._oView=t;break}t=t.getParent()}}return this._oView};Et.prototype.rebindTable=function(t){if(this.isInitialised()){this._reBindTable(null,t);return}G.error("rebindTable method called before the SmartTable is initialized. Please execute the UI5 Support Assistant 'SmartTable' rules to get more information",this.getId(),"sap.ui.comp.smarttable.SmartTable")};Et.prototype._reBindTable=function(t,e){var i,o,n,r,s,l,u=[],h,d,g,_,f,c,m,b={},T={preventTableBind:false};this._bUpdateTableAnnouncement=t&&t.getId&&t.getId()==="search";n=this._getTablePersonalisationData()||{};if(this._oMessageFilter){h=this._oMessageFilter}else{h=n.filters;d=n.excludeFilters}m=n.sorters;if(this._oSmartFilter){l=this._oSmartFilter.getFilters();b=this._oSmartFilter.getParameters()||{}}if(l&&l.length){if(d){u=[new x([l[0],d],true)]}else{u=l}}else if(d){u=[d]}if(h){h=u.concat(h)}else{h=u}g=this._getRequestAtLeastFields();f=this._getRelevantColumnPaths();_=f["select"];if(!_||!_.length){_=g}else{s=g.length;for(r=0;r<s;r++){if(_.indexOf(g[r])<0){_.push(g[r])}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(t){if(_.indexOf(t)<0){_.push(t)}})}if(_.length){b["select"]=_.toString();c=f["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(t){if(c.indexOf(t)<0){c.push(t)}})}if(c.length){b["expand"]=c.join(",")}}b["useBatchRequests"]=true;if(!m){m=[]}T.filters=h;T.sorter=m;T.parameters=b;T.length=undefined;T.startIndex=undefined;T.events={};this.fireBeforeRebindTable({bindingParams:T,messageFilterActive:!!this._oMessageFilter});if(!T.preventTableBind){m=T.sorter;h=T.filters;b=T.parameters;_=T.parameters["select"];if(!_||!_.length){p.error(a.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:this.$()&&this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return}o=this.getTableBindingPath()||"/"+this.getEntitySet();if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false)}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){e=true;this._bForceTableUpdate=false}if(!e){i=this._oTable.getBinding(this._sAggregation);if(i&&i.mParameters){e=!(q(b,i.mParameters,true)&&q(b.custom,i.mParameters.custom)&&!T.length&&!T.startIndex&&o===i.getPath())}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText()}else{this._setNoDataText(undefined,(this.getSmartFilterId()||this._bIsFilterPanelEnabled)&&h&&h.length)}if(!i||!this._bIsTableBound||e){Et._addBindingListener(T,"change",this._onBindingChange,this);Et._addBindingListener(T,"dataRequested",this._onDataRequested,this);Et._addBindingListener(T,"dataReceived",this._onDataReceived,this);if(this._isMobileTable){var y=this._oTable?this._oTable.getColumns():[];var C=this._oTemplate?this._oTemplate.getCells():[];if(y.length===C.length){y.forEach(function(t,e){C[e].setBindingContext(t.getVisible()?undefined:null)})}}this._oTable.bindRows({path:o,filters:h,sorter:m,parameters:b,length:T.length,startIndex:T.startIndex,template:this._oTemplate,events:T.events});this._bIsTableBound=true}else{i.sort(m);i.filter(h,"Application")}this._showOverlay(false)}};Et.prototype._onDataRequested=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}this._bIgnoreChange=true;this.fireDataRequested(t.getParameters())};Et.prototype._onDataReceived=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}this._bIgnoreChange=false;this._onDataLoadComplete(t,true);this.fireDataReceived(t)};Et.prototype._onBindingChange=function(t){if(this._bIgnoreChange){return}var e,i=false;e=t&&t.getParameter?t.getParameter("reason"):undefined;if(!e||e==="filter"||e==="context"||!this._bDataLoadPending&&e==="change"){i=true}if(e==="change"||i){this._onDataLoadComplete(t,i)}};Et._addBindingListener=function(t,e,i,a){if(!t.events){t.events={}}if(!t.events[e]){t.events[e]=i.bind(a)}else{var o=t.events[e];t.events[e]=function(){i.apply(a,arguments);o.apply(a,arguments)}}};Et.prototype._onDataLoadComplete=function(t,e){if(this._bDataLoadPending||e){this._bDataLoadPending=false;this.updateTableHeaderState()}};Et.prototype._isTableBound=function(){if(this._bIsTableBound){return true}if(this._oTable){return this._oTable.isBound(this._sAggregation)}return false};Et.prototype.setNoData=function(t){this._oNoData=t;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText()}return this};Et.prototype.getNoData=function(){return this._oNoData};Et.prototype._setNoDataText=function(t,e){var i=!this._isMobileTable&&this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText}if(!i){return}if(this._bNoDataUpdated&&this._vCustomNoData){i.call(this._oTable,this._vCustomNoData,true);return}var o=t;if(!o){o=this.getNoData()}if(!o){if(e){o=a.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS")}else{o=a.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR")}}i.call(this._oTable,o,true)};Et.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState()};Et.prototype._createContent=function(){var t,e=0,i,a,o,n=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse())}a=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(t=0;t<e;t++){i=this._aTableViewMetadata[t];if(i.isInitiallyVisible){this._aColumnKeys.push(i.name)}else{n.push(i.name)}if(!(i.isInitiallyVisible||i.inResult)){this._mLazyColumnMap[i.name]=i}else{o=this._createColumnForField(i);this._oTable.addColumn(o)}this._mFieldMetadataByKey[i.name]=i}this._insertIndexedColumns(a);this._aColumnKeys=this._aColumnKeys.concat(n);if(this._isMobileTable&&this.getEnableAutoColumnWidth()){this.setDemandPopin(true);this._oTable.setFixedLayout("Strict");this._oTable.setContextualWidth("auto");this._oTable.addDependent(new nt)}this._updateColumnsPopinFeature();if(this.getShowDetailsButton()){this._oTable.setHiddenInPopin(this._getImportanceToHide())}this._storeInitialColumnSettings()};Et.prototype._createColumnForField=function(t){var e,i;i=this.getId()+"-"+t.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");e=this._createColumn(t,i);t.isColumnCreated=true;e.data("p13nData",{columnKey:t.name,leadingProperty:t.name,additionalProperty:t.additionalProperty,navigationProperty:t.navigationProperty,sortProperty:t.sortable?t.name:undefined,filterProperty:t.filterable?t.name:undefined,isGroupable:t.sortable&&t.filterable&&t.aggregationRole==="dimension",fullName:t.hasValueListAnnotation?t.fullName:null,type:t.filterType,typeInstance:t.modelType,maxLength:t.maxLength,precision:t.precision,scale:t.scale,align:t.align,edmType:t.type,displayBehaviour:t.displayBehaviour,description:t.description,isDigitSequence:t.isDigitSequence,isCurrency:t.isCurrencyField,unit:t.unit,width:t.width,aggregationRole:t.aggregationRole,nullable:t.nullable!=="false"});if(t.filterable&&e.setFilterProperty){e.setFilterProperty(t.name)}if(t.sortable&&e.setSortProperty){e.setSortProperty(t.name)}if(this.getEnableAutoColumnWidth()){t.width=e.getWidth();if(this.getEditable()){this._updateColumnWidthForEdit(e,t)}}this._registerContentTemplateEvents(t.template);return e};Et.prototype._parseIndexedColumns=function(){var t,e,i,a,o,n,r,s,l;var u=this._oTable.getColumns();var h=null;if(this._oTemplate&&this._oTemplate.getCells){h=this._oTemplate.getCells()}if(!u){return null}a=[];e=u.length;for(t=0;t<e;t++){i=u[t];o=i.data("p13nData");n=null;r=null;if(o){n=o.columnIndex;r=o.columnKey}s=-1;if(n!==null&&n!==undefined){s=parseInt(n)}if(!isNaN(s)&&s>-1){if(h){l=h[t];this._oTemplate.removeCell(l)}else{l=null}this._aColumnKeys.splice(t-a.length,1);a.push({index:s,columnKey:r,column:i,template:l});this._oTable.removeColumn(i)}}a.sort(function(t,e){return t.index-e.index});return a};Et.prototype._insertIndexedColumns=function(t){var e,i,a;if(!t){return}i=t.length;for(e=0;e<i;e++){a=t[e];this._aColumnKeys.splice(a.index,0,a.columnKey);this._oTable.insertColumn(a.column,a.index);if(a.template){this._oTemplate.insertCell(a.template,a.index)}}};Et.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return}if(!this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(true)}var t=this._oTable.getColumns(true);if(!t){return}t=t.filter(function(t){return t.getVisible()});t.forEach(function(t){if(t.getPopinDisplay()!="WithoutHeader"){t.setPopinDisplay("Inline")}})};Et.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];R.createSort2Json(this._oTable,this._aInitialSorters,R.createArrayFromString(this.getIgnoreFromPersonalisation()))};Et.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return}if(this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(false)}var t=this._oTable.getColumns();if(!t){return}var e,i=t.length;for(var a=0;a<i;a++){e=t[a];e.setDemandPopin(false);e.setMinScreenWidth("1px")}};Et.prototype._registerContentTemplateEvents=function(t){if(t.isA("sap.ui.comp.SmartToggle")){t=t.getEdit()}if(t&&t.attachChange){t.attachChange(function(t){this.fireFieldChange({changeEvent:t})},this)}};Et.prototype._updateInitialColumns=function(){var t=this._oTable.getColumns(),e=t.length,i,a;var o=this.getEnableAutoColumnWidth();while(e--){i=t[e];a=i.data("p13nData");if(a&&a.columnKey&&this._aExistingColumns.indexOf(a.columnKey)>=0){continue}if(typeof a==="string"){try{a=JSON.parse(a);i.data("p13nData",a)}catch(t){}}if(a&&a.columnKey){this._aExistingColumns.push(a.columnKey)}if(o&&this._isMobileTable){var n=i.getHeader();if(n&&n.isPropertyInitial("wrapping")&&n.getMetadata().getProperty("wrapping")){n.setWrapping(false)}}}};Et.prototype._getRelevantColumnPaths=function(){var t={},e=[],i=[],a=this._oTable.getColumns(),o,n=a?a.length:0,r,s,l,u,h;var d=function(t,e){var i,a;if(t){a=t.split(",");i=a.length;while(i--){t=a[i];if(t&&e.indexOf(t)<0){e.push(t)}}}};for(o=0;o<n;o++){r=a[o];l=null;if(r.getVisible()||r.getInResult&&r.getInResult()){if(r.getLeadingProperty){l=r.getLeadingProperty()}s=r.data("p13nData");if(s){if(!l){l=s["leadingProperty"]}u=s["additionalProperty"];h=s["navigationProperty"]}if(l&&e.indexOf(l)<0){e.push(l)}d(u,e);d(h,i)}}t["select"]=e;t["expand"]=i;return t};Et.prototype._createTable=function(){var t=this.getItems(),e=t?t.length:0,i,a;this._sAggregation="rows";while(e--){i=t[e];if(i instanceof w||i instanceof g){break}i=null}if(i){this._oTable=i;if(i instanceof A){this._isAnalyticalTable=true}else if(i instanceof g){this._isMobileTable=true;this._oTemplate=i.getItems()&&i.getItems().length>0?i.getItems()[0]:new h;i.removeAllItems()}else if(i instanceof V){this._isTreeTable=true}this._updateInitialColumns()}else{a=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new A(a,{enableCustomFilter:true})}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new g(a,{growing:true,autoPopinMode:this.getDemandPopin()});this._oTemplate=new h}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new V(a,{selectionMode:"MultiToggle"})}else{this._oTable=new w(a,{selectionMode:"MultiToggle"})}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto")}this.insertItem(this._oTable,2)}this._oTableReady.resolve(this._oTable);this._fColumnPaddingBorder=this._isMobileTable?1:1.1875;if(!this._oTable.getLayoutData()){if(this._oTable instanceof g||this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto"){this._oTable.setLayoutData(new S({growFactor:1,baseSize:"auto"}))}else{this._oTable.setLayoutData(new S({growFactor:1,baseSize:"0%"}))}}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter())}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false)}this._attachTableCustomFilter();if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2])};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1])}}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;if(this.getShowDetailsButton()){this._oTable.attachEvent("popinChanged",this._onPopinChanged,this)}}if(!this._isMobileTable){this._oTable.attachRowsUpdated(function(){this._setExcelExportEnableState()},this)}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true)}this._oTable.attachPaste(this._onInnerTablePaste,this)};Et.prototype._attachTableCustomFilter=function(){if(this._oTable.detachCustomFilter){this._oTable.detachCustomFilter(this._onCustomFilter,this)}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false)}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this)}}};Et.prototype._createResponsivePopover=function(t){this._oFilterButton=new Q({text:a.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(t){this._onCustomFilter(t)},this]});var e=a.getLibraryResourceBundle("sap.ui.comp");this._aSortButton=[new rt({label:e.getText("SMARTTABLE_RP_SORT_ASCENDING"),icon:"sap-icon://sort-ascending",action:[true,this._onCustomSort,this]}),new rt({label:e.getText("SMARTTABLE_RP_SORT_DESCENDING"),icon:"sap-icon://sort-descending",action:[false,this._onCustomSort,this]})];this._oColumnHeaderPopover=new X({items:[this._aSortButton,this._oFilterButton]});if(t){this._oColumnHeaderPopover.addItem(new Q({text:a.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_RESIZE"),icon:"sap-icon://resize-horizontal",press:[function(){nt.getPlugin(this._oTable).startResizing(this._oColumnClicked.getDomRef())},this]}))}};Et.prototype._createColumnMenu=function(t,e){var i=a.getLibraryResourceBundle("sap.ui.comp");var o=t.data("p13nData");this._oFilterButton=new dt({label:i.getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[this._onCustomFilter,this]});var n=new gt({items:[new _t({key:o.columnKey,label:this._getColumnLabel(this._oColumnClicked)})],change:[function(t){var e=t.getParameter("item").getSortOrder();if(e==St.None){var i=this._oColumnClicked.data("p13nData");this._onCustomSort(t,i.sorted&&i.sorted.ascending)}else{this._onCustomSort(t,e==St.Ascending)}},this]});this._aSortButton=n.getEffectiveQuickActions();this._oColumnHeaderPopover=new ht;this._oColumnHeaderPopover.addAggregation("_quickActions",n);this._oColumnHeaderPopover.addAggregation("_items",new dt({label:i.getText("SMARTTABLE_RP_SORT"),icon:"sap-icon://sort",press:[this._showTableSortDialog,this]}));this._oColumnHeaderPopover.addAggregation("_items",this._oFilterButton);if(e){this._oColumnHeaderPopover.addAggregation("_quickActions",new ft({label:i.getText("SMARTTABLE_RP_RESIZE"),content:new J({icon:"sap-icon://resize-horizontal",press:[function(){this._oColumnHeaderPopover.close();nt.getPlugin(this._oTable).startResizing(this._oColumnClicked.getDomRef())},this]})}))}};Et.prototype._onColumnPress=function(t){this._oColumnClicked=t.getParameter("column");var e=this._oColumnClicked.data("p13nData");var i=window.matchMedia("(hover:none)").matches&&this._isMobileTable&&this.getEnableAutoColumnWidth();if(!e&&!i){return}var a=e.filterProperty;var o=e.sortProperty;if(!this._oColumnHeaderPopover){if(this._bUseColumnMenu){this._createColumnMenu(this._oColumnClicked,i)}else{this._createResponsivePopover(i)}}this._oFilterButton.setVisible(!!a&&this._bIsFilterPanelEnabled);var n=!!o&&this._bIsSortPanelEnabled;this._aSortButton.forEach(function(t){t.setVisible(n)});if(a&&this._bIsFilterPanelEnabled||o&&this._bIsSortPanelEnabled||i){if(!this._bUseColumnMenu){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader())}this._oColumnHeaderPopover.openBy(this._oColumnClicked)}};Et.prototype._onCustomSort=function(t,e){var i=this._oColumnClicked.data("p13nData");var a,o;if(i){if(i.sorted&&i.sorted.ascending===e){delete i.sorted;o=St.None;this._oColumnClicked.setSortIndicator(o)}else{i.sorted={ascending:e};a=i.sorted;o=a&&a.ascending?St.Ascending:St.Descending}this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:o,columnAdded:false})}};Et.prototype._onCustomFilter=function(t){this._showTableFilterDialog(t.getParameter("column")||this._oColumnClicked)};Et.prototype._onPopinChanged=function(t){if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton()}var e=t.getParameter("visibleInPopin");var i=t.getParameter("hiddenInPopin");var a=t.getSource().getVisibleItems();var o=e.some(function(t){return this._getImportanceToHide().indexOf(t.getImportance())>-1},this);if(a.length&&(i.length||o)){this._oShowHideDetailsButton.setVisible(true)}else{this._oShowHideDetailsButton.setVisible(false)}};Et.prototype.getTable=function(){return this._oTable};Et.prototype._showTableFilterDialog=function(t){if(this._oPersController){var e={filter:{visible:true}};if(t){e.filter["payload"]={column:t}}this._oPersController.openDialog(e)}};Et.prototype._showTableSortDialog=function(){if(this._oPersController){var t={sort:{visible:true}};this._oPersController.openDialog(t)}};Et.prototype._calcColumnWidth=function(t,e,i){i=Object.assign({label:e?false:true,defaultWidth:e?4:8,padding:this._fColumnPaddingBorder},i);if(!t){return i.defaultWidth}var a=0,o=0,n=Math.max(i.min||0,e?1:2),r=Math.max(n,i.max||19),s=t.additionalProperty||"",l=t.displayBehaviour,u=t.modelType,h=t.type||"";if(r<n){return r}if(i.additionalProperty){s=i.additionalProperty.concat(s.split(",")).filter(function(t,e,i){return t&&i.indexOf(t)==e}).join(",")}if(e||t.unit||!s||l!="descriptionOnly"){if(t.isImageURL||h=="Edm.Byte"||h=="Edm.SByte"){a+=n}else if(u){a+=st.calcTypeWidth(u,{defaultWidth:i.defaultWidth,maxWidth:i.maxWidth})}else{a+=i.defaultWidth}}if(this._isTreeTable&&t.hierarchy&&t.index==0){a+=3}if(!e){t.ownWidth=a=Math.min(a,r)}if(!e&&l!="idOnly"&&s&&this._oTableProvider&&a<r){s.split(",").forEach(function(e){if(e==t.fieldControlProperty){return}var i=this._oTableProvider.getFieldMetadata(e);var o=Object.assign({padding:.4,max:r-a-.4},t.vertical&&{padding:0,max:r});var n=this._calcColumnWidth(i,true,o);if(t.vertical){a=Math.max(n,a)}else{a+=n}},this);if(l=="descriptionOnly"){t.ownWidth=a}else{t.additionalWidth=a-t.ownWidth}}a=a+(i.gap||0);if(i.label){var d=t.label||t.fieldLabel||"";t.labelWidth=o=st.calcHeaderWidth(d,a,r,n)}a=Math.max(n,a,o);a=Math.min(a,r)+i.padding;a=Math.round(a*100)/100;return a};Et.prototype._setWidthForCustomColumn=function(t){var e=t.data("p13nData");if(!this._oTableProvider||!e||!e.autoColumnWidth||t.getWidth()){return}var i=e.autoColumnWidth;var a=i.visibleProperty||[e.leadingProperty,e.additionalProperty].join(",");var o=a.split(",");var n=this._oTableProvider.getFieldMetadata(o.shift(),true);if(!n){return}n.label=this._getColumnLabel(t);var r=this._calcColumnWidth(n,false,{additionalProperty:o,min:i.min,max:i.max,gap:i.gap});n.width=r+"rem";t.setWidth(n.width);if(this.getEditable()){this._updateColumnWidthForEdit(t,n,i)}};Et.prototype._updateColumnWidthForEdit=function(t,e){if(!e||!e.isColumnCreated||e.type=="Edm.Boolean"||e.semanticObjects){return}var i=this.data("useSmartField")=="true"||this.data("useSmartField")===true;if(i&&e["sap:updatable"]=="false"){return}var a=t.getWidth();if(!this.getEditable()){if(e.editWidth==a){t.setWidth(e.width)}}else if(e.width==a){if(e.editWidth){return t.setWidth(e.editWidth)}if(!this._aEditableColumnAdditionalWidth){var o=this._fColumnPaddingBorder;var n=this.$().closest(".sapUiSizeCompact").length?"_Compact":"";var r=parseFloat(ot.get({name:"_sap_m_InputBase"+n+"_IconWidth"}));o+=parseFloat(ot.get({name:"_sap_m_InputBaseWrapper_Sum_Border"}));o+=parseFloat(ot.get({name:"_sap_m_InputBase"+n+"_InnerPadding"}).split(" ").pop())*2;this._aEditableColumnAdditionalWidth=[o,o+r-.25]}var s=(e.displayBehaviour||"").includes("And");var l=(e.labelWidth||0)+this._fColumnPaddingBorder;if(i&&s&&e.additionalWidth&&e.hasValueListAnnotation&&!e.hasFixedValues){e.editWidth=Math.max(e.ownWidth+this._aEditableColumnAdditionalWidth[1],l)+"rem";return t.setWidth(e.editWidth)}var u=e.isCalendarDate||N.isDateOrTime(e.type);var h=e.hasValueListAnnotation||u;var d=this._aEditableColumnAdditionalWidth[+h];if(i&&s&&!e.additionalWidth&&e.hasValueListAnnotation&&e.hasFixedValues){d=Math.max(e.ownWidth+3+d,l)}else if(e.ownWidth<4||u){d+=e.ownWidth}else{d+=2}var p=parseFloat(a);if(p<d){e.editWidth=d+"rem";t.setWidth(e.editWidth)}}};Et.prototype._updateVisibleColumnsWidthForEdit=function(){if(this._oTable&&this._oTableProvider&&this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(function(t){if(t.getVisible()){var e=t.data("p13nData");var i=e&&e.leadingProperty;if(i){var a=this._oTableProvider.getFieldMetadata(i);a&&this._updateColumnWidthForEdit(t,a)}}},this)}};Et.prototype._createColumn=function(t,e){var i=new F(e,{autoResizable:true,hAlign:t.align,width:t.width,visible:t.isInitiallyVisible,label:new d(e+"-header",{textAlign:t.align,text:t.label}),sorted:t.sorted,sortOrder:t.sortOrder,tooltip:t.quickInfo,showSortMenuEntry:t.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:t.filterable&&this._bIsFilterPanelEnabled,name:t.fieldName,template:t.template});if(!t.width&&this.getEnableAutoColumnWidth()){i.setWidth(this._calcColumnWidth(t)+"rem")}return i};Et.prototype._createAnalyticalColumn=function(t,e){if(t.aggregationRole!=="measure"&&t.isMeasureField&&t.unit&&t.template.addStyleClass){t.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden")}else if(t.isCurrencyField&&t.template.addStyleClass){t.template.addStyleClass("sapUiCompCurrencyBold")}var i=new D(e,{autoResizable:true,hAlign:t.align,width:t.width,visible:t.isInitiallyVisible,inResult:t.inResult,label:new d(e+"-header",{textAlign:t.align,text:t.label}),tooltip:t.quickInfo,sorted:t.sorted,sortOrder:t.sortOrder,grouped:t.grouped,showIfGrouped:t.grouped,showSortMenuEntry:t.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:t.filterable&&this._bIsFilterPanelEnabled,summed:t.summed,leadingProperty:t.name,template:t.template,groupHeaderFormatter:O.getInlineGroupFormatterFunction(t,true,this._getDateFormatSettings(),this._bPreserveDecimals,true)});if(!t.width&&this.getEnableAutoColumnWidth()){i.setWidth(this._calcColumnWidth(t)+"rem")}return i};Et.prototype._createMobileColumn=function(t,i){var a=new u(i,{hAlign:t.align,visible:t.isInitiallyVisible,header:new d(i+"-header",{textAlign:t.align,text:t.label,tooltip:t.quickInfo,wrapping:!this.getEnableAutoColumnWidth(),wrappingType:e.WrappingType.Hyphenated}),tooltip:t.quickInfo});if(t.importance&&!this._oTableProvider.isLineItemDefaultImportance(t)){a.setImportance(t.importance)}if(this._oTemplate){this._oTemplate.addCell(t.template)}if(t.width){return a.setWidth(t.width)}if(!this.getEnableAutoColumnWidth()){return a.setWidth(t.isImageURL?"3em":"auto")}return a.setWidth(this._calcColumnWidth(t)+"rem")};Et.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{}}return this._oCurrentVariant};Et.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true)}if(this._oPersController){if(this._oCurrentVariant===null||t.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull")}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()})};Et.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding()};Et.prototype.getUiState=function(){var t=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new W({presentationVariant:{SortOrder:t?t.SortOrder:[],GroupBy:t?t.GroupBy:[],Total:t?t.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:t?t.Visualizations:[]},selectionVariant:{SelectOptions:t?t.SelectOptions:[]},variantName:this.getCurrentVariantId()})};Et.prototype.setUiState=function(t){this._setUiState(t,false)};Et.prototype.setUiStateAsVariant=function(t){this._setUiState(t,true)};Et.prototype._setUiState=function(t,e){var i=t.getPresentationVariant()&&t.getPresentationVariant().RequestAtLeast?[].concat(t.getPresentationVariant().RequestAtLeast):[];if(!q(i,this._getRequestAtLeastFields())){this._aAlwaysSelect=i}if(this._oPersController){if(e){this._oPersController.setPersonalizationDataAsDataSuiteFormat(j({},t.getPresentationVariant(),t.getSelectionVariant()),true)}else{var a=this._oVariantManagement&&t.getVariantName()?this._oVariantManagement.getVariantContent(this,t.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(j({},t.getPresentationVariant(),t.getSelectionVariant()),a,true)}}};Et.prototype._getRequestAtLeastFields=function(){var t=this.getRequestAtLeastFields();var e=t?t.split(","):[];return e.concat(this._aAlwaysSelect)};Et.prototype._personalisationRequestColumns=function(t){var e=t.getParameter("columnKeys"),i,a,o,n,r,s={};o=e.length;for(a=0;a<o;a++){i=e[a];n=this._mLazyColumnMap[i];if(n){r=this._createColumnForField(n);if(this._isMobileTable){this._oTable.addColumn(r)}s[n.name]=r}}this._oPersController.addColumns(s)};Et.prototype._beforePersonalisationModelDataChange=function(t){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo()}};Et.prototype._afterPersonalisationModelDataChange=function(t){this._updateColumnsPopinFeature();if(this.getEditable()){this._updateVisibleColumnsWidthForEdit()}};Et.prototype._personalisationModelDataChange=function(t){this._oCurrentVariant=t.getParameter("persistentData");if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange())}var e=t.getParameter("runtimeDeltaDataChangeType");var i=this._getChangeStatus(e);if(i==="Unchanged"){return}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation()}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true)}}if(this._isTableBound()){if(i==="ModelChanged"){if(e&&e.columns==="ModelChanged"){this._bForceTableUpdate=true}if(this._oSmartFilter){this._oSmartFilter.search()}else{this._reBindTable(null)}}else if(i==="TableChanged"&&this._isMobileTable&&this.getEditable()){this._updateMobileHiddenCellBindingContext(t)}}if(this._isMobileTable){this._adaptCustomSort()}this._createInfoToolbar();this.fireUiStateChange()};Et.prototype._updateMobileHiddenCellBindingContext=function(t){var e=a.getMessageManager().getMessageModel().getData();if(!e.length){return}var i=e.filter(function(t){return t.validation===true});if(!i.length){return}var o=t.getParameter("runtimeDeltaData").columns.columnsItems.filter(function(t){return t.visible===false});o.forEach(function(t){var i=this._getColumnByKey(t.columnKey),o=this._oTemplate.getCells()[this._oTable.indexOfColumn(i)],n;if(o.isA("sap.ui.comp.SmartToggle")){var r=o.getEdit();n=r.getId()}else{n=o.getId()}if(n){var s=e.find(function(t){return t.getControlId().includes(n)});if(s){var l=a.byId(s.getControlId());if(l){l.setBindingContext(null)}}}},this)};Et.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var t,e,a,o=[],n;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){o=this._oCurrentVariant.sort.sortItems}this._oTable.getColumns().forEach(function(r){t=r.data("p13nData");e=t&&t.columnKey;if(e){a=o.filter(function(t){return e===t.columnKey});n=a[0];if(n){if(!t.sorted){t.sorted={ascending:false}}if(n.operation===St.None){delete t.sorted}else{t.sorted={ascending:n.operation!==St.Descending}}r.setSortIndicator(n.operation)}else if(t&&t.sorted){t.sorted=null;r.setSortIndicator(i.None)}}else if(r.getSortIndicator()!==St.None){r.setSortIndicator(St.None)}},this)}};Et.prototype.setUseInfoToolbar=function(t){this.setProperty("useInfoToolbar",t,true);if(this.getTable()){this._createInfoToolbar()}return this};Et.prototype._updateInfoToolbar=function(t,e){if(!this._oInfoToolbar){this._oInfoToolbar=new c({active:true,visible:true,design:yt.Info,content:[new _({id:this.getId()+"-infoToolbarText",text:t,wrapping:false})],press:[e,this._handleInfoToolbarPress,this]})}else{this._oInfoToolbar.setVisible(true);this._oInfoToolbar.getContent()[0].setText(t);this._oInfoToolbar.detachPress(this._handleInfoToolbarPress,this);this._oInfoToolbar.attachPress(e,this._handleInfoToolbarPress,this)}};Et.prototype._handleInfoToolbarPress=function(t,e){this._showTableFilterDialog(e)};Et.prototype._createInfoToolbar=function(){var t=this.getUseInfoToolbar(),e=this.getTable(),i=this.getId()+"-infoToolbarText",o,r=a.getLibraryResourceBundle("sap.ui.comp");if(t===Pt.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);e.removeAriaLabelledBy(i)}return}if(this._isMobileTable){if(e.getInfoToolbar()&&!this._oInfoToolbar){G.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return}var s=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,l=s&&s.length;if(l){var u=[],h=n.getInstance();s.forEach(function(t){var e=this._getColumnLabel(t.columnKey);if(e&&u.indexOf(e)===-1){u.push(e)}},this);var d=r.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[h.format(u)]);o=this._getColumnByKey(s[0].columnKey);this._updateInfoToolbar(d,o);if(!e.getInfoToolbar()){e.setInfoToolbar(this._oInfoToolbar)}if(e.getAriaLabelledBy().indexOf(i)===-1){e.addAriaLabelledBy(i)}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);e.removeAriaLabelledBy(i)}}else if(this._oInfoToolbar){this._oInfoToolbar.setVisible(false)}};Et.prototype._getChangeStatus=function(t){if(!t){return"ModelChanged"}if(t.sort==="ModelChanged"||t.filter==="ModelChanged"||t.columns==="ModelChanged"||t.group==="ModelChanged"){return"ModelChanged"}if(t.sort==="TableChanged"||t.filter==="TableChanged"||t.columns==="TableChanged"||t.group==="TableChanged"){return"TableChanged"}return"Unchanged"};Et.prototype._getDateFormatSettings=function(){if(this._oTableProvider&&this._oTableProvider._oDateFormatSettings){return this._oTableProvider._oDateFormatSettings}return undefined};Et.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null}var t=[],e=[],i=[],a,o,n,r,u,h,d,p,g,_,f={},c={},m="",b;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){o=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(o.columnKey)<0){u=this._getColumnByKey(o.columnKey);if(u){m=u.getHeader().getText()}_=this._getPathFromColumnKeyAndProperty(o.columnKey,"sortProperty")}if(_){d=_;p=null;var T=this._mFieldMetadataByKey[o.columnKey],y;if(T){p=T.unit||T.description;y=O.getInlineGroupFormatterFunction(T,false,this._getDateFormatSettings(),this._bPreserveDecimals,true)}n=new I(d,o.operation==="GroupDescending",function(t){var e=t.getProperty(d),i;if(y){if(p){i=t.getProperty(p)}e=y(e,i)}if(e===undefined||e===null){e=""}return{key:e,text:m?m+": "+e:e}});this._mSelectExpandForGroup={select:[d]};if(T){if(T.additionalProperty){this._mSelectExpandForGroup.select.push(T.additionalProperty)}if(T.navigationProperty){this._mSelectExpandForGroup.expand=[T.navigationProperty]}}t.push(n)}}if(this._oCurrentVariant.sort){r=this._oCurrentVariant.sort.sortItems}else{r=this._aInitialSorters}if(r){r.forEach(function(e,i){var a=e.operation==="Descending";_=null;g=null;if(this._aDeactivatedColumns.indexOf(e.columnKey)<0){_=this._getPathFromColumnKeyAndProperty(e.columnKey,"sortProperty")}if(_){if(n&&n.sPath===_){n.bDescending=a}else{var o=this._mFieldMetadataByKey[e.columnKey];if(!o){u=this._getColumnByKey(e.columnKey);h=u.data("p13nData")}if(this._bMultiUnitBehaviorEnabled&&(o&&o.isCurrencyField||h&&h.isCurrency)){g=o?o.unit:h.unit;if(g&&!f[g]){f[g]={index:i,descending:a}}}c[_]={};if(c[g]){delete f[g]}else if(f[_]){delete f[_]}t.push(new I(_,a))}}},this);var C=Object.keys(f),S;if(C.length){C.reverse().forEach(function(e){S=n?f[e].index+1:f[e].index;t.splice(S,0,new I(e,f[e].descending))})}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(t){var a=t.value1,o=t.value2,n;_=null;b=false;u=null;if(this._aDeactivatedColumns.indexOf(t.columnKey)<0){u=this._getColumnByKey(t.columnKey)}if(u){if(u.getFilterProperty){_=u.getFilterProperty()}h=u.data("p13nData");if(h){b=h.type==="time";if(!_){_=h["filterProperty"]}}}if(_){if(b){if(a instanceof Date){a=O.getEdmTimeFromDate(a)}if(o instanceof Date){o=O.getEdmTimeFromDate(o)}}else{var r=h&&h.typeInstance&&h.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(a instanceof Date&&!r&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){a=s.localToUtc(a);o=o?s.localToUtc(o):o}}var d=t.exclude?i:e;if(t.operation==="Empty"){var p=t.exclude?M.NE:M.EQ;if(h.edmType==="Edm.String"||h.type==="string"){if(!h.nullable){d.push(new x(_,p,""))}else{d.push(new x({and:!!t.exclude,filters:[new x(_,p,""),new x(_,p,null)]}))}}else if(h.nullable){d.push(new x(_,p,null))}}else{n=t.exclude?l.getTransformedExcludeOperation(t.operation):t.operation;d.push(new x(_,n,a,o))}}},this);if(i.length){a=new x(i,true)}}return{filters:e,excludeFilters:a,sorters:t}};Et.prototype._getColumnByKey=function(t){var e,i,a,o,n;if(this._oTable){e=this._oTable.getColumns();a=e.length;for(o=0;o<a;o++){i=e[o];n=i.data("p13nData");if(n&&n.columnKey===t){return i}}}return null};Et.prototype._getPathFromColumnKeyAndProperty=function(t,e){var i=null,a,o;a=this._getColumnByKey(t);if(a){if(e=="sortProperty"&&a.getSortProperty){i=a.getSortProperty()}else if(e=="filterProperty"&&a.getFilterProperty){i=a.getFilterProperty()}else if(e=="leadingProperty"&&a.getLeadingProperty){i=a.getLeadingProperty()}if(!i){o=a.data("p13nData");if(o){i=o[e]}}}return i};Et.prototype._persistPersonalisation=function(){if(!a.getConfiguration().getDesignMode()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var t=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!t,key:t,def:true});delete this._bSaving}}};Et.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():""};Et.prototype.setCurrentVariantId=function(t){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(t)}else{G.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant")}return this};Et.prototype.setDetailsButtonSetting=function(t){this.setProperty("detailsButtonSetting",t,true);return this};Et.prototype.setEnablePaste=function(t){this.setProperty("enablePaste",t,true);var e=a.byId(this.getId()+"-btnPaste");if(e){e.setEnabled(this.getEnablePaste())}return this};Et.prototype.isInitialised=function(){return!!this.bIsInitialised};Et.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];Et.prototype.openPersonalisationDialog=function(t){if(!t||this._aAvailablePanels.indexOf(t)<0){G.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+t+" is not a valid panel!");return}if(this._oPersController){var e={};e[t.toLowerCase()]={visible:true};this._oPersController.openDialog(e)}};Et.prototype.deactivateColumns=function(t){this._aDeactivatedColumns=t||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns)}this._bDeactivatingColumns=false};Et.prototype._onInnerTablePaste=function(t){if(!this.getEnablePaste()||!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return}var e=t.getParameter("data");var i=e.slice(0);var a=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:a})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(t){t.parse(i,a).then(function(t){this.firePaste({result:t})}.bind(this))}.bind(this))}};Et.prototype._getColumnInfoForPaste=function(){var t=[],e=[],i=this._oTable.getColumns(),a,o=i.length,n,r,s,l,u,h;if(this._isMobileTable&&i.length){i=i.sort(function(t,e){return t.getOrder()-e.getOrder()})}for(a=0;a<o;a++){n=i[a];s=null;h=null;u=null;if(n.getVisible()){if(n.getLeadingProperty){s=n.getLeadingProperty()}r=n.data("p13nData");if(!s&&r){s=r["leadingProperty"]}l=r.type==="numeric"?"number":r.type;if(r.type==="date"){var d=this._getDateFormatSettings();if(d&&d["UTC"]){var p={displayFormat:"Date"};u=N.getType("Edm.DateTime",d,p)}}if(!u){u=r["typeInstance"]}if(r.isCurrency||l==="number"){h=r.unit}else if(r.description&&r.displayBehaviour!=="idOnly"){h=r.description}}var g={columnId:n.getId(),property:s,ignore:!s,type:u};if(s){t.push(g)}else{e.push(g)}u=N.getType("Edm.String");if(h){t.push({columnId:n.getId(),additionalProperty:true,property:h,type:u})}}return t.concat(e)};Et.prototype.exit=function(){var t,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy()}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy()}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy()}}this._oNumberFormatInstance=null;U.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy()}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy()}this.oNoData=null;if(this._aTableViewMetadata){t=this._aTableViewMetadata.length;while(t--){e=this._aTableViewMetadata[t];if(e&&!e.isColumnCreated&&e.template){e.template.destroy()}}}if(this._oShowHideDetailsButton){this._oShowHideDetailsButton.destroy()}this._oShowHideDetailsButton=null;this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy()}this._oToolbar=null;if(this._oExportButton){this._oExportButton.destroy()}this._oExportButton=null;if(this._oExportHandler){this._oExportHandler.destroy()}this._oExportHandler=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy()}this._oTemplate=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy()}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._aSortButton=null;this._oInfoToolbar=null;this._oTableReady=null;this._oView=null;this._oTable=null};return Et});