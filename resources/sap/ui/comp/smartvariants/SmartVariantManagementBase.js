/*
 * ! SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/Device","sap/ui/core/library","sap/ui/core/Icon","sap/base/Log","sap/base/util/merge","sap/m/library","sap/m/ObjectIdentifier","sap/m/RadioButton","sap/m/CheckBox","sap/m/Text","sap/m/Button","sap/m/Input","sap/m/HBox","sap/m/Dialog","sap/ui/comp/variants/VariantItem","sap/ui/comp/variants/EditableVariantItem","sap/ui/comp/variants/VariantManagement"],function(e,t,a,i,n,s,o,r,l,h,g,c,d,u,p,y,f){"use strict";var _=t.ValueState;var m=t.VerticalAlign;var C=s.ButtonType;var S=f.extend("sap.ui.comp.smartvariants.SmartVariantManagementBase",{metadata:{library:"sap.ui.comp"},renderer:{apiVersion:2}});S.prototype.init=function(){f.prototype.init.apply(this)};S.prototype.exit=function(){f.prototype.exit.apply(this,arguments);if(this._oRolesComponent){this._oRolesComponent=null}if(this._oInfoPopup){this._oInfoPopup.destroy();this._oInfoPopup=null}if(this._oRolesDialog){this._oRolesDialog.destroy();this._oRolesDialog=null}};S.prototype.getPersonalizableControlPersistencyKey=function(){if(this.isPageVariant()){return this.getPersistencyKey()}var e=this._getAllPersonalizableControls();if(e&&e.length===1){return this._getControlPersKey(e[0])}return null};S.prototype.addVariant=function(e,t){this._createVariantItem(e);if(t){this.setDefaultVariantId(e.getVariantId())}};S.prototype.removeVariant=function(e){if(e.variantId){var t=this.getItemByKey(e.variantId);if(t){this.removeVariantItem(t);t.destroy()}delete this._mVariants[e.variantId]}if(e.previousVariantId){this.activateVariant(e.previousVariantId)}if(e.previousDefault){this.setDefaultVariantId(e.previousDefault)}};S.prototype.removeWeakVariant=function(e){if(e.variantId){var t=this.getItemByKey(e.variantId);if(t){this.removeVariantItem(t);t.destroy()}delete this._mVariants[e.variantId]}if(e.previousVariantId){this.setInitialSelectionKey(e.previousVariantId)}if(e.previousDirtyFlag){this.setModified(e.previousDirtyFlag)}if(e.previousDefault){this.setDefaultVariantId(e.previousDefault)}};S.prototype.updateVariant=function(e){var t;if(e){t=this.getItemByKey(e.getVariantId());if(t){t.setExecuteOnSelection(this._getExecuteOnSelection(e));t.setFavorite(e.getFavorite());t.setText(e.getText("variantName"));if(e.getContexts){t.setContexts(e.getContexts())}}}};S.prototype.activateVariant=function(e){this._setSelectionByKey(e);this.setModified(false);this.fireSelect({key:e})};S.prototype.getAllVariants=function(){var e,t=this.getVariantItems();if(!t||t.length<1){return[]}e=t[0];t.splice(0,1);t.sort(this._compareItems);t.splice(0,0,e);var a=[];t.forEach(function(e){a.push(this._getVariantById(e.getKey()))}.bind(this));return a};S.prototype.getModified=function(){return this.currentVariantGetModified()};S.prototype.setModified=function(e){return this.currentVariantSetModified(e)};S.prototype.getDefaultVariantId=function(){return this.getDefaultVariantKey()};S.prototype.setDefaultVariantId=function(e){this.setDefaultVariantKey(e)};S.prototype.getPresentVariantId=function(){return this.getCurrentVariantId()?this.getCurrentVariantId():this.STANDARDVARIANTKEY};S.prototype.getPresentVariantText=function(){return this._getVariantText()};S.prototype.getPresentVariantContent=function(){return this._getContentAsync()};S.prototype._getPersoController=function(){return this._oPersoControl};S.prototype._getPersoControllerType=function(){if(this.isPageVariant()){return"page"}var e=this._getAllPersonalizableControls();if(e&&e.length===1){return e[0].type}return null};S.prototype.getTitle=function(){return this.oVariantText};S.prototype._isUIAdaptationMode=function(){var e=sap.ui.require("sap/ui/dt/OverlayRegistry");return!!(e&&e.getOverlay(this.getId()))};S.prototype._openVariantSelection=function(){f.prototype._openVariantSelection.apply(this);var e=this.oVariantSelectionPage.getFooter();if(e){e.setVisible(!this._isUIAdaptationMode())}};S.prototype.isNameDuplicate=function(e){var t=e.trim();return this._isDuplicateSaveAs(t)};S.prototype.isNameTooLong=function(e){var t=e.trim();return t.length>f.MAX_NAME_LEN};S.prototype.setStandardItemText=function(e){f.prototype.setStandardItemText.apply(this,arguments);if(this.oVariantList){var t=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(t){t.setText(e)}}return this};S.prototype._executeOnSelectForStandardVariantByXML=function(e){f.prototype._executeOnSelectForStandardVariantByXML.apply(this,arguments)};S.prototype.getExecuteOnSelectForStandardVariant=function(){var e=f.prototype.getExecuteOnSelectForStandardVariant.apply(this,arguments);var t=this.getItemByKey(this.getStandardVariantKey());if(t){e=t.getExecuteOnSelection()}return e};S.prototype._createStandardVariantListItem=function(){var e=this.getVariantItems()[0];var t=new p(this.oVariantPopoverTrigger.getId()+"-item-standard",{key:e.getKey()});t.setText(this._determineStandardVariantName());this._setVariantListItemProperties(e,t);if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){t.setAuthor(this.getStandardItemAuthor());t.setExecuteOnSelection(this.getExecuteOnSelectForStandardVariant())}return t};S.prototype._restoreCompleteList=function(e){var t,a,i,n,s;this.oVariantList.destroyItems();s=this._createStandardVariantListItem();if(s){if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===s.getKey()){this.oVariantList.setSelectedItem(s);this.oSelectedVariantItemKey=null}}else{if(this.getSelectionKey()==s.getKey()||this.getSelectionKey()===null){this.oVariantList.setSelectedItem(s)}}}i=this.getVariantItems();i.sort(this._compareItems);if(s){this.oVariantList.insertItem(s,0)}for(t=0;t<i.length;t++){a=i[t];if(!this._considerItem(e,a)){continue}if(a.getKey()===this.getStandardVariantKey()){continue}n=this.oVariantList.getItemByKey(a.getKey());if(!n){n=this._createVariantListItem(a,t);this.oVariantList.addItem(n)}if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===n.getKey()){this.oVariantList.setSelectedItem(n);this.oSelectedVariantItemKey=null}}else{if(this.getSelectionKey()==n.getKey()){this.oVariantList.setSelectedItem(n)}}}};S.prototype._determineTooltip=function(e){var t;if(e.getReadOnly()){t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER")}else if(e.getLabelReadOnly()){t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE")}if(e.getKey()===this.getStandardVariantKey()){t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_INFO")}return t};S.prototype._checkManageItemNameChangeKeyUser=function(e,t){var a=e.getValue().trim();var i=t.getKey();this._checkVariantNameConstraints(e,this.oManagementTable);if(e.getValueState()===_.Error){return}if(this.oVariantList.getItemByKey(i).getText().trim()===a){return}this._mTitleChanges[i]=a};S.prototype._getVariantByKeyFromManageKeyUser=function(e){var t=null;this.oManagementTable.getItems().some(function(a){if(a.getKey()===e){t=a}return t!=null});return t};S.prototype._getStandardVariantFromManageKeyUser=function(){return this._getVariantByKeyFromManageKeyUser(this.getStandardVariantKey())};S.prototype._getDefaultedEntryFromManageDefaultKeyUser=function(){var e=null;this.oManagementTable.getItems().some(function(t){if(t.getCells()[f.DEF_COLUMN].getSelected()){e=t}return e!=null});return e};S.prototype._handleManageDeletePressedKeyUser=function(e,t,a){var i=this._getDefaultedEntryFromManageDefaultKeyUser();if(i&&i.getKey()===t.getKey()){var n=this._getStandardVariantFromManageKeyUser();if(n){n.getCells()[f.DEF_COLUMN].setSelected(true);this._sDefaultChanges=n.getKey();if(a){var s=n.getCells()[f.FAV_COLUMN];if(s&&this._isFavoriteSelected(s)){a(n,s,true)}}}}this.oManagementTable.removeItem(t);this._anyInErrorState(this.oManagementTable,t.getCells()[f.NAME_COLUMN]);this._mDeletedChanges[t.getKey()]=true;t.destroy()};S.prototype._checkAndAddRolesContainerToManageDialog=function(){if(this._oRolesComponentContainer&&this._oRolesDialog){var e=null;this._oRolesDialog.getContent().some(function(t){if(t===this._oRolesComponentContainer){e=t;return true}return false}.bind(this));if(!e){this._oRolesDialog.addContent(this._oRolesComponentContainer)}}};S.prototype._determineRolesSpecificText=function(e,t){if(e&&t){t.setText(this.oResourceBundle.getText(e.role&&e.role.length>0?"VARIANT_MANAGEMENT_VISIBILITY_RESTRICTED":"VARIANT_MANAGEMENT_VISIBILITY_NON_RESTRICTED"))}};S.prototype._checkAndCreateContextInfoChanges=function(e,t){if(e){if(this._oRolesComponentContainer){try{if(!this._isInErrorContexts()){var a=this._getSelectedContexts();this._mContextInfoChanges[e]=a;this._determineRolesSpecificText(a,t)}else{return false}}catch(e){return false}}return true}return false};S.prototype._createRolesDialog=function(){if(!this._oRolesDialog){this._oRolesDialog=new u(this.getId()+"-roledialog",{draggable:true,resizable:true,contentWidth:"40%",title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SELECTROLES_DIALOG"),beginButton:new g(this.getId()+"-rolesave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),type:C.Emphasized,press:function(){if(!this._checkAndCreateContextInfoChanges(this._oCurrentContextsKey,this._oTextControl)){return}this._oRolesDialog.close()}.bind(this)}),endButton:new g(this.getId()+"-rolecancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){this._oRolesDialog.close()}.bind(this)}),content:[this._oRolesComponentContainer],stretch:e.system.phone});this._oRolesDialog.setParent(this);this._oRolesDialog.addStyleClass("sapUiContentPadding");this._oRolesDialog.addStyleClass(this._sStyleClassKeyUser);this._oRolesDialog.isPopupAdaptationAllowed=function(){return false}}this._checkAndAddRolesContainerToManageDialog()};S.prototype._openRolesDialog=function(e,t){this._createRolesDialog();this._oCurrentContextsKey=e.getKey();this._oTextControl=t;var a=e.getContexts();if(this._mContextInfoChanges[this._oCurrentContextsKey]){a=this._mContextInfoChanges[this._oCurrentContextsKey]}this._setSelectedContexts(a);this._oRolesDialog.open()};S.prototype._createEntriesForManageViewsDialog=function(e,t,i){var s,u,p,f,_,S,v;var V=this.getDefaultVariantId();var I,K=this._determineTooltip(e);var D=new y(this.oVariantManage.getId()+"-edit-"+t,{key:e.getKey(),global:e.getGlobal(),readOnly:e.getReadOnly(),author:e.getAuthor(),favorite:e.getFavorite(),labelReadOnly:e.getLabelReadOnly(),lifecyclePackage:e.getLifecyclePackage(),lifecycleTransportId:e.getLifecycleTransportId(),namespace:e.getNamespace(),vAlign:m.Middle});var M=this._getVariantById(e.getKey());if(this._fGetDataForKeyUser){var x=n({},e.getContexts());if(!x.hasOwnProperty("role")){x.role=[]}D.setContexts(x)}s=new a(this.oVariantManage.getId()+"-fav-"+t,{});this._setFavoriteIcon(s,e.getFavorite());if(e.getKey()===this.getStandardVariantKey()){s.addStyleClass("sapUICompVarMngmtFavNonInteractiveColor")}else{s.addStyleClass("sapUICompVarMngmtFavColor");s.attachPress(i.selectFavorite)}D.addCell(s);if(this._fGetDataForKeyUser){if(M&&!M.isRenameEnabled(this._sLayer)){u=new o(this.oVariantManage.getId()+"-text-"+t);u.setTitle(e.getText());if(K){u.setTooltip(K)}}else{u=new c(this.oVariantManage.getId()+"-input-"+t,{liveChange:i.inputLiveChange,change:i.inputChange});u.setValue(e.getText())}}else{if(e.getLabelReadOnly()||!this.getVariantCreationByUserAllowed()){u=new o(this.oVariantManage.getId()+"-text-"+t);u.setTitle(e.getText());if(K){u.setTooltip(K)}}else{u=new c(this.oVariantManage.getId()+"-input-"+t,{liveChange:i.inputLiveChange,change:i.inputChange});u.setValue(e.getText())}}D.addCell(u);if(this._fGetDataForKeyUser){p=new h}else{if(e.getGlobal()){I=this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARED")}else{I=this.oResourceBundle.getText("VARIANT_MANAGEMENT_PRIVATE")}p=new h(this.oVariantManage.getId()+"-type-"+t,{text:I,wrapping:false});p.addStyleClass("sapUICompVarMngmtType")}D.addCell(p);f=new r(this.oVariantManage.getId()+"-def-"+t,{groupName:this.oVariantManage.getId(),select:i.selectDefault});if(this._fGetDataForKeyUser){if(V===e.getKey()||e.getKey()===this.getStandardVariantKey()&&V===""){f.setSelected(true)}}else{if(this.sNewDefaultKey===e.getKey()||e.getKey()===this.getStandardVariantKey()&&this.sNewDefaultKey===""){f.setSelected(true);this._setFavoriteIcon(s,true)}}if(f.getSelected()&&s){if(s.hasStyleClass("sapUICompVarMngmtFavColor")){s.removeStyleClass("sapUICompVarMngmtFavColor");s.addStyleClass("sapUICompVarMngmtFavNonInteractiveColor")}}D.addCell(f);if(this.getDisplayTextForExecuteOnSelectionForStandardVariant&&this.getDisplayTextForExecuteOnSelectionForStandardVariant()&&e.getKey()===this.getStandardVariantKey()){_=new l(this.oVariantManage.getId()+"-exe-"+t,{enabled:true,wrapping:true,text:this.getDisplayTextForExecuteOnSelectionForStandardVariant(),select:i.executeOnSelect});if(this.bExecuteOnSelectForStandardByUser!==null){_.setSelected(this.bExecuteOnSelectForStandardByUser)}else{_.setSelected(e.getExecuteOnSelection())}}else{_=new l(this.oVariantManage.getId()+"-exe-"+t,{selected:false,enabled:true,text:"",select:i.executeOnSelect});if(e.getKey()===this.getStandardVariantKey()){_.setEnabled(true);if(this.bExecuteOnSelectForStandardByUser!==null){_.setSelected(this.bExecuteOnSelectForStandardByUser)}else{_.setSelected(e.getExecuteOnSelection())}}else{_.setSelected(e.getExecuteOnSelection())}}D.addCell(_);if(this._fGetDataForKeyUser&&e.getKey()!==this.getStandardVariantKey()){var T=new h({wrapping:false});this._determineRolesSpecificText(e.getContexts(),T);var A=new a({src:"sap-icon://edit",press:i.rolesPressed});A.addStyleClass("sapUiCompVarMngmtRolesEdit");A.setTooltip(this.oResourceBundle.getText("VARIANT_MANAGEMENT_VISIBILITY_ICON_TT"));v=new d(this.oVariantManage.getId()+"-role-"+t,{items:[T,A]});v.addStyleClass("sapUICompVarMngmtRole")}else{v=new h}D.addCell(v);p=new h(this.oVariantManage.getId()+"-author-"+t,{text:e.getAuthor(),textAlign:"Begin"});D.addCell(p);S=new g(this.oVariantManage.getId()+"-del-"+t,{icon:"sap-icon://decline",enabled:true,type:C.Transparent,press:i.deletePressed,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DELETE")});if(this._fGetDataForKeyUser){if(M){S.setEnabled(M.isDeleteEnabled(this._sLayer));if(e.getKey()===this.getStandardVariantKey()||e.getKey().indexOf("#")===0){S.setVisible(false)}else{S.setVisible(true)}}}else{if(M&&!M.isDeleteEnabled()||!this.getVariantCreationByUserAllowed()){S.setVisible(false);S.setEnabled(false)}}this._assignColumnInfoForDeleteButton(S);D.addCell(S);this.oManagementTable.addItem(D)};S.prototype._toggleIconActivityState=function(e,t,a){if(!e||!t){return}if(t.getKey()===this.getStandardVariantKey()){return}if(a){if(e.hasStyleClass("sapUICompVarMngmtFavColor")){e.removeStyleClass("sapUICompVarMngmtFavColor");e.addStyleClass("sapUICompVarMngmtFavNonInteractiveColor")}}else if(e.hasStyleClass("sapUICompVarMngmtFavNonInteractiveColor")){e.removeStyleClass("sapUICompVarMngmtFavNonInteractiveColor");e.addStyleClass("sapUICompVarMngmtFavColor")}};S.prototype.openManageViewsDialogForKeyUser=function(e,t){var a;var i=e.contextSharingComponentContainer;var n=e.rtaStyleClass;this._sLayer=e.layer;this._delayedControlCreation();this._mFavoriteChanges={};this._mExecuteOnSelectChanges={};this._mTitleChanges={};this._mDeletedChanges={};this._mContextInfoChanges={};this.aRemovedVariants=[];this._sDefaultChanges=null;this.oManagementSave.setEnabled(true);this.oManagementTable.destroyItems();this._sStyleClassKeyUser=n;this._fGetDataForKeyUser=t;this._bShowShare=this.getShowShare();this.setShowShare(false);var s=function(e,t,a){this._mFavoriteChanges[e.getKey()]=a;this._setFavoriteIcon(t,a)}.bind(this);var o=function(e){var t=this._isFavoriteSelected(e.oSource),a=e.oSource.getParent();if(a){s(a,e.oSource,t)}}.bind(this);var r=function(e){var t=e.oSource.getParent();if(t){this._checkManageItemNameChangeKeyUser(e.oSource,t)}}.bind(this);var l=function(e){this._checkVariantNameConstraints(e.oSource,this.oManagementTable)}.bind(this);var h=function(e){var t=e.oSource.getParent();if(t){this._handleManageDeletePressedKeyUser(e.oSource,t,s)}}.bind(this);var g=function(e){var t=e.getParameters().selected===true,a=e.oSource.getParent();if(a){var i=a.getCells()[f.FAV_COLUMN];if(t){this._sDefaultChanges=a.getKey();if(a.getKey()===this.getStandardVariantKey()){return}if(i&&this._isFavoriteSelected(i)){s(a,i,true)}}else{this._sDefaultChanges=null}this._toggleIconActivityState(i,a,t)}}.bind(this);var c=function(e){var t=e.getParameters().selected===true,a=e.oSource.getParent();if(a){this._mExecuteOnSelectChanges[a.getKey()]=t}}.bind(this);var d=function(e){var t=e.oSource.getParent().getParent();this._openRolesDialog(t,e.oSource.getParent().getItems()[0])}.bind(this);this._initalizeManagementTableColumns();this._restoreCompleteList(true);a=this.oVariantList.getItems();Promise.all([i]).then(function(e){this._oRolesComponentContainer=e[0];this._columnVisibilityManagementTable(f.RESTRICT_COLUMN,!!this._oRolesComponentContainer);var t={selectFavorite:o,selectDefault:g,executeOnSelect:c,rolesPressed:d,inputChange:r,inputLiveChange:l,deletePressed:h};for(var i=0;i<a.length;i++){this._createEntriesForManageViewsDialog(a[i],i,t)}this._createManagementDialog();this._setDialogCompactStyle(this,this.oManagementDialog);this.oManagementDialog.isPopupAdaptationAllowed=function(){return false};var s=this.oVariantList.getSelectedItem();if(s){this.lastSelectedVariantKey=s.getKey()}this.oVariantPopOver.close();this.oManagementDialog.addStyleClass(n);this.oManagementDialog.open()}.bind(this))};S.prototype._openVariantManagementDialog=function(){var e;var t=null;this._mFavoriteChanges={};this.oManagementSave.setEnabled(true);this.oManagementTable.destroyItems();var a=function(e){this._checkVariantNameConstraints(e.oSource,this.oManagementTable)}.bind(this);var i=function(e){var t=this._createEvent("inputfieldChange",this._checkManageItemNameChange);t.args.push(e.oSource.getParent());this._addEvent(t)}.bind(this);var n=function(e){var t=this._isFavoriteSelected(e.oSource),a=e.oSource.getParent();if(a&&this.sNewDefaultKey!==a.getKey()){this._mFavoriteChanges[a.getKey()]=t;this._setFavoriteIcon(e.oSource,t)}}.bind(this);var s=function(e){var t=e.getParameters().selected===true,a=e.oSource.getParent();if(a){var i=a.getCells()[f.FAV_COLUMN];if(t){this.sNewDefaultKey=a.getKey();if(a.getKey()===this.getStandardVariantKey()){return}this._mFavoriteChanges[a.getKey()]=t;if(i){this._setFavoriteIcon(i,true)}}this._toggleIconActivityState(i,a,t)}}.bind(this);var o=function(e){var t=this._createEvent("executeOnSelectionChange",this._handleManageExecuteOnSelectionChanged);t.args.push(e.oSource);this._addEvent(t)}.bind(this);var r=function(e){var t=this._createEvent("manageDeletePressed",this._handleManageDeletePressed);t.args.push(e.oSource);this._addEvent(t)}.bind(this);if(this.oManageDialogSearchField){this.oManageDialogSearchField.setValue("")}this._initalizeManagementTableColumns();this.sNewDefaultKey=this.getDefaultVariantKey();this._restoreCompleteList(true);e=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(e){this.oVariantList.removeItem(e)}t=this.oVariantList.getItems();t.sort(this._compareItems);if(e){this.oVariantList.insertItem(e);t.splice(0,0,e)}var l={selectFavorite:n,selectDefault:s,executeOnSelect:o,inputChange:i,inputLiveChange:a,deletePressed:r};for(var h=0;h<t.length;h++){this._createEntriesForManageViewsDialog(t[h],h,l)}this.aRemovedVariants=[];this.aRemovedVariantTransports=[];this.aRenamedVariants=[];this.aExeVariants=[];this._createManagementDialog();this._setDialogCompactStyle(this,this.oManagementDialog);e=this.oVariantList.getSelectedItem();if(e){this.lastSelectedVariantKey=e.getKey()}this.oVariantPopOver.close();this.oManagementDialog.open()};S.prototype._checkAndAddRolesContainerToSaveAsDialog=function(){if(this._oRolesComponentContainer&&this.oSaveDialog){var e=null;this.oSaveDialog.getContent().some(function(t){if(t===this._oRolesComponentContainer){e=t;return true}return false}.bind(this));this._setSelectedContexts({role:[]});if(!e){this.oSaveDialog.addContent(this._oRolesComponentContainer)}}};S.prototype.openSaveAsDialogForKeyUser=function(e,t,a){this._delayedControlCreation();this._sStyleClassKeyUser=e;this._fGetDataForKeyUser=t;this._mContextInfoChanges={};this._bShowShare=this.getShowShare();this.setShowShare(false);this._initSaveAsDialog();this.oSaveDialog.addStyleClass(e);this.oSaveDialog.isPopupAdaptationAllowed=function(){return false};Promise.all([a]).then(function(e){this._oRolesComponentContainer=e[0];this._checkAndAddRolesContainerToSaveAsDialog();this.oSaveDialog.open()}.bind(this))};S.prototype._cleanUpSaveForKeyUser=function(){this.oSaveDialog.removeStyleClass(this._sStyleClassKeyUser);if(this._oRolesComponentContainer){this.oSaveDialog.removeContent(this._oRolesComponentContainer)}this._cleanUpKeyUser();this.oSaveDialog.close()};S.prototype._cleanUpManageViewsForKeyUser=function(){this.oManagementDialog.removeStyleClass(this._sStyleClassKeyUser);this._cleanUpKeyUser();this.oManagementDialog.close()};S.prototype._cleanUpKeyUser=function(){this.setShowShare(this._bShowShare);this._mFavoriteChanges=null;this._mExecuteOnSelectChanges=null;this._sDefaultChanges=null;this._mTitleChanges=null;this._mDeletedChanges=null;this._mContextInfoChanges=null;this._fGetDataForKeyUser=null;this._sLayer=null;this._sStyleClassKeyUser=undefined;this._oRolesComponentContainer=null};S.prototype._handleManageSavePressedForKeyUser=function(){var e,t={};var a=false;if(this._sDefaultChanges){t.default=this._sDefaultChanges}if(Object.keys(this._mExecuteOnSelectChanges).length>0){for(e in this._mExecuteOnSelectChanges){if(!t[e]){t[e]={}}t[e].executeOnSelection=this._mExecuteOnSelectChanges[e]}}if(Object.keys(this._mFavoriteChanges).length>0){for(e in this._mFavoriteChanges){if(!t[e]){t[e]={}}t[e].favorite=this._mFavoriteChanges[e]}}if(Object.keys(this._mTitleChanges).length>0){for(e in this._mTitleChanges){if(!t[e]){t[e]={}}t[e].name=this._mTitleChanges[e]}}if(Object.keys(this._mDeletedChanges).length>0){for(e in this._mDeletedChanges){if(!t[e]){t[e]={}}t[e].deleted=this._mDeletedChanges[e]}if(this.lastSelectedVariantKey===e){a=true}}if(Object.keys(this._mContextInfoChanges).length>0){for(e in this._mContextInfoChanges){if(!t[e]){t[e]={}}t[e].contexts=this._mContextInfoChanges[e]}}if(a){this.activateVariant(this.getStandardVariantKey())}this._fGetDataForKeyUser(t);this._cleanUpManageViewsForKeyUser()};S.prototype._handleManageCancelPressedForKeyUser=function(){this._fGetDataForKeyUser();this._cleanUpManageViewsForKeyUser()};S.prototype._handleSaveAsCancelPressedForKeyUser=function(){this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()};S.prototype._getSelectedContexts=function(){return this._oRolesComponentContainer.getComponentInstance().getSelectedContexts()};S.prototype._setSelectedContexts=function(e){this._oRolesComponentContainer.getComponentInstance().setSelectedContexts(e)};S.prototype._isInErrorContexts=function(){return this._oRolesComponentContainer.getComponentInstance().hasErrorsAndShowErrorMessage()};S.prototype._getContentAsync=function(){return Promise.resolve(this._fetchContentAsync())};S.prototype._handleSaveAsPressedForKeyUser=function(){if(!this._checkAndCreateContextInfoChanges("newDummyKey")){return}try{this._getContentAsync().then(function(e){var t={default:this.oDefault.getSelected(),executeOnSelection:this.oExecuteOnSelect.getSelected(),type:this._getPersoControllerType(),text:this.oInputName.getValue().trim(),contexts:this._mContextInfoChanges["newDummyKey"],content:e};this._fGetDataForKeyUser(t);this._cleanUpSaveForKeyUser()}.bind(this))}catch(e){i.error("'_handleSaveAsPressedForKeyUser' throws an exception:"+e.message);this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};return S});