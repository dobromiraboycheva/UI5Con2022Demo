/*
 * ! SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FilterUtil","sap/ui/comp/library"],function(e,i,t,a,l,n,s){"use strict";var r=s.smartfilterbar.FilterType,f=s.valuehelpdialog.ValueHelpRangeOperation;var u=e.extend("sap.ui.comp.smartfilterbar.FilterProviderUtils");u.FIELD_NAME_REGEX=/\./g;u.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";u.BASIC_FILTER_AREA_ID="_BASIC";u.FILTER_MODEL_NAME="fi1t3rM0d31";u.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";u.ASSOCIATE_VALUE_LISTS="AssociateValueLists";u._getStringEmptyFilter=function(e,a,l){var n=l?t.NE:t.EQ;if(a&&a.nullable==="false"){return new i(e,n,"")}else{return new i({and:!!l,filters:[new i(e,n,""),new i(e,n,null)]})}};u._getFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fields){e.fields.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null})}return t!==null});return t};u.adaptTime=function(e,i){var t;if(!(e instanceof Date)||!i){return e}if(i.filterRestriction===r.single&&i.control&&i.control.isA("sap.m.DynamicDateRange")){return a.normalizeDate(e,true)}if(i.displayFormat==="Date"){return a.normalizeDate(e,true)}t=parseInt(i.precision);return a.adaptPrecision(e,t)};u.generateFilters=function(e,s,r){var o=[],p=null,m=null,c=null,d=null,T=u.FIELD_NAME_REGEX,E=null,D,g,w=null,h=0,F=0,_,C,I,v,O,y,A,S,U,L=[],R,M,x;if(r){_=r.dateSettings;C=r.useContainsAsDefault;I=r.stringFields;v=r.timeFields;A=r.dateTimeOffsetValueFields;L=r.viewMetadataData||[]}if(e&&s){F=e.length;while(F--){y=false;S=false;d=e[F];U=u._getFieldMetadata(L,d);if(U&&U.isCustomFilterField){continue}if(d&&d!==u.BASIC_SEARCH_FIELD_ID){w=null;O=false;if(C&&I){if(I.indexOf(d)>-1){O=true}}else if(v&&v.indexOf(d)>-1){y=true}else if(A&&A.indexOf(d)>-1){S=true}E=s[d];d=d.replace(T,"/");if(E&&E.hasOwnProperty("low")){if(E.low&&E.high){D=E.low;g=E.high;if(!S&&_&&_.UTC&&D instanceof Date&&g instanceof Date){D=a.localToUtc(D);g=a.localToUtc(g)}D=u.adaptTime(D,U);g=u.adaptTime(g,U);o.push(new i(d,t.BT,D,g))}else if(E.low){if(E.low instanceof Date){D=E.low;if(!S&&_&&_.UTC){D=a.localToUtc(D)}D=u.adaptTime(D,U);o.push(new i(d,t.EQ,D))}else if(typeof E.low==="string"){if(S&&U){w=l.parseDateTimeOffsetInterval(E.low);w[0]=U.ui5Type.parseValue(w[0],"string");if(w.length===2){w[1]=U.ui5Type.parseValue(w[1],"string")}}else{w=l.parseFilterNumericIntervalData(E.low)}if(w&&w.length===2){E[0]=u.adaptTime(E[0],U);E[1]=u.adaptTime(E[1],U);o.push(new i(d,t.BT,w[0],w[1]))}else if(w&&w.length===1){E[0]=u.adaptTime(E[0],U);o.push(new i(d,t.EQ,w[0]))}else{o.push(new i(d,O?t.Contains:t.EQ,E.low))}}}}else if(E&&E.hasOwnProperty("items")){p=[];c=[];m=null;if(E&&E.hasOwnProperty("ranges")){w=E.ranges;h=w.length;while(h--){R=w[h];D=R.value1;g=R.value2;if(y){if(D instanceof Date){D=l.getEdmTimeFromDate(D)}if(g instanceof Date){g=l.getEdmTimeFromDate(g)}}else if(U&&U.isCalendarDate){if(D instanceof Date){D=U.ui5Type.parseValue(D)}if(g instanceof Date){g=U.ui5Type.parseValue(g)}}else if(!S&&_&&_.UTC){if(D instanceof Date){D=a.localToUtc(D)}if(g instanceof Date){g=a.localToUtc(g)}}D=u.adaptTime(D,U);g=u.adaptTime(g,U);M=R.exclude?c:p;if(R.operation===f.Empty){if(U&&["Edm.DateTime","Edm.DateTimeOffset"].indexOf(U.type)>-1){M.push(new i(d,R.exclude?t.NE:t.EQ,null))}else{M.push(u._getStringEmptyFilter(d,U,R.exclude))}}else{if(R.operation!==t.BT&&R.operation!==t.NB){g=undefined}x=R.exclude?n.getTransformedExcludeOperation(R.operation):R.operation;M.push(new i(d,x,D,g))}}if(c.length){m=new i(c,true)}}w=E.items;h=w.length;while(h--){p.push(new i(d,t.EQ,w[h].key))}if(E.value||E.value===0||E.value===false){if(typeof E.value==="string"){E.value=E.value.trim()}p.push(new i(d,O?t.Contains:t.EQ,E.value))}if(p.length){if(m){o.push(new i([new i(p,false),m],true))}else{o.push(new i(p,false))}}else if(m){o.push(m)}}else if(E||E===0||E===false){if(typeof E==="string"){E=E.trim()}if(E&&E instanceof Date){if(y){E=l.getEdmTimeFromDate(E)}else if(!S&&_&&_.UTC){E=a.localToUtc(E)}}if(E||E===0||E===false){E=u.adaptTime(E,U);o.push(new i(d,O?t.Contains:t.EQ,E))}}}}}return o.length>1?[new i(o,true)]:o};return u});