/*
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/library","sap/m/library","sap/ui/comp/library","sap/ui/model/BindingMode","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/ui/comp/smartfield/ComboBox","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/FlexItemData","sap/m/HBox","sap/m/Input","sap/m/Select","sap/m/Text","sap/m/ExpandableText","sap/ui/core/Renderer","sap/ui/comp/navpopover/SmartLink","./ControlFactoryBase","./FieldControl","./ODataControlSelector","./ODataHelper","./ODataTypes","./TextArrangementDelegate","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/m/TimePicker","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/comp/util/FormatUtil","sap/ui/comp/smartfield/Configuration","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/navpopover/NavigationPopoverHandler","sap/ui/core/InvisibleText","sap/base/Log","sap/base/assert","sap/base/security/URLListValidator","sap/base/util/merge","sap/base/strings/capitalize","sap/base/util/deepClone","sap/base/strings/whitespaceReplacer"],function(t,e,a,o,i,r,n,s,l,p,u,h,d,g,c,m,y,_,f,M,v,D,C,P,T,b,x,S,I,F,V,A,E,O,B,L,w,U,N,H,k,R,j){"use strict";var W=t.ValueState;var z=t.TextAlign;var q=e.InputType;var K=e.EmptyIndicatorMode;var G=e.FlexJustifyContent;var $=a.smartfield.CriticalityRepresentationType;var J=a.smartfield.ControlContextType;var Q=t.TextDirection;var X=e.FlexAlignContent;var Y;var Z=M.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(t,e,a){M.call(this,t,e);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=a;this._oHelper=new C(t,this._oBinding);this._oFieldControl=new v(e,this._oHelper);this._oTypes=new P(e);this._oSelector=new D(this._oMetaData,e,this._oTypes);this.oTextArrangementDelegate=new T(this);this._bInitialized=false;this.bPending=false;this.oMeasureField=null;Y=sap.ui.require("sap/ui/comp/smartfield/SmartField");if(!Y){throw new Error("SmartField module not loaded for "+this)}}});Z.prototype._init=function(t){this._oMetaData.model=t.model;this._oMetaData.path=t.path;this._oMetaData.entitySet=t.entitySetObject||this._oHelper.oMeta.getODataEntitySet(t.entitySet);if(this._oHelper.oMeta){U(this._oMetaData.entitySet,'The entity set named "'+t.entitySet+'" was not found in the "'+this._oHelper.oMeta.getODataEntityContainer().name+'" entity container of the service metadata document. - '+this.getMetadata().getName())}this._oMetaData.entityType=t.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=t.navigationPath||null;if(typeof t.ignoreInsertRestrictions==="boolean"){this._oMetaData.ignoreInsertRestrictions=t.ignoreInsertRestrictions}if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);var e=this.getEdmProperty();U(!!e,'The EDM property "'+t.path+'" was not found in the "'+this._oMetaData.entityType.namespace+"."+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(e){this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData);this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=E.getSemanticObjectsFromProperty(e);this._oMetaData.annotations.semanticKeys=this._oHelper.getAnalyzer().getSemanticKeyAnnotation(this._oMetaData.entitySet.entityType);if(this._oMetaData.annotations.uom){this._oMetaData.annotations.uom.annotations={};this._oHelper.getValueListData(this._oMetaData.annotations.uom)}this._oHelper.getUOMTextAnnotation(this._oMetaData);if(this._oParent&&this._oParent.getExpandNavigationProperties()){var a=this._oParent.getBindingContext(),o=a&&a.getObject(),i=o&&o.__metadata.created;if(!i){var r=this._oHelper.getAutoExpandProperties(e);if(r.length>0){this._oParent.bindElement({path:"",parameters:{expand:r,select:r}})}}}}}else{this._oMetaData.modelObject=t.modelObject;this._oMetaData.property=t.property;this._oMetaData.annotations.text=t.annotations.text;this._oMetaData.annotations.uom=t.annotations.uom;if(this._oMetaData.annotations.uom&&!this._oMetaData.annotations.uom.annotations){this._oMetaData.annotations.uom.annotations={}}if(t.annotations.valueListData){this._oMetaData.annotations.valuelist=t.annotations.valueListData}else{this._oMetaData.annotations.valuelist=t.annotations.valuelist}this._oMetaData.annotations.valuelistType=t.annotations.valuelistType;this._oMetaData.annotations.lineitem=t.annotations.lineitem;this._oMetaData.annotations.semantic=t.annotations.semantic;this._oMetaData.annotations.valuelistuom=t.annotations.valuelistuom}};Z.prototype._initValueList=function(t){var e=this._oMetaData.property,a=t.primaryValueListAnnotation;this._oMetaData.annotations.valueListData=a;e.valueListAnnotation=a;e.valueListKeyProperty=this._oHelper.getODataValueListKeyProperty(a);e.valueListEntitySet=this._oHelper.oMeta.getODataEntitySet(a.valueListEntitySetName);e.valueListEntityType=this._oHelper.oMeta.getODataEntityType(this._oHelper.oMeta.getODataEntitySet(a.valueListEntitySetName).entityType)};Z.prototype._getTextArrangementType=function(){var t=null,e=T.getPaths("ValueList",this._oMetaData);if(e.keyField&&e.descriptionField){t=this._oTypes.getType(this._oMetaData.property,null,null,{composite:true,keyField:e.keyField,descriptionField:e.descriptionField,valueListNoValidation:this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation"});if(!(t.isA("sap.ui.comp.smartfield.type.TextArrangementString")||t.isA("sap.ui.comp.smartfield.type.TextArrangementGuid"))){t=null}}return t};Z.prototype._createEdmDisplay=function(t){var e,a=t.mode,o,i,r,n,s,l,p=false,u="getText",h=this,d={width:true,textAlign:true},g=this.getEdmProperty(),c=this._oParent.data("configdata"),_=c&&c.isInnerControl!==true||this._oParent.isContextTable(),f=this._oSelector.checkComboBox({mode:a,configOnly:_}),M=this._oSelector.checkDatePicker()||(g?g.type.startsWith("Edm.Date"):false);if(g){r=this._oHelper.oAnnotation.getText(g)}if(this._checkLink()&&!this._oSelector.useObjectIdentifier()){return this._createLink(M)}n=this.createAttributes(null,this._oMetaData.property,d);n.emptyIndicatorMode=K.Auto;this.oType=null;var v=g&&E.getTimezonePropertyPath(g)||false;if(g&&g.type==="Edm.DateTimeOffset"&&v){this.oType=this._getDateFormatType();var D=function(){if(!arguments[0]&&!(this.oType.oFormatOptions&&this.oType.oFormatOptions.showDate===false&&this.oType.oFormatOptions.showTime===false)){return""}return this.oType.formatValue(arguments,"string")};n.text={model:this._oMetaData.model,type:this.oType,parts:[{path:this._oMetaData.path,type:this.oType},{path:v,parameters:{useUndefinedForUnresolved:true}}],useRawValues:true,formatter:D.bind(this)}}else if(M){this.oType=this._getDateFormatType();n.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this.oType}}else{n.text={model:this._oMetaData.model,type:this.oType};if(this._bTextInDisplayModeValueList&&this._oMetaData.property&&this._oMetaData.property.valueListAnnotation){l={};if(this._oHelper.oAnnotation.isUpperCase(this._oMetaData.property.property)){l.sDisplayFormat="UpperCase"}l.valueListNoValidation=this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation";s=this.oTextArrangementDelegate.getBindingInfo(l);this.oType=s.type;n.text.parts=s.parts}if(!this.oType){this.oType=this._oTypes.getType(this._oMetaData.property);n.text.path=this._oHelper.getEdmDisplayPath(this._oMetaData)}n.text.type=this.oType}if(g){o=this._oHelper.oAnnotation.isMasked(g);if(o){n.text.formatter=P.maskValue}if(r){i=this._oSelector.useObjectIdentifier(M,o);if(i){delete n.width;delete n.textAlign;n.text={path:this._oMetaData.path};n.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};if(this._oParent.hasListeners("press")){n.titleActive=true;n.titlePress=function(t){h._oParent.firePress(t)}}else if(this._oMetaData.annotations.semantic&&this._oMetaData.annotations.semantic.defaultSemanticObject){var C;var T;var b=this._oMetaData.annotations.semantic.additionalSemanticObjects.concat(this._oMetaData.annotations.semantic.defaultSemanticObject);F.getDistinctSemanticObjects().then(function(t){C=F.hasDistinctSemanticObject(b,t);if(C){var e=h._oParent.getBindingInfo("value");var a=e.parts[0].path;var o=h._oHelper.oAnnotation.getLabel(h._oMetaData.property.property);if(h._oMetaData.annotations.lineitem&&h._oMetaData.annotations.lineitem.labels&&h._oMetaData.annotations.lineitem.labels[a]){o=h._oMetaData.annotations.lineitem.labels[a]}T=new B({semanticObject:h._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:h._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:o,fieldName:a,navigationTargetsObtained:function(t){var e=sap.ui.getCore().byId(t.getSource().getControl());var a=t.getParameters().mainNavigation;if(a){a.setDescription(e.getText())}t.getParameters().show(e.getTitle(),a,undefined,undefined)}})}});n.titleActive={path:"$sapuicompsmartfield_distinctSO>/distinctSemanticObjects",formatter:function(t){return F.hasDistinctSemanticObject(b,t)}};n.titlePress=function(t){if(C&&T){T.setControl(t.getSource(t.getParameter("domRef")));T.openPopover()}}}}else if(!(c&&c.isInnerControl===true)){n.text={};n.text.parts=[];n.text.parts.push(this._oMetaData.path);n.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));n.text.formatter=function(t,e){if(f.combobox){var a=h._formatDisplayBehaviour("defaultComboBoxReadOnlyDisplayBehaviour",t,e),o=a(t,e);return j(o)}if(h.oType&&!h._bTextInDisplayModeValueList){t=h.oType.formatValue(t,"string")}if(h.oType&&h.oType.isA("sap.ui.comp.odata.type.NumericText")&&t===null&&e){t=""}return h._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",t,e)}}}else if(this._oSelector.checkCheckBox()){n.text.formatter=function(t){return h._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",t)}}}if(i){e=new x(this._oParent.getId()+"-objIdentifier",n);if(this._oMetaData.annotations.semantic){e.setModel(F.getJSONModel(),"$sapuicompsmartfield_distinctSO")}}else{if(n.text.type&&n.text.type.isA("sap.ui.comp.smartfield.type.DateTime")&&n.text.type.oConstraints&&n.text.type.oConstraints.isDateOnly){n.wrapping=false}if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){n.textDirection="LTR"}if(typeof n.text.formatter==="undefined"&&!v){n.text.formatter=function(t){return j(t)}}if(this._oHelper.oAnnotation.isMultiLineText(g)){delete n.width;e=new y(this._oParent.getId()+"-expandableText",n)}else{e=new m(this._oParent.getId()+"-text",n)}p=this._oSelector._checkComboBox({mode:a,configOnly:_}).combobox&&(this._oParent.getFetchValueListReadOnly()||r===undefined);if(p){u=null}}if(i&&c&&c.configdata&&c.configdata.onText){delete c.configdata.onText}var S={control:e,onCreate:"_onCreate",params:{getValue:u,noValidations:true,type:null}};if(this.oType){S.type={type:this.oType,property:this._oMetaData.property}}return S};Z.prototype._getDateFormatType=function(){var t=this.getFormatSettings("dateFormatSettings"),e=this.getEdmProperty(),a;try{a=R(t)}catch(e){a=t}if(a&&e&&e.type==="Edm.DateTimeOffset"){a.UTC=false}return this._oTypes.getType(this._oMetaData.property,a)};Z.prototype._createEdmTime=function(){var t=this.getFormatSettings("dateFormatSettings"),e={width:true,placeholder:true,valueState:true,valueStateText:true};var a=Z.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var o={valueFormat:"HH:mm:ss"};o=Object.assign(o,this.createAttributes(a,this._oMetaData.property,e,{event:"change",parameter:"value"}));if(o.width===""){o.width="100%"}if(t){o[a].type=this._oTypes.getType(this._oMetaData.property,t)}var i=new I(this._oParent.getId()+"-timePicker",o);this._enhanceInputControls(i);return{control:i,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:o.value.type,property:this._oMetaData.property}}}};Z.prototype._createObjectStatus=function(){var t=this.createAttributes(null,this._oMetaData.property,null),e=this._oHelper.oAnnotation.getText(this.getEdmProperty());var a=Z.getBoundPropertiesMapInfoForControl(S.getMetadata().getName(),{propertyName:"value"})[0];if(e){t[a]={parts:[this._oHelper.getEdmDisplayPath(this._oMetaData)]}}else{t[a]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)}}this._addObjectStatusAttributes(t);var o=new S(this._oParent.getId()+"-objStatus",t);return{control:o,onCreate:"_onCreate",params:{getValue:"getText",noValidation:true}}};Z.prototype._addObjectStatusAttributes=function(t){var e,a=this._oParent.getControlProposal(),o=a.getObjectStatus();if(o){e=o.getBindingInfo("criticality")}var i=function(t){var e={0:W.None,1:W.Error,2:W.Warning,3:W.Success};var a={"com.sap.vocabularies.UI.v1.CriticalityType/Neutral":W.Neutral,"com.sap.vocabularies.UI.v1.CriticalityType/Negative":W.Warning,"com.sap.vocabularies.UI.v1.CriticalityType/Critical":W.Error,"com.sap.vocabularies.UI.v1.CriticalityType/Positive":W.Success};return a[t]||e[t]||W.None};var r=function(){var t={};t[W.Error]="sap-icon://error";t[W.Warning]="sap-icon://alert";t[W.Success]="sap-icon://sys-enter-2";t[W.None]=null;var a;if(e){if(e.formatter){a=e.formatter.apply(null,arguments)}else{a=arguments[0]}}else{a=o.getCriticality()}if(a===undefined||a===null){return null}return t[i(a)]};var n=function(){if(!o){return false}return o.getCriticalityRepresentationType()!==$.WithoutIcon};if(e){t.state={formatter:function(){var t;if(e.formatter){t=e.formatter.apply(null,arguments)}else{t=arguments[0]}return i(t)},parts:e.parts};if(n()){t.icon={formatter:r,parts:e.parts}}}else{if(o){t.state=i(o.getCriticality())}if(n()){t.icon=r()}}};Z.prototype._createInput=function(t){var e=new g(this._oParent.getId()+"-input",t);this._enhanceInputControls(e);return e};Z.prototype._enhanceInputControls=function(t){if(t.isA("sap.m.InputBase")&&typeof t._setPreferUserInteraction==="function"){t._setPreferUserInteraction(true)}};Z.prototype._createEdmString=function(t){var e={},a=t.mode;if(this._oSelector.checkCheckBox()){return this._createCheckBox()}var o=this._oSelector.checkSelection();if(o.selection){return this._createSelect({valueHelp:Z.getValueHelpDropdownSettings(o)})}o=this._oSelector.checkComboBox(t);if(o.combobox){return this._createComboBox({valueHelp:Z.getValueHelpDropdownSettings(o),edit:true})}var i={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var r=this.getEdmProperty();if(this._oHelper.oAnnotation.isMultiLineText(r)){delete i["width"];return this._createMultiLineText({attributesNamesMap:i})}var n=this._oParent.isTextInEditModeSourceNotNone(),s=/Edm.String|Edm.Guid/.test(r.type);if(n||this._bTextInDisplayModeValueList){U(s,"The ValueList and NavigationProperty"+"members of the sap.ui.comp.smartfield.TextInEditModeSource enumeration are only supported for OData "+"EDM Properties typed as Edm.String or Edm.Guid. - "+this.getMetadata().getName())}var l=Z.getBoundPropertiesMapInfoForControl(g.getMetadata().getName(),{propertyName:"value"})[0];var p=this._oParent._getComputedTextInEditModeSource(),u,h;if(this._oParent.data("defaultTextInEditModeSource")&&this._oParent.isPropertyInitial("textInEditModeSource")&&a==="edit"){u=true}this.oTextArrangementDelegate.bValidMetadata=s&&this.oTextArrangementDelegate.checkRequiredMetadata(p,u);if(this.oTextArrangementDelegate.bValidMetadata){h=this.createAttributes("",this._oMetaData.property,i);e.valueListNoValidation=this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation";h[l]=this.oTextArrangementDelegate.getBindingInfo(e)}else{h=this.createAttributes(l,this._oMetaData.property,i)}if(O.isFiscalValue(r)){h.placeholder=h.value.type.formatter.getPattern();return{control:this._createInput(h),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:h.value.type,property:this._oMetaData.property}}}}var d=this._createInput(h);if(this._oHelper.oAnnotation.isMasked(r)){d.setType(q.Password)}var c=this.getCustomDataConfiguration();if(this.oTextArrangementDelegate.bValidMetadata){this._handleEventingForTextArrangement({control:d})}else{this._handleEventingForEdmString({control:d,edmProperty:this._oMetaData.property.property,currency:c&&c.currency})}return{control:d,onCreate:"_onCreate",params:{valuehelp:{annotation:o.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:h.value.type,property:this._oMetaData.property}}}};Z.getValueHelpDropdownSettings=function(t){return{annotation:t.annotation,noDialog:true,noTypeAhead:true}};Z.prototype._getMaxLength=function(){return this._oTypes.getMaxLength(this._oMetaData.property,this._oParent.getBindingInfo("value"))};Z.prototype._addAriaLabelledBy=function(t){var e,a,o,i=this._oParent.getControlContext();if(i===J.None||i===J.Form||i===J.SmartFormGrid){M.prototype._addAriaLabelledBy.apply(this,arguments);o=this._oParent.data("configdata");if(o&&o.configdata.isInnerControl&&o.configdata.isUOM){if(t){a=t.control;if(a instanceof d){if(a.getItems().length>0){a=a.getItems()[0]}}}if(a&&a.getAriaLabelledBy&&a.getAriaLabelledBy().length===0){var r=this.getEdmProperty();if(this._oHelper.oAnnotation.getLabel(r)){e=new L({text:this._oHelper.oAnnotation.getLabel(r)});a.addAriaLabelledBy(e);this._oParent.addAggregation("_ariaLabelInvisibleText",e)}}}}};Z.prototype._addAriaDescribedBy=function(){var t=this._oParent.getControlContext();if(t===J.None||t===J.Form||t===J.SmartFormGrid){M.prototype._addAriaDescribedBy.apply(this,arguments)}};Z.prototype._handleEventingForEdmString=function(t){var e=t.control;if(!e){return}e.attachChange(function a(o){var i=this._getChangeEventParams(o),r=o&&o.getParameters(),n=o&&o.getSource();if(r){var s=r.value;i.value=s;i.newValue=s;if(e._oSuggestionPopup&&e._oSuggestionPopup.isOpen()){if(!r.validated){if(e._iPopupListSelectedIndex>=0){return}}}if(t.currency){var l=this.getCurrencyValidationSettings();l.oSource=n;if(this._oHelper.oAnnotation.isUpperCase(t.edmProperty)&&s){s=s.toUpperCase();e.setValue(s)}}try{this._oParent.fireChange(i)}catch(t){w.error(t)}}}.bind(this))};Z.prototype._handleEventingForTextArrangement=function(t){var e=t.control;if(!e){return}e.attachChange(function(t){var e=this._getChangeEventParams(t);try{var a=this._oParent.data("configdata");if(a&&a.configdata&&this._oParent.isTextInEditModeSourceNotNone()){this._oParent.checkValuesValidity().then(function(){this._oParent.fireChange(e)}.bind(this))}else{this._oParent.fireChange(e)}}catch(t){w.error(t)}}.bind(this))};Z.prototype.getUOMChangeHandler=function(t){return function(e){try{var a=t.smartFieldRootControl,o=e.getParameters(),i=o.value,r=e.getSource(),n=t.currency,s=n?this.getCurrencyValidationSettings(t):this.getUnitValidationSettings(t);s.oSource=r;n?this.updateModelPropertiesForCurrency("value",s):this.updateModelPropertiesForUnit("value",s);a.fireChange({value:i,newValue:i,unitChanged:!!t.unit,validated:!!o.validated})}catch(e){if(e.validationUnitError){a.fireChange({value:i,newValue:i,unitChanged:!!t.unit,validated:!!o.validated})}w.error(e)}}.bind(this)};Z.prototype.getCurrencyValidationSettings=function(t){var e;if(t){e=t.smartFieldRootControl}else{var a=this.getCustomDataConfiguration();e=a&&a.smartFieldRootControl}var o=e.getInnerControls();return{amountField:o[0],currencyField:o[1],errorState:e._oError,checkValidity:e.checkValuesValidity.bind(e),rootControl:e}};Z.prototype.getUnitValidationSettings=function(t){var e;if(t){e=t.smartFieldRootControl}else{var a=this.getCustomDataConfiguration();e=a&&a.smartFieldRootControl}var o=e.getInnerControls();return{measureField:o[0],unitField:o[1],errorState:e._oError,checkValidity:e.checkUnitValidity.bind(e),rootControl:e}};Z.prototype.updateModelPropertiesForCurrency=function(t,e){var a=e.amountField,i=e.currencyField,r=e.oSource,n=a.getValue(),s,l="";if(i){var p=i.getMetadata().getName();s=Z.getBoundPropertiesMapInfoForControl(p,{propertyName:t})[0];var u="get"+k(s);l=i[u]()}var h=[n,l];var d={rawValues:h,handleSuccess:false};var g=e.checkValidity(d);function c(e){var l=a.getModel(),p=a.getBinding(t),u,d;if(i){u=i.getBinding(s);d=u.getType()}var g=p.getType(),c=p.getExternalValue(),m=u&&u.getExternalValue(),y=g.parseValue(n,"string",h),_=y[1],f=g.formatValue(y,"string"),M=d&&d.formatValue(_,"string");if(l.getDefaultBindingMode()===o.TwoWay){if(!e){p.setValue(y)}}if(!e){a.setValue(f)}var v=false,D=true;if(p.hasValidation()&&!e){var C={element:a,property:t,type:g,newValue:f,oldValue:c,mParameters:{originSource:r}};a.fireValidationSuccess(C,v,D)}if(u&&u.hasValidation()){var P={element:i,property:s,type:d,newValue:M,oldValue:m,mParameters:{originSource:r}};i.fireValidationSuccess(P,v,D)}}function m(t){}function y(){var o=e.errorState;if(o.bComplex&&o.bFirst&&o.bSecond){var r=a.getBinding(t).getExternalValue();h=[r,l];var n={rawValues:h,innerControls:[i],handleSuccess:false};var s=e.checkValidity(n);s.then(function(){return c.call(this,true)}.bind(this)).catch(m)}}g.then(function(){return c()}).catch(m).finally(y)};Z.prototype.updateModelPropertiesForUnit=function(t,e){var a=e.measureField,i=e.unitField,r=a.getValue(),n,s="";if(i){var l=i.getMetadata().getName();n=Z.getBoundPropertiesMapInfoForControl(l,{propertyName:t})[0];var p="get"+k(n),u=i.getParent();if(i.isA("sap.m.ComboBox")){s=i.getSelectedKey()}else if(this._getDisplayBehaviourConfiguration()&&u&&(!u.getEditable()||u._oFactory._getTextArrangementType())){s=u.getBinding("value").getValue()}else{s=i[p]()}}else if(this._checkSuppressUnit()){var h=this.getMetaData().annotations.uom.path,d=a.getBindingContext();s=this._oModel.getData(h,d)}var g=[r,s];var c={rawValues:g,handleSuccess:false};var m=e.checkValidity(c);if(m){var y=a.getModel(),_=a.getBinding(t),f,M;if(i){f=i.getBinding(n);M=f.getType()}var v=_.getType(),D=v.parseValue(r,"string",g),C=D[1],P,T;if(C===undefined&&i&&!i.getEditable){P=v.formatValue([D[0],null],"string");T=C}else{P=v.formatValue(D,"string");if(!_.isA("sap.ui.comp.smartfield.type.Unit")){C=s}T=M&&M.formatValue(C,"string")}if(y.getDefaultBindingMode()===o.TwoWay){_.setValue(D)}a.setValue(P);if(i&&i.getEditable&&i.getEditable()&&i.getParent().getVisible()&&!i.isA("sap.m.ComboBox")){i.setValue(T)}}};Z.prototype._createComboBox=function(t){var e=null,a=this._oSelector&&this._oSelector._oParent&&this._oSelector._oParent.oParent&&this._oSelector._oParent.oParent.isA("sap.ui.comp.smartmultiedit.Field")||this._oParent&&this._oParent.getFixedValueListValidationEnabled&&this._oParent.getFixedValueListValidationEnabled(),o={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true},i,r;if(a){i=Z.getBoundPropertiesMapInfoForControl(s.getMetadata().getName(),{propertyName:"value"})[0];r={change:function(t){if(t.getParameter("itemPressed")){return}var e=t.getSource().getSelectedKey();this._oParent.fireChange({value:e,newValue:e})}.bind(this)}}else{i=Z.getBoundPropertiesMapInfoForControl(l.getMetadata().getName(),{propertyName:"value"})[0];r={change:function(t){if(this._oParent.getFirstInnerControl().setEnteredValue){this._oParent.getFirstInnerControl().setEnteredValue()}var e=t.getSource().getSelectedKey();if(!e){e=t.getSource().getValue()}this._oParent.fireChange({value:e,newValue:e})}.bind(this)}}r["selectionChange"]=this._oHelper.getSelectionChangeHandler(this._oParent);r=Object.assign(r,this.createAttributes(i,this._oMetaData.property,o));if(r.width===""){r.width="100%"}if(t.edit){if(a){e=new s(this._oParent.getId()+"-comboBoxEdit",r)}else{e=new l(this._oParent.getId()+"-comboBoxEdit",r)}this._enhanceInputControls(e)}else{e=this._createDisplayedComboBox(r)}return{control:e,onCreate:"_onCreate",params:{valuehelp:{annotation:t.valueHelp.annotation,aggregation:"items",noDialog:t.valueHelp.noDialog,noTypeAhead:t.valueHelp.noTypeAhead},getValue:"get"+i[0].toUpperCase()+i.slice(1),type:{type:r[i].type,property:this._oMetaData.property}}}};Z.prototype._createDisplayedComboBox=function(t){var e=s.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp",properties:{wrapping:{type:"boolean",group:"Appearance",defaultValue:true}}},renderer:function(t,e){var a=e.getWidth(),o=e.getValue(),i=e.getTextDirection(),r=e.getTextAlign(),n=e.getTooltip_AsString(),s=e.getWrapping();t.write("<span");t.writeControlData(e);t.addClass("sapMText");t.addClass("sapUiSelectable");if(s){if(o&&o.length>0&&!/\s/.test(o)){t.addClass("sapMTextBreakWord")}}else{t.addClass("sapMTextNoWrap")}if(a&&o!==""){t.addStyle("width",a)}else{t.addClass("sapMTextMaxWidth")}if(i!==Q.Inherit){t.writeAttribute("dir",i.toLowerCase())}if(n){t.writeAttributeEscaped("title",n)}if(r){r=_.getTextAlign(r,i);if(r){t.addStyle("text-align",r)}}var l=s?"sapMTextRenderWhitespaceWrap":"sapMTextRenderWhitespace";t.addClass(l);t.writeClasses();t.writeStyles();t.write(">");o.replace(/\r\n|\n\r|\r/g,"\n");t.writeEscaped(o);t.write("</span>")},updateDomValue:function(t){if(!this.isActive()){return this}t=this._getInputValue(t);if(this.$().text()!==t){this.$().text(t);this._bCheckDomValue=true}return this},getValue:function(){return this.getProperty("value")},getFocusDomRef:function(){return this.getDomRef()},getEditable:function(){return false}});return new e(this._oParent.getId()+"-comboBoxDisp",t)};Z.prototype._createSelect=function(t){var e={width:true,name:true,valueState:true},a;var o=Z.getBoundPropertiesMapInfoForControl(c.getMetadata().getName(),{propertyName:"value"})[0];var i={change:this._oHelper.getSelectionChangeHandler(this._oParent),forceSelection:false};i=Object.assign(i,this.createAttributes(o,this._oMetaData.property,e));if(i.width===""){i.width="100%"}a=new c(this._oParent.getId()+"-select",i);this._enhanceInputControls(a);return{control:a,onCreate:"_onCreate",params:{valuehelp:{annotation:t.valueHelp.annotation,aggregation:"items",noDialog:t.valueHelp.noDialog,noTypeAhead:t.valueHelp.noTypeAhead},getValue:"getSelectedKey",type:{type:i.selectedKey.type,property:this._oMetaData.property}}}};Z.prototype._createCheckBox=function(){var t=Z.getBoundPropertiesMapInfoForControl(n.getMetadata().getName(),{propertyName:"value"})[0];var e=this.createAttributes(t,null,{},{event:"select",parameter:"selected"});e.editable=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable();e.selected.type=this._oTypes.getAbapBoolean();return{control:new n(this._oParent.getId()+"-cBox",e),onCreate:"_onCreate",params:{getValue:"getSelected"}}};Z.prototype._createEdmDateTime=function(){var t=this.getFormatSettings("dateFormatSettings"),e,a,o;var i={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var r=this.createAttributes(null,this._oMetaData.property,i,{event:"change",parameter:"value"});if(this._oSelector.checkDatePicker()){e=Z.getBoundPropertiesMapInfoForControl(p.getMetadata().getName(),{propertyName:"value"})[0];r[e]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,t,{displayFormat:"Date"}),model:this._oMetaData.model,mode:this._oParent.getBindingMode("value")};if(t&&t.style){r.displayFormat=t.style}o=new p(this._oParent.getId()+"-datePicker",r);this._enhanceInputControls(o);return{control:o,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:r.value.type,property:this._oMetaData.property}}}}e=Z.getBoundPropertiesMapInfoForControl(u.getMetadata().getName(),{propertyName:"value"})[0];r[e]={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,t),mode:this._oParent.getBindingMode("value")};a=new u(this._oParent.getId()+"-input",r);this._enhanceInputControls(a);return{control:a,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:r.value.type,property:this._oMetaData.property}}}};Z.prototype._createEdmDateTimeOffset=function(){var t,e=this.getFormatSettings("dateFormatSettings"),a=this.getEdmProperty(),o;try{t=R(e)}catch(a){t=e}if(t){t.UTC=false}var i=Z.getBoundPropertiesMapInfoForControl(u.getMetadata().getName(),{propertyName:"value"})[0];var r={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var n=this.createAttributes(null,this._oMetaData.property,r,{event:"change",parameter:"value"});var s=a&&E.getTimezonePropertyPath(a)||false;if(s){if(e&&e.showTimezone===false){n.showTimezone=false}else{n.showTimezone=true}if(t&&t.style){n.displayFormat=t.style}if(t&&t.pattern){n.displayFormat=t.pattern}this.oType=this._oTypes.getType(this._oMetaData.property,t);n[i]={model:this._oMetaData.model,type:this.oType,parts:[{path:this._oMetaData.path,parameters:{useUndefinedForUnresolved:true},type:this.oType},{path:s,parameters:{useUndefinedForUnresolved:true}}],useRawValues:true,mode:this._oParent.getBindingMode("value")}}else{n[i]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,t),mode:this._oParent.getBindingMode("value")}}o=new u(this._oParent.getId()+"-input",n);this._enhanceInputControls(o);return{control:o,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:n.value.type,property:this._oMetaData.property}}}};Z.prototype._createEdmNumeric=function(t){var e=this._oSelector.checkComboBox(t);if(e.combobox){return this._createComboBox({valueHelp:{annotation:e.annotation,noDialog:true,noTypeAhead:true},edit:true})}var a={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var o=Z.getBoundPropertiesMapInfoForControl(g.getMetadata().getName(),{propertyName:"value"})[0];var i=this.createAttributes(o,this._oMetaData.property,a,{event:"change",parameter:"value"});if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){i.textDirection="LTR"}return{control:this._createInput(i),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:i.value.type,property:this._oMetaData.property}}}};Z.prototype._createEdmUOM=function(t){var e=t.mode,a=Z.getBoundPropertiesMapInfoForControl(Y.getMetadata().getName(),{propertyName:"value"})[0],o=this._getPropertyBindingMode(a),i=this.getEdmProperty(),r=this._oMetaData.annotations.uom.property.property,n=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(i,r);var s={currency:n,edmProperty:r,bindingMode:o};var l=this._createEdmUOMAttributes(s),p=sap.ui.getCore().getConfiguration().getRTL(),u=p&&this._oParent.isContextTable(),h=this._oParent.getId(),g;if(u){l.textDirection="LTR"}var c=this._createInput(l);this.oMeasureField=c;if(this._oParent.data("suppressUnit")==="true"){var m={getValue:"getValue"};if(!n){m.type={type:l.value.type,property:this._oMetaData.property}}return{control:c,onCreate:"_onCreate",params:m}}if(!n){g={type:l.value.type,property:this._oMetaData.property}}var y={textAlign:this._getEdmUOMTextAlignment()};if(o==="TwoWay"){y.change=this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:n,unit:true})}var _=this._oHelper.getUOMPath(this._oMetaData);y[a]={model:this._oMetaData.model,path:_,mode:o};this.mapBindings(y,Z._getEmbeddedSmartFieldMapSettings(),t);if(this._oParent.getConfiguration()){y.configuration=new A({preventInitialDataFetchInValueHelpDialog:this._getPreventInitialDataFetchInVHDialog()})}var f=new Y(h+"-sfEdit",y),M=this;f.data("configdata",{configdata:{currency:n,smartFieldRootControl:this._oParent,measureField:this.oMeasureField,isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:_,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,valuelistType:this._oMetaData.annotations.uom.annotations.valuelistType,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(t){M._updateStaticAmountInputFlexItemData(c);M._updateStaticUOMTextFlexItemData(f);M._updateInnerControl(t,{RTLInTable:u})},onInput:function(t){var e=f&&!f.getVisible();M._updateDynamicAmountInputFlexItemData(c,{isfullWidth:e});M._updateStaticUOMInputFlexItemData(f);M._updateInnerControl(t,{RTLInTable:u})}}});f.data("errorCheck","setComplexClientErrorSecondOperandNested");if(f.getVisible()){c.addStyleClass("smartFieldPaddingRight")}c.addStyleClass("sapUiCompSmartFieldValue");var v=new d({justifyContent:G.End,items:[c,f],fitContainer:true,width:this._oParent.getWidth()});v.addStyleClass("sapUiCompUOM");v.enhanceAccessibilityState=function(t,e){this._oParent.enhanceAccessibilityState(t,e)}.bind(this);if(this._oParent.isContextTable()){if(u){v.addStyleClass("sapUiCompDirectionLTR")}v.addStyleClass("sapUiCompUOMInTable");if(e!=="edit"){v.addStyleClass("sapUiCompUOMInTableDisplay")}}return{control:v,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:g}}};Z.prototype._createEdmUOMAttributes=function(t){t=t||{};var e=this.createUOMDefaultAttributes(t);var a=Z.getBoundPropertiesMapInfoForControl(g.getMetadata().getName(),{propertyName:"value"})[0];var i=t.bindingMode||"TwoWay";var r=t.currency||this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property);e[a]={mode:o.OneWay,model:this._oMetaData.model,parts:[{mode:i,path:this._oMetaData.path},{mode:i,path:this._oHelper.getUOMPath(this._oMetaData)},{mode:"OneTime",path:r?"/##@@requestCurrencyCodes":"/##@@requestUnitsOfMeasure",targetType:"any"}],type:r?this._oTypes.getCurrencyType(this._oMetaData.property):this._oTypes.getUoMType(this._oMetaData.property)};return e};Z.prototype.createUOMDefaultAttributes=function(t){var e={textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),valueState:this.getValueStateBindingInfoForRecommendationStateAnnotation()};if(t.bindingMode==="TwoWay"){e.change=this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:t.currency})}return e};Z.prototype._getEdmUOMTextAlignment=function(){var t=this.getAttribute("textAlign");if(!t){t=z.Initial}if(t===z.Initial){if(this._oParent.isContextTable()){return z.End}return z.Begin}return t};Z.prototype._createEdmUOMDisplay=function(t){var e=this,a=this._oHelper.getUOMPath(this._oMetaData),o=this._getEdmUOMTextAlignment(),i=null,r=this.getEdmProperty(),n=sap.ui.getCore().getConfiguration().getRTL(),s=n&&this._oParent.isContextTable(),l=this._oHelper.oAnnotation.isCurrency(r),p=Z.getBoundPropertiesMapInfoForControl(Y.getMetadata().getName(),{propertyName:"value"})[0],u=this._getPropertyBindingMode(p)||"TwoWay";var h=Z.getBoundPropertiesMapInfoForControl(m.getMetadata().getName(),{propertyName:"value"})[0];var g={textAlign:o};g[h]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:a},{mode:"OneTime",path:l?"/##@@requestCurrencyCodes":"/##@@requestUnitsOfMeasure",targetType:"any"}],model:this._oMetaData.model,formatter:this._oTypes.getDisplayFormatter(r,{currency:l,mask:this._oHelper.oAnnotation.isMasked(r),type:this._oTypes.getType(this._oMetaData.property)}),useRawValues:true};if(s){g.textDirection="LTR"}var c=new m(this._oParent.getId()+"-text",g);a=this._oHelper.getUOMPath(this._oMetaData);g={textAlign:this._getEdmUOMTextAlignment()};if(u==="TwoWay"){g.change=this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:l,unit:true})}h=Z.getBoundPropertiesMapInfoForControl(Y.getMetadata().getName(),{propertyName:"value"})[0];g[h]={model:this._oMetaData.model,path:a,mode:this._getPropertyBindingMode(h)};this.mapBindings(g,Z._getEmbeddedSmartFieldMapSettings(),t);c.addStyleClass("smartFieldPaddingRight");c.addStyleClass("sapUiCompSmartFieldValue");if(this._checkSuppressUnit()){return{control:c}}i=new Y(this._oParent.getId()+"-sfDisp",g);i.data("configdata",{configdata:{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:a,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(t){if(t&&t.setWrapping){t.setWrapping(false)}e._updateInnerControl(t,{RTLInTable:s})},onInput:function(t){e._updateInnerControl(t,{RTLInTable:s})},getContextEditable:function(){return e._oParent.getContextEditable()}}});i.data("errorCheck","setComplexClientErrorSecondOperandNested");var y=new d({alignItems:X.Center,items:[c,i],fitContainer:true,width:this._oParent.getWidth()});y.enhanceAccessibilityState=function(t,e){this._oParent.enhanceAccessibilityState(t,e)}.bind(this);if(this._oParent.isContextTable()){y.setJustifyContent("End");this._oParent.addStyleClass("sapUiCompUOMInTable");if(s){y.addStyleClass("sapUiCompDirectionLTR")}y.addStyleClass("sapUiCompUOMInTable")}return{control:y}};Z.prototype._createEdmUOMObjectStatus=function(){var t,e=this.getEdmProperty(),a=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(e),o=this._oTypes.getDisplayFormatter(e,{currency:a}),i=this._oHelper.getUOMPath(this._oMetaData),r={};var n=Z.getBoundPropertiesMapInfoForControl(S.getMetadata().getName(),{propertyName:"value"})[0];r[n]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:i},{mode:"OneTime",path:a?"/##@@requestCurrencyCodes":"/##@@requestUnitsOfMeasure",targetType:"any"}],formatter:function(){var t=o.apply(this,arguments);return t+arguments[1]},useRawValues:true};this._addObjectStatusAttributes(r);t=new S(this._oParent.getId()+"-objStatus",r);t.addStyleClass("sapUiCompUOM");return{control:t}};Z.prototype._createEdmUOMObjectNumber=function(){var t,e,a=this._getEdmUOMTextAlignment();var o=Z.getBoundPropertiesMapInfoForControl(b.getMetadata().getName(),{propertyName:"value"});if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property)){t={model:this._oMetaData.model,textAlign:a};t[o[0]]={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)},{mode:"OneTime",path:"/##@@requestCurrencyCodes",targetType:"any"}],type:this._oTypes.getCurrencyType(this._oMetaData.property)};t[o[1]]={path:this._oHelper.getUOMPath(this._oMetaData)}}else{t={model:this._oMetaData.model,textAlign:a};t[o[0]]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};t[o[1]]={path:this._oHelper.getUOMPath(this._oMetaData)}}e=new b(this._oParent.getId()+"-objNumber",t);e.addStyleClass("sapUiCompUOM");return{control:e}};Z.prototype._createEdmSemantic=function(){var t=this,e=this._oParent.getBindingPath("value"),a=this.getEdmProperty(),o=this._oHelper.oAnnotation.getLabel(a);if(this._oMetaData.annotations.lineitem&&this._oMetaData.annotations.lineitem.labels&&this._oMetaData.annotations.lineitem.labels[e]){o=this._oMetaData.annotations.lineitem.labels[e]}var i={semanticObject:this._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:this._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:o,fieldName:e,width:this.getAttribute("width"),createControlCallback:function(){var t=this.createControl(true);if(t){return t.control}return null}.bind(this)};var r=this._oHelper.oAnnotation.getText(a);this.oType=this._oTypes.getType(this._oMetaData.property);if(r){i.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],model:this._oMetaData.model,formatter:function(e,a){if(t.oType){e=t.oType.formatValue(e,"string")}if(t.oType&&t.oType.isA("sap.ui.comp.odata.type.NumericText")&&e===null&&a){e=""}if(e&&a){return t._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",e,a)}return e?e:""}};i.navigationTargetsObtained=function(e){var a=this.getBinding("text");if(!Array.isArray(a.getValue())){e.getParameters().show();return}var o=a.getValue();var i=t._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")||"idOnly";var r=V.getTextsFromDisplayBehaviour(i,o[0],o[1]);var n=e.getParameters().mainNavigation;if(n){n.setDescription(r.secondText)}e.getParameters().show(r.firstText,n,undefined,undefined)}}else{var n=this._oHelper.getUOMPath(this._oMetaData);if(n){i.text={parts:[{path:e},{path:n}],model:this._oMetaData.model,formatter:this._oHelper.oAnnotation.isCurrency(a,this._oMetaData.annotations.uom.property.property)?V.getAmountCurrencyFormatter():V.getMeasureUnitFormatter(),useRawValues:true};i.uom={path:n}}else{i.text={path:e,model:this._oMetaData.model,type:this.oType}}}return{control:new f(this._oParent.getId()+"-sl",i),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}}};Z.prototype._createMultiLineText=function(t){var e=Z.getBoundPropertiesMapInfoForControl(i.getMetadata().getName(),{propertyName:"value"})[0];var a=this.createAttributes(e,this._oMetaData.property,t.attributesNamesMap);var o=this.getFormatSettings("multiLineSettings");a=H(a,o);if(this._oParent.isContextTable()){a.width="100%"}var r=new i(this._oParent.getId()+"-textArea",a);this._enhanceInputControls(r);this._handleEventingForEdmString({control:r,edmProperty:this._oMetaData.property.property});return{control:r,onCreate:"_onCreate",params:{type:{type:a.value.type,property:this._oMetaData.property},getValue:"getValue"}}};Z.prototype._createLink=function(t){var e=this,a=this._oParent,o=a.getBindingInfo("url");var i={text:"",href:""};var n=Z.getBoundPropertiesMapInfoForControl(r.getMetadata().getName(),{propertyName:"url"})[0];if(o){i[n]=this._oBinding.toBinding(o)}else{i[n]=a.getUrl()}if(a.hasListeners("press")){i.press=function(t){t.preventDefault();a.firePress(t)}}var s=a.getBindingInfo("value");var l=Z.getBoundPropertiesMapInfoForControl(r.getMetadata().getName(),{propertyName:"value"});if(s){var p=this._oMetaData,u=p.path,h=p.property.property;if(p.annotations.text&&h.type==="Edm.String"){i[l[0]]={parts:[p.path,this._oHelper.getEdmDisplayPath(p)],formatter:this._formatText.bind(e)}}else if(Z.isSpecialLink(h)){var d=Z[Z._getLinkFormatterFunctionName(h)];i[l[0]]={path:u};i[l[1]]={path:u,formatter:null};if(typeof d==="function"){i[l[1]].formatter=d}}else if(t){i[l[0]]={path:u,type:this._getDateFormatType()}}else{i[l[0]]=this._oBinding.toBinding(s)}}else{i[l[0]]=a.getValue()}return{control:new r(a.getId()+"-link",i),onCreate:"_onCreate",params:{noValidation:true}}};Z.prototype._createEdmBoolean=function(t){var e=this._oSelector.checkComboBox(t),a=t.mode==="edit",o=this,i=null,r;if(e.combobox){if(a||this._oParent.getFetchValueListReadOnly()){return this._createComboBox({valueHelp:{annotation:e.annotation,noDialog:true,noTypeAhead:true},edit:a})}}var s,l;if(a){l=Z.getBoundPropertiesMapInfoForControl(n.getMetadata().getName(),{propertyName:"value"})[0];s=this.createAttributes(l,this._oMetaData.property,{},{event:"select",parameter:"selected"});r=new n(this._oParent.getId()+"-cBoxBool",s);i={getValue:"getSelected"}}else{l=Z.getBoundPropertiesMapInfoForControl(m.getMetadata().getName(),{propertyName:"value"})[0];s=this.createAttributes(l,this._oMetaData.property,{width:true,textAlign:true});s[l]={model:this._oMetaData.model,path:this._oMetaData.path,formatter:function(t){return o._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",t)}};r=new m(this._oParent.getId()+"-text",s)}return{control:r,onCreate:"_onCreate",params:i}};Z.prototype._createValueHelp=function(){var t=this._oParent.getContent();if(!t){return}var e={annotation:this._oMetaData.annotations.valuelist,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"};this._getValueHelpDialogTitle(e);e.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:t,edmProperty:this.getEdmProperty(),valueHelp:e,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(t){this._oParent.fireValueListChanged({changes:t.mParameters.changes})}.bind(this)})};Z.prototype.getValueListProviderConfiguration=function(t){var e=M.prototype.getValueListProviderConfiguration.apply(this,arguments);if(this._oHelper.oAnnotation.isUpperCase(this._oMetaData.property.property)){e.displayFormat="UpperCase"}return e};Z.prototype._checkSuppressUnit=function(){if(this._oParent.data("suppressUnit")==="true"){return true}var t=this._oParent.getBindingInfo("uomVisible");return!t&&!this._oParent.getUomVisible()};Z.prototype.getEdmProperty=function(){var t=this._oHelper;if(t){return t.getEdmProperty(this._oMetaData)}return null};Z.prototype.getEntityType=function(){if(this._oMetaData){return this._oMetaData.entityType}return null};Z.prototype._checkLink=function(){var t=this._oParent.getBindingInfo("url"),e=this.getEdmProperty();if(t||this._oParent.getUrl()||Z.isSpecialLink(e)){return true}return this._oParent.hasListeners("press")};Z._getEmbeddedSmartFieldMapSettings=function(){return{uomEditable:"editable",uomEnabled:"enabled",uomVisible:"visible",mandatory:"mandatory",contextEditable:"contextEditable"}};Z.getBoundPropertiesMapInfoForControl=function(t,e){e=e||{};var a=null;switch(t){case"sap.m.Input":case"sap.m.TimePicker":case"sap.m.DatePicker":case"sap.m.DateTimePicker":case"sap.m.TextArea":a={value:["value"]};break;case"sap.m.Text":case"sap.m.ObjectIdentifier":case"sap.ui.comp.navpopover.SmartLink":a={value:["text"]};break;case"sap.m.Link":a={url:["href"],value:["text","href"]};break;case"sap.m.ObjectStatus":a={value:["text","state","icon"]};break;case"sap.m.ObjectNumber":a={value:["number","unit"]};break;case"sap.m.Select":case"sap.m.ComboBox":case"sap.ui.comp.smartfield.DisplayComboBox":a={value:["selectedKey"]};break;case"sap.ui.comp.smartfield.ComboBox":a={value:["enteredValue"]};break;case"sap.m.CheckBox":a={value:["selected"]};break;case"sap.ui.comp.smartfield.SmartField":var o=Object.keys(Y.getMetadata().getProperties());a={};o.forEach(function(t,e,o){a[t]=[o[e]]});break}if(a&&e.propertyName){return a[e.propertyName]||null}return a};Z.isSpecialLink=function(t){return E.isEmailAddress(t)||E.isPhoneNumber(t)||E.isURL(t)};Z._getLinkFormatterFunctionName=function(t){return"_format"+E.getLinkDisplayFormat(t)};Z._formatEmailAddress=function(t){return"mailto:"+t};Z._formatPhoneNumber=function(t){return"tel:"+t};Z._formatURL=function(t){return N.validate(t)?t:""};Z.prototype._formatText=function(t,e){if(t&&e){return this._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",t,e)}return t||""};Z.prototype._getCreator=function(t){return this._oSelector.getCreator(t)};Z.prototype._onCreate=function(t,e){var a,o,i=true,r=this;if(e){if(e.noValidation){i=false}if(e.valuehelp){this._getValueHelpDialogTitle(e.valuehelp);e.valuehelp.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:t,edmProperty:this.getEdmProperty(),valueHelp:e.valuehelp,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(t){r._oParent.fireValueListChanged({changes:t.mParameters.changes})}})}if(e.getValue){a=e.getValue;e.getValue=function(){return t[a]()}}if(e.type){o=this._oFieldControl.getMandatoryCheck(e.type.property);if(o){e.type.type.oFieldControl=o}}}if(i){this.addValidations(t,this._oParent.data("errorCheck")||"setSimpleClientError")}if(!this._checkUOM()){t.addStyleClass("sapUiCompSmartFieldValue")}};Z.prototype._checkUOM=function(){var t=this._oParent.data("configdata");if(t&&t.configdata){if(t.configdata.onInput||t.configdata.onText){return true}}return false};Z.prototype.getValueStateBindingInfoForRecommendationStateAnnotation=function(t,e,a){t=t||this.getEdmProperty();var o=t&&t["com.sap.vocabularies.UI.v1.RecommendationState"];if(!o){return null}U(!(o.Path===undefined),'Missing "Path" attribute of the "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+t.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());U(!(o.Path===""),'Missing path name of "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+t.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());e=e||this._oHelper.findProperty(this._oMetaData.entityType.property,o.Path);U(!!e,'The EDM property was not found in the "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(e&&e.type==="Edm.Byte"){return{model:a||this._oMetaData.model,path:o.Path,formatter:Z.formatRecommendationState}}U(e&&e.type==="Edm.Byte",'The EDM property "'+e.name+'" of "'+this._oMetaData.entityType.name+'" entity type must be typed as Edm.Byte. - '+this.getMetadata().getName());return null};Z.formatRecommendationState=function(t){t=String(t);switch(t){case"0":return W.None;case"1":return W.Information;case"2":return W.Warning;default:return W.None}};Z.prototype._updateDynamicAmountInputFlexItemData=function(t,e){var a=t.getLayoutData(),o="sapUiCompSmartFieldFlexItemAmountEdit",i="";if(a){if(e.isfullWidth){o="sapUiCompSmartFieldFlexItemAmountNoUnitEdit";i="100%"}a.setGrowFactor(1);a.setMaxWidth(i);a.setStyleClass(o)}};Z.prototype._updateStaticAmountInputFlexItemData=function(t){var e=t.getLayoutData();if(e){e.setGrowFactor(1);e.setMaxWidth("");e.setStyleClass("")}};Z.prototype._updateStaticUOMInputFlexItemData=function(t){var e=t.getLayoutData();if(e){e.setShrinkFactor(1);e.setGrowFactor(0);e.setStyleClass("sapUiCompSmartFieldFlexItemUnitEdit");e.setMinWidth("")}};Z.prototype._updateStaticUOMTextFlexItemData=function(t){var e=t.getLayoutData();if(e){e.setShrinkFactor(0);e.setGrowFactor(0);e.setStyleClass("sapUiCompSmartFieldFlexItemUnitDisplay sapUiCompSmartFieldUOMDisplayText");e.setMinWidth("auto")}};Z.prototype._updateInnerControl=function(t,e){var a=e.RTLInTable;if(t){if(a&&typeof t.setTextDirection==="function"){t.setTextDirection("LTR")}t.addStyleClass("sapUiCompSmartFieldUnit")}};Z.prototype._getValueHelpDialogTitle=function(t){t.dialogtitle=this._oParent.getComputedTextLabel();if(!t.dialogtitle){var e=this.getEdmProperty();t.dialogtitle=this._oHelper.oAnnotation.getLabel(e)||e.name}};Z.prototype._onCreateUOM=function(t,e){var a=t.getItems(),o;this.addValidations(a[0],"setComplexClientErrorFirstOperand");if(e&&e.getValue){e.getValue=function(){return a[0].getValue()}}e.uom=function(){return a[1].getValue()};e.uomset=function(t){a[1].setValue(t)};if(e.type){o=this._oFieldControl.getMandatoryCheck(e.type.property);if(o){e.type.type.oFieldControl=o}}};Z.prototype.triggerCreationOfControls=function(){try{this._setUOMEditState();this._oFieldControl.bindProperties({metadata:this._oMetaData});this._addLabelAndQuickInfo()}catch(t){w.error(t,null,this.getMetadata().getName())}};Z.prototype._checkTextInDisplayModeValueList=function(t){var e=this._oHelper.getValueListAnnotationPath(this._oMetaData),a=this.getEdmProperty();return!!(this._oMetaData.annotations&&this._oMetaData.annotations.valuelist!==undefined&&this._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")&&(this._oMetaData.property&&(this._oMetaData.property.property.type==="Edm.String"||this._oMetaData.property.property.type==="Edm.Guid"))&&(this._oHelper.oAnnotation.getTextArrangement(a)||this._oParent.data("defaultInputFieldDisplayBehaviour"))&&t.mode==="display"&&this._oParent.getFetchValueListReadOnly()&&e&&!this._oParent.getExpandNavigationProperties()&&!this._oHelper.startWithNavigationProperty(e,this._oMetaData)&&!this.isValueInitialWithTextArrangement(a))};Z.prototype.isValueInitialWithTextArrangement=function(t){return this._oParent._isValueInitial()&&this._oHelper.oAnnotation.getText(t)};Z.prototype._hasBoundFieldControl=function(){var t=this._oFieldControl.getPropertyNames();for(var e=0;e<t.length;e++){if(this._oParent.getBinding(t[e])){return true}}return false};Z.prototype.bind=function(t){var e=t.mode,t=t||{},a=this._oMetaData;this._bTextInDisplayModeValueList=this._checkTextInDisplayModeValueList(t);if(!(!this._bInitialized&&!this.bPending)&&(!t.rebind&&!this._bTextInDisplayModeValueList)){return Promise.resolve()}this._bInitialized=true;var o=this._oParent.data("configdata");if(o&&o.configdata){try{this._init(this._oMeta);if(a&&a.annotations&&o.configdata.property){a.annotations.valueListData=o.configdata.property.valueListAnnotation;return Promise.resolve({fetchIDAndDescription:true})}}catch(t){if(t){w.error(t,null,this.getMetadata().getName()+".onMetaModelLoaded")}}return Promise.resolve()}if(!this._oModel){return Promise.reject()}var i=!!(this._oParent&&this._oParent.isTextInEditModeSourceNotNone());if(!i&&this._oModel.bMetaModelLoaded&&(e!=="display"||!this._oParent.getFetchValueListReadOnly())){try{this._init(this._oMeta)}catch(t){if(t){w.error(t,null,this.getMetadata().getName()+".onMetaModelLoaded")}}return Promise.resolve()}this.bPending=true;var r=this._oModel.getMetaModel().loaded().catch(function(t){w.error("The meta model could not be loaded.",t,this.getMetadata().getName())}.bind(this));var n=r.then(function t(){if(!this._oParent){this.bPending=false;return Promise.reject()}this._init(this._oMeta);if(e!=="display"&&i||this._bTextInDisplayModeValueList){var a=this._oMetaData.annotations.valuelist;if(typeof a==="string"){var o=this._oParent&&this._oParent.getBindingContext()&&this._oParent.getBindingContext().getPath();return this._oHelper.loadValueListAnnotation(a,o)}else{this.bPending=false;return Promise.reject()}}this.bPending=false}.bind(this)).then(function t(e){var a={fetchIDAndDescription:false};if(!i&&!this._bTextInDisplayModeValueList||!this._oParent){return}this.bPending=false;if(e){this._initValueList(e)}if(e&&this.oTextArrangementDelegate){a.fetchIDAndDescription=true}return a}.bind(this)).catch(function(t){if(t){w.error(t,null,this.getMetadata().getName()+".onMetaModelLoaded")}}.bind(this));return n};Z.prototype._addLabelAndQuickInfo=function(){var t=this.getDataProperty();t=t.property;var e=this._oHelper.oAnnotation.getLabel(t);var a=this._oHelper.oAnnotation.getQuickInfo(t);if(e){this._oParent._sAnnotationLabel=e}if(a&&this._oParent.isPropertyInitial("tooltipLabel")){this._oParent.setTooltipLabel(a)}};Z.prototype.rebindOnCreated=function(){var t,e=this._oFieldControl.getControlFormatters(this._oMetaData,["editable"]);for(var a in e){t=this._oBinding.fromFormatter(this._oMetaData.model,e[a]);this._oParent.bindProperty(a,t)}};Z.prototype._setUOMEditState=function(){if(this._oFieldControl.hasUomEditState(this._oMetaData)){var t=this._oFieldControl.getUOMEditState(this._oMetaData);if(t){var e=this._oBinding.fromFormatter(this._oMetaData.model,t);this._oParent.bindProperty("uomEditState",e)}}};Z.prototype.getDataProperty=function(){return this._oMetaData.property};Z.prototype.getDropdownItemKeyType=function(t){var e=t.getMetadata().getName();if(e==="sap.ui.comp.smartfield.DisplayComboBox"||e==="sap.m.ComboBox"||e==="sap.ui.comp.smartfield.ComboBox"||e==="sap.m.Select"){var a=Z.getBoundPropertiesMapInfoForControl(e,{propertyName:"value"})[0];var o=t.getBindingInfo(a);return o&&o.type||null}return null};Z.prototype.getMetaData=function(){return this._oMetaData};Z.prototype.getODataHelper=function(){return this._oHelper};Z.prototype._getChangeEventParams=function(t){var e,a={},o=t&&t.getParameters();if(o){e=o.value;a.value=e;a.newValue=e;if(o.validated){a.validated=o.validated}}else{a=t}return a};Z.prototype._getPropertyBindingMode=function(t){var e=typeof this._oParent.getBinding==="function"&&this._oParent.getBinding(t);return e&&typeof e.getBindingMode==="function"&&e.getBindingMode()||"TwoWay"};Z.prototype.fetchIDAndDescriptionCollectionIfRequired=function(t){this.oTextArrangementDelegate&&this.oTextArrangementDelegate.fetchIDAndDescriptionCollectionIfRequired(t)};Z.prototype.destroy=function(){if(this._oFieldControl){this._oFieldControl.destroy()}if(this._oSelector){this._oSelector.destroy()}if(this._oTypes){this._oTypes.destroy()}if(this._oHelper){this._oHelper.destroy()}if(this.oType){this.oType.destroy();this.oType=null}if(this.oTextArrangementDelegate){this.oTextArrangementDelegate.destroy()}this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;this.oMeasureField=null;this.oTextArrangementDelegate=null;M.prototype.destroy.apply(this,arguments)};return Z},true);