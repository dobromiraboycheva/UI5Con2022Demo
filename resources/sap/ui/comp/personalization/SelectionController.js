/*
 * ! SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["./BaseController","sap/m/library","sap/ui/comp/library","./Util"],function(e,t,n,i){"use strict";var s=e.extend("sap.ui.comp.personalization.SelectionController",{constructor:function(n,i){e.apply(this,arguments);this.setType(t.P13nPanelType.selection);this.setItemType(t.P13nPanelType.selection+"Items")},metadata:{events:{afterSelectionModelDataChange:{}}}});s.prototype.getColumn2Json=function(e,t,n){return{columnKey:t,text:e.getLabel(),visible:e.getSelected()}};s.prototype.getColumn2JsonTransient=function(e,t,n,i){return{columnKey:t,text:n,href:e.getHref(),target:e.getTarget(),press:e.getPress(),description:e.getDescription()}};s.prototype.syncJson2Table=function(e){this.fireBeforePotentialTableChange();this.fireAfterPotentialTableChange()};s.prototype.getPanel=function(e){return new Promise(function(e){sap.ui.require(["sap/m/P13nSelectionPanel","sap/m/P13nItem","sap/m/P13nSelectionItem"],function(t,n,i){return e(new t({titleLarge:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_SELECTION_TITLE"),items:{path:"$sapmP13nPanel>/transientData/selection/selectionItems",template:new n({columnKey:"{$sapmP13nPanel>columnKey}",href:"{$sapmP13nPanel>href}",target:"{$sapmP13nPanel>target}",text:"{$sapmP13nPanel>text}",press:"{$sapmP13nPanel>press}"})},selectionItems:{path:"$sapmP13nPanel>/controlDataReduce/selection/selectionItems",template:new i({columnKey:"{$sapmP13nPanel>columnKey}",selected:"{$sapmP13nPanel>visible}"})},beforeNavigationTo:this.setModelFunction(),changeSelectionItems:function(e){if(!e.getParameter("items")){return}var t=this.getControlDataReduce();t.selection.selectionItems=e.getParameter("items").map(function(e){return{columnKey:e.columnKey,visible:e.selected}});this.setControlDataReduce2Model(t);this.fireAfterPotentialModelChange({json:t})}.bind(this)}))}.bind(this))}.bind(this))};s.prototype.getChangeType=function(e,t){return this.getChangeData(e,t)?n.personalization.ChangeType.ModelChanged:n.personalization.ChangeType.Unchanged};s.prototype.getChangeData=function(e,t){if(!t||!t.selection||!t.selection.selectionItems){return null}var n={selection:i.copy(e.selection)};if(this._isSemanticEqual(e,t)){return null}var s=[];n.selection.selectionItems.forEach(function(e){var n=i.getArrayElementByKey("columnKey",e.columnKey,t.selection.selectionItems);if(i.semanticEqual(e,n)){s.push(e);return}for(var o in e){if(o==="columnKey"||!n){continue}if(e[o]===n[o]){delete e[o]}}if(Object.keys(e).length<2){s.push(e)}});s.forEach(function(e){var t=i.getIndexByKey("columnKey",e.columnKey,n.selection.selectionItems);n.selection.selectionItems.splice(t,1)});return n};s.prototype.getUnionData=function(e,t){var n=i.copy(e);if(!t||!t.selection||!t.selection.selectionItems){return n.selection?{selection:i.copy(n.selection)}:null}if(!n||!n.selection||!n.selection.selectionItems){return{selection:i.copy(t.selection)}}var s=this.createControlDataStructure();n.selection.selectionItems.forEach(function(e){var n=i.getArrayElementByKey("columnKey",e.columnKey,t.selection.selectionItems);if(n){if(n.visible!==undefined){e.visible=n.visible}}s.selection.selectionItems.push(e)});return s};s.prototype._isSemanticEqual=function(e,t){var n=function(e,t){if(e.visible===true&&(t.visible===false||t.visible===undefined)){return-1}else if((e.visible===false||e.visible===undefined)&&t.visible===true){return 1}else if(e.visible===true&&t.visible===true){return 0}else if((e.visible===false||e.visible===undefined)&&(t.visible===false||t.visible===undefined)){if(e.columnKey<t.columnKey){return-1}else if(e.columnKey>t.columnKey){return 1}else{return 0}}};var s=i.copy(e.selection.selectionItems).sort(n);var o=i.copy(t.selection.selectionItems).sort(n);return!s.some(function(e,t){if(!i.semanticEqual(e,o[t])){return true}})};return s});