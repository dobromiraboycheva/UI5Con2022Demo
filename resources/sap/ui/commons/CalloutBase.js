/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/TooltipBase","./CalloutBaseRenderer","sap/ui/core/Popup","sap/ui/events/ControlEvents","sap/ui/events/KeyCodes","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Focusable"],function(t,e,o,i,s,n,p){"use strict";var r=s.Dock;var u=o.extend("sap.ui.commons.CalloutBase",{metadata:{library:"sap.ui.commons",deprecated:true,events:{open:{parameters:{parent:{type:"sap.ui.core.Control"}}},close:{},beforeOpen:{allowPreventDefault:true,parameters:{parent:{type:"sap.ui.core.Control"}}},opened:{}}}});u.prototype.init=function(){this.oPopup=new s;this.oPopup.setShadow(true);this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons");this.setPosition(r.BeginBottom,r.BeginTop);this.fAnyEventHandlerProxy=t.proxy(this.onAnyEvent,this);var e=this;this.oPopup._applyPosition=function(t){s.prototype._applyPosition.call(this,t);e.setTip()};this.oPopup.setFollowOf(s.CLOSE_ON_SCROLL)};u.prototype.exit=function(){this.oPopup.close();this.oPopup.detachEvent("opened",this.handleOpened,this);this.oPopup.detachEvent("closed",this.handleClosed,this);this.oPopup.destroy();delete this.oPopup;delete this.oRb;n.unbindAnyEvent(this.fAnyEventHandlerProxy)};u.prototype._getPopup=function(){return this.oPopup};u.prototype.hasChild=function(e){return e&&!!t(e).closest(this.getDomRef()).length};u.prototype.isPopupElement=function(e){if(!e){return false}if(this.hasChild(e)){return true}var o=sap.ui.getCore().getStaticAreaRef();var i=parseInt(t(e).closest(t(o).children()).css("z-index"));var s=parseInt(this.$().css("z-index"));return i&&s&&i>=s};u.prototype.setTip=function(){if(!this.oPopup||!this.oPopup.isOpen()){return}var t=this._currentControl.$(),e=this.$(),o=this.$("arrow"),i=e.offset(),s=t.offset(),n=true,p={},r={l:i.left,r:i.left+e.outerWidth(),w:e.outerWidth(),t:i.top,b:i.top+e.outerHeight(),h:e.outerHeight()},u={l:s.left,r:s.left+t.outerWidth(),w:t.outerWidth(),t:s.top,b:s.top+t.outerHeight(),h:t.outerHeight()},h=(e.outerWidth()-e.innerWidth())/2,f=o.outerWidth()*1.4,l=o.outerWidth()/5,a=l-h-8,c=this.getMyPosition();if(r.r<u.l-a){p.x="right"}else if(r.l-a>u.r){p.x="left"}if(r.t>u.b-a){p.y="top"}else if(r.b<u.t+a){p.y="bottom"}if(p.x){var d=0;if(c.indexOf("top")>-1){d=20}else if(c.indexOf("bottom")>-1){d=r.h-20-f}else{d=(r.h-f)/2}var y=r.t+d+f/2+h;if(y<u.t||y>u.b||u.t>r.t&&u.b<r.b){d=(Math.max(r.t,u.t)+Math.min(r.b,u.b))/2-r.t-f/2}o.css(p.x,a+"px");o.css("top",d);if(d<0||d>r.h-f){n=false}}if(p.y){var P=sap.ui.getCore().getConfiguration().getRTL();if(P){c.replace("begin","right").replace("end","left")}var m=0;if(c.indexOf("begin")>-1||c.indexOf("left")>-1){m=20}else if(c.indexOf("right")>-1||c.indexOf("end")>-1){m=r.w-20-f}else{m=(r.w-f)/2}var O=r.l+m+f/2+h;if(O<u.l||O>u.r){m=(Math.max(r.l,u.l)+Math.min(r.r,u.r))/2-r.l-f/2}o.css(p.y,a+"px");o.css("left",m+"px");if(m<0||m>r.w-f){n=false}}if(p.x&&p.y||!p.x&&!p.y){n=false}o.toggle(n)};u.prototype.adjustPosition=function(){function e(){if(this.oPopup){var t=this._currentControl.getDomRef();this.oPopup.setPosition(this.getMyPosition(),this.getAtPosition(),t,this.getOffset(),this.getCollision())}}setTimeout(t.proxy(e,this),0)};u.prototype.focus=function(){if(this.oPopup&&this.oPopup.isOpen()){var t=this.$("cont");h(t.firstFocusableDomRef()||t.get(0))}};u.prototype.openPopup=function(t){if(!this.oPopup||this.oPopup.isOpen()){return}if(o.sOpenTimeout){clearTimeout(o.sOpenTimeout);o.sOpenTimeout=undefined}if(!this.fireEvent("beforeOpen",{parent:this._currentControl},true,false)){if(!this.sCloseNowTimeout){o.sOpenTimeout=setTimeout(function(){this.openPopup(this._currentControl)}.bind(this),200)}return}this.oParentFocusInfo=t.getFocusInfo();this.oPopup.attachEvent("opened",this.handleOpened,this);o.prototype.openPopup.call(this,t);this.adjustPosition();this.fireOpen({parent:this._currentControl})};u.prototype.close=function(){if(this.oPopup&&this.oPopup.isOpen()&&!this.sCloseNowTimeout){if(o.sOpenTimeout){clearTimeout(o.sOpenTimeout);o.sOpenTimeout=undefined}this.closePopup()}};u.prototype.closePopup=function(){var t=this.oPopup!==undefined&&this.oPopup.isOpen();if(this.fAnyEventHandlerProxy){n.unbindAnyEvent(this.onAnyEvent)}o.prototype.closePopup.call(this);if(t&&this._currentControl&&this.bFocused){this._currentControl.applyFocusInfo(this.oParentFocusInfo);this.bFocused=false}this.fireClose()};u.prototype.handleClosed=function(){if(this.oPopup){this.oPopup.detachEvent("closed",this.handleClosed,this);this.fireClosed()}};u.prototype.onkeydown=function(e){var i=e.ctrlKey&&e.which==p.I;var s=e.which==p.ESCAPE;if(!i&&!s){if(t(e.target).control(0)===this._currentControl){this.close()}return}if(i){if(this.oPopup&&this.oPopup.isOpen()){return}this.bDoFocus=true}o.prototype.onkeydown.call(this,e)};u.prototype.handleOpened=function(){this.oPopup.detachEvent("opened",this.handleOpened,this);if(this.bDoFocus){this.focus();this.bDoFocus=false;this.bFocused=true}this.$().css("display","");this.fireOpened();n.bindAnyEvent(this.fAnyEventHandlerProxy)};u.prototype.onfocusin=function(t){this.bFocused=true;var e=t.target;if(e.id===this.getId()+"-fhfe"){h(this.$("cont").lastFocusableDomRef())}else if(e.id===this.getId()+"-fhee"){h(this.$("cont").firstFocusableDomRef())}};u.prototype.onfocusout=function(t){return};u.prototype.onmouseover=function(t){if(this.oPopup&&(this.oPopup.isOpen()&&this.oPopup.getContent()==this)){if(this.sCloseNowTimeout){clearTimeout(this.sCloseNowTimeout);this.sCloseNowTimeout=null}return}else{o.prototype.onmouseover.call(this,t)}};u.prototype.onmouseout=function(t){if(this.oPopup&&(this.oPopup.isOpen()&&this.isPopupElement(t.relatedTarget))){return}o.prototype.onmouseout.call(this,t)};u.prototype.onmousedown=function(e){if(t(e.target).control(0)===this._currentControl){this.close();this.removeStandardTooltips()}};u.prototype.onAnyEvent=function(e){if(this.oPopup&&!this.oPopup.isOpen()||e.type!="mouseover"||this.hasChild(e.target)){return}var i=this.isPopupElement(e.target)||t(e.target).control(0)===this._currentControl;if(!i&&!this.sCloseNowTimeout&&!o.sOpenTimeout){this.sCloseNowTimeout=setTimeout(function(){this.closePopup()}.bind(this),400)}if(i&&this.sCloseNowTimeout){clearTimeout(this.sCloseNowTimeout);this.sCloseNowTimeout=null}};u.prototype.setPosition=function(t,e){var o=t||r.BeginBottom;var i=e||r.BeginTop;var s=0,n=0,p=0,u=0,h=5;if(o.indexOf("begin")>-1||o.indexOf("left")>-1){s=-1}else if(o.indexOf("right")>-1||o.indexOf("end")>-1){s=1}if(i.indexOf("begin")>-1||i.indexOf("left")>-1){p=-1}else if(i.indexOf("right")>-1||i.indexOf("end")>-1){p=1}if(o.indexOf("top")>-1){n=-1}else if(o.indexOf("bottom")>-1){n=1}if(i.indexOf("top")>-1){u=-1}else if(i.indexOf("bottom")>-1){u=1}var f=(s-p)*s*p*h+" "+(n-u)*n*u*h;this.setMyPosition(o);this.setAtPosition(i);this.setOffset(f);return this};function h(t){if(t){t.focus()}}return u});