/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./TextField","./library","sap/ui/Device","sap/ui/core/Popup","./ComboBoxRenderer","sap/ui/core/library","./ListBox","sap/ui/base/Event","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/ui/events/jquery/EventExtension","sap/ui/dom/jquery/rect","sap/ui/dom/jquery/selectText","jquery.sap.strings"],function(e,t,i,s,o,n,a,d,r,h,l,p){"use strict";var g=a.AccessibleRole;var u=t.extend("sap.ui.commons.ComboBox",{metadata:{interfaces:["sap.ui.commons.ToolbarItem"],library:"sap.ui.commons",deprecated:true,properties:{maxPopupItems:{type:"int",group:"Behavior",defaultValue:10},displaySecondaryValues:{type:"boolean",group:"Misc",defaultValue:false},selectedKey:{type:"string",group:"Data",defaultValue:null},selectedItemId:{type:"string",group:"Data",defaultValue:null}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.ListItem",multiple:true,singularName:"item",bindable:"bindable"},myListBox:{type:"sap.ui.commons.ListBox",multiple:false,visibility:"hidden"}},associations:{listBox:{type:"sap.ui.commons.ListBox",multiple:false}}}});u.prototype.init=function(){t.prototype.init.apply(this,arguments);this._iClosedUpDownIdx=-1;this._sCloseId=null;this.setAccessibleRole(g.Combobox);if(!s.system.desktop){this.mobile=true}};u.prototype.exit=function(){if(this._oListBox){if(this._oListBoxDelegate){this._oListBox.removeDelegate(this._oListBoxDelegate)}if(this.getAggregation("myListBox")){this.destroyAggregation("myListBox",true)}else{this._oListBox.destroy()}this._oListBox=null}else if(this.getListBox()){var e=sap.ui.getCore().byId(this.getListBox());if(e){e.detachEvent("itemsChanged",this._handleItemsChanged,this);e.detachEvent("itemInvalidated",this._handleItemInvalidated,this)}}this._sWantedSelectedKey=undefined;this._sWantedSelectedItemId=undefined;if(this._sHandleItemsChanged){clearTimeout(this._sHandleItemsChanged);this._sHandleItemsChanged=null;this._bNoItemCheck=undefined}};u.prototype.onclick=function(e){if(this.getEnabled&&this.getEnabled()&&this.getEditable()&&e.target===this.getF4ButtonDomRef()){if(this.oPopup&&this.oPopup.isOpen()){this._close()}else if(!this._F4ForClose){this._open()}this.focus()}this._F4ForClose=false};u.prototype.onmousedown=function(t){var i=this.getF4ButtonDomRef();if(t.target!==i||!this.getEnabled()||!this.getEditable()){if(this.oPopup&&this.oPopup.isOpen()){t.stopPropagation()}return}else if(t.target==i&&e(this.getFocusDomRef()).data("sap.INItem")){t.stopPropagation();this.focus()}if(this.oPopup&&this.oPopup.isOpen()){this._F4ForClose=true}else{this._F4ForOpen=true}};u.prototype.onsapshow=function(e){if(this.mobile){return}if(this.oPopup&&this.oPopup.isOpen()){this._close()}else{this._open()}e.preventDefault();e.stopImmediatePropagation()};u.prototype.onsapnextmodifiers=function(e){t.prototype.onsapnextmodifiers.apply(this,arguments);if(e.keyCode==l.ARROW_DOWN&&e.altKey){this.onsapshow(e);e.stopPropagation()}};u.prototype.onsaphide=function(e){if(this.mobile){return}this._close();e.stopPropagation()};u.prototype.onsapescape=function(e){if(this.oPopup&&this.oPopup.isOpen()){this._close();e.stopPropagation()}t.prototype.onsapescape.apply(this,arguments);var i=this.getSelectedItemId();if(i){var s=sap.ui.getCore().byId(i);this._iClosedUpDownIdx=this.indexOfItem(s);var o=this._getListBox();o.setSelectedIndex(this._iClosedUpDownIdx);this._updatePosInSet(null,this._iClosedUpDownIdx+1,s.getAdditionalText?s.getAdditionalText():"")}else{this._updatePosInSet(null,-1,null);this._iClosedUpDownIdx=-1}};u.prototype.onsapenter=function(e){this._close();this._checkChange(e)};u.prototype.onsapfocusleave=function(e){var i=this._getListBox();if(e.relatedControlId&&h(i.getFocusDomRef(),sap.ui.getCore().byId(e.relatedControlId).getFocusDomRef())||this._bOpening){this.focus()}else{t.prototype.onsapfocusleave.apply(this,arguments)}};u.prototype._checkChange=function(t,i){var s=this.getInputDomRef();if(!s){return}var o=e(s).val(),n=this.getValue();if(!this._F4ForOpen&&(this.getEditable()&&this.getEnabled())){var a=this.getItems(),d=null,r,h,l,p;if(n!=o){this.setValue(o,true);for(var g=0,u=a.length;g<u;g++){r=a[g].getText();if(r===o){if(g==this._iClosedUpDownIdx){d=a[g];h=d.getKey();l=d.getId();p=g;break}else if(!p){d=a[g];h=d.getKey();l=d.getId();p=g}}}this.setProperty("selectedKey",h,true);this.setProperty("selectedItemId",l,true);if(l){this._iClosedUpDownIdx=p}else{this._iClosedUpDownIdx=-1}if(this.mobile){if(!l){this._addDummyOption(o)}else{this._removeDummyOption();this.getDomRef("select").selectedIndex=p}}}else{var f=this.getSelectedItemId();var c;p=this._iClosedUpDownIdx;if(p>=0){d=a[p];if(d.getText()==o){c=d.getId()}}if(c&&c!=f){this.setSelectedItemId(c,true)}else{return}}this.fireChange({newValue:o,selectedItem:d})}};u.prototype.onkeypress=function(e){if(e.target.id==this.getId()+"-select"){return}if(!this.getEnabled()||!this.getEditable()){return}if(this._sTypeAhead){clearTimeout(this._sTypeAhead)}if(u._isHotKey(e)||e.keyCode===l.F4&&e.which===0){return}var i=e.which||e.keyCode;if(i!==l.DELETE&&i!==l.BACKSPACE&&i!==l.ESCAPE){this._sTypeAhead=setTimeout(function(){this._doTypeAhead()}.bind(this),200)}else{t.prototype.onkeypress.apply(this,arguments);if(i!==l.ESCAPE){this._updatePosInSet(null,-1,null)}}};u.prototype.onsapup=function(t){if(t.target.id==this.getId()+"-select"){return}if(!this.getEnabled()||!this.getEditable()){return}if(e(this.getFocusDomRef()).data("sap.InNavArea")){return}var i=this._getListBox(),s=i.getItems(),o=this.getInputDomRef(),n=e(o).val();var a=this._prepareUpDown(s,n);a=this._updateIdx(s,o,a-1,a,t);t.preventDefault();t.stopPropagation()};u.prototype.onsapdown=function(t){if(t.target.id==this.getId()+"-select"){return}if(!this.getEnabled()||!this.getEditable()){return}if(e(this.getFocusDomRef()).data("sap.InNavArea")){return}var i=this._getListBox(),s=i.getItems(),o=this.getInputDomRef(),n=e(o).val();var a=this._prepareUpDown(s,n);a=this._updateIdx(s,o,a+1,a,t);t.preventDefault();t.stopPropagation()};u.prototype.onsaphome=function(e){t.prototype.onsaphome.apply(this,arguments);if(e.target.id==this.getId()+"-select"){return}if(!this.getEditable()||!this.getEnabled()||!this.oPopup||!this.oPopup.isOpen()){return}var i=this._getListBox(),s=i.getItems(),o=this.getInputDomRef();this._updateIdx(s,o,0,undefined,e);e.preventDefault();e.stopPropagation()};u.prototype.onsapend=function(e){t.prototype.onsapend.apply(this,arguments);if(e.target.id==this.getId()+"-select"){return}if(!this.getEditable()||!this.getEnabled()||!this.oPopup||!this.oPopup.isOpen()){return}var i=this._getListBox(),s=i.getItems(),o=this.getInputDomRef();var n=s.length-1;n=this._updateIdx(s,o,n,undefined,e);e.preventDefault();e.stopPropagation()};u.prototype._doTypeAhead=function(){this._sTypeAhead=null;this._sWantedSelectedKey=undefined;this._sWantedSelectedItemId=undefined;var t=this._getListBox(),i=t.getItems(),s,o,n=e(this.getInputDomRef()),a=n.val(),d=e.sap.startsWithIgnoreCase;this._sTypedChars=a;var r=false;var h=0;for(var l=i.length;h<l;h++){s=i[h];o=""+s.getText();if(d(o,a)&&s.getEnabled()){this._updatePosInSet(n,h+1,s.getAdditionalText?s.getAdditionalText():"");n.val(o);this._doSelect(a.length,o.length);t.setSelectedIndex(h);t.scrollToIndex(h,true);r=true;if(this.mobile){this._removeDummyOption();this.getDomRef("select").selectedIndex=h}return}}t.clearSelection();t.scrollToIndex(h,true);if(!r){this._updatePosInSet(n,-1,null);if(this.mobile){this._addDummyOption(a)}}};u.prototype._prepareUpDown=function(e,t){var i;if(this._iClosedUpDownIdx>=0&&e[this._iClosedUpDownIdx]&&e[this._iClosedUpDownIdx].getText()!==t){this._iClosedUpDownIdx=-1}if(this._iClosedUpDownIdx===-1){for(var s=0,o=e.length;s<o;s++){i=e[s].getText();if(i===t){this._iClosedUpDownIdx=s;break}}}return this._iClosedUpDownIdx};u.prototype._updateIdx=function(t,i,s,o,n){var a=t.length,d=s===0&&o===undefined,r=o!==undefined&&o<s||d,h,l=e(i);if(s<0){h=0}else if(s<a){h=s}else{h=a-1}var p,g=false;do{s=r?h++:h--;p=t[s];g=p&&p.getEnabled()&&!(p instanceof sap.ui.core.SeparatorItem)&&p.getId()!==this.getId()+"_shi"}while(!g&&h<a&&h>=0);if(g){var u=p.getText();var f=s+1;if(this._determinePosinset){f=this._determinePosinset(t,s)}this._updatePosInSet(l,f,p.getAdditionalText?p.getAdditionalText():"");l.val(u);this._doSelect();this._fireLiveChange(n);var c=this._getListBox();c.setSelectedIndex(s);c.scrollToIndex(s,true)}else{s=o}this._iClosedUpDownIdx=s;return s};u.prototype._doSelect=function(t,i){var s=this.getInputDomRef();if(s){var o=e(s);s.focus();o.selectText(t?t:0,i?i:o.val().length)}return this};u.prototype.getF4ButtonDomRef=function(){return this.getDomRef("icon")};u.prototype._getPrivateListBox=function(){if(this._oListBox){return this._oListBox}this._oListBox=new d(this.getId()+"-lb",{allowMultiSelect:false});this.setAggregation("myListBox",this._oListBox,true);this._oListBox.attachEvent("itemsChanged",this._handleItemsChanged,this);this._oListBox.attachEvent("itemInvalidated",this._handleItemInvalidated,this);if(this.getDomRef()){this.$().attr("aria-owns",this.getId()+"-input "+this._oListBox.getId())}return this._oListBox};u.prototype._getExistingListBox=function(){var e=this.getListBox(),t;if(e){t=sap.ui.getCore().byId(e)}else if(this._oListBox){t=this._getPrivateListBox()}return t};u.prototype._getListBox=function(t){var i=this._getExistingListBox();if(!i){i=this._getPrivateListBox()}if(t){i.setAllowMultiSelect(false);i.setDisplaySecondaryValues(this.getDisplaySecondaryValues());var s=this.getDomRef();if(s){i.setMinWidth(e(s).rect().width+"px")}}return i};u.prototype._open=function(t){if(this.mobile){return}if(t===undefined){t=-1}if(!this.getEditable()||!this.getEnabled()){return}if(!this.oPopup){this.oPopup=new o}this._F4ForOpen=false;var i=this._getListBox(!this.oPopup.isOpen());var s=this.oPopup;this._prepareOpen(i);if(!this._oListBoxDelegate){this._oListBoxDelegate={oCombo:this,onclick:function(t){var i=e(t.target).closest("li").attr("id");if(i){var s=new r("_internalSelect",this.oCombo,{selectedId:i});this.oCombo._handleSelect(s)}}}}i.addDelegate(this._oListBoxDelegate);s.setContent(i);s.setAutoClose(true);s.setAutoCloseAreas([this.getDomRef()]);s.setDurations(0,0);s.setInitialFocusId(this.getId()+"-input");var n=this._rerenderListBox(i);if(n){return}s.attachOpened(this._handleOpened,this);var a=o.Dock;s.open(t,a.BeginTop,a.BeginBottom,this,null,null,o.CLOSE_ON_SCROLL);e(i.getFocusDomRef()).attr("tabindex","-1");e(this.getDomRef()).attr("aria-expanded",true)};u.prototype._rerenderListBox=function(e){sap.ui.getCore().applyChanges();return false};u.prototype._prepareOpen=function(t){this._bOpening=true;var i=e(this.getInputDomRef()),s=i.val(),o,n=t.getItems(),a,d=e.sap.startsWithIgnoreCase,r=s==="",h=this.getSelectedItemId(),p;var g=0;var u=-1;for(var f=n.length;g<f;g++){p=n[g];if(!p.getEnabled()){continue}a=""+p.getText();if(r||d(a,s)){if(a==s&&g==this._iClosedUpDownIdx){u=g;o=a;break}else if(this._iClosedUpDownIdx<0&&a==s&&p.getId()==h){u=g;o=a;break}else if(u<0){u=g;o=a}}}if(u>=0){this._iClosedUpDownIdx=u;this._updatePosInSet(i,u+1,p.getAdditionalText?p.getAdditionalText():"");i.val(o);this._doSelect();var c=new e.Event("sapshow");c.which=l.F4;this._fireLiveChange(c)}var m=t.getItems().length;var I=this.getMaxPopupItems();t.setVisibleItems(I<m?I:-1);t.setSelectedIndex(u)};u.prototype._handleOpened=function(){this.oPopup.detachOpened(this._handleOpened,this);var t=this._getListBox();t.scrollToIndex(this._iClosedUpDownIdx,true);t.attachSelect(this._handleSelect,this);this.oPopup.attachClosed(this._handleClosed,this);if(e(this.getFocusDomRef()).data("sap.InNavArea")){e(this.getFocusDomRef()).data("sap.InNavArea",false)}this._bOpening=false};u.prototype._close=function(e){if(this.oPopup){this.oPopup.close(0)}};u.prototype._handleClosed=function(){this.oPopup.detachClosed(this._handleClosed,this);var t=this._getListBox();t.removeDelegate(this._oListBoxDelegate);t.detachSelect(this._handleSelect,this);e(this.getDomRef()).attr("aria-expanded",false);if(this._cleanupClose){this._cleanupClose(t)}};u.prototype._handleSelect=function(t){var i=t.getParameter("selectedIndex"),s=t.getParameter("selectedId"),o=t.getParameter("selectedItem");if(!o&&s){o=sap.ui.getCore().byId(s);if(o.getParent()!==this._getListBox(false)){o=null}i=e.inArray(o,this._getListBox().getItems())}if(o&&o.getEnabled()){var n=o.getText();this._iClosedUpDownIdx=i;this._close();this._updatePosInSet(null,this._getListBox().getSelectedIndex()+1,o.getAdditionalText?o.getAdditionalText():"");var a=this.getValue();var d=this.getSelectedKey();var r=o.getKey();var h=this.getSelectedItemId();var l=o.getId();this._sTypedChars=n;this._sWantedSelectedKey=undefined;this._sWantedSelectedItemId=undefined;if(a!=n||d!=r||h!=l){this.setValue(n,true);this.setProperty("selectedKey",r,true);this.setProperty("selectedItemId",l,true);this.fireChange({newValue:n,selectedItem:o})}else if(n!=e(this.getInputDomRef()).val()){e(this.getInputDomRef()).val(n)}}this._doSelect();return o};u.prototype.getItems=function(){var e=this._getExistingListBox();return e?e.getItems():[]};u.prototype.insertItem=function(e,t){e=this.validateAggregation("items",e,true);this._getListBox().insertItem(e,t);return this};u.prototype.addItem=function(e){e=this.validateAggregation("items",e,true);this._getListBox().addItem(e);return this};u.prototype.removeItem=function(e){return this._getListBox().removeItem(e)};u.prototype.removeAllItems=function(){var e=this._getExistingListBox();return e?e.removeAllItems():[]};u.prototype.indexOfItem=function(e){return this._getListBox().indexOfItem(e)};u.prototype.destroyItems=function(){var e=this._getExistingListBox();if(e){this._getListBox().destroyItems()}return this};u.prototype.updateItems=function(){this._bNoItemCheck=true;this.updateAggregation("items");if(!this._sHandleItemsChanged){this._sHandleItemsChanged=setTimeout(function(){this._handleItemsChanged(null,true)}.bind(this),0)}};u.prototype.setListBox=function(e){var t=sap.ui.getCore().byId(this.getListBox());if(t){t.detachEvent("itemsChanged",this._handleItemsChanged,this);t.detachEvent("itemInvalidated",this._handleItemInvalidated,this);if(this._bListBoxDependentSet){this.removeDependent(t);this._bListBoxDependentSet=false}}if(this._oListBox&&e){this._oListBox.detachEvent("itemsChanged",this._handleItemsChanged,this);this._oListBox.detachEvent("itemInvalidated",this._handleItemInvalidated,this);if(this.getAggregation("myListBox")){this.destroyAggregation("myListBox",true)}else{this._oListBox.destroy()}this._oListBox=null}this.setAssociation("listBox",e);var i=typeof e==="string"?sap.ui.getCore().byId(e):e;if(i&&i.attachEvent){i.attachEvent("itemsChanged",this._handleItemsChanged,this);i.attachEvent("itemInvalidated",this._handleItemInvalidated,this)}if(i&&!i.getParent()){this.addDependent(i);this._bListBoxDependentSet=true}if(this.getDomRef()&&i){this.$().attr("aria-owns",this.getId()+"-input "+i.getId())}return this};u.prototype._handleItemsChanged=function(t,i){if(i){this._sHandleItemsChanged=null;this._bNoItemCheck=undefined}if(this._bNoItemCheck){return}var s=[];if(this._getExistingListBox()){s=this._getListBox().getItems()}var o=this.getSelectedKey();var n=this.getSelectedItemId();var a,d,r,h;var l=this.getValue();var p=-1;var g=false;var u=false;var f=false;this._iClosedUpDownIdx=-1;var c=!!this.getBinding("value");var m=!!this.getBinding("selectedKey");if(c&&m){c=false}var I=0;var _;for(I=0;I<s.length;I++){_=s[I];if((this._sWantedSelectedKey||this._sWantedSelectedItemId)&&(_.getKey()==this._sWantedSelectedKey||_.getId()==this._sWantedSelectedItemId)&&_.getEnabled()){a=_.getKey();d=_.getId();r=_.getText();h=_.getAdditionalText?_.getAdditionalText():"";p=I;this._sWantedSelectedKey=undefined;this._sWantedSelectedItemId=undefined;break}else if(o&&_.getKey()==o&&_.getEnabled()&&!(f&&c)){g=true;a=o;d=_.getId();r=_.getText();h=_.getAdditionalText?_.getAdditionalText():"";p=I;if(r==l&&d==n&&!this._sWantedSelectedKey&&!this._sWantedSelectedItemId){break}if(m&&!this._sWantedSelectedKey&&!this._sWantedSelectedItemId){break}}else if(n&&_.getId()==n&&_.getEnabled()&&!g&&!(f&&c)){u=true;a=_.getKey();d=n;r=_.getText();h=_.getAdditionalText?_.getAdditionalText():"";p=I}else if(_.getText()==l&&_.getEnabled()&&!(g&&!c)&&!(u&&!c)&&!f){f=true;a=_.getKey();d=_.getId();r=l;h=_.getAdditionalText?_.getAdditionalText():"";p=I;if(c&&!this._sWantedSelectedKey&&!this._sWantedSelectedItemId){break}}}this._iClosedUpDownIdx=p;if(l!=r&&p>=0){this.setProperty("value",r,true);e(this.getInputDomRef()).val(r)}this.setProperty("selectedKey",a,true);this.setProperty("selectedItemId",d,true);var y=this.getDomRef();if(y){e(this.getInputDomRef()).attr("aria-setsize",s.length);if(d){this._updatePosInSet(null,p+1,h)}else{this._updatePosInSet(null,-1,null)}if(this.mobile){var v=this.getDomRef("select");while(v.length>0){v.remove(0)}for(I=0;I<s.length;I++){_=s[I];var x=document.createElement("option");x.text=_.getText();x.id=this.getId()+"-"+_.getId();if(!_.getEnabled()){x.disabled="disabled"}v.add(x,null)}v.selectedIndex=p}}};u.prototype._handleItemInvalidated=function(e){if(this._bNoItemCheck){return}var i=e.getParameter("item");if(i.getId()==this.getSelectedItemId()){if(i.getKey()!=this.getSelectedKey()){this.setProperty("selectedKey",i.getKey(),true)}if(i.getText()!=this.getValue()){t.prototype.setValue.apply(this,[i.getText()])}}if(!this._sHandleItemsChanged){this._handleItemsChanged(e)}};u.prototype.onAfterRendering=function(e){t.prototype.onAfterRendering.apply(this,arguments);var i=this.getListBox();if(i){var s=sap.ui.getCore().byId(i);if(s.getDomRef()){s.$().appendTo(sap.ui.getCore().getStaticAreaRef())}}if(this.mobile){var o=this;this.$("select").on("change",function(){var e=o.$("select").val();var t=o.getItems();var i=true;var s=0;var n=o.getValue();for(var a=0;a<t.length;a++){if(t[a].getText()==e){i=t[a].getEnabled()}if(t[a].getText()==n){s=a}}if(i){o.setValue(e);o.fireChange({newValue:e,selectedItem:sap.ui.getCore().byId(o.getSelectedItemId())})}else{o.getDomRef("select").selectedIndex=s}});if(this.getSelectedItemId()){for(var n=0;n<this.getItems().length;n++){var a=this.getItems()[n];if(this.getSelectedItemId()==a.getId()){this.getDomRef("select").selectedIndex=n;break}}}else{this._addDummyOption(this.getValue())}}};u._isHotKey=function(e){if(e.altKey||e.ctrlKey||e.metaKey){return true}var t=e.keyCode||e.which;switch(t){case l.ENTER:case l.SHIFT:case l.TAB:case l.ALT:case l.CONTROL:return true;case l.END:case l.HOME:case l.ARROW_LEFT:case l.ARROW_UP:case l.ARROW_RIGHT:case l.ARROW_DOWN:case l.F1:case l.F2:case l.F3:case l.F4:case l.F5:case l.F6:case l.F7:case l.F8:case l.F9:case l.F10:case l.F11:case l.F12:if(e.type=="keypress"){return e.which===0}else{return true}default:return false}};u.prototype.setSelectedKey=function(e){if(this.getSelectedKey()==e){return this}if(!e&&this._isSetEmptySelectedKeyAllowed()){return this}var t=this.getItems();var i=true;var s;var o;var n;for(var a=0;a<t.length;a++){if(t[a].getKey()==e&&t[a].getEnabled()){var d=t[a];s=d.getId();var r=d.getText();n=d.getAdditionalText?d.getAdditionalText():"";this.setValue(r,true);this._sTypedChars=r;o=a;i=false;break}}if(!i){this.setProperty("selectedKey",e,true);this.setProperty("selectedItemId",s,true);var h=this.getDomRef();if(h){this._updatePosInSet(null,o+1,n);if(this.mobile){this._removeDummyOption();this.getDomRef("select").selectedIndex=o}}this._sWantedSelectedKey=undefined;this._iClosedUpDownIdx=o}else{this._sWantedSelectedKey=e;this._iClosedUpDownIdx=-1}this._sWantedSelectedItemId=undefined;return this};u.prototype._isSetEmptySelectedKeyAllowed=function(){this.setProperty("selectedKey","",true);this.setProperty("selectedItemId","",true);this.setValue("",true);return true};u.prototype.setSelectedItemId=function(e){if(this.getSelectedItemId()==e){return this}if(!e&&this._isSetEmptySelectedKeyAllowed()){return this}var t=this.getItems();var i=true;var s;var o;var n;for(var a=0;a<t.length;a++){if(t[a].getId()==e&&t[a].getEnabled()){var d=t[a];s=d.getKey();var r=d.getText();n=d.getAdditionalText?d.getAdditionalText():"";this.setValue(r,true);this._sTypedChars=r;o=a;i=false;break}}if(!i){this.setProperty("selectedItemId",e,true);this.setProperty("selectedKey",s,true);var h=this.getDomRef();if(h){this._updatePosInSet(null,o+1,n);if(this.mobile){this._removeDummyOption();this.getDomRef("select").selectedIndex=o}}this._sWantedSelectedItemId=undefined;this._iClosedUpDownIdx=o}else{this._sWantedSelectedItemId=e;this._iClosedUpDownIdx=-1}this._sWantedSelectedKey=undefined;return this};u.prototype.setValue=function(e,i){if(!i){var s=this.getItems();var o;var n;var a;var d;this._iClosedUpDownIdx=-1;for(var r=0;r<s.length;r++){if(s[r].getText()==e&&s[r].getEnabled()){var h=s[r];n=h.getId();o=h.getKey();d=h.getAdditionalText?h.getAdditionalText():"";a=r;this._iClosedUpDownIdx=a;break}}this.setProperty("selectedKey",o,true);this.setProperty("selectedItemId",n,true);var l=this.getDomRef();if(l){if(n){this._updatePosInSet(null,a+1,d)}else{this._updatePosInSet(null,-1,null)}if(this.mobile){if(!n){this._addDummyOption(e)}else{this._removeDummyOption();this.getDomRef("select").selectedIndex=a}}}}t.prototype.setValue.apply(this,[e]);this._sTypedChars=this.getValue();this._sWantedSelectedKey=undefined;this._sWantedSelectedItemId=undefined;return this};u.prototype.invalidate=function(e){if(!e||!(e instanceof d)||e!=this._getListBox()){t.prototype.invalidate.apply(this,arguments)}else{if(this.getUIArea()&&e.getDomRef()){this.getUIArea().addInvalidatedControl(e)}}};u.prototype.clone=function(e){var i=t.prototype.clone.apply(this,arguments),s=this.getAggregation("myListBox"),o;if(s&&!i._oListBox){s.detachEvent("itemsChanged",this._handleItemsChanged,this);s.detachEvent("itemInvalidated",this._handleItemInvalidated,this);o=s.clone(e);o.attachEvent("itemsChanged",i._handleItemsChanged,i);o.attachEvent("itemInvalidated",i._handleItemInvalidated,i);i.setAggregation("myListBox",o,true);i._oListBox=o;s.attachEvent("itemsChanged",this._handleItemsChanged,this);s.attachEvent("itemInvalidated",this._handleItemInvalidated,this)}return i};u.prototype._addDummyOption=function(e){var t=this.getDomRef("dummyOption");if(!t){var i=this.getItems();t=document.createElement("option");t.text=e;t.id=this.getId()+"-dummyOption";if(i.length>0){this.getDomRef("select").add(t,document.getElementById(this.getId()+"-"+i[0].getId()))}else{this.getDomRef("select").add(t,null)}}else{t.text=e}this.getDomRef("select").selectedIndex=0};u.prototype._removeDummyOption=function(){var e=this.getDomRef("dummyOption");if(e){this.getDomRef("select").remove(0)}};u.prototype.getFocusDomRef=function(){if(this.mobile){return this.getDomRef("select")||null}else{return this.getDomRef("input")||null}};u.prototype._updatePosInSet=function(e,t,i){if(!e){e=this.$("input")}if(t>=0){e.attr("aria-posinset",t);if(this.getDisplaySecondaryValues()){this.$("SecVal").text(i)}}else{e.removeAttr("aria-posinset");if(this.getDisplaySecondaryValues()){this.$("SecVal").text("")}}};u.prototype.getAccessibilityInfo=function(){var e=t.prototype.getAccessibilityInfo.apply(this,arguments);e.role="combobox";e.type=sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons").getText("ACC_CTR_TYPE_COMBO");return e};return u});