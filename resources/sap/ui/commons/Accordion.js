/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","./AccordionRenderer","sap/ui/dom/jquery/control","sap/ui/thirdparty/jqueryui/jquery-ui-core","sap/ui/thirdparty/jqueryui/jquery-ui-widget","sap/ui/thirdparty/jqueryui/jquery-ui-mouse","sap/ui/thirdparty/jqueryui/jquery-ui-sortable"],function(t,e,i,o){"use strict";var n=i.extend("sap.ui.commons.Accordion",{metadata:{library:"sap.ui.commons",deprecated:true,properties:{width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"200px"},openedSectionsId:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"sections",aggregations:{sections:{type:"sap.ui.commons.AccordionSection",multiple:true,singularName:"section"}},events:{sectionOpen:{parameters:{openSectionId:{type:"string"},closeSectionIds:{type:"string[]"}}},sectionClose:{parameters:{closeSectionId:{type:"string"}}},sectionsReorder:{parameters:{movedSectionId:{type:"string"},newIndex:{type:"int"}}}}}});n.CARD_1=1;n.CARD_0_1=2;n.aAccordions=[];n.prototype.init=function(){this.bInitialRendering=true;this.activationMode=n.CARD_1;this.rb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons");this.aSectionTitles=[];n.aAccordions.push(this)};n.prototype.onsapspace=function(t){this.onclick(t)};n.prototype.onsappagedownmodifiers=function(e){var i=t(e.target);var o=i.parentsUntil(".sapUiAcd");var n=o[o.length-1];var r=t(n).next();while(!this.getCorrespondingSection(r[0]).getEnabled()){r=r.next()}r=r[0];this.openSection(r.id);var s=this.getSections();s[this.__idxOfSec(r.id)].focus();e.preventDefault();e.stopPropagation()};n.prototype.onsappageupmodifiers=function(e){var i=t(e.target);var o=i.parentsUntil(".sapUiAcd");var n=o[o.length-1];var r=t(n).prev();while(!this.getCorrespondingSection(r[0]).getEnabled()){r=r.prev()}r=r[0];this.openSection(r.id);var s=this.getSections();s[this.__idxOfSec(r.id)].focus();e.preventDefault();e.stopPropagation()};n.prototype.onsapupmodifiers=function(e){e.preventDefault();e.stopPropagation();var i=t(e.target).parentsUntil(".sapUiAcd");var o=i[i.length-1];if(this.__idxOfSec(o.id)===0){return}var n=t(o).prev().first()[0];var r=false;if(this.__idxOfSec(n.id)===0){r=true}this.dropSection(o,n,r);var s=this.getSections();s[this.__idxOfSec(o.id)].focus()};n.prototype.onsapdownmodifiers=function(e){e.preventDefault();e.stopPropagation();var i=t(e.target).parentsUntil(".sapUiAcd");var o=i[i.length-1];if(this.__idxOfSec(o.id)==this.getSections().length-1){return}var n=t(o).next().first()[0];this.dropSection(o,n,false);var r=this.getSections();r[this.__idxOfSec(o.id)].focus()};n.prototype.onsapprevious=function(e){if(e.srcControl.getMetadata().getName()!="sap.ui.commons.AccordionSection"){return}e.preventDefault();e.stopPropagation();var i=this.getCurrentSection(e.target),o=null;if(i.id==this.getSections()[0].getId()){o=t(i).find("div.sapUiAcdSectionHdr");if(o){o.trigger("focus")}}if(i){var n=t(i).prev();while(n&&t(n).hasClass("sapUiAcdSectionDis")){n=t(n).prev()}if(n){o=t(n).find("div.sapUiAcdSectionHdr");if(o){o.trigger("focus")}}}};n.prototype.onsapnext=function(e){if(e.srcControl.getMetadata().getName()!="sap.ui.commons.AccordionSection"){return}e.preventDefault();e.stopPropagation();var i=this.getCurrentSection(e.target);if(i){var o=t(i).next();while(o&&t(o).hasClass("sapUiAcdSectionDis")){o=t(o).next()}if(o){var n=t(o).find("div.sapUiAcdSectionHdr");if(n){n.trigger("focus")}}}};n.prototype.onsaphome=function(e){e.preventDefault();e.stopPropagation();var i=this.getSections()[0].getDomRef();if(t(i).hasClass("sapUiAcdSectionDis")){i=t(i).next();while(i&&t(i).hasClass("sapUiAcdSectionDis")){i=t(i).next()}}if(i){var o=t(i).find("div.sapUiAcdSectionHdr");if(o){o.trigger("focus")}}};n.prototype.onsapend=function(e){e.preventDefault();e.stopPropagation();var i=this.getSections().length;var o=this.getSections()[i-1].getDomRef();if(t(o).hasClass("sapUiAcdSectionDis")){o=t(o).prev();while(o&&t(o).hasClass("sapUiAcdSectionDis")){o=t(o).prev()}}if(o){var n=t(o).find("div.sapUiAcdSectionHdr");if(n){n.trigger("focus")}}};n.prototype.getCurrentSection=function(e){var i=e;while(!t(i).hasClass("sapUiAcdSection")){i=t(i).parent()}return i[0]};n.prototype.dropSection=function(e,i,o){var n=t(e).parent()[0];var r=t(n).children(".sapUiAcdSection").toArray();var s=t.inArray(i,r);if(o){s-=1}this.moveSection(e.id,s)};n.prototype.moveSection=function(t,e){var i=this.__idxOfSec(t);if(e==i){return}var o=this.aSectionTitles[i];this.aSectionTitles.splice(i,1);var n=this.getSections();var r=n[i];this.removeSection(i,true);if(e!=-1){this.aSectionTitles.splice(e,0,o)}else{this.aSectionTitles.splice(0,0,o)}this.insertSection(r,e,true);this.fireSectionsReorder({movedSectionId:t,newIndex:e})};n.prototype._onSortChange=function(e,i){e.preventDefault();e.stopPropagation();var o=i.item[0];var n=i.item[0].getAttribute("Id");var r=t(o).parent()[0];var s=t(r).children(".sapUiAcdSection").toArray();var a=t.inArray(o,s);this.moveSection(n,a)};n.prototype.onclick=function(e){if(e.srcControl.getId()==this.getId()){return}var i=t(e.target);if(i.hasClass("sapUiAcdSectionCont")){return}if(!(t(e.target).control(0)instanceof sap.ui.commons.AccordionSection)){return}var o=e.srcControl.getDomRef();var n=this.getCorrespondingSection(o);if(n&&!n.getEnabled()){return}if(e.srcControl.getCollapsed()){this.openSection(o.id)}else{this.closeSection(o.id)}e.preventDefault();e.stopPropagation();var r=this.getSections();r[this.__idxOfSec(o.id)].focus()};n.prototype.openSection=function(t){var e=this.__idxOfSec(t);var i=this.getSections(),o=[];if(this.activationMode==n.CARD_0_1||this.activationMode==n.CARD_1){o=this.closeOpenedSections()}i[e]._setCollapsed(false);this.fireSectionOpen({openSectionId:t,closeSectionIds:o})};n.prototype.closeSection=function(t){var e=this.__idxOfSec(t);var i=this.getSections();i[e]._setCollapsed(true);this.fireSectionClose({closeSectionId:t})};n.prototype.closeOpenedSections=function(){var t=[];var e=this.getSections();for(var i=0;i<e.length;i++){if(!e[i].getCollapsed()){e[i]._setCollapsed(true);t.push(e[i].getId())}}return t};n.prototype.openDefaultSections=function(){var t=this.getSections();var e=this.getOpenedSectionsId().split(",");for(var i=0;i<e.length;i++){var o=t[this.__idxOfSec(e[i])];o._setCollapsed(false)}};n.prototype.getNumberOfOpenedSections=function(){var t=0;var e=this.getSections();for(var i=0;i<e.length;i++){if(e[i].getCollapsed()==false){t++}}return t};n.prototype.addSection=function(t){this.addAggregation("sections",t);if((this.getOpenedSectionsId()==null||this.getOpenedSectionsId()=="")&&t.getEnabled()){this.setOpenedSectionsId(t.getId())}this.aSectionTitles.push(t.getTitle());return this};n.prototype.__idxOfSec=function(t){if(typeof t=="string"){t=sap.ui.getCore().byId(t)}return this.indexOfSection(t)};n.prototype.setOpenedSectionsId=function(t){var e=this.getSections();var i=t.split(",");if(i.length==1){if(this.__idxOfSec(t)<0){this.setProperty("openedSectionsId",t);return this}if(e[this.__idxOfSec(t)].getEnabled()){this.setProperty("openedSectionsId",t)}else{for(var o=0;o<e.length;o++){if(e[o].getEnabled()){this.setProperty("openedSectionsId",e[o].getId());return this}}}}else if(i.length==0){return this}else{var n;for(var o=0;o<i.length;o++){if(e[this.__idxOfSec(i[o])].getEnabled()){if(n){n+=","+i[o]}else{n=i[o]}}}if(n){this.setProperty("openedSectionsId",n)}}return this};n.prototype.getCorrespondingSection=function(e){if(t(e).hasClass("sapUiAcdSection")){var i=t(e).parent();var o=i[0];var n=t(o).children();var r=n.index(e);var s=this.getSections();return s[r-1]}};n.prototype.isLastSection=function(e){var i=this.getSections();return t.inArray(e,i)===i.length-1};n.prototype.onAfterRendering=function(){var e=sap.ui.getCore(),i=this;function o(){var t=i.getDomRef();if(t){t.style.height=t.clientHeight-7+"px"}}if(e.isThemeApplied()){o()}else{e.attachThemeChanged(o,this)}this.$().sortable({handle:"> div.sapUiAcdSectionHdr > div",stop:t.proxy(this._onSortChange,this)})};return n});