/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./Menu","./MenuItem","./MenuItemBase","./library","sap/ui/core/Control","./MenuBarRenderer","sap/ui/core/ResizeHandler","sap/ui/core/Popup","sap/ui/events/checkMouseEnterOrLeave","sap/ui/events/KeyCodes"],function(e,t,r,i,n,s,o,u,a,l,f){"use strict";var p=a.Dock;var d=n.MenuBarDesign;var g=s.extend("sap.ui.commons.MenuBar",{metadata:{library:"sap.ui.commons",deprecated:true,properties:{enabled:{type:"boolean",group:"Behavior",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},design:{type:"sap.ui.commons.MenuBarDesign",group:"Appearance",defaultValue:d.Standard}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.unified.MenuItem",multiple:true,singularName:"item"}}}});var v=r.extend("sap.ui.commons._DelegatorMenuItem",{constructor:function(e){r.apply(this);this.oAlterEgoItm=e;this.bNoSubMenu=true;var t=this.oAlterEgoItm.getSubmenu();if(t){var i=this;t.getRootMenu=function(){return i.getParent()};this.bNoSubMenu=false}},exit:function(){if(!this.bNoSubMenu){this.oAlterEgoItm.getSubmenu().getRootMenu=t.prototype.getRootMenu}this.bNoSubMenu=true;this.oAlterEgoItm=null},getText:function(){return this.oAlterEgoItm.getText()},getIcon:function(){return this.oAlterEgoItm.getIcon()},getEnabled:function(){return this.oAlterEgoItm.getEnabled()},getVisible:function(){return this.oAlterEgoItm.getVisible()},getSubmenu:function(){return this.oAlterEgoItm.getSubmenu()}});g.prototype.init=function(){this.oOvrFlwMnu=null;this.sCurrentFocusedItemRefId=null;this.data("sap-ui-fastnavgroup","true",true)};g.prototype.exit=function(){if(this.oOvrFlwMnu){this.oOvrFlwMnu.destroy()}this.oOvrFlwMnu=null;if(this.sResizeListenerId){u.deregister(this.sResizeListenerId);this.sResizeListenerId=null}};g.prototype.doBeforeRendering=function(){var e=this.getItems();for(var t=0;t<e.length;t++){var r=e[t].getSubmenu();if(r){r.setRootMenuTopStyle(this.getDesign()==d.Header)}}if(this.oOvrFlwMnu){this.oOvrFlwMnu.setRootMenuTopStyle(this.getDesign()==d.Header)}if(this.sResizeListenerId){u.deregister(this.sResizeListenerId);this.sResizeListenerId=null}};g.prototype.onAfterRendering=function(){this.sResizeListenerId=u.register(this.getDomRef(),e.proxy(this.onresize,this));this.onresize()};g.prototype.onresize=function(e){b(this)};g.prototype.onfocusin=function(t){var r=this.getId();var i=e(t.target);var n=i.attr("id");if(!n||n==r||n==r+"-area"){var s=this.$("area").children();this.sCurrentFocusedItemRefId=s.length==0?null:e(s.get(0)).attr("id")}else{this.sCurrentFocusedItemRefId=n}var o=this.sCurrentFocusedItemRefId?document.getElementById(this.sCurrentFocusedItemRefId):null;if(o){o.focus()}this.$().attr("tabindex","-1")};g.prototype.onfocusout=function(e){this.$().attr("tabindex","0")};g.prototype.onmousedown=function(e){var t=I(this,e);if(t==="ovrflw"){this._bOvrFlwMnuSkipOpen=this.oOvrFlwMnu&&this.oOvrFlwMnu.bOpen}else if(t){var r=t.getSubmenu();t._bSkipOpen=r&&r.bOpen}};g.prototype.onmouseout=function(e){var t=I(this,e);if(t==="ovrflw"){var r=m(this,e);if(this._bOvrFlwMnuSkipOpen&&l(e,r[0])){this._bOvrFlwMnuSkipOpen=false}}else if(t){var r=m(this,e);if(t._bSkipOpen&&l(e,r[0])){t._bSkipOpen=false}}};g.prototype.onclick=function(e){c(this,e,false)};g.prototype.onsapselect=function(e){c(this,e,true)};g.prototype.onsapdown=function(e){c(this,e,true)};g.prototype.onsapdownmodifiers=function(e){if(e.altKey){c(this,e,true)}};g.prototype.onsapprevious=function(e){if(e.keyCode!=f.ARROW_UP){y(this,e,"prev")}};g.prototype.onsapnext=function(e){if(e.keyCode!=f.ARROW_DOWN){y(this,e,"next")}};g.prototype.onsaphome=function(e){y(this,e,"first")};g.prototype.onsapend=function(e){y(this,e,"last")};var c=function(e,t,r){t.preventDefault();t.stopPropagation();if(e.getEnabled()){var i=I(e,t);if(i==="ovrflw"){var n=m(e,t);if(e.oOvrFlwMnu&&!e._bOvrFlwMnuSkipOpen){var s=p;e.oOvrFlwMnu.open(r,n.get(0),s.EndTop,s.EndBottom,n.get(0))}}else if(i){if(i.getEnabled()){var n=m(e,t);var o=i.getSubmenu();if(o&&!i._bSkipOpen){var s=p;o.open(r,n.get(0),s.BeginTop,s.BeginBottom,n.get(0))}else if(!o){i.fireSelect({item:i})}}}}e._bOvrFlwMnuSkipOpen=false;var u=e.getItems();for(var a=0;a<u.length;a++){u[a]._bSkipOpen=false}};var m=function(t,r){var i=e(r.target);if(!i.attr("itemidx")){i=i.parent()}return i.attr("itemidx")?i:null};var I=function(e,t){var r=m(e,t);if(r){var i=r.attr("itemidx");if(i){if(i=="ovrflw"){return"ovrflw"}else{var n=parseInt(i);var s=e.getItems()[n];return s}}}return null};var h=function(t){var r=0;var i=t.$("area");var n=i.children();var s=sap.ui.getCore().getConfiguration().getRTL();var o=s?1e5:0;n.each(function(i){if(i==0){return true}var n=this.offsetLeft;var u=s?n>=o:n<=o;if(u){r=i;return false}else if(e(this).attr("id")==t.getId()+"-ovrflw"){r=i;return false}else{o=n;return true}});return r};var b=function(e){var r=h(e);var i=r;var n=e.$("area");var s=n.children();var o=e.$("ovrflw");var u=false;if(r<s.length-1){o.attr("style","display:block;");if(!e.oOvrFlwMnu){e.oOvrFlwMnu=new t(e.getId()+"-ovrflwmnu");e.oOvrFlwMnu.bUseTopStyle=e.getDesign()==d.Header;e.oOvrFlwMnu.attachItemSelect(function(e){var r=e.getParameter("item");if(!(r instanceof v)){var i=t.prototype.getRootMenu.apply(r.getParent());i.fireItemSelect({item:r})}else if(r.bNoSubMenu&&r instanceof v){r.oAlterEgoItm.fireSelect({item:r.oAlterEgoItm})}})}e.oOvrFlwMnu.destroyItems();var a=e.getItems();for(var l=0;l<a.length;l++){var f=a[l];if(r!=0){if(f.getVisible()){r--}if(r==0){e.sLastVisibleItemId=f.getId()}}else{e.oOvrFlwMnu.addItem(new v(f));if(f.getId()==e.sCurrentFocusedItemRefId){u=true}}}if(sap.ui.getCore().getConfiguration().getAccessibility()){s.attr("aria-setsize",i+1);o.attr("aria-posinset",i+1)}}else{o.attr("style","display:none;");if(e.oOvrFlwMnu){e.oOvrFlwMnu.destroyItems()}e.sLastVisibleItemId=null;if(sap.ui.getCore().getConfiguration().getAccessibility()){s.attr("aria-setsize",i);o.attr("aria-posinset",0)}}n.scrollTop(0);if(u){e.sCurrentFocusedItemRefId=e.sLastVisibleItemId;document.getElementById(e.sLastVisibleItemId).focus()}};var y=function(t,r,i){r.stopPropagation();r.preventDefault();if(!t.sCurrentFocusedItemRefId){return}var n=null;if(t.sLastVisibleItemId&&(t.sCurrentFocusedItemRefId==t.sLastVisibleItemId&&i=="next"||i=="last")){n=t.getId()+"-ovrflw"}else if(t.sLastVisibleItemId&&t.sCurrentFocusedItemRefId==t.getId()+"-ovrflw"&&i=="prev"){n=t.sLastVisibleItemId}else{var s=i+"All";var o=false;if(i=="first"){s="prevAll";o=true}else if(i=="last"){s="nextAll";o=true}var u=e(document.getElementById(t.sCurrentFocusedItemRefId));var a=u[s](":visible");n=e(a.get(o?a.length-1:0)).attr("id")}if(n){t.sCurrentFocusedItemRefId=n;document.getElementById(n).focus()}};return g});