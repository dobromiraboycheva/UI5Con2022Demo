/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/commons/library","sap/ui/ux3/library","sap/ui/commons/Link","sap/ui/commons/MessageBox","sap/ui/core/Control","sap/ui/core/format/DateFormat","sap/ui/ux3/OverlayContainer","sap/ui/commons/Button","sap/ui/core/ListItem","sap/ui/commons/layout/VerticalLayout","sap/ui/commons/layout/HorizontalLayout","sap/ui/layout/HorizontalLayout","sap/ui/core/HTML","sap/ui/commons/TextField","sap/ui/commons/InPlaceEdit","sap/ui/commons/Label","sap/ui/commons/ListBox","sap/ui/commons/TextArea","sap/base/security/encodeXML","sap/base/security/URLListValidator","./NoteTakerCardRenderer"],function(t,e,a,o,r,s,n,i,l,d,u,y,p,C,T,_,h,g,v,m,c,O){"use strict";var b=s.extend("sap.suite.ui.commons.NoteTakerCard",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{header:{type:"string",group:"Misc",defaultValue:null},body:{type:"string",group:"Misc",defaultValue:null},timestamp:{type:"object",group:"Misc",defaultValue:new Date},tags:{type:"object",group:"Misc",defaultValue:[]},viewAllTrigger:{type:"int",group:"Misc",defaultValue:1800},uid:{type:"string",group:"Misc",defaultValue:null},isFiltered:{type:"boolean",group:"Misc",defaultValue:false},thumbUp:{type:"boolean",group:"Misc",defaultValue:null},thumbDown:{type:"boolean",group:"Misc",defaultValue:null},allTags:{type:"object",group:"Misc",defaultValue:[]},attachmentFilename:{type:"string",group:"Misc",defaultValue:null},attachmentUrl:{type:"string",group:"Misc",defaultValue:null}},events:{editNote:{parameters:{title:{type:"string"},body:{type:"string"},timestamp:{type:"string"},uid:{type:"string"},thumbUp:{type:"boolean"},thumbDown:{type:"boolean"},tags:{type:"object"}}},deleteNote:{parameters:{cardId:{type:"string"},title:{type:"string"},body:{type:"string"},timestamp:{type:"string"},uid:{type:"string"},thumbUp:{type:"boolean"},thumbDown:{type:"boolean"}}},attachmentClick:{parameters:{uid:{type:"string"},url:{type:"string"},filename:{type:"string"}}}}}});b.prototype.init=function(){this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var e=this;this._oEditButton=new l({id:this.getId()+"-edit-button",press:function(t){e._handleEdit()},tooltip:this._rb.getText("NOTETAKERCARD_BUTTON_OPEN_EDIT_TOOLTIP")});this._oEditButton.addStyleClass("sapSuiteUiCommonsNoteTakerCardEditButton");this._oDeleteButton=new l({id:this.getId()+"-delete-button",tooltip:this._rb.getText("NOTETAKERCARD_BUTTON_DELETE_TOOLTIP"),press:function(){e._handleDelete()}});this._oDeleteButton.addStyleClass("sapSuiteUiCommonsNoteTakerCardDeleteButton");this._oViewAllLink=new o({id:this.getId()+"-viewAll-link",text:this._rb.getText("NOTETAKERCARD_LINK_VIEW_ALL_TEXT"),tooltip:this._rb.getText("NOTETAKERCARD_LINK_VIEW_ALL_TOOLTIP"),press:function(){e._openOverlay()}});this._oOverlayCard=new i(this.getId()+"-overlay",{openButtonVisible:false,close:function(t){e._handleOverlayCloseEvent(t.getSource());t.preventDefault()}});this._oOverlayCard.addDelegate({onAfterRendering:function(){var a=t(document.getElementById(e.getId()+"-overlayTimestamp"));if(a){a.html(e.getFormattedTimestamp())}}});this._oOverlayCard._superOnsapselect=this._oOverlayCard.onsapselect;this._oOverlayCard.onsapselect=function(t){var a=t.srcControl.getId();if(a.indexOf("-overlayBody")<0&&a.indexOf("-inputTag")<0&&a.indexOf("-overlayCardTitle")<0){t.stopPropagation();t.preventDefault()}setTimeout(function(){e._oOverlayCard._superOnsapselect(t)},10)};this._oOverlayCard.addStyleClass("sapSuiteCommonsNoteTakerCardOverlayWindow");this._oOverlayCard._tagControls={}};b.prototype.exit=function(){this._oDeleteButton.destroy();this._oDeleteButton=null;this._oEditButton.destroy();this._oEditButton=null;this._oViewAllLink.destroy();this._oViewAllLink=null;this._oOverlayCard.destroy();this._oOverlayCard=null};b.prototype.getFormattedTimestamp=function(){var t=sap.ui.getCore().getConfiguration().getLocale();var e=n.getDateTimeInstance({style:"medium"},t);return e.format(this.getTimestamp())};b.prototype._handleOverlayCloseEvent=function(t){if(t.bEditMode){var e=this;r.show(this._rb.getText("NOTETAKERCARD_CONFIRMATION_CANCEL_EDIT_MESSAGE"),r.Icon.QUESTION,this._rb.getText("NOTETAKERCARD_CONFIRMATION_CANCEL_EDIT_TITLE"),[r.Action.YES,r.Action.NO],function(t){if(t===r.Action.YES){e._closeOverlay();e._oEditButton.focus()}else{if(e.getId()+"-overlayBody"?window.document.getElementById(e.getId()+"-overlayBody"):null){(e.getId()+"-overlayBody"?window.document.getElementById(e.getId()+"-overlayBody"):null).focus()}}},r.Action.NO)}else{this._closeOverlay()}};b.prototype._closeOverlay=function(){this._oOverlayCard.close();this._destroyTagControls();this._oOverlayCard.bEditMode=false;this._oOverlayCard.destroyContent()};b.prototype._openOverlay=function(e){var a;if(!this._oOverlayCard.isOpen()){this._oOverlayCard.bThumbUp=this.getThumbUp();this._oOverlayCard.bThumbDown=this.getThumbDown();this._prepareOverlayLayouts();this._prepareOverlayToolbar(e);this._prepareOverlayHeaderBtns(e);this._prepareOverlayBody();this._prepareOverlayButtons(e);if(e){a=this.getId()+"-overlayBody"}else{a=this.getId()+"-overlay-close"}this._oOverlayCard.open(a);t(document.getElementById(this.getId()+"-overlay-thumb-down-button")).attr("aria-pressed",this.getThumbDown());t(document.getElementById(this.getId()+"-overlay-thumb-up-button")).attr("aria-pressed",this.getThumbUp())}};b.prototype._getFormattedBody=function(){var t=[];var e=this.getBody();var a;do{a=e.search(/[\s<>]/);var o="",r="";if(a<0){r=e}else{r=e.slice(0,a);o=e.slice(a,a+1);e=e.slice(a+1)}switch(true){case this._isFullUrl(r):this.wrapFullUrl(t,r,o);break;case this._isShortUrl(r):this._wrapShortUrl(t,r,o);break;case this._isEmail(r):this._wrapEmail(t,r,o);break;default:t.push(m(r+o))}}while(a>=0);return t.join("")};b.prototype._isFullUrl=function(t){return/^(https?|ftp):\/\//i.test(t)&&c.validate(t)};b.prototype._isShortUrl=function(t){return/^(www\.)/i.test(t)&&c.validate("http://"+t)};b.prototype._isEmail=function(t){return/^[\w\.=-]+@[\w\.-]+\.[\w]{2,5}$/.test(t)};b.prototype.wrapFullUrl=function(t,e,a){t.push('<a class="sapUiLnk" ');t.push("href = "+'"'+m(e)+'"');t.push(' target = "_blank" rel="noopener noreferrer"');t.push(">");t.push(m(e));t.push("</a>"+a)};b.prototype._wrapShortUrl=function(t,e,a){t.push('<a class="sapUiLnk" ');t.push("href = "+'"'+m("http://"+e)+'"');t.push(' target = "_blank" rel="noopener noreferrer"');t.push(">");t.push(m(e));t.push("</a>"+a)};b.prototype._wrapEmail=function(t,e,a){t.push('<a class="sapUiLnk" ');t.push('href = "mailto:'+m(e)+'"');t.push(">");t.push(m(e));t.push("</a>"+a)};b.prototype._wrapBodyToDiv=function(t){return"<div class='sapSuiteUiCommonsNoteTakerCardBody'>"+t+"</div>"};b.prototype._wrapTagPanelToDiv=function(t,e){if(e){return"<div class='suiteUiNtcOverlayTagPanelEditMode'>"+t+"</div>"}else{return"<div class='suiteUiNtcOverlayTagPanelViewMode'>"+t+"</div>"}};b.prototype._handleEdit=function(){this._openOverlay(true)};b.prototype._getFormattedTags=function(){var t=[];var e;if(this._oOverlayCard.isOpen()){e=this._oOverlayCard._selectedTags}else{e=this.getTags()}t.push("<div id='"+this.getId()+"-tag-list' class='sapSuiteUiCommonsNoteTakerCardTagList'>");if(e.length===0){t.push(this._rb.getText("NOTETAKERCARD_LABEL_TAGS_EMPTY"))}else{t.push(this._rb.getText("NOTETAKERCARD_LABEL_TAGS_FULL")+": ");var a=m(e.sort().join(" "));t.push("<span title='"+a+"'>");t.push(a);t.push("</span>")}t.push("</div>");return t.join("")};b.prototype._handleDelete=function(t){var e=this;r.show(this._rb.getText("NOTETAKERCARD_CONFIRMATION_DELETE_MESSAGE"),r.Icon.QUESTION,this._rb.getText("NOTETAKERCARD_CONFIRMATION_DELETE_TITLE"),[r.Action.YES,r.Action.NO],function(a){if(a===r.Action.YES){if(t){e._closeOverlay()}e._handleDeleteClick()}},r.Action.NO)};b.prototype._handleDeleteClick=function(){var t={};t.uid=this.getUid();t.cardId=this.getId();t.title=this.getHeader();t.timestamp=this.getTimestamp();t.body=this.getBody();t.thumbUp=this.getThumbUp();t.thumbDown=this.getThumbDown();this.fireDeleteNote(t)};b.prototype.setUid=function(t){this.setProperty("uid",t,true);return this};b.prototype._wrapThumbToDiv=function(t){var e=null;var a=null;if(this.getThumbUp()&&!this.getThumbDown()){e="sapSuiteUiCommonsNoteTakerCardThumbUp";a=this._rb.getText("NOTETAKERCARD_ICON_THUMB_UP_TOOLTIP");this._oOverlayCard.removeStyleClass("suiteUiNtcNegativeCard");this._oOverlayCard.addStyleClass("suiteUiNtcPositiveCard")}else if(!this.getThumbUp()&&this.getThumbDown()){e="sapSuiteUiCommonsNoteTakerCardThumbDown";a=this._rb.getText("NOTETAKERCARD_ICON_THUMB_DOWN_TOOLTIP");this._oOverlayCard.removeStyleClass("suiteUiNtcPositiveCard");this._oOverlayCard.addStyleClass("suiteUiNtcNegativeCard")}else{this._oOverlayCard.removeStyleClass("suiteUiNtcPositiveCard");this._oOverlayCard.removeStyleClass("suiteUiNtcNegativeCard")}var o=[];o.push("<div");if(t){o.push(" id='");o.push(t);o.push("'")}if(e){o.push(" class='");o.push(e);o.push("'");o.push(" title='");o.push(a);o.push("'")}o.push("></div>");return o.join("")};b.prototype._handleAddTag=function(t){this._oOverlayCard._selectedTags=[];var e=t.split(new RegExp("\\s+"));var a={};for(var o=0;o<e.length;o++){if(e[o].length!==0){a[e[o]]=0}}for(var r in a){this._oOverlayCard._selectedTags.push(r)}var s=sap.ui.getCore().byId(this.getId()+"-overlayTagPanel");s.setContent(this._wrapTagPanelToDiv(this._getFormattedTags(),true));this._adjustTagButton()};b.prototype._adjustTagButton=function(){var t=this._oOverlayCard._tagControls.tagButton;if(this._oOverlayCard._selectedTags.length){t.addStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}else{t.removeStyleClass("sapSuiteUiCommonsNoteTakerFeederButtonSelected")}};b.prototype._toggleTagPopup=function(){var e=this._oOverlayCard._selectedTags;if(this._bTagPopupOpen){t(document.getElementById(this.getId()+"-selectTag-panel")).slideToggle();this._focusDefaultControl();this._bTagPopupOpen=false}else{this._addTagsToListBox(this.getAllTags());t(document.getElementById(this.getId()+"-selectTag-panel")).slideToggle();t(document.getElementById(this.getId()+"-inputTag")).val(e.length===0?"":e.join(" ")+" ");this._oOverlayCard._tagControls.tagInput.focus();this._bTagPopupOpen=true}};b.prototype._focusDefaultControl=function(){this._oOverlayCard._tagControls.tagButton.focus()};b.prototype._handleTagInputLive=function(t){var e=t.getParameter("liveValue");var a=e.split(" ");var o=a[a.length-1];this._filterListBox(o)};b.prototype._filterListBox=function(e){if(e.length===0){this._addTagsToListBox(this.getAllTags());return}var a=t.grep(this.getAllTags(),function(t){if(t.indexOf(e)>=0){return true}});this._addTagsToListBox(a)};b.prototype._addTagsToListBox=function(e){var a=t.map(e,function(t,e){return new d({text:t})});this._oOverlayCard._tagControls.tagList.setItems(a,true);this._oOverlayCard._tagControls.tagList.rerender()};b.prototype._handleListSelect=function(t){var e=t.getParameter("selectedItem").getText();var a=this._oOverlayCard._tagControls.tagInput;var o=a.getValue();var r=o.split(" ");r.pop();if(r.length===0){a.setValue(e+" ")}else{a.setValue(r.join(" ")+" "+e+" ")}this._oOverlayCard._tagControls.tagList.setSelectedIndex(-1);a.focus()};b.prototype._destroyTagControls=function(){var t=this._oOverlayCard._tagControls;for(var e in t){t[e].destroy()}this._oOverlayCard._tagControls={}};b.prototype._createTagSelectorControl=function(){var t=this._oOverlayCard._tagControls;var e=new u({id:this.getId()+"-selectTag-panel"});e.addStyleClass("sapSuiteUiCommonsNoteTakerFeederSelectTagPanel");e.addStyleClass("sapUiShd");t.tagSelectorLayout=e;e.addContent(new C(this.getId()+"-selectTag-arrow",{content:"<div class='sapSuiteUiCommonsNoteTakerFeederSelectTagArrow' ></div>"}));e.addContent(new C(this.getId()+"-selectTag-header",{content:["<div class='sapSuiteUiCommonsNoteTakerFeederSelectTagHeader' >",this._rb.getText("NOTETAKERFEEDER_TOOLPOPUP_TITLE"),"</div>"].join("")}));e.addContent(t.tagInput);e.addContent(t.tagList);var a=new y;a.addStyleClass("sapSuiteUiCommonsNoteTakerFeederSelectTagButtons");a.addContent(t.tagApplyBtn);a.addContent(t.tagCancelBtn);e.addContent(a);return e};b.prototype._prepareAttachmentPanel=function(t){var e=t?"-overlay":"";var a=t?"Overlay":"";var r=[this.getId(),e,"-attachmentPanel"].join("");var s=sap.ui.getCore().byId(r);if(s){s.destroy()}var n=new y(r);n.addStyleClass(["suiteUiNtc",a,"AttachmentPanel"].join(""));n.addContent(new C({content:"<div class='suiteUiNtcAttachmentIcon'></div>"}));var i=new o({id:[this.getId(),e,"-attachmentLink"].join(""),text:this.getAttachmentFilename(),tooltip:this._rb.getText("NOTETAKERCARD_LINK_ATTACHMENT_TOOLTIP"),press:this._handleAttachmentDownload,href:this.getAttachmentUrl()});i._ntc=this;n.addContent(i);return n};b.prototype._prepareOverlayLayouts=function(){var t=new u;var e=new u;e.addStyleClass("sapSuiteUiCommonsNtcOverlayTitle");var a=new y;a.addStyleClass("sapSuiteUiCommonsNtcHeaderButtons");var o=new y(this.getId()+"-overlayHeader",{content:[e,a]});o.addStyleClass("sapSuiteUiCommonsNtcOverlayHeader");t.addContent(o);var r=new y(this.getId()+"-overlayToolbar");r.addStyleClass("suiteUiNtcToolbar");var s=new y;s.addStyleClass("suiteUiNtcOverlayToolbarLeftPanel");var n=new y;n.addStyleClass("suiteUiNtcOverlayToolbarRightPanel");r.addContent(s);r.addContent(n);t.addContent(r);this._oOverlayCard.addContent(t);var i=new p;i.addStyleClass("sapSuiteUiCommonsNoteTakerCardContent");var l=new y(this.getId()+"-buttons");l.addStyleClass("sapSuiteUiCommonsNoteTakerCardOverlayButtonPanel");this._oOverlayCard.layouts={topSection:t,headerLeft:e,headerRight:a,toolbar:r,toolbarLeft:s,toolbarRight:n,body:i,buttons:l}};b.prototype._prepareOverlayHeaderBtns=function(t){var e=this;var a=new l(this.getId()+"-editButton",{tooltip:this._rb.getText("NOTETAKERCARD_BUTTON_EDIT_TOOLTIP"),press:function(){e._fnEdit()}});e._oOverlayCard.layouts.headerRight.addContent(a,0);if(t){a.setEnabled(false);a.addStyleClass("sapSuiteUiCommonsNoteTakerCardEditButtonDsbl")}else{a.setEnabled(true);a.addStyleClass("sapSuiteUiCommonsNoteTakerCardEditButton")}var o=new l(this.getId()+"-deleteButton",{tooltip:this._rb.getText("NOTETAKERCARD_BUTTON_DELETE_TOOLTIP"),press:function(){e._handleDelete(true)}});o.addStyleClass("sapSuiteUiCommonsNoteTakerCardDeleteButton");e._oOverlayCard.layouts.headerRight.addContent(o,1);var r=new h(this.getId()+"-overlayTimestamp",{text:e.getFormattedTimestamp()});r.addStyleClass("sapSuiteUiCommonsNoteTakerCardTimestamp");e._oOverlayCard.layouts.headerLeft.addContent(r,1)};b.prototype._prepareOverlayToolbar=function(t){this._oOverlayCard._selectedTags=this.getTags();if(this.getAttachmentFilename()!==""){var e=this._prepareAttachmentPanel(true);this._oOverlayCard.layouts.topSection.addContent(e);this._oOverlayCard.layouts.body.addStyleClass("suiteUiNtcOverlayWithAttachment")}else{this._oOverlayCard.layouts.body.addStyleClass("suiteUiNtcOverlayWithoutAttachment")}};b.prototype._prepareOverlayBody=function(){this._oOverlayCard.addContent(this._oOverlayCard.layouts.body)};b.prototype._prepareOverlayButtons=function(t){var e=this;var a=new l(this.getId()+"-closeButton",{text:this._rb.getText("NOTETAKERCARD_BUTTON_CLOSE_OVERLAY"),tooltip:this._rb.getText("NOTETAKERCARD_BUTTON_CLOSE_OVERLAY_TOOLTIP"),press:function(){e._handleOverlayCloseEvent(e._oOverlayCard)}});a.addStyleClass("sapSuiteUiCommonsNoteTakerCardOverlayButtonClose");var o=new l(this.getId()+"-saveButton",{text:this._rb.getText("NOTETAKERCARD_BUTTON_SAVE_TEXT"),tooltip:this._rb.getText("NOTETAKERCARD_BUTTON_SAVE_TOOLTIP"),press:function(){e._fnSave()}});o.addStyleClass("sapSuiteUiCommonsNoteTakerCardOverlayButtonSave");e._oOverlayCard.layouts.buttons.addContent(a,0);e._oOverlayCard.layouts.buttons.addContent(o,1);if(t){o.setEnabled(true);this._fnCreateInEditMode()}else{o.setEnabled(false);this._fnCreateInViewMode()}this._oOverlayCard.addContent(this._oOverlayCard.layouts.buttons)};b.prototype._fnCreateInViewMode=function(){var t=this;t._oOverlayCard.bEditMode=false;var e=new h(t.getId()+"-overlayCardHeader",{text:t.getHeader()});e.addStyleClass("sapSuiteUiCommonsNoteTakerCardTitle");t._oOverlayCard.layouts.headerLeft.insertContent(e,0);var a=new C(t.getId()+"-overlayTagPanel");a.setContent(t._wrapTagPanelToDiv(t._getFormattedTags(),t._oOverlayCard.bEditMode));t._oOverlayCard.layouts.toolbarLeft.addContent(a);var o=new C({id:t.getId()+"-overlay-thumb",content:t._wrapThumbToDiv()});t._oOverlayCard.layouts.toolbarRight.addContent(o);var r=new C(t.getId()+"-overlayBody");r.setContent(t._wrapBodyToDiv(t._getFormattedBody()));r.addStyleClass("sapSuiteUiCommonsNoteTakerCardBody");t._oOverlayCard.layouts.body.addContent(r);var s=t._oOverlayCard.layouts.buttons.getContent()[1];s.setEnabled(false);var n=t._oOverlayCard.layouts.headerRight.getContent()[0];n.setEnabled(true);n.removeStyleClass("sapSuiteUiCommonsNoteTakerCardEditButtonDsbl");n.addStyleClass("sapSuiteUiCommonsNoteTakerCardEditButton")};b.prototype._fnCreateInEditMode=function(){var a=this;a._oOverlayCard.bEditMode=true;var o=new T(a.getId()+"-overlayCardTitle",{maxLength:50});o.setValue(a.getHeader());o.addStyleClass("sapSuiteUiCommonsNoteTakerCardTitle");var r=new _(a.getId()+"-overlayCardTitleEdit",{content:o,tooltip:a._rb.getText("NOTETAKERCARD_EDITFIELD_TITLE_TOOLTIP"),design:e.TextViewDesign.H2,undoEnabled:false});r.addStyleClass("sapSuiteUiCommonsNtcdTitleEdit");a._oOverlayCard.layouts.headerLeft.insertContent(r,0);var s=new C(a.getId()+"-overlayTagPanel");s.setContent(a._wrapTagPanelToDiv(a._getFormattedTags(),a._oOverlayCard.bEditMode));a._oOverlayCard.layouts.toolbarLeft.addContent(s);var n=new l({id:a.getId()+"-tag-button",tooltip:a._rb.getText("NOTETAKERCARD_BUTTON_TAG_TOOLTIP"),press:function(){a._toggleTagPopup()}});n.addStyleClass("sapSuiteUiCommonsNoteTakerFeederTagButton");var i=new g({id:a.getId()+"-tagListBox",visibleItems:10,width:"100%",height:"194px",select:function(t){a._handleListSelect(t)}});var d=new T({id:a.getId()+"-inputTag",liveChange:function(t){a._handleTagInputLive(t)}});d.onsapdown=function(e){e.preventDefault();e.stopPropagation();t("#"+a.getId()+"-tagListBox li:eq(0)").focus()};var u=new l({id:a.getId()+"-cancel-tags-button",text:a._rb.getText("NOTETAKERFEEDER_BUTTON_CANCEL_TAGS"),tooltip:a._rb.getText("NOTETAKERFEEDER_BUTTON_CANCEL_TAGS_TOOLTIP"),press:function(){a._toggleTagPopup()}});u.addStyleClass("sapSuiteUiCommonsNoteTakerFeederCancelTagButton");var y=new l({id:a.getId()+"-add-tags-button",text:a._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TAGS"),tooltip:a._rb.getText("NOTETAKERFEEDER_BUTTON_ADD_TAGS_TOOLTIP"),press:function(){a._handleAddTag(d.getValue());n.rerender();a._toggleTagPopup()}});a._oOverlayCard._tagControls={tagButton:n,tagList:i,tagInput:d,tagCancelBtn:u,tagApplyBtn:y};a._oOverlayCard.addContent(a._createTagSelectorControl());var p=new l({id:a.getId()+"-overlay-thumb-up-button",press:function(t){a._oOverlayCard.bThumbUp=!a._oOverlayCard.bThumbUp;if(a._oOverlayCard.bThumbUp){a._oOverlayCard.bThumbDown=false}c()},tooltip:a._rb.getText("NOTETAKERFEEDER_BUTTON_THUMB_UP_TOOLTIP")});p.addStyleClass("sapSuiteUiCommonsNoteTakerThumbUpBtn");var m=new l({id:a.getId()+"-overlay-thumb-down-button",press:function(t){a._oOverlayCard.bThumbDown=!a._oOverlayCard.bThumbDown;if(a._oOverlayCard.bThumbDown){a._oOverlayCard.bThumbUp=false}c()},tooltip:a._rb.getText("NOTETAKERFEEDER_BUTTON_THUMB_DOWN_TOOLTIP")});m.addStyleClass("sapSuiteUiCommonsNoteTakerThumbDownBtn");function c(){if(a._oOverlayCard.bThumbUp){p.addStyleClass("sapSuiteUiCommonsNoteTakerCardSelectedBtn");a._oOverlayCard.addStyleClass("suiteUiNtcPositiveCard")}else{p.removeStyleClass("sapSuiteUiCommonsNoteTakerCardSelectedBtn");a._oOverlayCard.removeStyleClass("suiteUiNtcPositiveCard")}if(a._oOverlayCard.bThumbDown){m.addStyleClass("sapSuiteUiCommonsNoteTakerCardSelectedBtn");a._oOverlayCard.addStyleClass("suiteUiNtcNegativeCard")}else{m.removeStyleClass("sapSuiteUiCommonsNoteTakerCardSelectedBtn");a._oOverlayCard.removeStyleClass("suiteUiNtcNegativeCard")}t(document.getElementById(p.getId())).attr("aria-pressed",a._oOverlayCard.bThumbUp);t(document.getElementById(m.getId())).attr("aria-pressed",a._oOverlayCard.bThumbDown)}c();a._oOverlayCard.layouts.toolbarLeft.insertContent(n,0);a._oOverlayCard.layouts.toolbarRight.addContent(p);a._oOverlayCard.layouts.toolbarRight.addContent(m);var O=a._oOverlayCard.layouts.buttons.getContent()[1];O.setEnabled(true);var b=new v(a.getId()+"-overlayBody",{required:true,liveChange:function(t){var e=t.getParameter("liveValue");var a=e!==null&&!/^\s*$/.test(e);if(a!==O.getEnabled()){O.setEnabled(a)}}});b.setValue(a.getBody());b.addStyleClass("sapSuiteUiCommonsNoteTakerCardBody");a._oOverlayCard.layouts.body.addContent(b);a._oOverlayCard.layouts.body.addContent(new h({required:true}).addStyleClass("sapSuiteRequiredLbl"));var f=a._oOverlayCard.layouts.headerRight.getContent()[0];f.setEnabled(false);f.removeStyleClass("sapSuiteUiCommonsNoteTakerCardEditButton");f.addStyleClass("sapSuiteUiCommonsNoteTakerCardEditButtonDsbl")};b.prototype._fnSave=function(){var e=this;var a=e._oOverlayCard.layouts.headerLeft.getContent()[0];var o=a.getContent();var r=e._oOverlayCard.layouts.body.getContent()[0];if(r.getValue()){if(!this.getBinding("body")){e.setHeader(o.getValue());e.setBody(r.getValue());e.setTimestamp(new Date);e.setThumbUp(e._oOverlayCard.bThumbUp);e.setThumbDown(e._oOverlayCard.bThumbDown);e.setTags(e._oOverlayCard._selectedTags)}var s={};s.uid=e.getUid();s.title=o.getValue();s.body=r.getValue();s.timestamp=new Date;s.thumbUp=e._oOverlayCard.bThumbUp;s.thumbDown=e._oOverlayCard.bThumbDown;s.tags=e._oOverlayCard._selectedTags;e.fireEditNote(s);e._oOverlayCard.layouts.headerLeft.removeContent(a);a.destroy();o.destroy();e._oOverlayCard.layouts.body.removeAllContent();r.destroy();e._destroyTagControls();e._oOverlayCard.layouts.toolbarLeft.destroyContent();e._oOverlayCard.layouts.toolbarRight.destroyContent();e._fnCreateInViewMode();t(document.getElementById(e.getId()+"-overlayTimestamp")).html(e.getFormattedTimestamp());t(document.getElementById(e.getId()+"-overlay-close")).focus()}};b.prototype._fnEdit=function(){var t=this;var e=t._oOverlayCard.layouts.headerLeft.getContent()[0];var a=t._oOverlayCard.layouts.body.getContent()[0];t._oOverlayCard.layouts.topSection.removeContent(e);e.destroy();t._oOverlayCard.layouts.body.removeContent(a);a.destroy();t._oOverlayCard.layouts.toolbarLeft.destroyContent();t._oOverlayCard.layouts.toolbarRight.destroyContent();t._fnCreateInEditMode();t._oOverlayCard.layouts.topSection.rerender();t._oOverlayCard.layouts.body.rerender();if(t.getId()+"-overlayBody"?window.document.getElementById(t.getId()+"-overlayBody"):null){(t.getId()+"-overlayBody"?window.document.getElementById(t.getId()+"-overlayBody"):null).focus()}};b.prototype._handleAttachmentDownload=function(){var t={};t.uid=this._ntc.getUid();t.url=this._ntc.getAttachmentUrl();t.filename=this._ntc.getAttachmentFilename();this._ntc.fireAttachmentClick(t)};return b});