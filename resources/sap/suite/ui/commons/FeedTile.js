/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/suite/ui/commons/util/FeedItemUtils","sap/base/Log","sap/base/security/encodeCSS","sap/base/security/encodeXML","sap/base/security/URLListValidator","./FeedTileRenderer"],function(e,t,i,s,a,n,r,d,l){"use strict";var u=i.extend("sap.suite.ui.commons.FeedTile",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{displayDuration:{type:"int",group:"Misc",defaultValue:5},displayArticleImage:{type:"boolean",group:"Behavior",defaultValue:true},source:{type:"string",group:"Misc",defaultValue:null},defaultImages:{type:"sap.ui.core.URI[]",group:"Misc",defaultValue:null}},aggregations:{items:{type:"sap.suite.ui.commons.FeedItem",multiple:true,singularName:"item"}},events:{press:{}}}});u.prototype.init=function(){this._currentItemIndex=0;this._stagedModel=null;this._defaultImageIndex=-1};u.prototype.cycle=function(){if(this._stagedModel){a.debug("FeedTile: Updating news tile with new model");this.setModel(this._stagedModel);this._stagedModel=null;var t=this.getItems().length;if(this._currentItemIndex>=t){this._currentItemIndex=0}return}var i=this.getItems();this._currentItemIndex=(this._currentItemIndex+1)%i.length;var s=e("#"+this.getId()+"-next-feedTileImage");var n=e("#"+this.getId()+"-feedTileImage");if(e.support.cssTransitions){s.addClass("sapSuiteFTItemRight").removeClass("sapSuiteFTItemHidden");n.addClass("sapSuiteFTItemCenter");setTimeout(function(){var t=false;var i=null;i=function(){e(this).off("webkitTransitionEnd transitionend");if(!t){t=true}else{s.removeClass("sapSuiteFTItemSliding");n.removeClass("sapSuiteFTItemSliding").addClass("sapSuiteFTItemHidden").removeClass("sapSuiteFTItemLeft").addClass("sapSuiteFTItemRight");n.detach();s.after(n);this.flipIds(s,n);setTimeout(function(){this.setNextItemValues(this)}.bind(this),100);this._timeoutId=setTimeout(function(){this.cycle()}.bind(this),this.getDisplayDuration()*1e3)}};n.on("webkitTransitionEnd transitionend",i.bind(this));s.on("webkitTransitionEnd transitionend",i.bind(this));n.addClass("sapSuiteFTItemSliding").removeClass("sapSuiteFTItemCenter").addClass("sapSuiteFTItemLeft");s.addClass("sapSuiteFTItemSliding").removeClass("sapSuiteFTItemRight").addClass("sapSuiteFTItemCenter")}.bind(this),60)}else{s.css("left","100%");s.removeClass("sapSuiteFTItemHidden");s.animate({left:"0%"},400);n.animate({left:"-100%"},400,function(){n.addClass("sapSuiteFTItemHidden");n.css("left","0");this.flipIds(s,n);setTimeout(function(){this.setNextItemValues(this)}.bind(this),100);this._timeoutId=setTimeout(function(){this.cycle()}.bind(this),this.getDisplayDuration()*1e3)}.bind(this))}};u.prototype.onAfterRendering=function(){var e=this.getDisplayDuration()*1e3;if(this.getItems().length>1){if(typeof this._timeoutId==="number"){clearTimeout(this._timeoutId);delete this._timeoutId}this._timeoutId=setTimeout(function(){this.cycle()}.bind(this),e)}};u.prototype.onclick=function(e){var t=this.getCurrentItem();var i="";if(t&&t.getId()){i=t.getId()}this.firePress({itemId:i})};u.prototype.getCurrentItem=function(){var e=this.getItems();if(e.length){return e[this._currentItemIndex]}};u.prototype.getNextItem=function(){var e=this.getItems();if(e.length&&e.length>1){return e[(this._currentItemIndex+1)%e.length]}};u.prototype.setNextItemValues=function(){var t=this.getNextItem();var i=this.getId();var a=t.getImage();if(!a||!this.getDisplayArticleImage()){a=this.getDefaultImage()}e("#"+i+"-next-feedTileImage").css("background-image","url("+n(a)+")");e("#"+i+"-next-feedTileTitle").html(r(t.getTitle()));e("#"+i+"-next-feedTileSource").html(r(t.getSource()));e("#"+i+"-next-feedTileAge").html(r(s.calculateFeedItemAge(t.getPublicationDate())));return this};u.prototype.flipIds=function(e,t){var i=this.getId();t.attr("id",i+"-next-feedTileImage");t.find("#"+i+"-feedTileText").attr("id",i+"-next-feedTileText");t.find("#"+i+"-feedTileTitle").attr("id",i+"-next-feedTileTitle");t.find("#"+i+"-feedTileSource").attr("id",i+"-next-feedTileSource");t.find("#"+i+"-feedTileAge").attr("id",i+"-next-feedTileAge");e.attr("id",i+"-feedTileImage");e.find("#"+i+"-next-feedTileText").attr("id",i+"-feedTileText");e.find("#"+i+"-next-feedTileTitle").attr("id",i+"-feedTileTitle");e.find("#"+i+"-next-feedTileSource").attr("id",i+"-feedTileSource");e.find("#"+i+"-next-feedTileAge").attr("id",i+"-feedTileAge")};u.prototype.setDisplayDuration=function(e){if(e<3){e=3;a.error("FeedTile: displayDuration should be equal or more than 3 seconds.")}this.setProperty("displayDuration",e);return this};u.prototype.stageModel=function(e){this._stagedModel=e};u.prototype.getDefaultImage=function(){var e="";var t=this.getDefaultImages();if(t&&t.length>0){var i=t.length;if(this._defaultImageIndex===-1){var s=Math.floor(Math.random()*i);this._defaultImageIndex=s;e=t[s]}else{var a=this._defaultImageIndex+1>=i?0:this._defaultImageIndex+1;this._defaultImageIndex=a;e=t[a]}}return e};u.prototype.setDefaultImages=function(e){if(e&&e.length>0){var t=[];var i=null;for(var s=0;s<e.length;s++){i=e[s];var n=d.validate(i);if(n){t.push(i)}else{a.error("Invalid Url:'"+i)}}if(t.length<=0){a.error("Default Images are not set because supplied Urls are invalid")}else{this.setProperty("defaultImages",t)}}return this};return u});