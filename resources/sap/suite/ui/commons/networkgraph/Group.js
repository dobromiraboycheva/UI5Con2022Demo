/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/commons/library","sap/ui/thirdparty/jquery","./ElementBase","sap/ui/core/IconPool","sap/m/CheckBox"],function(e,t,o,i,s){"use strict";var r=e.networkgraph.ElementStatus,n=e.networkgraph.HeaderCheckboxState;var a={COLLAPSED_HEIGHT:32,COLLAPSED_WIDTH:160,ROUNDING:6,ICON_OFFSET:8,ICON_SIZE:15,HEADER_SIZE:32};var u="expand-all",p="collapse-all",h="horizontal-grip";var l=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var d=o.extend("sap.suite.ui.commons.networkgraph.Group",{metadata:{library:"sap.suite.ui.commons",properties:{headerCheckBoxState:{type:"sap.suite.ui.commons.networkgraph.HeaderCheckboxState",group:"Misc",defaultValue:n.Hidden},key:{type:"string",group:"Misc",defaultValue:null},collapsed:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Appearance",defaultValue:null},minWidth:{type:"float",defaultValue:undefined},parentGroupKey:{type:"string",group:"Misc",defaultValue:null}},events:{headerCheckBoxPress:{parameters:{checked:"boolean"}},collapseExpand:{},showDetail:{}},aggregations:{_checkBox:{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(e,t){t._render({renderManager:e})}},onAfterRendering:function(){this._afterRenderingBase()}});d.prototype.aProcessRequiredProperties=["key","parentGroupKey"];d.BUTTONS={MENU:"menu",COLLAPSE:"collapse"};d.prototype.init=function(){this._iWidth=a.COLLAPSED_WIDTH;this._iHeight=a.COLLAPSED_HEIGHT;this._oActionButtons={};this._clearChildren();this._bIsHidden=false};d.prototype._afterRendering=function(){this._setupEvents();if(!this._isVisible()){this.$().hide()}if(this.$().find(".sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner").length!==0){this.$().find(".sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner").attr("aria-label",this.getTitle())}this._removeFromInvalidatedControls()};d.prototype._renderTopGroup=function(e){var t=this._getElementId(e.idSufix),o=this._iTopGroupIndex===0,i=e.renderManager;var s=this.getIcon(),r=this.getTitle();var n=this._iTopGroupIndex*50;if(this.getParent()._bIsRtl){o=!o;n=o?0:50}if(o){i.openStart("div").class("sapSuiteUiCommonsNetworkTopGroupDelimiter").openEnd().close("div")}this._renderHtmlElement("div",{top:0,left:n+"%",width:"50%",height:"32px"},{id:t,"data-sap-ui":t,class:"sapSuiteUiCommonsNetworkTopGroup "+(!o?"sapSuiteUiCommonsNetworkTopGroupRight":"")},i);i.openStart("div").class("sapSuiteUiCommonsNetworkTopGroupHeader").openEnd();if(s){this._renderHtmlIcon(s,null,null,null,null,i)}if(r){i.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderTitle").openEnd().text(r).close("div")}i.close("div");i.close("div")};d.prototype._render=function(e){var t=this.getParent(),i=!this.getCollapsed()||this._isCollapsedSwimLane()?this._iHeight:a.HEADER_SIZE,s;e=e||{};if(this._iNestedLevel===0&&t._isTwoColumnsLayout()){this._renderTopGroup(e);return""}if(this._isIgnored()||!this.getVisible()){return""}if(this.getParent()._isLayered()){s=this._getElementId(e.idSufix);var r=this._convertToStyle({top:this.getY()+"px",left:this.getX()+"px",width:this._iWidth+"px",height:i+"px"},this._getStatusStyle({"border-color":o.ColorType.Border,"border-width":o.ColorType.BorderWidth,"border-style":o.ColorType.BorderStyle}),true);this._renderHtmlElement("div",{},{id:s,"data-sap-ui":s,class:this._getGroupClass(),style:r},e.renderManager);this._renderHeader(e);e.renderManager.close("div")}};d.prototype._renderHeader=function(e){var t=this.getIcon(),i=this.getTitle();var s="",n="",a="",d="";if(this.getStatus()&&this.getStatus()!==r.Standard){a=this._getStatusStyle({color:o.ColorType.Content},true);d=this._getStatusStyle({color:o.ColorType.Content},false);if(this._bIsSwimLane){s=this._getStatusStyle({"background-color":o.ColorType.Background},false)}else{n=this._getStatusStyle({"background-color":o.ColorType.Background,"border-color":o.ColorType.Background},false)}}e.renderManager.openStart("div");this.applyStyles(e.renderManager,this.getStyleObject(n));e.renderManager.class("sapSuiteUiCommonsNetworkGroupHeader").openEnd();if(this._bIsSwimLane&&(s||this._hasDefaultStatus())){e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderStatus").openEnd();this.applyStyles(e.renderManager,this.getStyleObject(s));e.renderManager.close("div")}e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderInner").class("sapSuiteUiCommonsNetworkGroupHeaderInnerText").openEnd();if(this._showHeaderCheckBox()){this._renderClonedControl(e,this._getHeaderCheckbox())}if(t){this._renderHtmlIcon(t,"sapSuiteUiCommonsNetworkGroupHeaderIcon",null,a,null,e.renderManager)}if(i){e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderTitle");var c=sap.ui.getCore().getConfiguration().getLanguage();var f=["ja","zh_TW","zh_CN","ko"];if(this._isVerticalSwimLane()&&f.indexOf(c)>-1){d=d.length>0?d.concat(";text-orientation:sideways"):d.concat("text-orientation:sideways")}this.applyStyles(e.renderManager,this.getStyleObject(d));e.renderManager.openEnd();e.renderManager.text(i);e.renderManager.close("div")}e.renderManager.close("div");e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderInner").class("sapSuiteUiCommonsNetworkGroupHeaderInnerIcons").openEnd();this._renderHtmlIcon(this.getCollapsed()?u:p,"sapSuiteUiCommonsNetworkGroupHeaderMenuIcon","collapse",a,l.getText("NETWORK_GRAPH_EXPAND_COLLAPSE"),e.renderManager);this._renderHtmlIcon(h,"sapSuiteUiCommonsNetworkGroupHeaderMenuIcon","menu",a,l.getText("NETWORK_GRAPH_GROUP_DETAILS"),e.renderManager);e.renderManager.close("div");e.renderManager.close("div")};d.prototype._getGroupClass=function(){return"sapSuiteUiCommonsNetworkGroup "+this._getStatusClass()+(this.getCollapsed()?"sapSuiteUiCommonsNetworkGroupCollapsed":"sapSuiteUiCommonsNetworkGroupExpanded")+(this._bIsSwimLane?" sapSuiteUiCommonsNetworkGroupSwimLane":" sapSuiteUiCommonsNetworkGroupClassic")+(this._isVerticalSwimLane()?" sapSuiteUiCommonsNetworkGroupVerticalSwimLane":"")+(this._isTopBottom()?" sapSuiteUiCommonsNetworkGroupTopBottom ":"")};d.prototype.getChildNodes=function(){this._checkForProcessData();return this.aChildren};d.prototype.getChildLines=function(){this._checkForProcessData();return this.aLines};d.prototype.getParentNodes=function(){this._checkForProcessData();return this.aParents};d.prototype.getParentLines=function(){this._checkForProcessData();return this.aParentLines};d.prototype.getNodes=function(){this._checkForProcessData();return this.aNodes};d.prototype.isHidden=function(){return this._bIsHidden};d.prototype.setHidden=function(e){this.$()[e?"hide":"show"]();this._bIsHidden=e};d.prototype.getHeaderCheckbox=function(){return this._getHeaderCheckbox()};d.prototype._getHeaderCheckbox=function(){var e=this.getAggregation("_checkBox"),t=this;if(!e){e=new s(this.getId()+"-checkbox",{select:function(o){var i=e.getSelected();t.fireHeaderCheckBoxPress({checked:i})}}).addStyleClass("sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner");this.setAggregation("_checkBox",e,true)}return e};d.prototype._isCollapsedSwimLane=function(){return this._bIsSwimLane&&this.getCollapsed()};d.prototype._clearChildren=function(){this.aNodes=[];this.aLines=[];this.aChildren=[];this.aParentLines=[];this.aParents=[];this.aChildGroups=[]};d.prototype._hasVisibleNodes=function(e){var t=this.aNodes.some(function(e){return!e._bIsHidden});if(!t){for(var o=0;o<this.aChildGroups.length;o++){if(this.aChildGroups[o]._hasVisibleNodes()){return true}}}return t};d.prototype._hasNodes=function(){var e=this.aNodes.some(function(e){return e._useInLayout()});if(!e){e=this.aChildGroups.some(function(e){return e._hasNodes()})}return e};d.prototype._hideShow=function(e){this.$()[e?"hide":"show"]();this._bIsHidden=e;var t=this._oParentGroup;while(t){var o=t._hasVisibleNodes();if(o&&!e||!o&&e){t._hideShow(e)}else{break}t=t._oParentGroup}};d.prototype._setButtonFocus=function(e,t){var o=t?"addClass":"removeClass";e[o]("sapSuiteUiCommonsNetworkElementFocus")};d.prototype._setMenuButtonFocus=function(e){this._setButtonFocus(t(this._oActionButtons.menu),e)};d.prototype._setCollapseButtonFocus=function(e){this._setButtonFocus(t(this._oActionButtons.collapse),e)};d.prototype._setupEvents=function(){var e=this.$("menu"),i=this.$("header"),s=this.$("collapse"),r=this.$().find(".sapSuiteUiCommonsNetworkGroupHeaderMenuIcon");this._oActionButtons.menu=e[0];this._oActionButtons.collapse=s[0];s.off("click");e.off("click");i.off("click");r.off("mouseover");r.off("mouseout");e.on("click",function(e){var t=this.fireEvent("showDetail",{},true);if(t){this._openDetail()}if(this.getParent()){this.getParent().setFocus({item:this,button:d.BUTTONS.MENU})}this._setMenuButtonFocus(false)}.bind(this));s.on("click",function(e){this._collapse();if(this.getParent()){this.getParent().setFocus({item:this,button:d.BUTTONS.COLLAPSE})}}.bind(this));i.on("click",function(e){if(this.getParent()){this.getParent().setFocus({item:this})}this.firePress()}.bind(this));var n=function(e,t,o){if(!this._bIsSwimLane){e.css("background-color",this._getColor(t))}e.css("color",this._getColor(o))}.bind(this);r.on("mouseover",function(e){n(t(e.currentTarget),o.ColorType.HoverBackground,o.ColorType.HoverContent)});r.on("mouseout",function(e){n(t(e.currentTarget),o.ColorType.Background,o.ColorType.Content)})};d.prototype._collapse=function(){this.getParent()._selectElementAfterScroll=this;this.fireEvent("collapseExpand",{},true);this.setCollapsed(!this.getCollapsed())};d.prototype._openDetail=function(){var e=this.$("menu");this.getParent()._tooltip.openDetail({item:this,opener:e[0]})};d.prototype._isEmpty=function(){return this.aNodes.length===0};d.prototype._isIgnored=function(){if(!this._useInLayout()){return true}return!this._hasNodes()};d.prototype._isVisible=function(){var e=this._bIsSwimLane||this.aNodes.some(function(e){return!e.isHidden()});if(!e){e=this.aChildGroups.some(function(e){return e._isVisible()})}return e};d.prototype._useInLayout=function(){return!this._oCollapsedByParent};d.prototype._resetSize=function(){if(this.getCollapsed()){this._iHeight=a.COLLAPSED_HEIGHT}};d.prototype._getAccessibilityLabel=function(){return l.getText("NETWORK_GRAPH_GROUP")+" "+this.getTitle()};d.prototype._isTopBottom=function(){var e=this.getParent();return e&&e._isTopBottom()};d.prototype._isVerticalSwimLane=function(){if(this._bIsSwimLane){var e=this._isTopBottom();return e&&!this.getCollapsed()||!e&&this.getCollapsed()}return false};d.prototype._isCollapsed=function(){return this.getCollapsed()||!!this._oCollapsedByParent};o.prototype._showHeaderCheckBox=function(){return this.getHeaderCheckBoxState()!==n.Hidden};d.prototype._getBorderSize=function(){return 1};d.prototype._setFocus=function(e){this._setMenuButtonFocus(e)};d.prototype._isOnScreen=function(e,t,i,s){var r=this.getX(),n=this.getY();return o._isRectOnScreen(r,r+this._iWidth,n,n+this._iHeight,e,t,i,s)};d.prototype.getHeaderCheckBoxState=function(){if(this.getProperty("headerCheckBoxState")===n.Hidden){return n.Hidden}return this.getHeaderCheckbox().getSelected()?n.Checked:n.Unchecked};d.prototype.setHeaderCheckBoxState=function(e){this._setHeaderCheckBoxState(e);return this};d.prototype.setX=function(e){this.fX=e;return this};d.prototype.getX=function(){return this.fX};d.prototype.setY=function(e){this.fY=e;return this};d.prototype.getY=function(){return this.fY};d.prototype._setCollapsed=function(e,t){var o=this;var i=this.getParent(),s=[];var r=function(t){t.aChildGroups.forEach(function(e){r(e)});if(o!==t){if(!t._oCollapsedByParent||t._oCollapsedByParent===o){t._oCollapsedByParent=e?o:null}}};var n=function(t){if(e){this.getNodes().forEach(function(e){if(e.getSelected()){e.setSelected(false);s.push(e)}});this.getChildLines().forEach(function(e){if(e.getSelected()&&e._isInCollapsedGroup()){e.setSelected(false);s.push(e)}})}}.bind(this);if(e!==this.getCollapsed()||t){this.setProperty("collapsed",e,true);if(e){this.getNodes().forEach(function(e){if(e.getSelected()){e.setSelected(false);s.push(e)}});this.getChildLines().forEach(function(e){if(e.getSelected()&&e._isInCollapsedGroup()){e.setSelected(false);s.push(e)}})}this.aChildGroups.forEach(function(e){n(e)});r(this);if(i&&s.length>0){i.fireSelectionChange({items:s})}if(i&&i._bIsLayedOut){i.invalidate()}}};d.prototype.setCollapsed=function(e){this._setCollapsed(e,false);return this};d.prototype.setVisible=function(e){this.setProperty("visible",e);var t=this.getParent();if(t&&t._bIsLayedOut&&!this.getCollapsed()){this.aNodes.forEach(function(t){if(!e){t.$().hide()}else if(!t._bIsHidden){t.$().show()}})}return this};return d});