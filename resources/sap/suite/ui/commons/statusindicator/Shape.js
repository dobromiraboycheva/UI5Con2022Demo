/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","../library","sap/ui/core/Control","sap/suite/ui/commons/util/HtmlElement","sap/suite/ui/commons/statusindicator/util/ThemingUtil","sap/base/Log"],function(t,i,e,n,r,o){"use strict";var l=i.statusindicator.FillingType;var a=i.statusindicator.FillingDirectionType;var s=i.statusindicator.VerticalAlignmentType;var u=i.statusindicator.HorizontalAlignmentType;var g=e.extend("sap.suite.ui.commons.statusindicator.Shape",{metadata:{abstract:true,library:"sap.suite.ui.commons",properties:{fullAnimationDuration:{type:"int",defaultValue:0},fillColor:{type:"sap.m.ValueCSSColor",defaultValue:"Neutral"},animationOnStartup:{type:"boolean",defaultValue:false},animationOnChange:{type:"boolean",defaultValue:true},animationOnStartupDelay:{type:"int",defaultValue:0},fillingDirection:{type:"sap.suite.ui.commons.statusindicator.FillingDirectionType",defaultValue:a.Up},fillingType:{type:"sap.suite.ui.commons.statusindicator.FillingType",defaultValue:l.Linear},fillingAngle:{type:"int",defaultValue:undefined},verticalAlignment:{type:"sap.suite.ui.commons.statusindicator.VerticalAlignmentType",defaultValue:s.Middle},horizontalAlignment:{type:"sap.suite.ui.commons.statusindicator.HorizontalAlignmentType",defaultValue:u.Middle}}},renderer:null});g.prototype.GRADIENT_ID="gradient";g.prototype.STOP_ID="stop";g.prototype.getDisplayedValue=function(){o.fatal("Must be overridden!")};g.prototype._setInitialValue=function(t){o.fatal("Must be overridden!")};g.prototype._updateDom=function(t,i){o.fatal("Must be overridden!")};g.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this,arguments)}this._oAnimationPropertiesResolver=null};g.prototype.onBeforeRendering=function(){if(e.prototype.onBeforeRendering){e.prototype.onBeforeRendering.apply(this,arguments)}this._clearBoundingBox()};g.prototype._getCssFillColor=function(){return r.resolveColor(this.getFillColor())};g.prototype._resolveFillColor=function(){return this._oAnimationPropertiesResolver.getColor(this,this.getDisplayedValue())};g.prototype._injectAnimationPropertiesResolver=function(t){this._oAnimationPropertiesResolver=t};g.prototype.getDisplayedFillColor=function(t){return this._oAnimationPropertiesResolver.getColor(this,t)};g.prototype.getFullAnimationDuration=function(){return 250};g.prototype._buildPreserveAspectRatioAttribute=function(){var t="x";switch(this.getHorizontalAlignment()){case u.Left:t+="Min";break;case u.Middle:t+="Mid";break;case u.Right:t+="Max";break}t+="Y";switch(this.getVerticalAlignment()){case s.Top:t+="Min";break;case s.Middle:t+="Mid";break;case s.Bottom:t+="Max";break}t+=" meet";return t};g.prototype._getGradientElement=function(t){var i=new n(this.getFillingType()===l.Linear?"linearGradient":"radialGradient");i.setId(this._buildIdString(this.getId(),this.GRADIENT_ID));if(this.getFillingType()===l.Linear){var e=this.computeLinearFillingAngle();i.setAttribute("x1",e===90?1:0);i.setAttribute("y1",e===0?1:0);i.setAttribute("x2",e===270?1:0);i.setAttribute("y2",e===180?1:0)}var r=this._getDisplayedGradientOffset(t);var o=new n(this.STOP_ID);o.setAttribute("offset",r);o.setAttribute("stop-color","white");i.addChild(o);var a=new n(this.STOP_ID);a.setAttribute("offset",r);a.setAttribute("stop-color","transparent");i.addChild(a);return i};g.prototype.getPolygonElement=function(t){var i=new n("polygon");i.setId(this._buildIdString(this.getId(),"polygon"));i.setAttribute("fill","white");return i};g.prototype.computeLinearFillingAngle=function(){if(this.getFillingAngle()!==undefined){return this._getNormalizedFillingAngle()}switch(this.getFillingDirection()){case a.Up:return 0;case a.Down:return 180;case a.Left:return 90;case a.Right:return 270;default:o.error("Unknown FillingDirection '"+this.getFillingDirection()+"'");return 0}};g.prototype._useGradientForAnimation=function(){var t=this._getNormalizedFillingAngle();var i=this.getFillingType();return i===l.Radial||i===l.Linear&&(t===undefined||[0,90,180,270].indexOf(t)>-1)};g.prototype._getPolygonPoints=function(t){var i;switch(this.getFillingType()){case l.Linear:i=this._getPolygonPointsForLinearFilling(t);break;case l.Circular:i=this._getPolygonPointsForCircularFilling(t);break;default:o.error("Unknown FillingType '"+this.getFillingType()+"' given.");i=this._getPolygonPointsForLinearFilling(t)}i=i.map(function(t){t.x=Number(t.x.toFixed(3));t.y=Number(t.y.toFixed(3));return t});return i};g.prototype._getPolygonPointsForLinearFilling=function(t){var i=180-this._getNormalizedFillingAngle();var e=Math.tan(i*Math.PI/180);var n=this._getBoundingPoints();var r=n.start;var o=n.end;var l=r.y-e*r.x;var a=o.y-e*o.x;var s=l+(a-l)/100*t;var u=r.x;var g=u*e+s;var p=r.y;var d=(p-s)/e;var h=[r,{x:u,y:g},{x:d,y:p}];return h};g.prototype._getPolygonPointsForCircularFilling=function(t){var i=this,e=3.6*t,n=this._getBoundingBox(),r=[];var o,l,s;var u=p(n.x+n.width/2,n.y);var g=p(n.x+n.width/2,n.y+n.height/2);function d(t){var e=Object.assign({},t);if(i.getFillingDirection()===a.CounterClockwise){var n=t.x-g.x;e.x=g.x-n}return e}function h(t,i,e){var n=Math.tan((i-t)*Math.PI/180);return n*e/2}r.push(u);if(0<e&&e<45){o=h(e,0,n.height);s=p(u.x-o,u.y);r.push(d(s))}if(45<=e){r.push(d(p(n.x+n.width,n.y)))}if(45<e&&e<135){l=h(e,90,n.width);s=p(n.x+n.width,n.y+n.height/2-l);r.push(d(s))}if(135<=e){r.push(d(p(n.x+n.width,n.y+n.height)))}if(135<e&&e<225){o=h(e,180,n.height);s=p(n.x+n.width/2+o,n.y+n.height);r.push(d(s))}if(225<=e){r.push(d(p(n.x,n.y+n.height)))}if(225<e&&e<315){l=h(e,270,n.width);s=p(n.x,n.y+n.height/2+l);r.push(d(s))}if(315<=e){r.push(d(p(n.x,n.y)))}if(315<e&&e<=360){o=h(e,360,n.height);s=p(n.x+n.width/2-o,n.y);r.push(d(s))}r.push(g);return r};g.prototype._isFillingAngleInFirstQuadrant=function(){var t=this._getNormalizedFillingAngle();return 0<t&&t<90};g.prototype._isFillingAngleInSecondQuadrant=function(){var t=this._getNormalizedFillingAngle();return 90<t&&t<180};g.prototype._isFillingAngleInThirdQuadrant=function(){var t=this._getNormalizedFillingAngle();return 180<t&&t<270};g.prototype._isFillingAngleInForthQuadrant=function(){var t=this._getNormalizedFillingAngle();return 270<t&&t<360};g.prototype._getBoundingPoints=function(){var t=this._getBoundingBox();var i=t.x+t.width;var e=t.y+t.height;var n=t.x;var r=t.y;if(this._isFillingAngleInFirstQuadrant()){}else if(this._isFillingAngleInSecondQuadrant()){i=t.x+t.width;e=t.y;n=t.x;r=t.y+t.height}else if(this._isFillingAngleInThirdQuadrant()){i=t.x;e=t.y;n=t.x+t.width;r=t.y+t.height}else if(this._isFillingAngleInForthQuadrant()){i=t.x;e=t.y+t.height;n=t.x+t.width;r=t.y}else{o.error("Invalid call of _getBoundingPoints. FillingAngle '"+this.getFillingAngle()+"' is not in any quadrant")}return{start:p(i,e),end:p(n,r)}};g.prototype._getBoundingBox=function(){if(!this._oBoundingBox){this._oBoundingBox=this.$()[0].getBBox()}return this._oBoundingBox};g.prototype._clearBoundingBox=function(){this._oBoundingBox=null};g.prototype._getNormalizedFillingAngle=function(){if(this.getFillingAngle()===undefined){return this.getFillingAngle()}var t=this.getFillingAngle()%360;if(t<0){t+=360}return t};g.prototype.isFillable=function(){return this.getFillingType()!==l.None};g.prototype._getDisplayedGradientOffset=function(t){if(this.isFillable()){var i=t/100;return i}else{return 1}};g.prototype._getMaskElement=function(t){var i=new n("mask");i.setId(t);if(this._useGradientForAnimation()){var e=this._getSimpleShapeElement(this._buildIdString(this.getId(),"mask-shape"));e.setAttribute("stroke-width",0);e.setAttribute("stroke","white");e.setAttribute("fill",this._buildSvgUrlString(this.getId(),this.GRADIENT_ID));i.addChild(e)}else{i.addChild(this.getPolygonElement(this._iDisplayedValue))}return i};g.prototype._buildSvgUrlString=function(){return"url(#"+this._buildIdString.apply(this,arguments)+")"};g.prototype._buildIdString=function(){var i=t.makeArray(arguments).join("-");return i};function p(t,i){return{x:t,y:i}}return g});