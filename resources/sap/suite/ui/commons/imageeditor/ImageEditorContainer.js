sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/suite/ui/commons/library","sap/ui/core/library","sap/m/library","./ImageEditor","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/m/OverflowToolbarLayoutData","sap/m/ToggleButton","sap/m/ToolbarSeparator","sap/m/ToolbarSpacer","sap/m/Label","sap/m/Slider","sap/m/Input","sap/m/CheckBox","sap/ui/model/json/JSONModel","sap/m/MenuButton","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/m/Button","sap/ui/core/Item","sap/m/ResponsivePopover","sap/m/List","sap/m/StandardListItem","sap/m/CustomListItem","sap/m/FlexBox","sap/m/FlexItemData","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/core/Icon","sap/ui/core/HTML","sap/m/Switch","sap/suite/ui/commons/ControlProxy","sap/base/Log","sap/ui/unified/FileUploader","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","./ImageEditorContainerRenderer"],function(t,e,o,i,r,s,a,n,l,p,h,d,u,g,m,c,_,I,y,f,T,C,b,S,M,E,R,O,P,L,A,w,B,v,F,x,G,H,z,D){"use strict";var N=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var Z=r.InputType,k=r.ListType,V=o.ImageEditorMode,U=o.ImageEditorContainerMode,K=o.ImageEditorContainerButton,W=i.ValueState,X=r.ListMode,j=r.ButtonType,Y=r.FlexDirection,$=r.FlexRendertype,J=r.FlexJustifyContent,q=r.FlexAlignItems,Q=r.IconTabDensityMode,tt=r.BackgroundDesign,et=r.SwitchType,ot=i.TextAlign,it=Object.freeze({WIDTH:{min:s.LIMITS.WIDTH_MIN,max:s.LIMITS.WIDTH_MAX,callback:"_setWidth"},HEIGHT:{min:s.LIMITS.HEIGHT_MIN,max:s.LIMITS.HEIGHT_MAX,callback:"_setHeight"},ROTATION:{min:s.LIMITS.ROTATION_MIN,max:s.LIMITS.ROTATION_MAX,callback:"_rotate"},FILTER:{callback:"_applyCurrentFilter"}}),rt=Object.freeze({CUSTOMSIZE:"sap-icon://write-new-document",ORIGINALSIZE:"sap-icon://table-view",ROTATELEFT:"sap-icon://response",ROTATERIGHT:"sap-icon://forward",CROPRECTANGLE:"sap-icon://color-fill",CROPELLIPSE:"sap-icon://circle-task-2",CROPCUSTOMSHAPE:"sap-icon://add-favorite",TRANSFORM:"sap-icon://draw-rectangle",FILTER:"sap-icon://palette",CROP:"sap-icon://crop",UNDO:"sap-icon://undo",DROPDOWN:"sap-icon://slim-arrow-down",ZONES:"sap-icon://tag",LOCK:"sap-icon://locked",RESET:"sap-icon://reset",FLIPVERTICAL:"sap-icon://resize-vertical",FLIPHORIZONTAL:"sap-icon://resize-horizontal",RELATIVE:"sap-icon://resize",ZOOMIN:"sap-icon://zoom-in",ZOOMOUT:"sap-icon://zoom-out",ZOOMFIT:"sap-icon://popup-window"});var st=e.extend("sap.suite.ui.commons.imageeditor.ImageEditorContainer",{metadata:{library:"sap.suite.ui.commons",properties:{mode:{type:"sap.suite.ui.commons.ImageEditorContainerMode",defaultValue:U.Filter},enabledButtons:{type:"sap.suite.ui.commons.ImageEditorContainerButton[]",defaultValue:[K.Filter,K.Transform,K.Crop]}},defaultAggregation:"imageEditor",aggregations:{imageEditor:{type:"sap.suite.ui.commons.imageeditor.ImageEditor",multiple:false,singularName:"imageEditor"},customToolbarControls:{type:"sap.ui.core.Control",multiple:true,singularName:"customToolbarControl"},customResizeItems:{type:"sap.suite.ui.commons.imageeditor.CustomSizeItem",multiple:true,singularName:"customResizeItem"},customRectangleCropItems:{type:"sap.suite.ui.commons.imageeditor.CustomSizeItem",multiple:true,singularName:"customRectangleCropItem"},customEllipseCropItems:{type:"sap.suite.ui.commons.imageeditor.CustomSizeItem",multiple:true,singularName:"customEllipseCropItem"}}}});var at=Object.freeze({NUM_KEPT_ITEMS:2});st.prototype.init=function(){var t={enabled:false,mode:null,zoom:100,transform:{keepAspectRatio:true,width:null,height:null,widthValueState:W.None,widthValueStateText:null,heightValueState:W.None,heightValueStateText:null,rotate:0,rotateValueState:W.None,rotateValueStateText:null,selectedTypeKey:"Resize",flipVertical:false,flipHorizontal:false,resizes:[{key:"custom",text:N.getText("IMGEDITOR_CUSTOM_SIZE"),icon:rt.CUSTOMSIZE,unlockRatio:true},{key:"original",text:N.getText("IMGEDITOR_ORIGINAL_SIZE"),icon:rt.ORIGINALSIZE}],rotates:[{key:"90left",text:N.getText("IMGEDITOR_ROTATE_90LEFT"),rotate:-90,icon:rt.ROTATELEFT},{key:"90right",text:N.getText("IMGEDITOR_ROTATE_90RIGHT"),rotate:90,icon:rt.ROTATERIGHT},{key:"45left",text:N.getText("IMGEDITOR_ROTATE_45LEFT"),rotate:-45,icon:rt.ROTATELEFT},{key:"45right",text:N.getText("IMGEDITOR_ROTATE_45RIGHT"),rotate:45,icon:rt.ROTATERIGHT}],flips:[{key:"vertical",text:N.getText("IMGEDITOR_FLIP_VERTICAL"),icon:rt.FLIPVERTICAL,flipVertical:true,flipHorizontal:false},{key:"horizontal",text:N.getText("IMGEDITOR_FLIP_HORIZONTAL"),icon:rt.FLIPHORIZONTAL,flipVertical:false,flipHorizontal:true}]},crop:{scaleCropArea:false,customShapeLoaded:false,zoom:100,zoomValueState:W.None,zoomValueStateText:null,width:null,widthValueState:W.None,widthValueStateText:null,height:null,heightValueState:W.None,heightValueStateText:null,keepAspectRatio:true,selectedTypeKey:"Rectangle",selectedType:null,enabled:true,areaRectangle:{x:10,y:10,width:80,height:80},types:[{key:"Rectangle",text:"",icon:rt.CROPRECTANGLE,apply:"applyVisibleCrop"},{key:"Ellipse",text:"",icon:rt.CROPELLIPSE,apply:"applyVisibleCrop"},{key:"CustomShape",text:"",icon:rt.CROPCUSTOMSHAPE,apply:"applyVisibleCrop"}],ratiosRectangle:[{key:"custom",text:N.getText("IMGEDITOR_CUSTOM_SIZE"),icon:rt.CUSTOMSIZE,unlockRatio:true,relative:true},{key:"original",text:N.getText("IMGEDITOR_CROP_RATIO_ORIGINAL"),width:null,height:null,icon:rt.ORIGINALSIZE,relative:true}],ratiosCircle:[{key:"custom",text:N.getText("IMGEDITOR_CUSTOM_SIZE"),icon:rt.CUSTOMSIZE,unlockRatio:true,relative:true},{key:"original",text:N.getText("IMGEDITOR_CROP_RATIO_ORIGINAL"),width:null,height:null,icon:rt.ORIGINALSIZE,relative:true}],ratiosCustomShape:[{key:"custom",text:N.getText("IMGEDITOR_CUSTOM_SIZE"),icon:rt.CUSTOMSIZE,unlockRatio:true,relative:true},{key:"original",text:N.getText("IMGEDITOR_CROP_RATIO_ORIGINAL"),callback:"_setCustomShapeCropAreaRatio",icon:rt.ORIGINALSIZE,relative:true}]},filter:{filterValueState:W.None,filterValueStateText:null,selectedFilter:null,filters:[{text:N.getText("IMGEDITOR_FILTER_BRIGHTNESS"),type:"brightness",value:100,defaultValue:100,unit:"%",min:s.LIMITS.BRIGHTNESS_MIN,max:s.LIMITS.BRIGHTNESS_MAX},{text:N.getText("IMGEDITOR_FILTER_CONTRAST"),type:"contrast",value:100,defaultValue:100,unit:"%",min:s.LIMITS.CONTRAST_MIN,max:s.LIMITS.CONTRAST_MAX},{text:N.getText("IMGEDITOR_FILTER_SATURATION"),type:"saturate",value:100,defaultValue:100,unit:"%",min:s.LIMITS.SATURATE_MIN,max:s.LIMITS.SATURATE_MAX},{text:N.getText("IMGEDITOR_FILTER_GRAYSCALE"),type:"grayscale",value:0,defaultValue:0,unit:"%",min:s.LIMITS.GRAYSCALE_MIN,max:s.LIMITS.GRAYSCALE_MAX},{text:N.getText("IMGEDITOR_FILTER_INVERT"),type:"invert",value:0,defaultValue:0,unit:"%",min:s.LIMITS.INVERT_MIN,max:s.LIMITS.INVERT_MAX},{text:N.getText("IMGEDITOR_FILTER_SEPIA"),type:"sepia",value:0,defaultValue:0,unit:"%",min:s.LIMITS.SEPIA_MIN,max:s.LIMITS.SEPIA_MAX}]},history:[],historyIndex:0};this._bFirstTimeRendered=true;this._oObserver=new z(this._onManagedObjectChange.bind(this));this._oObserver.observe(this,{properties:["enabledButtons"],aggregations:["customToolbarControls"]});this._oModel=new I(t);this._oThumbnailCanvas=document.createElement("canvas");this._updateToolbarsContent();this["_setMode"+this.getMode()]()};st.prototype.onBeforeRendering=function(){if(this._sResizeHandlerId){D.deregister(this._sResizeHandlerId)}};st.prototype.onAfterRendering=function(){var t=this;this._bIsSmallSize=this._isSmallSize();function e(){sap.ui.getCore().detachThemeChanged(e);t._zoomToFit()}if(this._bFirstTimeRendered&&this.getImageEditor()){this._bFirstTimeRendered=false;if(sap.ui.getCore().isThemeApplied()){this._zoomToFit()}else{sap.ui.getCore().attachThemeChanged(e)}}this._sResizeHandlerId=D.register(this,this._onResize.bind(this))};st.prototype.onExit=function(){if(this._sResizeHandlerId){D.deregister(this._sResizeHandlerId)}};st.prototype._onResize=function(){var t=this._isSmallSize();if(this._bIsSmallSize!==t){this._bIsSmallSize=t;this.rerender()}};st.prototype._isSmallSize=function(){var t=sap.m.ScreenSizes&&sap.m.ScreenSizes.table||600;return this.$()[0]&&this.$().width()<t};st.prototype._zoomToFit=function(){var t=this.getImageEditor();if(t&&t._isReady()&&this.getDomRef()){t.zoomToFit();this._oModel.setProperty("/zoom",t.getZoomLevel());this._refreshCropAreaSize()}};st.prototype.exit=function(){this._oObserver.disconnect();this._oObserver.destroy()};st.prototype.setMode=function(t){this.setProperty("mode",t,true);this["_setMode"+this.getMode()]();return this};st.prototype.setImageEditor=function(t){this._detachEditorEvents(this.getImageEditor());this.setAggregation("imageEditor",t);this._attachEditorEvents(t);if(t&&t.getLoaded()){this._onImageLoaded()}if(t&&t.getCustomShapeLoaded()){this._onCustomShapeLoaded()}return this};st.prototype.destroyImageEditor=function(){this._detachEditorEvents(this.getImageEditor());this.destroyAggregation("imageEditor");this._oModel.setProperty("/enabled",false);return this};st.prototype.getToolbar=function(){return this._getHeaderToolbar()};st.prototype.getToolbarIds=function(){return{filter:this.getId()+"-filterButton",crop:this.getId()+"-cropButton",transform:this.getId()+"-transformButton",undo:this.getId()+"-undoButton",history:this.getId()+"-historyButton",zoomIn:this.getId()+"-zoominButton",zoomOut:this.getId()+"-zoomoutButton",zoomToFit:this.getId()+"-zoomToFitButton",zoomLabel:this.getId()+"-zoomLabel",separator:this.getId()+"-separator"}};st.prototype.getMobileHeaderToolbar=function(){return this._getMobileHeaderToolbar()};st.prototype.getMobileZoomToolbar=function(){return this._getMobileZoomToolbar()};st.prototype.getMobileZoomToolbarIds=function(){return{zoomIn:this.getId()+"-mobileZoominButton",zoomLabel:this.getId()+"-mobileZoomLabel",zoomOut:this.getId()+"-mobilezoomoutButton",zoomToFit:this.getId()+"-mobileZoomToFitButton",scaleSwitch:this.getId()+"-mobileScaleSwitch",scaleLabel:this.getId()+"-mobileScaleLabel"}};st.prototype.getMobileFooterToolbar=function(){return this._getMobileFooterToolbar()};st.prototype.getMobileFooterToolbarIds=function(){return{filter:this.getId()+"-mobileFilterButton",crop:this.getId()+"-mobileCropButton",transform:this.getId()+"-mobileTransformButton",undo:this.getId()+"-mobileUndoButton",history:this.getId()+"-mobileHistoryButton",apply:this.getId()+"-mobileApplyButton"}};st.prototype._attachEditorEvents=function(t){if(!t){return}t.attachLoaded(this._onImageLoaded,this);t.attachCustomShapeLoaded(this._onCustomShapeLoaded,this);t.attachError(this._onImageError,this);t.attachCropAreaChanged(this._onCropAreaChange,this);t.attachHistoryChanged(this._onHistoryChange,this);t.attachSizeChanged(this._onSizeChange,this);t.attachZoomChanged(this._onZoomChange,this)};st.prototype._detachEditorEvents=function(t){if(!t){return}t.detachLoaded(this._onImageLoaded,this);t.detachCustomShapeLoaded(this._onCustomShapeLoaded,this);t.detachError(this._onImageError,this);t.detachCropAreaChanged(this._onCropAreaChange,this);t.detachHistoryChanged(this._onHistoryChange,this);t.detachSizeChanged(this._onSizeChange,this);t.detachZoomChanged(this._onZoomChange,this)};st.prototype._onManagedObjectChange=function(t){if(t.object===this._oMobileHeaderToolbar){this._oMobileHeaderToolbar.setVisible(t.object.getContent().length>0)}else if(t.object===this){this._updateToolbarsContent()}};st.prototype._refreshImageSize=function(){if(!this.getImageEditor()||!this.getImageEditor().getLoaded()){return}var t=this.getImageEditor().getWidth(),e=this.getImageEditor().getHeight();this._oModel.setProperty("/transform/resizes/1/width",t);this._oModel.setProperty("/transform/resizes/1/height",e);this._oModel.setProperty("/crop/ratiosRectangle/1/width",t);this._oModel.setProperty("/crop/ratiosRectangle/1/height",e);this._oModel.setProperty("/crop/ratiosCircle/1/width",t);this._oModel.setProperty("/crop/ratiosCircle/1/height",e);this._updateCurrentSize(t,e)};st.prototype._refreshCropAreaSize=function(){var t=this.getImageEditor().getCropArea();if(!t){return}this._updateCropSize(Math.round(t.width),Math.round(t.height))};st.prototype._onImageLoaded=function(){var t=this.getImageEditor();this._resetValueStates();this._oModel.setProperty("/enabled",!!t.getSrc());if(!t.getSrc()){this._changeOptionsPanelContent();return}this["_setMode"+this.getMode()]();this._refreshImageSize();this._oModel.setProperty("/history",[]);this._oModel.setProperty("/historyIndex",0);this._zoomToFit();this._updateOrigThumbnail();this._resetCurrentPanel()};st.prototype._onCustomShapeLoaded=function(){var t=this.getImageEditor();if(t.getCustomShapeSrc()&&t.getLoaded()&&t.getMode()===V.CropCustomShape){this._setCustomShapeCropAreaRatio()}this._oModel.setProperty("/crop/customShapeLoaded",!!t.getCustomShapeSrc())};st.prototype._onImageError=function(){this._resetValueStates();this._changeOptionsPanelContent();this._oModel.setProperty("/enabled",false)};st.prototype._onCropAreaChange=function(t){this._resetValueStates();this._updateCropSize(Math.round(t.getParameter("cropArea").width),Math.round(t.getParameter("cropArea").height))};st.prototype._onHistoryChange=function(t){var e=t.getParameter("history"),o=t.getParameter("index");this._resetValueStates();this._refreshImageSize();e.push({noChange:"NoChange"});this._oModel.setProperty("/history",e);this._oModel.setProperty("/historyIndex",o)};st.prototype._onSizeChange=function(t){this._resetValueStates();this._updateCurrentSize(t.getParameter("width"),t.getParameter("height"));this._selectResizeCustomSizeItem(this.getImageEditor().getKeepResizeAspectRatio())};st.prototype._onZoomChange=function(t){var e=t.getParameter("zoom");this._oModel.setProperty("/zoom",e);this._refreshCropAreaSize()};st.prototype._updateCropSize=function(t,e){this._oModel.setProperty("/crop/width",t);this._oModel.setProperty("/crop/height",e)};st.prototype._updateCurrentSize=function(t,e){this._oModel.setProperty("/transform/width",t);this._oModel.setProperty("/transform/height",e)};st.prototype._updateOrigThumbnail=function(){var t=this.$("origThumbnail"),e=this.getImageEditor(),o,i,r=this._oThumbnailCanvas.getContext("2d");if(e.getWidth()>=e.getHeight()){o=300;i=Math.round(e.getHeight()*o/e.getWidth())}else{i=300;o=Math.round(e.getWidth()*i/e.getHeight())}this._oThumbnailCanvas.width=o;this._oThumbnailCanvas.height=i;r.clearRect(0,0,o,i);r.drawImage(e._oCanvas,0,0,o,i);t.attr({href:this._oThumbnailCanvas.toDataURL()});if(t[0]){t[0].setAttribute("viewBox","0 0 "+o+" "+i)}};st.prototype._getHeaderToolbar=function(){if(!this._oHeaderToolbar){this._oHeaderToolbar=new a({enabled:"{/enabled}"}).addStyleClass("sapSuiteUiCommonsImageEditorContainerHeaderToolbar");this._oHeaderToolbar.setModel(this._oModel);this.addDependent(this._oHeaderToolbar)}return this._oHeaderToolbar};st.prototype._updateToolbarsContent=function(){var t=this._getHeaderToolbar(),e=this._getMobileHeaderToolbar(),o=this._getMobileFooterToolbar(),i=this.getEnabledButtons(),r;t.removeAllContent();e.removeAllContent();o.removeAllContent();this._getHistoryItems().forEach(function(e){t.addContent(e)});this._getMobileHistoryItems().forEach(function(t){o.addContent(t)});this._getZoomItems().forEach(function(e){t.addContent(e)});t.addContent(this._getToolbarSeparator());for(r=0;r<i.length;r++){switch(i[r]){case K.Filter:{t.addContent(this._getFilterButton());o.addContent(this._getMobileFilterButton());break}case K.Crop:{t.addContent(this._getCropButton());o.addContent(this._getMobileCropButton());break}case K.Transform:{t.addContent(this._getTransformButton());o.addContent(this._getMobileTransformButton());break}case K.History:{break}default:break}}t.addContent(this._getToolbarSpacer());o.addContent(this._getMobileFooterToolbarSpacer());o.addContent(this._getMobileApplyButton());if(this.getCustomToolbarControls().length>0){e.addContent(this._getMobileHeaderToolbarSpacer())}this.getCustomToolbarControls().forEach(function(o){var i=new x,r=new x;this.addDependent(i);i.setAssociation("control",o);t.addContent(i);this.addDependent(r);r.setAssociation("control",o);e.addContent(r)},this)};st.prototype._getToolbarSpacer=function(){if(!this._oSpacer){this._oSpacer=new u({id:this.getId()+"-spacer"});this.addDependent(this._oSpacer)}return this._oSpacer};st.prototype._getMobileHeaderToolbarSpacer=function(){if(!this._oMobileHeaderSpacer){this._oMobileHeaderSpacer=new u({id:this.getId()+"-mobileSpacer"});this.addDependent(this._oMobileHeaderSpacer)}return this._oMobileHeaderSpacer};st.prototype._getMobileFooterToolbarSpacer=function(){if(!this._oMobileFooterSpacer){this._oMobileFooterSpacer=new u({id:this.getId()+"-mobileFooterSpacer"});this.addDependent(this._oMobileFooterSpacer)}return this._oMobileFooterSpacer};st.prototype._getMobileHeaderToolbar=function(){if(!this._oMobileHeaderToolbar){this._oMobileHeaderToolbar=new a({enabled:"{/enabled}",visible:false}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileToolbar");this.addDependent(this._oMobileHeaderToolbar);this._oObserver.observe(this._oMobileHeaderToolbar,{aggregations:["content"]})}return this._oMobileHeaderToolbar};st.prototype._getMobileZoomToolbar=function(){if(!this._oMobileZoomToolbar){this._oMobileZoomToolbar=new a({enabled:"{/enabled}",content:[this._getMobileZoomInButton(),this._getMobileZoomLabel(),this._getMobileZoomOutButton(),this._getMobileZoomToFitButton(),this._getMobileScaleSwitch(),this._getMobileScaleLabel()]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileToolbar");this._oMobileZoomToolbar.setModel(this._oModel);this.addDependent(this._oMobileZoomToolbar)}return this._oMobileZoomToolbar};st.prototype._getMobileFooterToolbar=function(){if(!this._oMobileFooterToolbar){this._oMobileFooterToolbar=new a({enabled:"{/enabled}"}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileToolbar");this._oMobileFooterToolbar.setModel(this._oModel);this.addDependent(this._oMobileFooterToolbar);if(this._oMobileFooterToolbar._applyContextClassFor){this._oMobileFooterToolbar._applyContextClassFor("footer")}else{G.warning("ImageEditorContainer: _applyContextClassFor method doesn't exist, footer look is not applied on mobile footer toolbar")}}return this._oMobileFooterToolbar};st.prototype._getHistoryPopover=function(){var t=this;if(!this._oHistoryPopover){this._oHistoryPopover=new M({title:{path:"/history",formatter:function(t){return N.getText("IMGEDITOR_HISTORY_TITLE",String(t.length-1))}},endButton:new b({text:N.getText("IMGEDITOR_HISTORY_CLOSE"),press:function(){t._oHistoryPopover.close()}}),afterOpen:function(){var e=t._oModel.getProperty("/historyIndex"),o=t._oHistoryList.getItems()[e];t._oHistoryList.setSelectedItem(o);o.focus()}});this._oHistoryList=new E({mode:X.SingleSelectMaster,selectionChange:function(e){var o=e.getParameter("listItem"),i=o.getParent().indexOfItem(o);t._jumpToHistory(i)},items:{path:"/history",factory:this._historyItemFactory.bind(this)}});this._oHistoryPopover.setModel(this._oModel);this._oHistoryPopover.addContent(this._oHistoryList);this.addDependent(this._oHistoryPopover)}return this._oHistoryPopover};st.prototype._historyItemFactory=function(t,e){var o=this._oModel.getProperty("/history").indexOf(e.getProperty()),i=e.getProperty(),r,s,a,n;switch(i.noChange||i.getMetadata().getName()){case"sap.suite.ui.commons.imageeditor.RotateHistoryItem":{s=N.getText("IMGEDITOR_ROTATE");a=i.getDegrees();n=rt.TRANSFORM;break}case"sap.suite.ui.commons.imageeditor.ResizeHistoryItem":{s=N.getText("IMGEDITOR_RESIZE");a=N.getText("IMGEDITOR_HISTORY_TEXT",[i.getOldWidth()+" x "+i.getOldHeight(),i.getWidth()+" x "+i.getHeight()]);n=rt.TRANSFORM;break}case"sap.suite.ui.commons.imageeditor.FlipHistoryItem":{s=N.getText("IMGEDITOR_FLIP");if(i.getVertical()&&i.getHorizontal()){a=N.getText("IMGEDITOR_FLIP_BOTH");n=rt.FLIPHORIZONTAL}else{a=i.getVertical()?N.getText("IMGEDITOR_FLIP_VERTICAL"):N.getText("IMGEDITOR_FLIP_HORIZONTAL");n=i.getVertical()?rt.FLIPVERTICAL:rt.FLIPHORIZONTAL}break}case"sap.suite.ui.commons.imageeditor.FilterHistoryItem":{s=i.getType();s=s[0].toUpperCase()+s.slice(1);a=i.getValue();n=rt.FILTER;break}case"sap.suite.ui.commons.imageeditor.CropRectangleHistoryItem":case"sap.suite.ui.commons.imageeditor.CropEllipseHistoryItem":case"sap.suite.ui.commons.imageeditor.CropCustomShapeHistoryItem":{s=N.getText("IMGEDITOR_CROP");a=N.getText("IMGEDITOR_HISTORY_TEXT",[i.getOldWidth()+" x "+i.getOldHeight(),i.getWidth()+" x "+i.getHeight()]);n=rt.CROP;break}case"NoChange":{s=N.getText("IMGEDITOR_HISTORY_ORIGINAL");a=N.getText("IMGEDITOR_HISTORY_ORIGINAL_TEXT");n=rt.RESET;break}default:{break}}r=new R({title:s,description:a,icon:n,selected:{path:"/historyIndex",formatter:function(t){return o===t}}});return r};st.prototype._getHistoryItems=function(){if(!this._aHistoryItems){this._aHistoryItems=[this._getUndoButton(),this._getHistoryArrowButton()]}return this._aHistoryItems};st.prototype._getMobileHistoryItems=function(){if(!this._aMobileHistoryItems){this._aMobileHistoryItems=[this._getMobileUndoButton(),this._getMobileHistoryArrowButton()]}return this._aMobileHistoryItems};st.prototype._getUndoButton=function(){if(!this._oHistoryButton){this._oHistoryButton=this._createUndoButton(this.getId()+"-undoButton");this.addDependent(this._oHistoryButton)}return this._oHistoryButton};st.prototype._getMobileUndoButton=function(){if(!this._oMobileHistoryButton){this._oMobileHistoryButton=this._createUndoButton(this.getId()+"-mobileUndoButton");this.addDependent(this._oMobileHistoryButton)}return this._oMobileHistoryButton};st.prototype._createUndoButton=function(t){var e=this;return new n({id:t,type:j.Transparent,icon:rt.UNDO,enabled:{parts:["/history","/historyIndex"],formatter:function(t,e){return t.length>1&&e<t.length-1}},press:function(){e._undo()},tooltip:N.getText("IMGEDITOR_PANEL_UNDO")})};st.prototype._getHistoryArrowButton=function(){var t=this;if(!this._oHistoryArrowButton){this._oHistoryArrowButton=this._createHistoryArrowButton(this.getId()+"-historyButton",function(){t._resetValueStates();t._getHistoryPopover().openBy(t._oHistoryArrowButton)});this.addDependent(this._oHistoryArrowButton)}return this._oHistoryArrowButton};st.prototype._getMobileHistoryArrowButton=function(){var t=this;if(!this._oMobileHistoryArrowButton){this._oMobileHistoryArrowButton=this._createHistoryArrowButton(this.getId()+"-mobileHistoryButton",function(){t._resetValueStates();t._getHistoryPopover().openBy(t._oMobileHistoryArrowButton)});this.addDependent(this._oMobileHistoryArrowButton)}return this._oMobileHistoryArrowButton};st.prototype._createHistoryArrowButton=function(t,e){return new n({id:t,type:j.Transparent,icon:rt.DROPDOWN,enabled:{path:"/history",formatter:function(t){return t.length>1}},press:e,tooltip:N.getText("IMGEDITOR_PANEL_HISTORY")})};st.prototype._getZoomItems=function(){if(!this._aZoomItems){this._aZoomItems=[this._getZoomInButton(),this._getZoomLabel(),this._getZoomOutButton(),this._getZoomToFitButton()]}return this._aZoomItems};st.prototype._getZoomInButton=function(){if(!this._oZoomInButton){this._oZoomInButton=this._createZoomInButton(this.getId()+"-zoominButton");this.addDependent(this._oZoomInButton)}return this._oZoomInButton};st.prototype._getMobileZoomInButton=function(){if(!this._oMobileZoomInButton){this._oMobileZoomInButton=this._createZoomInButton(this.getId()+"-mobileZoominButton");this.addDependent(this._oMobileZoomInButton)}return this._oMobileZoomInButton};st.prototype._createZoomInButton=function(t){var e=this;return new n({id:t,type:j.Transparent,icon:rt.ZOOMIN,press:function(){var t=e.getImageEditor();t.zoomIn();e._oModel.setProperty("/zoom",t.getZoomLevel());e._refreshCropAreaSize()},tooltip:N.getText("IMGEDITOR_PANEL_ZOOMIN")})};st.prototype._getZoomLabel=function(){if(!this._oZoomLabel){this._oZoomLabel=this._createZoomLabel(this.getId()+"-zoomLabel");this.addDependent(this._oZoomLabel)}return this._oZoomLabel};st.prototype._getMobileZoomLabel=function(){if(!this._oMobileZoomLabel){this._oMobileZoomLabel=this._createZoomLabel(this.getId()+"-mobileZoomLabel");this.addDependent(this._oMobileZoomLabel)}return this._oMobileZoomLabel};st.prototype._createZoomLabel=function(t){return new g({id:t,text:{path:"/zoom",formatter:function(t){return t+"%"}}})};st.prototype._getZoomOutButton=function(){if(!this._oZoomOutButton){this._oZoomOutButton=this._createZoomOutButton(this.getId()+"-zoomoutButton");this.addDependent(this._oZoomOutButton)}return this._oZoomOutButton};st.prototype._getMobileZoomOutButton=function(){if(!this._oMobileZoomOutButton){this._oMobileZoomOutButton=this._createZoomOutButton(this.getId()+"-mobileZoomoutButton");this.addDependent(this._oMobileZoomOutButton)}return this._oMobileZoomOutButton};st.prototype._createZoomOutButton=function(t){var e=this;return new n({id:t,type:j.Transparent,icon:rt.ZOOMOUT,press:function(){var t=e.getImageEditor();t.zoomOut();e._oModel.setProperty("/zoom",t.getZoomLevel());e._refreshCropAreaSize()},tooltip:N.getText("IMGEDITOR_PANEL_ZOOMOUT")})};st.prototype._getZoomToFitButton=function(){if(!this._oZoomToFit){this._oZoomToFit=this._createZoomToFitButton(this.getId()+"-zoomToFitButton");this.addDependent(this._oZoomToFit)}return this._oZoomToFit};st.prototype._getMobileZoomToFitButton=function(){if(!this._oMobileZoomToFit){this._oMobileZoomToFit=this._createZoomToFitButton(this.getId()+"-mobileZoomToFitButton");this.addDependent(this._oMobileZoomToFit)}return this._oMobileZoomToFit};st.prototype._createZoomToFitButton=function(t){var e=this;return new n({id:t,type:j.Transparent,icon:rt.ZOOMFIT,press:e._zoomToFit.bind(e),tooltip:N.getText("IMGEDITOR_PANEL_ZOOMTOFIT")})};st.prototype._getScaleSwitch=function(){if(!this._oScaleSwitch){this._oScaleSwitch=this._createScaleSwitch(this.getId()+"-scaleSwitch");this.addDependent(this._oScaleSwitch)}return this._oScaleSwitch};st.prototype._getMobileScaleSwitch=function(){if(!this._oMobileScaleSwitch){this._oMobileScaleSwitch=this._createScaleSwitch(this.getId()+"-mobileScaleSwitch");this.addDependent(this._oMobileScaleSwitch)}return this._oMobileScaleSwitch};st.prototype._createScaleSwitch=function(t){var e=this;return new F({id:t,type:et.AcceptReject,state:"{/crop/scaleCropArea}",visible:{path:"/mode",formatter:function(t){return t==="Crop"}},change:function(t){e._setScaleCropArea(t.getParameter("state"))}}).addStyleClass("sapUiTinyMarginEnd")};st.prototype._getScaleLabel=function(){if(!this._oScaleLabel){this._oScaleLabel=this._createScaleLabel(this.getId()+"-scaleLabel");this.addDependent(this._oScaleLabel)}return this._oScaleLabel};st.prototype._getMobileScaleLabel=function(){if(!this._oMobileScaleLabel){this._oMobileScaleLabel=this._createScaleLabel(this.getId()+"-mobileScaleLabel");this.addDependent(this._oMobileScaleLabel)}return this._oMobileScaleLabel};st.prototype._createScaleLabel=function(t){return new g({text:N.getText("IMGEDITOR_CROP_SCALE"),labelFor:t,visible:{path:"/mode",formatter:function(t){return t==="Crop"}}})};st.prototype._getToolbarSeparator=function(){if(!this._oSeparator){this._oSeparator=new d({id:this.getId()+"-separator"});this.addDependent(this._oSeparator)}return this._oSeparator};st.prototype._getTransformButton=function(){if(!this._oTransformButton){this._oTransformButton=this._createTransformButton(this.getId()+"-transformButton");this.addDependent(this._oTransformButton)}return this._oTransformButton};st.prototype._getMobileTransformButton=function(){if(!this._oMobileTransformButton){this._oMobileTransformButton=this._createTransformButton(this.getId()+"-mobileTransformButton");this.addDependent(this._oMobileTransformButton)}return this._oMobileTransformButton};st.prototype._createTransformButton=function(t){return new l({id:t,icon:rt.TRANSFORM,type:j.Transparent,pressed:{path:"/mode",formatter:function(t){return t===U.Transform}},enabled:{path:"/mode",formatter:function(t){return t!==U.Transform}},press:this._onButtonPress.bind(this,this._setModeTransform.bind(this)),tooltip:N.getText("IMGEDITOR_PANEL_TRANSFORM")})};st.prototype._getCropButton=function(){if(!this._oCropButton){this._oCropButton=this._createCropButton(this.getId()+"-cropButton");this.addDependent(this._oCropButton)}return this._oCropButton};st.prototype._getMobileCropButton=function(){if(!this._oMobileCropButton){this._oMobileCropButton=this._createCropButton(this.getId()+"-mobileCropButton");this.addDependent(this._oMobileCropButton)}return this._oMobileCropButton};st.prototype._createCropButton=function(t){return new l({id:t,icon:rt.CROP,type:j.Transparent,pressed:{path:"/mode",formatter:function(t){return t===U.Crop}},enabled:{path:"/mode",formatter:function(t){return t!==U.Crop}},press:this._onButtonPress.bind(this,this._setModeCrop.bind(this)),tooltip:N.getText("IMGEDITOR_PANEL_CROP")})};st.prototype._getFilterButton=function(){if(!this._oFilterButton){this._oFilterButton=this._createFilterButton(this.getId()+"-filterButton");this.addDependent(this._oFilterButton)}return this._oFilterButton};st.prototype._getMobileFilterButton=function(){if(!this._oMobileFilterButton){this._oMobileFilterButton=this._createFilterButton(this.getId()+"-mobileFilterButton");this.addDependent(this._oMobileFilterButton)}return this._oMobileFilterButton};st.prototype._createFilterButton=function(t){return new l({id:t,icon:rt.FILTER,type:j.Transparent,pressed:{path:"/mode",formatter:function(t){return t===U.Filter}},enabled:{path:"/mode",formatter:function(t){return t!==U.Filter}},press:this._onButtonPress.bind(this,this._setModeFilter.bind(this)),tooltip:N.getText("IMGEDITOR_PANEL_FILTER")})};st.prototype._getMobileApplyButton=function(){if(!this._oMobileApplyButton){this._oMobileApplyButton=new b({id:this.getId()+"-mobileApplyButton",text:N.getText("IMGEDITOR_APPLY"),type:j.Emphasized,press:this._applyPreview.bind(this)})}return this._oMobileApplyButton};st.prototype._changeOptionsPanelContent=function(t){var e=this._getOptionsPanel();e.removeAllItems();if(!this.getImageEditor()||!this.getImageEditor().getLoaded()||!t){return}t().forEach(function(t){e.addItem(t)})};st.prototype._onButtonPress=function(t){this.getImageEditor()._cancelPreview();t()};st.prototype._setModeTransform=function(t){this._changeOptionsPanelContent(this._getTransformPanelContent.bind(this));if(this.getImageEditor()){this.getImageEditor().setMode(V.Resize)}if(this.getMode()!==U.Transform){this.setProperty("mode",U.Transform,true)}this._setTransformTypeByKey(t||"Resize");this._oModel.setProperty("/mode",U.Transform)};st.prototype._setModeCrop=function(t){this._changeOptionsPanelContent(this._getCropPanelContent.bind(this));if(this.getImageEditor()){this._setCropTypeByKey(t||"Rectangle")}if(this.getMode()!==U.Crop){this.setProperty("mode",U.Crop,true)}this._oModel.setProperty("/mode",U.Crop);this._setScaleCropArea(this._oModel.getProperty("/crop/scaleCropArea"))};st.prototype._setModeFilter=function(){this._changeOptionsPanelContent(this._getFilterPanelContent.bind(this));if(this.getImageEditor()){this.getImageEditor().setMode(V.Default)}if(this.getMode()!==U.Filter){this.setProperty("mode",U.Filter,true)}this._resetFilterValues();this._selectFilterItem(0);this._oModel.setProperty("/mode",U.Filter)};st.prototype._constraintValue=function(t,e,o){var i=o.getBinding("value"),r=o.getBinding("valueState"),s=o.getBinding("valueStateText"),a;if(isNaN(t)||t<e.min||t>e.max){a=N.getText("IMGEDITOR_BAD_NUMBER",[e.min,e.max]);t=this._oModel.getProperty(i.getPath())}if(a){this._oModel.setProperty(r.getPath(),W.Warning);this._oModel.setProperty(s.getPath(),a)}this._oModel.setProperty(i.getPath(),t);o.setValue(t);return t};st.prototype._onNumberInputChange=function(t,e){var o=e.getParameter("value"),i=e.getParameter("newValue"),r;this._resetValueStates();if(typeof o==="number"){r=o}else if(typeof i==="number"){r=i}else{r=parseInt(e.getParameter("value")||e.getParameter("newValue"),10)}r=this._constraintValue(r,t,e.getSource());this[t.callback](r)};st.prototype._setRatio=function(t,e){if(!this.getImageEditor()||!this.getImageEditor().getLoaded()){return}this.getImageEditor().setCropAreaByRatio(t,e);this._refreshCropAreaSize()};st.prototype._setCropAreaBySize=function(t,e){this.getImageEditor().setCropAreaBySize(t,e);this._refreshCropAreaSize()};st.prototype._setRatioByKey=function(t){if(t==="Rectangle"){this._setRatio(this._oModel.getProperty("/crop/ratiosRectangle/1/width"),this._oModel.getProperty("/crop/ratiosRectangle/1/height"))}else if(t==="Ellipse"){this._setRatio(1,1)}else if(t==="CustomShape"&&this.getImageEditor().getCustomShapeLoaded()){this._setCustomShapeCropAreaRatio()}};st.prototype._setCustomShapeCropAreaRatio=function(){this.getImageEditor().setCustomShapeCropAreaRatio();this._refreshCropAreaSize()};st.prototype._setTransformTypeByKey=function(t){var e=t==="Resize"?V.Resize:V.Default;if(t==="Resize"){this._refreshImageSize();this._selectResizeCustomSizeItem()}else if(t==="Rotate"){this._oModel.setProperty("/transform/rotate",0)}else if(t==="Flip"){this._resetFlips()}this._oModel.setProperty("/transform/selectedTypeKey",t);this._resetValueStates();if(this.getImageEditor()){this.getImageEditor()._cancelPreview();this.getImageEditor().setMode(e)}};st.prototype._setCropTypeByKey=function(t,e){var o=this._oModel.getProperty("/crop/types").filter(function(e){return e.key===t})[0];this._setRatioByKey(t);this._oModel.setProperty("/crop/selectedTypeKey",t);this._oModel.setProperty("/crop/selectedType",o);if(this["_select"+t+"CropCustomSizeItem"]){this["_select"+t+"CropCustomSizeItem"](e)}this.getImageEditor().setMode("Crop"+t);this._resetValueStates()};st.prototype._resetCurrentPanel=function(){this.getImageEditor().cancelPreview();switch(this.getMode()){case U.Transform:{this._setTransformTypeByKey(this._oModel.getProperty("/transform/selectedTypeKey"));break}case U.Crop:{this._setCropTypeByKey(this._oModel.getProperty("/crop/selectedTypeKey"));break}case U.Filter:{this._selectFilterItem(this._getSelectedFilterIndex());break}default:break}this._resetValueStates()};st.prototype._undo=function(){this.getImageEditor().undo();this._resetCurrentPanel()};st.prototype._redo=function(){this.getImageEditor().redo();this._resetCurrentPanel()};st.prototype._jumpToHistory=function(t){this.getImageEditor().jumpToHistory(t);this._resetCurrentPanel()};st.prototype._setZoom=function(t){this._oModel.setProperty("/zoom",t);this.getImageEditor().zoom(t);this._refreshCropAreaSize()};st.prototype._setWidth=function(t){this.getImageEditor().setWidth(t,true);this._oModel.setProperty("/transform/height",this.getImageEditor().getPreviewHeight());this._selectResizeCustomSizeItem(this.getImageEditor().getKeepResizeAspectRatio())};st.prototype._setHeight=function(t){this.getImageEditor().setHeight(t,true);this._oModel.setProperty("/transform/width",this.getImageEditor().getPreviewWidth());this._selectResizeCustomSizeItem(this.getImageEditor().getKeepResizeAspectRatio())};st.prototype._setSize=function(t,e,o){if(o){t=this.getImageEditor().getWidth()*t;e=this.getImageEditor().getHeight()*e}this._updateCurrentSize(t,e);if(this.getImageEditor().getPreviewWidth()===t&&this.getImageEditor().getPreviewHeight()===e){return}this.getImageEditor().setSize(t,e,true)};st.prototype._rotate=function(t){t=t>s.LIMITS.ROTATION_MAX?s.LIMITS.ROTATION_MAX:t;t=t<s.LIMITS.ROTATION_MIN?s.LIMITS.ROTATION_MIN:t;this._oModel.setProperty("/transform/rotate",t);this.getImageEditor().rotate(t,true)};st.prototype._flip=function(t,e){this.getImageEditor().flip(t,e,true)};st.prototype._setKeepResizeAspectRatio=function(t){this._oModel.setProperty("/transform/keepAspectRatio",t);if(this.getImageEditor()){this.getImageEditor().setKeepResizeAspectRatio(t)}};st.prototype._getKeepCropAspectRatio=function(){return this._oModel.getProperty("/crop/keepAspectRatio")};st.prototype._setKeepCropAspectRatio=function(t){this._oModel.setProperty("/crop/keepAspectRatio",t);if(this.getImageEditor()){this.getImageEditor().setKeepCropAspectRatio(t)}};st.prototype._setScaleCropArea=function(t){this._oModel.setProperty("/crop/scaleCropArea",t);if(this.getImageEditor()){this.getImageEditor().setScaleCropArea(t)}};st.prototype._applyCurrentFilter=function(t){var e=this._oModel.getProperty("/filter/selectedFilter");if(typeof t!=="undefined"){this._oModel.setProperty("/filter/selectedFilter/value",t)}this.getImageEditor()[e.type](e.value,true)};st.prototype._resetFilterValues=function(){var t=this._oModel.getProperty("/filter/filters");t.forEach(function(t,e){this._oModel.setProperty("/filter/filters/"+e+"/value",t.defaultValue)},this)};st.prototype._resetValueStates=function(){var t=["/transform/widthValueState","/transform/heightValueState","/transform/rotateValueState","/crop/widthValueState","/crop/heightValueState","/filter/filterValueState"];t.forEach(function(t){this._oModel.setProperty(t,W.None)},this)};st.prototype._resetFlips=function(){this._oModel.setProperty("/transform/flipVertical",false);this._oModel.setProperty("/transform/flipHorizontal",false)};st.prototype._applyPreview=function(){this.getImageEditor().applyPreview();this._resetValueStates();switch(this.getMode()){case U.Transform:{switch(this._oModel.getProperty("/transform/selectedTypeKey")){case"Resize":{this._refreshImageSize();break}case"Rotate":{this._oModel.setProperty("/transform/rotate",0);this._refreshImageSize();break}case"Flip":{this._resetFlips();break}default:break}break}case U.Crop:{var t=this._oModel.getProperty("/crop/selectedType/apply");if(t){this.getImageEditor()[t]()}this._refreshImageSize();this._setRatioByKey(this._oModel.getProperty("/crop/selectedTypeKey"));this._deselectCropItem();this.getImageEditor().setMode(V.Default);break}case U.Filter:{this._resetFilterValues();break}default:break}};st.prototype._createGridList=function(t,e,o){var i=this;var r=new E({width:"auto",mode:"SingleSelectMaster",itemPress:function(t){i._resetValueStates();o.call(i,t)},items:{path:t,factory:e.bind(this)}}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridList");r.setModel(this._oModel);if(!r._oItemNavigation){r._startItemNavigation()}if(r._oItemNavigation){r._oItemNavigation.setColumns(2)}return r};st.prototype._selectResizeCustomSizeItem=function(t){var e=this._getResizeGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepResizeAspectRatio(!!t)};st.prototype._deselectCropItem=function(){this._getRectangleCropGridList().removeSelections();this._getEllipseCropGridList().removeSelections();this._disableCrop()};st.prototype._disableCrop=function(){this._oModel.setProperty("/crop/enabled",false)};st.prototype._enableCrop=function(){this._oModel.setProperty("/crop/enabled",true)};st.prototype._selectRectangleCropCustomSizeItem=function(t){var e=this._getRectangleCropGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepCropAspectRatio(!!t);this._enableCrop()};st.prototype._selectEllipseCropCustomSizeItem=function(t){var e=this._getEllipseCropGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepCropAspectRatio(!!t);this._enableCrop()};st.prototype._selectCustomShapeCropCustomSizeItem=function(t){var e=this._getCustomShapeCropGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepCropAspectRatio(!!t);this._enableCrop()};st.prototype._selectFilterItem=function(t){var e=this._getFilterGridList(),o=e.getItems()[t];this._oModel.setProperty("/filter/selectedFilter",o.getBindingContext().getProperty());this._oModel.setProperty("/filter/selectedFilter/value",this._oModel.getProperty("/filter/selectedFilter/defaultValue"));e.setSelectedItem(o)};st.prototype._getSelectedFilterIndex=function(){var t=this._oModel.getProperty("/filter/selectedFilter"),e=t?this._oModel.getProperty("/filter/filters").indexOf(t):0;return e};st.prototype._getResizeGridList=function(){if(!this._oGridListResize){this._oGridListResize=this._createGridList("/transform/resizes",this._gridRectShapeItemFactory,this._onResizeGridListSelectionChange)}return this._oGridListResize};st.prototype._onResizeGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext();if(o.getProperty("width")){this._setSize(o.getProperty("width"),o.getProperty("height"),o.getProperty("relative"))}this._setKeepResizeAspectRatio(!o.getProperty("unlockRatio"))};st.prototype._getRotateGridList=function(){if(!this._oGridListRotate){this._oGridListRotate=this._createGridList("/transform/rotates",this._gridRectShapeItemFactory,this._onRotateGridListSelectionChange)}return this._oGridListRotate};st.prototype._onRotateGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext();this._getRotateGridList().removeSelections();this._rotate(this._oModel.getProperty("/transform/rotate")+o.getProperty("rotate"))};st.prototype._getFlipGridList=function(){if(!this._oGridListFlip){this._oGridListFlip=this._createGridList("/transform/flips",this._gridRectShapeItemFactory,this._onFlipGridListSelectionChange)}return this._oGridListFlip};st.prototype._onFlipGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext(),i=this._oModel.getProperty("/transform/flipVertical"),r=this._oModel.getProperty("/transform/flipHorizontal");this._getFlipGridList().removeSelections();i=i!==o.getProperty("flipVertical");r=r!==o.getProperty("flipHorizontal");this._oModel.setProperty("/transform/flipVertical",i);this._oModel.setProperty("/transform/flipHorizontal",r);this._flip(i,r)};st.prototype._getRectangleCropGridList=function(){if(!this._oGridListRectCrop){this._oGridListRectCrop=this._createGridList("/crop/ratiosRectangle",this._gridRectShapeItemFactory,this._onRectCropGridListSelectionChange)}return this._oGridListRectCrop};st.prototype._onRectCropGridListSelectionChange=function(t){var e=t.getParameter("listItem");this._onGridListSelectionChange(e,V.CropRectangle)};st.prototype._getEllipseCropGridList=function(){if(!this._oGridListEllipseCrop){this._oGridListEllipseCrop=this._createGridList("/crop/ratiosCircle",this._gridCircleShapeItemFactory,this._onEllipseCropGridListSelectionChange)}return this._oGridListEllipseCrop};st.prototype._onEllipseCropGridListSelectionChange=function(t){var e=t.getParameter("listItem");this._onGridListSelectionChange(e,V.CropEllipse)};st.prototype._getCustomShapeCropGridList=function(){if(!this._oGridListCustomShapeCrop){this._oGridListCustomShapeCrop=this._createGridList("/crop/ratiosCustomShape",this._gridRectShapeItemFactory,this._onCustomShapeCropGridListSelectionChange);this._oGridListCustomShapeCrop.setModel(this._oModel)}return this._oGridListCustomShapeCrop};st.prototype._onCustomShapeCropGridListSelectionChange=function(t){var e=t.getParameter("listItem");this._onGridListSelectionChange(e,V.CropCustomShape)};st.prototype._onGridListSelectionChange=function(t,e){var o=t.getBindingContext(),i=this.getImageEditor();i.setMode(e);if(o.getProperty("callback")){this[o.getProperty("callback")]()}if(o.getProperty("width")&&o.getProperty("relative")){this._setRatio(o.getProperty("width"),o.getProperty("height"))}else if(o.getProperty("width")&&!o.getProperty("relative")){this._setCropAreaBySize(o.getProperty("width"),o.getProperty("height"))}this._enableCrop();this._setKeepCropAspectRatio(!o.getProperty("unlockRatio"))};st.prototype._getFilterGridList=function(){if(!this._oGridListFilter){this._oGridListFilter=this._createGridList("/filter/filters",this._gridFilterItemFactory,this._onFilterGridListSelectionChange)}return this._oGridListFilter};st.prototype._onFilterGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext();this._resetFilterValues();this._oModel.setProperty("/filter/selectedFilter",o.getProperty());this.getImageEditor().cancelPreview();this.getImageEditor()[o.getProperty("type")](o.getProperty("value"),true)};st.prototype._gridRectShapeItemFactory=function(t,e){var o;if(e.getProperty("icon")){o=new P({renderType:$.Bare,alignItems:q.Center,justifyContent:J.Center,items:[new B({src:"{icon}"})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItemIcon")}else{o=this._createGridItemRectShape(e.getProperty("width"),e.getProperty("height"))}return this._createGridListItem(o)};st.prototype._gridCircleShapeItemFactory=function(t,e){var o;if(e.getProperty("icon")){o=new P({renderType:$.Bare,alignItems:q.Center,justifyContent:J.Center,items:[new B({src:"{icon}"})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItemIcon")}else{o=this._createGridItemCircleShape(e.getProperty("width"),e.getProperty("height"))}return this._createGridListItem(o)};st.prototype._refreshGridListsItems=function(){var t=this,e=[{path:"/transform/resizes",fnGetItems:this.getCustomResizeItems.bind(this)},{path:"/crop/ratiosRectangle",fnGetItems:this.getCustomRectangleCropItems.bind(this)},{path:"/crop/ratiosCircle",fnGetItems:this.getCustomEllipseCropItems.bind(this)}];this.getCustomResizeItems().forEach(function(t){if(t.getRelative()&&!t.getIcon()){t.setIcon(rt.RELATIVE)}});e.forEach(function(e){var o=t._oModel.getProperty(e.path),i=o.slice(0,at.NUM_KEPT_ITEMS);e.fnGetItems().forEach(function(t){if(t.getWidth()>0&&t.getHeight()>0){i.push({width:t.getWidth(),height:t.getHeight(),text:t.getLabel(),icon:t.getIcon(),relative:t.getRelative()})}});t._oModel.setProperty(e.path,i)})};st.prototype._createGridListItem=function(t){return new O({type:k.Active,content:[t,new g({text:"{text}",wrapping:false,textAlign:ot.Center,layoutData:[new L({growFactor:0,shrinkFactor:0,baseSize:"auto"})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItemLabel")]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItem")};st.prototype._createGridItemRectShape=function(t,e){var o,i;if(t<100){t*=10;e*=10}else if(t>100){t/=10;e/=10}o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","sapSuiteUiCommonsImageEditorContainerGridItemHeaderContent");o.setAttribute("viewBox","-1 -1 "+(t+2)+" "+(e+2));i=document.createElement("rect");i.setAttribute("x","0");i.setAttribute("y","0");i.setAttribute("width",t);i.setAttribute("height",e);o.appendChild(i);return new v({content:(new XMLSerializer).serializeToString(o)})};st.prototype._createGridItemCircleShape=function(t,e){var o,i;t*=100;e*=100;o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","sapSuiteUiCommonsImageEditorContainerGridItemHeaderContent");o.setAttribute("viewBox","-"+(t+2)+" -"+(e+2)+" "+(t*2+4)+" "+(e*2+4));i=document.createElement("ellipse");i.setAttribute("cx","0");i.setAttribute("cy","0");i.setAttribute("rx",t);i.setAttribute("ry",e);o.appendChild(i);return new v({content:(new XMLSerializer).serializeToString(o)})};st.prototype._gridFilterItemFactory=function(t,e){var o,i,r;i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("class","sapSuiteUiCommonsImageEditorContainerGridItemHeaderContent sapSuiteUiCommonsImageEditorContainerGridItemHeaderFilterContent");r=document.createElementNS("http://www.w3.org/2000/svg","use");r.setAttribute("href","#"+this.getId()+"-origThumbnail");r.setAttribute("filter","url(#"+this.getId()+"-"+e.getProperty("type")+")");i.appendChild(r);o=new v({content:(new XMLSerializer).serializeToString(i)});return this._createGridListItem(o)};st.prototype._getTransformPanelContent=function(){var t=this;if(!this._oTransformToolbarContent){this._oTransformToolbarContent=[new m({min:s.LIMITS.ROTATION_MIN,max:s.LIMITS.ROTATION_MAX,showAdvancedTooltip:true,visible:{path:"/transform/selectedTypeKey",formatter:function(t){return t==="Rotate"}},value:{path:"/transform/rotate",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,it.ROTATION),progress:true,ariaLabelledBy:[this.getId()+"-transformAngle"]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileSlider"),new A({tabDensityMode:Q.Compact,backgroundDesign:tt.Transparent,headerBackgroundDesign:tt.Transparent,expandable:false,select:function(e){var o=e.getParameter("key");t._setTransformTypeByKey(o)},selectedKey:"{/transform/selectedTypeKey}",items:[new w({key:"Resize",text:N.getText("IMGEDITOR_RESIZE"),content:[this._getResizeGridList(),new P({renderType:$.Bare,direction:Y.Column,items:[new P({renderType:$.Bare,justifyContent:J.SpaceBetween,items:[new P({renderType:$.Bare,direction:Y.Column,items:[new g({text:N.getText("IMGEDITOR_WIDTH"),labelFor:this.getId()+"-transformWidth"}),new c({id:this.getId()+"-transformWidth",type:Z.Number,textAlign:ot.Right,change:this._onNumberInputChange.bind(this,it.WIDTH),value:{path:"/transform/width",type:"sap.ui.model.type.Integer",mode:"OneWay"},valueState:"{/transform/widthValueState}",valueStateText:"{/transform/widthValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:N.getText("IMGEDITOR_PX")})]}),new P({renderType:$.Bare,direction:Y.Column,justifyContent:J.End,items:[new h({tooltip:N.getText("IMGEDITOR_LOCK_RATIO"),icon:rt.LOCK,type:j.Transparent,pressed:{path:"/transform/keepAspectRatio"},press:function(e){t._resetValueStates();t.getImageEditor().setKeepResizeAspectRatio(e.getParameter("pressed"));t._selectResizeCustomSizeItem(e.getParameter("pressed"))}})]}),new P({renderType:$.Bare,direction:Y.Column,items:[new g({text:N.getText("IMGEDITOR_HEIGHT"),labelFor:this.getId()+"-transformHeight"}),new c({id:this.getId()+"-transformHeight",type:Z.Number,textAlign:ot.Right,change:this._onNumberInputChange.bind(this,it.HEIGHT),value:{path:"/transform/height",type:"sap.ui.model.type.Integer",mode:"OneWay"},valueState:"{/transform/heightValueState}",valueStateText:"{/transform/heightValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:N.getText("IMGEDITOR_PX")})]})]}),new b({width:"50%",text:N.getText("IMGEDITOR_APPLY"),type:j.Emphasized,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")]}),new w({key:"Rotate",text:N.getText("IMGEDITOR_ROTATE"),content:[this._getRotateGridList(),new P({renderType:$.Bare,direction:Y.Column,items:[new g({id:this.getId()+"-transformAngle",text:N.getText("IMGEDITOR_TRANSFORM_ANGLE")}),new m({min:s.LIMITS.ROTATION_MIN,max:s.LIMITS.ROTATION_MAX,value:{path:"/transform/rotate",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,it.ROTATION),progress:true,ariaLabelledBy:[this.getId()+"-transformAngle"]}),new c({type:Z.Number,textAlign:ot.Right,width:"50%",fieldWidth:"50%",description:N.getText("IMGEDITOR_TRANSFORM_DEG"),change:this._onNumberInputChange.bind(this,it.ROTATION),value:{path:"/transform/rotate",type:"sap.ui.model.type.Integer",mode:"OneWay"},valueState:"{/transform/rotateValueState}",valueStateText:"{/transform/rotateValueStateText}",ariaLabelledBy:[this.getId()+"-transformAngle"]}),new b({width:"50%",text:N.getText("IMGEDITOR_APPLY"),type:j.Emphasized,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")]}),new w({key:"Flip",text:N.getText("IMGEDITOR_FLIP"),content:[this._getFlipGridList(),new P({renderType:$.Bare,direction:Y.Column,items:[new b({width:"50%",text:N.getText("IMGEDITOR_APPLY"),type:j.Emphasized,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")]})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerTabBar")];this._oTransformToolbarContent.forEach(function(t){this.addDependent(t)},this)}return this._oTransformToolbarContent};st.prototype._onCropSizeInputChange=function(t,e){var o=this._oModel.getProperty("/crop/width"),i=this._oModel.getProperty("/crop/height"),r=this._getKeepCropAspectRatio(),s,a,n,l,p,h=parseInt(e.getParameter("value"),10);h=isNaN(h)?0:h;if(t==="width"){n=o;s=h;a=r?s*i/o:i;p=this.getImageEditor()._getMaxCropAreaWidth(true);l=this.getImageEditor()._getMinCropAreaWidth(true)}else{n=i;a=h;s=r?a*o/i:o;p=this.getImageEditor()._getMaxCropAreaHeight(true);l=this.getImageEditor()._getMinCropAreaHeight(true)}this._resetValueStates();if(h>p||h<l){e.getSource().setValue(n);this._oModel.setProperty("/crop/"+t+"ValueState",W.Warning);this._oModel.setProperty("/crop/"+t+"ValueStateText",N.getText("IMGEDITOR_BAD_NUMBER",[l,p]))}else{this._setCropAreaBySize(s,a)}};st.prototype._getCropPanelContent=function(){var t=this;if(!this._oCropToolbarContent){this._oCropToolbarContent=[new A({tabDensityMode:Q.Compact,backgroundDesign:tt.Transparent,headerBackgroundDesign:tt.Transparent,expandable:false,select:function(e){var o=e.getParameter("key");t._setCropTypeByKey(o)},selectedKey:"{/crop/selectedTypeKey}",items:[new w({tooltip:N.getText("IMGEDITOR_CROP_RECTANGLE"),key:"Rectangle",text:"",content:[this._getRectangleCropGridList()]}),new w({tooltip:N.getText("IMGEDITOR_CROP_ELLIPSE"),key:"Ellipse",text:"",content:[this._getEllipseCropGridList()]}),new w({tooltip:N.getText("IMGEDITOR_CROP_CUSTOM"),key:"CustomShape",text:"",content:[this._getCustomShapeCropGridList(),this._getCustomShapeCropContent()]})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerTabBar").addStyleClass("sapSuiteUiCommonsImageEditorContainerFilterIcons"),new P({renderType:$.Bare,direction:Y.Column,items:[new P({renderType:$.Bare,justifyContent:J.SpaceBetween,items:[new P({renderType:$.Bare,direction:Y.Column,items:[new g({text:N.getText("IMGEDITOR_WIDTH"),labelFor:this.getId()+"-cropWidth"}),new c({id:this.getId()+"-cropWidth",type:Z.Number,textAlign:ot.Right,value:{path:"/crop/width",mode:"OneWay",type:"sap.ui.model.type.Integer"},valueState:"{/crop/widthValueState}",valueStateText:"{/crop/widthValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:N.getText("IMGEDITOR_PX"),change:this._onCropSizeInputChange.bind(this,"width"),enabled:{parts:["/crop/selectedTypeKey","/crop/customShapeLoaded","/crop/enabled"],formatter:function(t,e,o){return!(t==="CustomShape"&&!e)&&o}}})]}),new P({renderType:$.Bare,direction:Y.Column,justifyContent:J.End,items:[new h({tooltip:N.getText("IMGEDITOR_LOCK_RATIO"),icon:rt.LOCK,type:j.Transparent,pressed:{path:"/crop/keepAspectRatio"},press:function(e){var o=t.getImageEditor().getMode(),i,r;t._resetValueStates();if(t._oModel.getProperty("/crop/selectedTypeKey")==="Rectangle"){i=V.CropRectangle;r=t._selectRectangleCropCustomSizeItem.bind(t)}else if(t._oModel.getProperty("/crop/selectedTypeKey")==="Ellipse"){i=V.CropEllipse;r=t._selectEllipseCropCustomSizeItem.bind(t)}else{i=V.CropCustomShape;r=t._selectCustomShapeCropCustomSizeItem.bind(t)}if(o!==i){t.getImageEditor().setMode(i)}if(r){r(e.getParameter("pressed"))}}})]}),new P({renderType:$.Bare,direction:Y.Column,items:[new g({text:N.getText("IMGEDITOR_HEIGHT"),labelFor:this.getId()+"-cropHeight"}),new c({id:this.getId()+"-cropHeight",type:Z.Number,textAlign:ot.Right,value:{path:"/crop/height",mode:"OneWay",type:"sap.ui.model.type.Integer"},valueState:"{/crop/heightValueState}",valueStateText:"{/crop/heightValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:N.getText("IMGEDITOR_PX"),change:this._onCropSizeInputChange.bind(this,"height"),enabled:{parts:["/crop/selectedTypeKey","/crop/customShapeLoaded","/crop/enabled"],formatter:function(t,e,o){return!(t==="CustomShape"&&!e)&&o}}})]})]}),new P({renderType:$.Bare,alignItems:q.Center,items:[this._getScaleSwitch(),this._getScaleLabel()]}).addStyleClass("sapUiSmallMarginTopBottom"),new b({width:"50%",text:N.getText("IMGEDITOR_APPLY"),type:j.Emphasized,press:this._applyPreview.bind(this),enabled:{parts:["/crop/selectedTypeKey","/crop/customShapeLoaded","/crop/enabled"],formatter:function(t,e,o){return!(t==="CustomShape"&&!e)&&o}}})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")];this._oCropToolbarContent.forEach(function(t){this.addDependent(t)},this)}return this._oCropToolbarContent};st.prototype._getCustomShapeCropContent=function(){var t=this;if(!this.oCustomShapeContent){this.oCustomShapeContent=new P({renderType:$.Bare,direction:Y.Column,items:[new g({text:N.getText("IMGEDITOR_CROP_CUSTOM_FILE"),labelFor:this.getId()+"-customFile"}),new H({id:this.getId()+"-customFile",mimeType:"image/*",change:function(e){var o=e.getParameter("files")[0];if(!o){return}t._resetValueStates();t._enableCrop();t.getImageEditor().setMode(V.CropCustomShape);t.getImageEditor().setCustomShapeSrc(o)}})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea").addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelAreaMobile");this.addDependent(this.oCustomShapeContent)}return this.oCustomShapeContent};st.prototype._getFilterPanelContent=function(){var e=this;if(!this._oFilterToolbarContent){this._oFilterToolbarContent=[new m({min:"{/filter/selectedFilter/min}",max:"{/filter/selectedFilter/max}",showAdvancedTooltip:true,value:{path:"/filter/selectedFilter/value",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,it.FILTER),progress:true,ariaLabelledBy:[this.getId()+"-filterValue"]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileSlider"),this._getFilterGridList(),new P({renderType:$.Bare,direction:Y.Column,items:[new m({min:"{/filter/selectedFilter/min}",max:"{/filter/selectedFilter/max}",value:{path:"/filter/selectedFilter/value",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,it.FILTER),progress:true,ariaLabelledBy:[this.getId()+"-filterValue"]}),new g({id:this.getId()+"-filterValue",text:N.getText("IMGEDITOR_FILTER_VALUE")}),new c({type:Z.Number,textAlign:ot.Right,width:"5.9375rem",fieldWidth:"4.375rem",description:"{/filter/selectedFilter/unit}",change:function(o){e._onNumberInputChange(t.extend(it.FILTER,e._oModel.getProperty("/filter/selectedFilter")),o)},value:{path:"/filter/selectedFilter/value",type:"sap.ui.model.type.Integer",mode:"OneWay"},valueState:"{/filter/filterValueState}",valueStateText:"{/filter/filterValueStateText}",ariaLabelledBy:[this.getId()+"-filterValue"]}),new b({width:"50%",text:N.getText("IMGEDITOR_APPLY"),type:j.Emphasized,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")];this._oFilterToolbarContent.forEach(function(t){this.addDependent(t)},this)}return this._oFilterToolbarContent};st.prototype._getOptionsPanel=function(){if(!this._oOptionsPanel){this._oOptionsPanel=new P({renderType:$.Bare,direction:Y.Column});this._oOptionsPanel.addStyleClass("sapSuiteUiCommonsImageEditorContainerPanel");this._oOptionsPanel.setModel(this._oModel);this.addDependent(this._oOptionsPanel)}return this._oOptionsPanel};st.prototype.onkeydown=function(t){var e=this;function o(){return e._oModel.getProperty("/historyIndex")<e._oModel.getProperty("/history").length-1}if(t.ctrlKey&&t.key!=="Control"&&t.shiftKey&&t.key!=="Shift"){switch(t.key){case"z":case"Z":if(o()){this.getImageEditor().undo();if(o()){this._getUndoButton().focus()}else{this._getHistoryArrowButton().focus()}}t.preventDefault();break;case"y":case"Y":if(this._oModel.getProperty("/historyIndex")>0){this.getImageEditor().redo();this._getUndoButton().focus()}t.preventDefault();break;case"h":case"H":if(this._oModel.getProperty("/history").length>1){this._getHistoryArrowButton().focus();this._getHistoryPopover().openBy(this._oHistoryArrowButton)}t.preventDefault();break;default:break}}else if(t.ctrlKey&&t.key!=="Control"&&!t.shiftKey){switch(t.key){case"u":case"U":this._focusOnToolbar();t.preventDefault();break;case"g":case"G":this._focusOnPanel();t.preventDefault();break;case"i":case"I":this._focusOnImageEditor();t.preventDefault();break;case"e":case"E":this._setModeTransform("Resize");this._focusOnItem(this._getResizeGridList().getItems()[0]);t.preventDefault();break;case"r":case"R":this._setModeTransform("Rotate");this._focusOnItem(this._getRotateGridList().getItems()[0]);t.preventDefault();break;case"f":case"F":this._setModeTransform("Flip");this._focusOnItem(this._getFlipGridList().getItems()[0]);t.preventDefault();break;case"j":case"J":this._setModeCrop("Rectangle");this._focusOnItem(this._getRectangleCropGridList().getItems()[0]);t.preventDefault();break;case"s":case"S":this._setModeFilter();this._focusOnItem(this._getFilterGridList().getItems()[0]);t.preventDefault();break;case"Enter":this._applyPreview();break;default:break}}else if(t.altKey&&t.key!=="Alt"){switch(t.key){case"Enter":this._switchFocusPanelImage();t.preventDefault();break;default:break}}};st.prototype._focusFirstTabbable=function(t){var e=t.find(":tabbable").get(0);if(e){e.focus()}};st.prototype._focusOnToolbar=function(){this._focusFirstTabbable(this._getHeaderToolbar().$())};st.prototype._focusOnPanel=function(){this._focusFirstTabbable(this._getOptionsPanel().$())};st.prototype._focusOnImageEditor=function(){this._focusFirstTabbable(this.getImageEditor().$())};st.prototype._focusOnItem=function(t){if(t.getDomRef()){if(!this._getHistoryPopover().isOpen()){t.focus()}}else{var e={onAfterRendering:function(){t.removeEventDelegate(e);t.focus();if(t.getParent()&&t.getParent().isA("sap.m.List")){t.getParent()._startItemNavigation()}}};t.addEventDelegate(e)}};st.prototype._switchFocusPanelImage=function(){var t=document.activeElement;if(this._getOptionsPanel().getDomRef().contains(t)){this._focusOnImageEditor()}else{this._focusOnPanel()}};return st});