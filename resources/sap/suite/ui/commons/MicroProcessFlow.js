sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/base/ManagedObject","sap/ui/core/delegate/ItemNavigation","sap/ui/core/ResizeHandler"],function(t,e,i,s,o,r,n){"use strict";var l=e.MicroProcessFlowRenderType;var a=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var c=function(t){return t[t.length-1]};var h=i.extend("sap.suite.ui.commons.MicroProcessFlow",{metadata:{library:"sap.suite.ui.commons",interfaces:["sap.ui.core.IFormContent"],properties:{ariaLabel:{type:"string",defaultValue:null},renderType:{type:"sap.suite.ui.commons.MicroProcessFlowRenderType",defaultValue:sap.suite.ui.commons.MicroProcessFlowRenderType.Wrap},width:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{content:{type:"sap.suite.ui.commons.MicroProcessFlowItem",multiple:true,singularName:"content"}}},renderer:function(t,e){var i=e.getContent(),s=e.getWidth(),o=i.length,r=e.getAriaLabel();if(!e._bThemeApplied){return}t.write("<div ");t.writeAttributeEscaped("role","listbox");t.writeAttributeEscaped("aria-roledescription",a.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"));t.writeControlData(e);t.writeAttribute("aria-label",r);if(s){t.addStyle("width",s)}t.writeStyles();t.addClass("sapSuiteUiCommonsMicroProcessFlow");t.writeClasses(e);t.write(">");if(e._hasScrolling()){t.write('<div tabindex="0" id="'+e.getId()+'-leftscroller" class="sapSuiteUiCommonsMicroProcessFlowScroller sapSuiteUiCommonsMicroProcessFlowLeftScroller">');t.renderControl(e._getLeftScroller());t.write('<span id="'+e.getId()+'-leftlabel" class="sapSuiteUiCommonsMicroProcessFlowLeftLabel"></span>');t.write("</div>")}t.write('<div id="'+e.getId()+'-content" class="sapSuiteUiCommonsMicroProcessFlowContent">');t.write('<div id="'+e.getId()+'-scrolling" class="sapSuiteUiCommonsMicroProcessFlowScrolling sapSuiteUiCommonsMicroProcessFlowScrollingTransition"');if(e.getRenderType()===l.Wrap){t.addStyle("flex-wrap","wrap");t.writeStyles()}t.write(">");i.forEach(function(e,i){e._setAccessibilityData(i+1,o);t.renderControl(e)});t.write("</div>");t.write("</div>");if(e._hasScrolling()){t.write('<div tabindex="0" id="'+e.getId()+'-rightscroller" class="sapSuiteUiCommonsMicroProcessFlowScroller sapSuiteUiCommonsMicroProcessFlowRightScroller">');t.write('<span id="'+e.getId()+'-rightlabel" class="sapSuiteUiCommonsMicroProcessFlowRightLabel"></span>');t.renderControl(e._getRightScroller());t.write("</div>")}t.write("</div>")}});h.prototype.exit=function(){if(this._oLeftScroller){this._oLeftScroller.destroy()}if(this._oRightScroller){this._oRightScroller.destroy()}};h.prototype.init=function(){sap.ui.getCore().attachThemeChanged(function(){this._bThemeApplied=true;this.invalidate()},this);this._bThemeApplied=sap.ui.getCore().isThemeApplied();this._iScrollingIndex=0;this._iLastVisibleIndex=0;this._aEdges=[];this._aWidths=[]};h.prototype.onAfterRendering=function(){this._correctSeparatorWidth();this._setupKeyboard();if(this._hasScrolling()){this._setupScrolling();this._collectEdgesAndWidths();this._updateScrollingElements();if(this.getRenderType()===l.ScrollingWithResizer){this._oResizer=n.register(this,t.proxy(this._performResizeChanges,this))}}};h.prototype._performResizeChanges=function(){this._collectEdgesAndWidths();this._updateScrollingElements()};h.prototype._isLastItem=function(t){return t===this.getContent()[this.getContent().length-1]};h.prototype._getMaxHeight=function(e){return Math.max.apply(null,this.$().find(".sapSuiteUiCommonsMicroProcessFlowItemWrapper").map(function(){return t(this).height()}).get())};h.prototype._correctSeparatorWidth=function(){var t=this._getMaxHeight();if(t){this.getContent().forEach(function(e){var i=e.getStepWidth(),s;if(i.indexOf("%")!==-1){s=parseInt(i,10);if(!isNaN(s)){e.$("separator").width(t/s*100)}}},this)}};h.prototype._firePress=function(){if(this._oItemNavigation){var t=this._oItemNavigation.getFocusedIndex(),e=this.getContent()[t];if(e){e._firePress()}}};h.prototype._setupKeyboard=function(){var t=this.getDomRef(),e=this.getContent(),i=[];e.forEach(function(t,e){var s=t._getAccessibleItem();i.push(s[0])});if(!this._oItemNavigation){this._oItemNavigation=new r;this.addDelegate(this._oItemNavigation)}this._oItemNavigation.setRootDomRef(t);this._oItemNavigation.setItemDomRefs(i);this._oItemNavigation.setCycling(false);this._oItemNavigation.attachEvent(r.Events.AfterFocus,function(t){if(this._bKeyBoard===true){this._findEdgeItems(t.getParameter("index"));this._updateScrollingElements()}this._bKeyBoard=false}.bind(this))};h.prototype._hasScrolling=function(){var t=this.getRenderType();return t===l.Scrolling||t===l.ScrollingWithResizer};h.prototype._setupScrolling=function(){var t=this.$("leftscroller"),e=this.$("rightscroller");this._iScrollingIndex=0;this._iLastVisibleIndex=0;t.on("click",this._scroll.bind(this,-1));e.on("click",this._scroll.bind(this,1));this._iScrollingIndex<=0?t.hide():t.show()};h.prototype._updateScrollingElements=function(t){var e=this.getContent(),i=this.$("leftscroller"),s=this.$("rightscroller");i[this._iScrollingIndex<=0?"hide":"show"]();this._iLastVisibleIndex=this._findLastVisibleItemIndex(t);s[this._iLastVisibleIndex>=e.length-1?"hide":"show"]();this.$("leftlabel").text(this._iScrollingIndex);this.$("rightlabel").text(e.length-1-this._iLastVisibleIndex)};h.prototype._scroll=function(t,e){e.stopPropagation();var i=this.getContent(),s=this.$("rightscroller"),o=this.$("leftscroller"),r=sap.ui.getCore().getConfiguration().getRTL(),n,l,a;var h=function(){if(t>0){var e=this.$("content").width()-(o.is(":visible")?0:o.width()),i=c(this._aEdges)+c(this._aWidths);if(n+e>i){n-=n+e-i+s.width();for(var r=0;r<this._aEdges;r++){if(this._aEdges[r]+this._aWidths[r]>n){this._iScrollingIndex=r;break}}}}}.bind(this);var p=function(){if(!r&&g[0].scrollLeft!=0){this._clearScroll(g)}if(r){a=g.scrollRightRTL();if(a){this._clearScroll(g)}}}.bind(this);var d=this.$("scrolling"),g=d.parent();this._bKeyBoard=false;if(t<0&&this._iScrollingIndex<=0){return}p();t<0?s.show():o.show();this._iScrollingIndex+=t;n=this._aEdges[this._iScrollingIndex];h();l="translateX("+(r?1:-1)*n+"px)";this.$("scrolling").css("transform",l);if(!d.hasClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")){setTimeout(function(){d.addClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")},0)}this._updateScrollingElements(t);p()};h.prototype._clearScroll=function(t){var e=sap.ui.getCore().getConfiguration().getRTL();if(t&&t[0]){e?t.scrollLeftRTL(t[0].scrollWidth-t[0].clientWidth):t[0].scrollLeft=0}};h.prototype._findLastVisibleItemIndex=function(t){var e=this._aEdges[this._iScrollingIndex],i=this.$("content").width(),s=i+this.$("rightscroller").width(),o,r=0,n;for(var l=0;l<this._aEdges.length;l++){o=this._aEdges[l];if(o+this._aWidths[l]-10<e+i){r=l}else{if(o+this._aWidths[l]<e+s){n=true}else{n=false;break}}}return n&&t!==-1?this.getContent().length-1:r};h.prototype._collectEdgesAndWidths=function(){var t=0,e=0,i=this.$("content").width();this._aEdges=[];this._aWidths=[];this.getContent().forEach(function(e,i){var s=e.$().width();this._aEdges.push(t);this._aWidths.push(s);t+=s},this)};h.prototype._getLeftScroller=function(){if(!this._oLeftScroller){this._oLeftScroller=new s(this.getId()+"leftscroller",{src:"sap-icon://nav-back"});this._oLeftScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow")}return this._oLeftScroller};h.prototype._getRightScroller=function(){if(!this._oRightScroller){this._oRightScroller=new s(this.getId()+"rightscroller",{src:"sap-icon://navigation-right-arrow"});this._oRightScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow")}return this._oRightScroller};h.prototype._findEdgeItems=function(t){var e=this.$("scrolling"),i=e.parent(),s=this.$("leftscroller"),o=this.$("rightscroller"),r=this.getContent(),n=Math.abs(e.position().left),l,a,c=-1,h=-1;if(n<10||t===0){c=0;this._clearScroll(i)}if(t===r.length-1){h=r.length-1}l=e.width();for(var p=0;p<this._aEdges.length;p++){a=this._aEdges[p];if(c===-1&&a>=n){c=p}if(h===-1&&a+this._aWidths[p]>n+l+5){h=p-1;break}}this._iScrollingIndex=c;this._iLastVisibleIndex=h!==-1?h:r.length-2};h.prototype._processKeyPress=function(){if(this._hasScrolling()){var t=this.$("scrolling");this._bKeyBoard=true;t.removeClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");t.css("transform","")}};h.prototype.onsapspace=function(){this._firePress()};h.prototype.onsapenter=function(){this._firePress()};h.prototype.onsapnext=function(t){this._processKeyPress()};h.prototype.onsapprevious=function(){this._processKeyPress()};h.prototype.onsaphome=function(t){this._processKeyPress()};h.prototype.onsapend=function(){this._processKeyPress()};h.prototype.getAccessibilityInfo=function(){var t="";this.getAggregation("content").forEach(function(e){t=t.concat(e._getAriaText())});return{type:a.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"),description:t}};h.prototype.getFormDoNotAdjustWidth=function(){return true};return h});