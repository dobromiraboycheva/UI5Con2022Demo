/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","./VizFrame","./VizRangeSlider","./common/utils/Constants","sap/ui/Device","sap/ui/thirdparty/jquery","sap/base/util/deepEqual","./VizSliderRenderer"],function(e,t,i,a,r,n,s){"use strict";var g={plotArea:{dataLabel:{visible:false}},legend:{visible:false},categoryAxis:{visible:false},valueAxis:{title:{visible:false}},title:{visible:false},interaction:{noninteractiveMode:true},timeAxis:{visible:false}};var o=e.extend("sap.viz.ui5.controls.VizSlider",{metadata:{library:"sap.viz",properties:{vizType:{type:"string",group:"Misc",defaultValue:"column"},uiConfig:{type:"object",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"800px"},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"200px"},valueAxisVisible:{type:"boolean",group:"Misc",defaultValue:true},showPercentageLabel:{type:"boolean",group:"Appearance",defaultValue:true},showStartEndLabel:{type:"boolean",group:"Appearance",defaultValue:true},range:{type:"object",group:"Appearance",defaultValue:null},_categoryRange:{type:"object",group:"Appearance",defaultValue:null,visibility:"hidden"}},aggregations:{_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},_rangeSlider:{type:"sap.viz.ui5.controls.VizRangeSlider",multiple:false,visibility:"hidden"},dataset:{type:"sap.viz.ui5.data.Dataset",multiple:false},feeds:{type:"sap.viz.ui5.controls.common.feeds.FeedItem",multiple:true,singularName:"feed"}},events:{rangeChanged:{}}}});o.prototype.applySettings=function(){e.prototype.applySettings.apply(this,arguments);var a=new t({width:this.getWidth(),height:this.getHeight(),vizType:this.getVizType(),uiConfig:this.getUiConfig()});a.attachRenderComplete(y.bind(this));var r=new i({visible:false,showAdvancedTooltip:false,showHandleTooltip:false});r.setParentFrame(this);this.setAggregation("_vizFrame",a);this.setAggregation("_rangeSlider",r);r.attachChange(m.bind(this))};var l=["info/column","info/line","info/timeseries_line","info/timeseries_column"];o.prototype.setVizType=function(e){if(e.indexOf("info/")!==0){e="info/"+e}if(l.indexOf(e)===-1){e="info/null"}this.setProperty("vizType",e);return this};o.prototype.getDataset=function(e){var t=this._getVizFrame();return t&&t.getDataset()||this.getAggregation("dataset")};o.prototype.addFeed=function(e){var t=this._getVizFrame();if(t){t.addFeed(e)}else{this.addAggregation("feeds",e)}return this};o.prototype.removeFeed=function(e){var t=this._getVizFrame();if(t){t.removeFeed(e)}else{this.removeAggregation("feeds",e)}return this};o.prototype.removeAllFeeds=function(){var e=this._getVizFrame();if(e){e.removeAllFeeds()}else{this.removeAllAggregation("feeds")}return this};o.prototype.getFeeds=function(){var e=this._getVizFrame();return e&&e.getFeeds()||this.getAggregation("feeds")};o.prototype.exit=function(){var e=this._getVizFrame();e&&e.detachRenderComplete(y.bind(this),this);var t=this.getAggregation("_rangeSlider");t&&t.detachChange(m.bind(this))};o.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame")};o.prototype._getRangeSlider=function(){return this.getAggregation("_rangeSlider")};o.prototype.onAfterRendering=function(){var e=this._getVizFrame();var t={valueAxis:{visible:this.getProperty("valueAxisVisible")}};t=n.extend(true,{},t,g);e.setVizProperties(t);e.setUiConfig(this.getProperty("uiConfig"));e.setVizType(this.getProperty("vizType"));e.setHeight(this.getProperty("height"));e.setWidth(this.getProperty("width"));var i=this.getAggregation("dataset");if(i){this.removeAggregation("dataset");e.setDataset(i)}var a=this.getAggregation("feeds");if(a){this.removeAllAggregation("feeds");e.removeAllFeeds();for(var r=0;r<a.length;++r){e.addFeed(a[r])}}var s=this._getRangeSlider();s.setShowStartEndLabel(this.getProperty("showStartEndLabel"));s.setShowPercentageLabel(this.getProperty("showPercentageLabel"))};o.prototype.setRange=function(e){this.setProperty("range",e);this.invalidate();if(this._getVizFrame()){if(this._getVizFrame()._vizFrame){d.call(this,e)}}return this};o.prototype._setCategoryRange=function(e){this.setProperty("_categoryRange",e);this.invalidate();if(this._getVizFrame()){if(this._getVizFrame()._vizFrame){f.call(this,e)}}return this};function h(){var e=this.getVizType();return e==="info/timeseries_column"||e==="info/timeseries_line"}function p(){var e=this.getVizType();return e==="info/column"||e==="info/line"}function u(e){return e[Object.keys(e)[0]]}o.prototype.getRange=function(){if(!h.apply(this)){return null}return this.rangeState};o.prototype._getCategoryRange=function(){if(!p.apply(this)){return null}return this.categoryRangeState};o.prototype._getTooltipContent=function(e,t,i){var a=e,r=t;if(p.apply(this)){if(i==="end"&&r-a>1){r--}}var n=this._getVizFrame();return n._getDataRange(a,r).displayValues[i]};function d(e){var t=this._getRangeSlider();var i=this._getVizFrame();t.setRange(v.call(this,e));var a=t.getRange();var r=i._getDataRange(a[0],a[1]);this.rangeState={start:u(r.start),end:u(r.end)}}function f(e){var t=this._getRangeSlider();var i=this._getVizFrame();t.setRange(c.call(this,e));var a=t.getRange();var r=i._getDataRange(a[0]+1,a[1]-1);this.categoryRangeState={start:r.data[0],end:r.data[r.data.length-1]}}function v(e){if(!h.apply(this)){return null}if(!e||!("start"in e)&&!("end"in e)){return[0,100]}var t=new Date(e.start).getTime();var i=new Date(e.end).getTime();var a=this._getVizFrame()._getDataRange(0,100);var r=this.getRange();var n=u(a.start);var s=u(a.end);if(!r){r={};r.start=n;r.end=s}t=isNaN(t)?r.start:t;i=isNaN(i)?r.end:i;if(t<i&&t<s&&i>n){t=Math.max(t,n);i=Math.min(i,s);var g=s-n;return[(t-n)/g*100,(i-n)/g*100]}return[0,100]}function c(e){if(!p.apply(this)){return null}if(!e||!("start"in e)&&!("end"in e)){return[0,100]}var t=this._getVizFrame()._getDataRange(0,100);var i=t.data.length;var a=t.data[0];var r=t.data[i-1];var n=this._getCategoryRange()||{start:a,end:r};var g=e.start||n.start;var o=e.end||n.end;var l=-1,h=-1;t.data.forEach(function(e,t){if(s(g,e)){l=t}if(s(o,e)){h=t+1}});if(l<h&&l<i&&h>0){l=Math.max(l,0);h=Math.min(h,i);return[l/i*100,h/i*100]}return[0,100]}function y(){var e=this._getVizFrame()._states().plot.sizeInfo;var t=this._getVizFrame();this._curRange=[];var i=this._getRangeSlider();if(e){i.setWidth(e.width+"px");i.setHeight(e.height+"px");i.setLeft(e.x+"px");i.setTop(e.y+"px");i.setVisible(true);i.invalidate();if(h.apply(this)){var a=this.rangeState?this.rangeState:this.getProperty("range");d.call(this,a)}if(p.apply(this)){var r=this.categoryRangeState?this.categoryRangeState:this.getProperty("_categoryRange");f.call(this,r)}}else{i.setVisible(false)}t._setTitleAria("A noninteractive "+t._getMetadata().name+" with Range Slider ")}function m(e,t){var i=e.getParameters().range;if(this._curRange[0]===i[0]&&this._curRange[1]===i[1]){return}else{var a=this._getVizFrame();var r=a._getDataRange(i[0],i[1]);if(h.apply(this)){this.rangeState={start:u(r.start),end:u(r.end)}}if(p.apply(this)){if(i[1]-i[0]>1){r=a._getDataRange(i[0],i[1]-1)}this.categoryRangeState={start:r.data[0],end:r.data[r.data.length-1]}}this._curRange[0]=i[0];this._curRange[1]=i[1];delete r.displayValues;this.fireEvent("rangeChanged",{data:r})}}return o});