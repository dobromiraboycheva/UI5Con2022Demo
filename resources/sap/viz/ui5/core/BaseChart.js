/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ui/core/theming/Parameters","sap/viz/library","sap/viz/libs/sap-viz","./BaseStructuredType","./BaseChartMetadata","sap/ui/thirdparty/jquery","sap/base/util/each","./BaseChartRenderer","jquery.sap.sjax"],function(t,e,i,s,r,a,n,o,p){"use strict";var h=t.extend("sap.viz.ui5.core.BaseChart",{metadata:{abstract:true,library:"sap.viz",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"640px"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"480px"},css:{type:"string",group:"Appearance",defaultValue:null}},aggregations:{dataset:{type:"sap.viz.ui5.data.Dataset",multiple:false},noData:{type:"sap.ui.core.Control",multiple:false}},events:{beforeCreateViz:{parameters:{usrOptions:{type:"object"}}}}}},n);h.prototype.getVIZChartType=function(){return this.getMetadata().getVIZChartType()};h.prototype._getSapVizCSS=function(){var t,e,i;var s=window.document.getElementById("sap-ui-theme-sap.viz");if(s){e=s.href;t=o.sap.syncGetText(e+"?",undefined,undefined);if(!t){t=""}}if(this.getCss()){i=t+this.getCss()}return i};h.prototype._getMergedChartOptions=function(){var t=this._getOptions();var e=i.get("sapVizChartAxisGridlineColor");var s=i.get("sapVizChartAxisColor");var r={xAxis:{gridline:{color:e}},yAxis:{gridline:{color:e}}};var a=this.getVIZChartType();switch(a){case"viz/dual_bar":r.yAxis.color=s;break;case"viz/dual_combination":case"viz/dual_line":case"viz/dual_stacked_column":case"viz/100_dual_stacked_column":case"viz/dual_column":r.xAxis.color=s;break;default:r.xAxis.color=s;r.yAxis.color=s;break}return o.extend(true,r,t)};h.prototype._unregisterListener=function(){if(this._sResizeListenerId){e.deregister(this._sResizeListenerId);delete this._sResizeListenerId}};h.prototype._registerListener=function(){this._sResizeListenerId=e.register(this.getDomRef(),o.proxy(this.onresize,this))};h.prototype._renderChart=function(){if(!sap.viz.__svg_support||!this.getDataset()||!this.getDataset().getVIZDataset()){return}if(this._oVIZInstance){this._oVIZInstance.destroy();delete this._oVIZInstance}var t=this._getSapVizCSS();var e=this._getMergedChartOptions();var i={type:this.getVIZChartType(),data:this.getDataset().getVIZDataset(),container:this.getDomRef(),options:e,css:t};this.fireBeforeCreateViz({usrOptions:i});this._oVIZInstance=sap.viz.core.createViz(i);var s=this;p(this._mVIZHandler,function(t,e){s._oVIZInstance.on(t+h.EVENT_SUFFIX,e)})};h.prototype.init=function(){sap.viz._initializeVIZ();this._mVIZHandler={}};h.prototype.exit=function(){this._unregisterListener();if(this._oVIZInstance){this._oVIZInstance.destroy();delete this._oVIZInstance}};h.prototype.onBeforeRendering=function(){this._unregisterListener()};h.prototype.onAfterRendering=function(){this._renderChart();this._registerListener()};h.prototype.onresize=function(t){var e={width:this.$().width(),height:this.$().height()};if(this.getDomRef()&&this._oVIZInstance){this._oVIZInstance.size(e)}};h.prototype.setDefaultSelection=function(t){var e=this.getDataset();if(e){var i=e.getVIZDataset();if(i){i.info({type:"defaultSelection",value:t});if(this._oVIZInstance){this._oVIZInstance.data(i)}}}};h.prototype.onThemeChanged=function(t){if(!this.getDomRef()){return}this._renderChart()};h.prototype.onLocalizationChanged=function(t){if(!this.getDomRef()){return}this._renderChart()};h.prototype.validateAggregation=function(e,i,s){if(e==="interaction"){i=a._convertAggregatedObject.call(this,e,i,s)}return t.prototype.validateAggregation.call(this,e,i,s)};h.EVENT_SUFFIX=".sap.viz.ui5.core";h.prototype._getOrCreate=a.prototype._getOrCreate;h.prototype._getOptions=a.prototype._getOptions;h.prototype._attachVIZEvent=function(e,i,s,r){var a=this;if(!this.hasListeners(e)){this._mVIZHandler[e]=function(t){a.fireEvent(e,t)};if(this._oVIZInstance){this._oVIZInstance.on(e+h.EVENT_SUFFIX,this._mVIZHandler[e])}}t.prototype.attachEvent.apply(this,arguments);return this};h.prototype._detachVIZEvent=function(e,i,s,r){t.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners(e)){if(this._oVIZInstance){this._oVIZInstance.on(e+h.EVENT_SUFFIX,null)}delete this._mVIZHandler[e]}return this};h.prototype.getVIZInstance=function(){return this._oVIZInstance||null};h.prototype.selection=function(t,e){if(this._oVIZInstance){return this._oVIZInstance.selection.apply(this._oVIZInstance,arguments)}};return h});