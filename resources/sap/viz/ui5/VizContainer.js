/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/viz/library","sap/viz/libs/sap-viz","./container/libs/common/libs/rgbcolor/rgbcolor_static","./container/libs/sap-viz-controls-vizcontainer","./controls/common/BaseControl","./controls/common/feeds/AnalysisObject","./controls/common/feeds/FeedItem","./container/VizControlsHelper","sap/ui/thirdparty/jquery","./VizContainerRenderer","sap/ui/thirdparty/jqueryui/jquery-ui-core","sap/ui/thirdparty/jqueryui/jquery-ui-widget","sap/ui/thirdparty/jqueryui/jquery-ui-mouse","sap/ui/thirdparty/jqueryui/jquery-ui-draggable","sap/ui/thirdparty/jqueryui/jquery-ui-droppable"],function(e,i,t,s,r,a,n,o,h){"use strict";var l=r.extend("sap.viz.ui5.VizContainer",{metadata:{library:"sap.viz",properties:{vizType:{type:"string",group:"Misc",defaultValue:null},vizCss:{type:"string",group:"Misc",defaultValue:null},vizProperties:{type:"object",group:"Misc",defaultValue:null},enableMorphing:{type:"boolean",group:"Misc",defaultValue:null}},aggregations:{vizData:{type:"sap.viz.ui5.data.Dataset",multiple:false},analysisObjectsForPicker:{type:"sap.viz.ui5.controls.common.feeds.AnalysisObject",multiple:true,singularName:"analysisObjectsForPicker"},feeds:{type:"sap.viz.ui5.controls.common.feeds.FeedItem",multiple:true,singularName:"feed"}},events:{feedsChanged:{parameters:{feeds:{type:"sap.viz.ui5.controls.common.feeds.FeedItem[]"}}},vizTypeChanged:{},vizDefinitionChanged:{},selectData:{},deselectData:{},showTooltip:{},hideTooltip:{},initialized:{}}}});l.prototype.init=function(){r.prototype.init.apply(this,arguments);this._uiConfig={layout:"horizontal",enableMorphing:true};this._vizFrame=null;this._vizBuilder=null;this._switchBar=null;this._vSplitter$=null;this._clearVariables()};l.prototype.exit=function(){r.prototype.exit.apply(this,arguments);this._clearVariables();this.setVizData(null)};l.prototype._clearVariables=function(){this._vizFrame$=null;this._vizBuilder$=null;this._switchBar$=null;this._clearRequestedProperties()};l.prototype._clearRequestedProperties=function(){this._requestedVizType="viz/column";this._requestedVizCss=null;this._requestedVizProperties=null;this._requestedOptions=null};l.prototype.setUiConfig=function(e){this._mergeConfig(e);return this};l.prototype._mergeConfig=function(e){e=e||{};if(e.layout==="vertical"||e.layout==="horizontal"){this._uiConfig.layout=e.layout}this._uiConfig.enableMorphing=e.enableMorphing!==false};l.prototype.getFeeds=function(){var e=[];if(this._vizFrame&&this._vizFrame.feeds()){e=n.fromVizControlsFmt(this._vizFrame.feeds())}else{e=this.getAggregation("feeds")}return e};l.prototype.getVizType=function(){if(this._vizFrame){return this._vizFrame.vizType()}else{return this._requestedVizType}};l.prototype.setVizType=function(e){if(this._vizFrame){this._vizFrame.vizType(e)}else{this._requestedVizType=e}return this};l.prototype.getVizCss=function(){if(this._vizFrame){return this._vizFrame.vizCss()}else{return this._requestedVizCss}};l.prototype.setVizCss=function(e){if(this._vizFrame){this._vizFrame.vizCss(e)}else{this._requestedVizCss=e}return this};l.prototype.getVizProperties=function(){if(this._vizFrame){return this._vizFrame.vizProperties()}else{return this._requestedVizProperties}};l.prototype.setVizProperties=function(e){if(this._vizFrame){this._vizFrame.vizProperties(e)}else{this._requestedVizProperties=e}return this};l.prototype.getEnableMorphing=function(){if(this._vizFrame){return this._vizFrame.enableMorphing()}else{return this._uiConfig.enableMorphing}};l.prototype.setEnableMorphing=function(e){if(this._vizFrame){this._vizFrame.enableMorphing(e)}else{this._uiConfig.enableMorphing=e}return this};l.prototype.vizSelection=function(e,i){if(this._vizFrame){var t=this._vizFrame.vizSelection.apply(this._vizFrame,arguments);if(t===this._vizFrame){t=this}return t}else{return null}};l.prototype.vizUpdate=function(e){if(this._vizFrame){if(e.data||e.feeds){this._requestedOptions=this._requestedOptions||{}}if(this._requestedOptions){var i=this._requestedOptions;i.css=i.css||e.css;i.properties=i.properties||e.properties;if(e.data){this.setVizData(e.data)}if(e.feeds){this._resetFeeds(e.feeds)}}else{this._vizFrame.vizUpdate(e)}}};l.prototype._resetFeeds=function(e){this.destroyFeeds();o.updateFeedsByAAIndex(this.getVizType(),e);if(e&&e.length){for(var i=0;i<e.length;i++){this.addFeed(e[i])}}return this};l.prototype._setAnalysisObjectsForPicker=function(e){this.destroyAnalysisObjectsForPicker();if(e&&e.length){for(var i=0;i<e.length;i++){this.addAnalysisObjectsForPicker(e[i])}}return this};l.prototype._createVizFrame=function(e){var i=sap.viz.controls.frame.VizFrame;var t=sap.viz.controls.common.config.GlobalConfig;var s=t.defaultUIConfig(t.DEFAULT_UICONFIG_TYPE_FRAME);s.enableFilterMenu=false;s.enableFilterBar=false;s.enableSettingButton=false;s.enableFullScreenButton=false;s.controls.chart.enableMorphing=this._uiConfig.enableMorphing;s.controls.chart.enableTrellis=false;s.controls.contextMenu.menu=[["direction","stacking"],["legend","datalabels"]];var r=new i(e,s);r.addEventListener("feedsChanged",h.proxy(function(e){this._resetFeeds(this.getFeeds());this.fireEvent("feedsChanged",{feeds:this.getFeeds()})},this));r.addEventListener("vizTypeChanged",h.proxy(function(e){this.fireEvent("vizTypeChanged")},this));r.addEventListener("vizDefinitionChanged",h.proxy(function(e){this.fireEvent("vizDefinitionChanged")},this));r.vizOn("selectData",h.proxy(function(e){this.fireEvent("selectData",e)},this));r.vizOn("deselectData",h.proxy(function(e){this.fireEvent("deselectData",e)},this));r.vizOn("showTooltip",h.proxy(function(e){this.fireEvent("showTooltip",e)},this));r.vizOn("hideTooltip",h.proxy(function(e){this.fireEvent("hideTooltip",e)},this));r.vizOn("initialized",h.proxy(function(e){this.fireEvent("initialized",e)},this));var a=r.getDefaultIncompleteOptions(this.getVizType());var n=this.getAggregation("feeds");if(n){a.feeds=o.getFeedInstances(n)}var l=o.getFakedDataInstance(this.getVizType(),this.getVizData(),n);if(l){a.data=l}if(this.getVizCss()){a.css=this.getVizCss()}if(this.getVizProperties()){a.properties=this.getVizProperties()}this._clearRequestedProperties();r.createViz(a);return r};l.prototype._createChildren=function(){var e=this._app$;var i="ui5-viz-controls";var t=sap.viz.controls.common.config.GlobalConfig;this._vizFrame$=h(document.createElement("div")).appendTo(e).addClass(i+"-viz-frame");this._vizFrame=this._createVizFrame(this._vizFrame$[0]);if(this._uiConfig.layout==="horizontal"){var s=t.defaultUIConfig(t.DEFAULT_UICONFIG_TYPE_BUILDER);s.controls.feedingPanel.enableTrellis=false;s.controls.switchBar.groups=o.getSwitchBarGroups();this._vizBuilder$=h(document.createElement("div")).appendTo(e).addClass(i+"-viz-builder");this._vizBuilder=new sap.viz.controls.builder.VizBuilder(this._vizBuilder$[0],s);this._vizBuilder.connect(this._vizFrame.vizUid());this._vSplitter$=h(document.createElement("div")).appendTo(e).addClass(i+"-vertical-splitter")}else if(this._uiConfig.layout==="vertical"){var r=t.defaultUIConfig(t.DEFAULT_UICONFIG_TYPE_SWITCHBAR);r.groups=o.getSwitchBarGroups();this._switchBar$=h(document.createElement("div")).appendTo(e);this._switchBar=new sap.viz.controls.switchbar.SwitchBar(this._switchBar$[0],r);this._switchBar.connect(this._vizFrame.vizUid())}this._validateAOs();this._validateSize()};l.prototype._updateChildren=function(){var e={};if(this._requestedOptions){if(this._requestedOptions.css){e.css=this._requestedOptions.css}if(this._requestedOptions.properties){e.properties=this._requestedOptions.properties}this._requestedOptions=null}e.data=o.getFakedDataInstance(this.getVizType(),this.getVizData(),this.getAggregation("feeds"));e.feeds=o.getFeedInstances(this.getAggregation("feeds"));this._vizFrame.vizUpdate(e);this._validateAOs()};l.prototype._validateAOs=function(){if(this._vizBuilder){var e=a.toVizControlsFmt(this.getAnalysisObjectsForPicker());this._vizBuilder.analysisObjectsForPicker(e)}};l.prototype._validateSize=function(){if(this._uiConfig.layout==="horizontal"){this._app$.css({"min-width":"560px","min-height":"601px"})}else if(this._uiConfig.layout==="vertical"){this._app$.css({"min-width":"300px","min-height":"654px"})}this.$().css({overflow:"hidden"});var e={width:this._app$.width(),height:this._app$.height()};if(this._uiConfig.layout==="horizontal"&&this._vizFrame){var i=this._vizBuilder$.width();this._vizFrame.size({width:e.width-i,height:e.height});this._vizBuilder.size({width:i,height:e.height-1});this._vizFrame$.css({left:"0px",top:"0px"});this._vizBuilder$.css({left:e.width-i+"px",top:"0px"});this._vSplitter$.css({left:e.width-i+"px",top:"0px",height:e.height+"px"})}else if(this._uiConfig.layout==="vertical"&&this._vizFrame){var t=388;var s=54;this._vizFrame.size({width:e.width,height:e.height-s});this._switchBar.size({width:t,height:s});this._vizFrame$.css({left:"0px",top:s+"px"});this._switchBar$.css({left:(e.width-t)/2+"px",top:(s-36)/2+"px"})}this.$().css({overflow:"auto"})};return l});