/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/chart/coloring/ColoringUtils","sap/chart/coloring/ColorPalette","sap/chart/coloring/criticality/measureValues/MeasureUtils","sap/chart/ChartLog","sap/chart/data/MeasureSemantics","sap/ui/thirdparty/jquery"],function(e,t,r,i,a,n){"use strict";var s={};var o=["Static","Calculated","DynamicThresholds","ConstantThresholds"];function l(e,t,a,s,o,l,u,c){var h={supportMultiMsr:false,supportHeatMap:false};var f=o.length>1;if(r[e].validate){n.extend(h,r[e].validate(l,a,s,t,c))}if(f&&!h.supportMultiMsr){throw new i("error","Colorings.Criticality","Only support multiple active measures when using Static Criticality.")}if(u.bMBC&&!h.supportHeatMap){throw new i("error","Colorings","Heatmap only support Criticality.MeasureValues.ConstantThresholds.")}}var u=function(t,r,a,n,s){var u=a.aMsr;e.checkColoringMeasure(n,u,t);var h=[];n.forEach(function(e,u){var f=Object.keys(t[e]).filter(function(e){return o.indexOf(e)>-1}).sort();var g=c(f);if(f.length>1&&!g){throw new i("error","Colorings.Criticality.MeasureValues",'The combination of "DynamicThresholds"and "ConstantThresholds" or only one of "Static", "Calculated", "DynamicThresholds", or "ConstantThresholds" can be applied to the measure, '+e+".")}if(!g&&f.length===1){l(f[0],r,e,a,n,t,s,h)}});if(e.hasSeriesDim(a)||s.bTimeChart&&s.bWaterfall&&a.aDim.length>1||s.bIsPie&&a.aDim.length){throw new i("error","colorings.Criticality.MeasureValues","Semantic coloring could not be applied if chart already has coloring.")}};function c(e){return e.length===2&&e[0]=="ConstantThresholds"&&e[1]==="DynamicThresholds"}function h(e,t){var r=e.filter(function(e){return e.msr.getName()===t})[0];return r}function f(e,t,r){if(e.sMethod==="Static"){var i=[];t.forEach(function(t){n.each(a,function(s,o){var l=t[o];if(l){var u=h(e,t[o]);if(!u){n.each(a,function(a,n){if(o!==n){var s=h(e,t[n]);if(s){var u=r.filter(function(e){return e.getName()===l})[0];var c={msr:u,settings:{Static:s.settings.Static},type:"Static"};i.push(c)}}})}else{t.criticalityType=u.settings.Static}}})});e.push.apply(e,i)}}s.qualify=function(t,r,s,o,h,g){u(t,r,o,s,g);var d=[],m=[],p=o.aDim.map(function(e){return e.getName()}).sort();n.each(t,function(a,n){var u=Object.keys(n);var h=e.find(a,o.aMsr);var f=u.filter(function(e){return e!=="Legend"}).sort();if(s.length&&s.indexOf(a)===-1){return}var v=false,C;for(var y=0;y<f.length&&!v;y++){C=f[y];d.sMethod=C;if(C==="ConstantThresholds"){var M=null,b=null;for(var w=0;w<n[C].AggregationLevels.length;w++){if(n[C].AggregationLevels[w].VisibleDimensions){var T=n[C].AggregationLevels[w].VisibleDimensions.sort();if(T.join(",")===p.join(",")){M=n[C].AggregationLevels[w]}}else{b=n[C].AggregationLevels[w]}}M=M||b;if(M){v=true;if(!g.bFiltered){d.push({type:C,msr:h,settings:n,byAggregation:M});m.push(h.getName())}}}else{v=true;d.push({type:C,msr:h,settings:n});m.push(h.getName())}}if(!v){throw new i("error","Colorings.Criticality.MeasureValues.ConstantThresholds","No aggregation levels matched with current visible dimensions.")}if(c(f)){l(C,r,h.getName(),o,s,t,g)}});f(d,r,o.aMsr);if(d.length){var v=0;r.forEach(function(e){var t=false;n.each(a,function(r,i){if(m.indexOf(e[i])>-1){t=true;return false}});if(!t){e.iUnMentionedIndex=v++}});if(v>3){throw new i("error","Colorings.Criticality.MeasureValues","Too many unmentioned measures (the maximum number is 3).")}}d.bShowUnmentionedMsr=g.bShowUnmentionedMsr;return d};s.parse=function(e,t,i,a,n){var s=a.bMBC,o={aMsrs:t.aMsr,aDims:t.aDim,oStatus:i},l={msr:e.msr,callbacks:{},additionalDimensions:[],additionalMeasures:[],legend:{}};r[e.type].parse(e,o,l,s,n);return l};s.getContextHandler=function(e,t,i,a){if(r[e].getContextHandler){return r[e].getContextHandler(t,i,a)}else{return null}};return s});