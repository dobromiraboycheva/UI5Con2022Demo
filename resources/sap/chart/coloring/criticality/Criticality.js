/*
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/chart/coloring/criticality/measureValues/MeasureValues","sap/chart/coloring/criticality/DimensionValues","sap/chart/coloring/ColoringUtils","sap/chart/coloring/ColorPalette","sap/chart/coloring/CriticalityType","sap/chart/data/MeasureSemantics","sap/ui/thirdparty/jquery"],function(e,t,i,a,r,n,s){"use strict";var l=["DimensionValues","MeasureValues"];var o=[r.Positive,r.Neutral,r.Critical,r.Negative,"Unmentioned"];var u=[r.Positive,r.Critical,r.Negative,r.Neutral];function c(e,t){var r=[];t.forEach(function(t){e.forEach(function(e){if(e.chartLog){throw e.chartLog}var n=e.parsed.callbacks[t]||[];n.forEach(function(s,l){var o,u;if(t==="Unmentioned"){o=i.assignUnmentionedColor(a.CRITICALITY.Neutral,n.length);u=e.parsed.legend[l]}else{o=i.assignColor(a.CRITICALITY[t],n.length);var c=e.parsed.legend[t];u=Array.isArray(c)?c[l]:c}var d={callback:s,properties:{color:o[l]},displayName:u};r.push(d)})})});return r}function d(e){var t=e[0];var r=t.parsed.legend;var n=[],s=[];var l=r.segments[0].upperBound>r.min;var o=r.segments.length<2||r.segments[r.segments.length-2].upperBound<r.max;r.segments.forEach(function(e){var t=i.assignColor(a.CRITICALITY[e.CriticalityType],1)[0];n.push(t);s.push(e.upperBound)});if(l){s=[r.min].concat(s)}else{n.splice(0,1)}if(o){s[s.length-1]=r.max}else{n.splice(n.length-1,1);s.splice(s.length-1,1)}var u=n.length;if(n.length===1){n=[n[0],n[0]];u=2}else if(n.length===0){return null}return{feed:"color",palette:n,numOfSegments:u,legendValues:s}}function f(e){var t;if(e&&e.legendTitle){t={title:{text:e.legendTitle,visible:true}}}return t}function g(e,t){return function(){var i,a;if(e.bMBC){i=d(e)}else{var r=c(e,t);a={plotArea:{dataPointStyle:{rules:r}},legend:f(e)}}return{colorScale:i,properties:a}}}function p(e,t){var i=[n.Actual,n.Projected,n.Reference];var a=[r.Positive,r.Neutral,r.Critical,r.Negative];var s=[];var l=[];var o=false;e.forEach(function(e){var a=false;var r=[];e.order=[];if(e.criticalityType){o=true}i.forEach(function(i){if(e[i]){var n=t.filter(function(t){return e[i]===t.msr.getName()})[0];if(n){a=true;e.order.push(i)}else{r.push(i)}}});e.order=e.order.concat(r);if(a){s.push(e)}else{l.push(e)}});if(o){s.sort(function(e,t){return a.indexOf(e.criticalityType)-a.indexOf(t.criticalityType)})}e.splice(0,e.length);e.push.apply(e,s.concat(l))}return{getCandidateSetting:function(a,r,n,c,d,f,h){var v=a.Criticality||{},m=r.parameters||{};var y=i.dimOrMsrUse(v,m,l,"Criticality");var C={additionalMeasures:[],additionalDimensions:[]};var T=f.bMBC,M,V,b;switch(y){case"DimensionValues":var x=m.dimension||Object.keys(v.DimensionValues);if(typeof x==="string"||x instanceof String){x=[x]}M=t.qualify(v.DimensionValues,x,c,f);if(M){C.qualifiedSettings=M;M.parsed=t.parse(M,c.aDim,d,h,f);C.contextHandler=t.getContextHandler(M,h,f);C.ruleGenerator=g([M],u)}break;case"MeasureValues":var D=m.measure||Object.keys(v.MeasureValues);if(typeof D==="string"||D instanceof String){D=[D]}M=e.qualify(v.MeasureValues,n,D,c,d,f);if(M.sMethod){s.each(M,function(t,i){V=e.parse(i,c,d,f,h);s.each(V.additionalMeasures,function(e,t){C.additionalMeasures.push(t)});s.each(V.additionalDimensions,function(e,t){C.additionalDimensions.push(t)});i.parsed=V;if(i.settings.Legend&&i.settings.Legend.Title){M.legendTitle=i.settings.Legend.Title}});b=M.sMethod;C.contextHandler=e.getContextHandler(b,M,T,h);C.qualifiedSettings=M;C.ruleGenerator=g(M,o);M.bMBC=T;p(n,M)}break;default:return{}}if(M.length){C.subType=y}return C},getLegendProps:f}});